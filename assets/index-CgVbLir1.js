(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function t(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=t(i);fetch(i.href,l)}})();var Gg={exports:{}},Rp={};var Jv;function jC(){if(Jv)return Rp;Jv=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function t(s,i,l){var c=null;if(l!==void 0&&(c=""+l),i.key!==void 0&&(c=""+i.key),"key"in i){l={};for(var u in i)u!=="key"&&(l[u]=i[u])}else l=i;return i=l.ref,{$$typeof:e,type:s,key:c,ref:i!==void 0?i:null,props:l}}return Rp.Fragment=n,Rp.jsx=t,Rp.jsxs=t,Rp}var eb;function RC(){return eb||(eb=1,Gg.exports=jC()),Gg.exports}var L=RC(),Wg={exports:{}},rn={};var tb;function BC(){if(tb)return rn;tb=1;var e=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),_=Symbol.for("react.activity"),p=Symbol.iterator;function y(U){return U===null||typeof U!="object"?null:(U=p&&U[p]||U["@@iterator"],typeof U=="function"?U:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,k={};function b(U,K,H){this.props=U,this.context=K,this.refs=k,this.updater=H||v}b.prototype.isReactComponent={},b.prototype.setState=function(U,K){if(typeof U!="object"&&typeof U!="function"&&U!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,U,K,"setState")},b.prototype.forceUpdate=function(U){this.updater.enqueueForceUpdate(this,U,"forceUpdate")};function S(){}S.prototype=b.prototype;function $(U,K,H){this.props=U,this.context=K,this.refs=k,this.updater=H||v}var w=$.prototype=new S;w.constructor=$,T(w,b.prototype),w.isPureReactComponent=!0;var C=Array.isArray;function P(){}var A={H:null,A:null,T:null,S:null},I=Object.prototype.hasOwnProperty;function W(U,K,H){var B=H.ref;return{$$typeof:e,type:U,key:K,ref:B!==void 0?B:null,props:H}}function G(U,K){return W(U.type,K,U.props)}function q(U){return typeof U=="object"&&U!==null&&U.$$typeof===e}function Z(U){var K={"=":"=0",":":"=2"};return"$"+U.replace(/[=:]/g,function(H){return K[H]})}var X=/\/+/g;function Q(U,K){return typeof U=="object"&&U!==null&&U.key!=null?Z(""+U.key):K.toString(36)}function te(U){switch(U.status){case"fulfilled":return U.value;case"rejected":throw U.reason;default:switch(typeof U.status=="string"?U.then(P,P):(U.status="pending",U.then(function(K){U.status==="pending"&&(U.status="fulfilled",U.value=K)},function(K){U.status==="pending"&&(U.status="rejected",U.reason=K)})),U.status){case"fulfilled":return U.value;case"rejected":throw U.reason}}throw U}function R(U,K,H,B,ce){var ve=typeof U;(ve==="undefined"||ve==="boolean")&&(U=null);var Pe=!1;if(U===null)Pe=!0;else switch(ve){case"bigint":case"string":case"number":Pe=!0;break;case"object":switch(U.$$typeof){case e:case n:Pe=!0;break;case m:return Pe=U._init,R(Pe(U._payload),K,H,B,ce)}}if(Pe)return ce=ce(U),Pe=B===""?"."+Q(U,0):B,C(ce)?(H="",Pe!=null&&(H=Pe.replace(X,"$&/")+"/"),R(ce,K,H,"",function(Re){return Re})):ce!=null&&(q(ce)&&(ce=G(ce,H+(ce.key==null||U&&U.key===ce.key?"":(""+ce.key).replace(X,"$&/")+"/")+Pe)),K.push(ce)),1;Pe=0;var ze=B===""?".":B+":";if(C(U))for(var Ze=0;Ze<U.length;Ze++)B=U[Ze],ve=ze+Q(B,Ze),Pe+=R(B,K,H,ve,ce);else if(Ze=y(U),typeof Ze=="function")for(U=Ze.call(U),Ze=0;!(B=U.next()).done;)B=B.value,ve=ze+Q(B,Ze++),Pe+=R(B,K,H,ve,ce);else if(ve==="object"){if(typeof U.then=="function")return R(te(U),K,H,B,ce);throw K=String(U),Error("Objects are not valid as a React child (found: "+(K==="[object Object]"?"object with keys {"+Object.keys(U).join(", ")+"}":K)+"). If you meant to render a collection of children, use an array instead.")}return Pe}function ee(U,K,H){if(U==null)return U;var B=[],ce=0;return R(U,B,"","",function(ve){return K.call(H,ve,ce++)}),B}function ie(U){if(U._status===-1){var K=U._result;K=K(),K.then(function(H){(U._status===0||U._status===-1)&&(U._status=1,U._result=H)},function(H){(U._status===0||U._status===-1)&&(U._status=2,U._result=H)}),U._status===-1&&(U._status=0,U._result=K)}if(U._status===1)return U._result.default;throw U._result}var he=typeof reportError=="function"?reportError:function(U){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var K=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof U=="object"&&U!==null&&typeof U.message=="string"?String(U.message):String(U),error:U});if(!window.dispatchEvent(K))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",U);return}console.error(U)},_e={map:ee,forEach:function(U,K,H){ee(U,function(){K.apply(this,arguments)},H)},count:function(U){var K=0;return ee(U,function(){K++}),K},toArray:function(U){return ee(U,function(K){return K})||[]},only:function(U){if(!q(U))throw Error("React.Children.only expected to receive a single React element child.");return U}};return rn.Activity=_,rn.Children=_e,rn.Component=b,rn.Fragment=t,rn.Profiler=i,rn.PureComponent=$,rn.StrictMode=s,rn.Suspense=d,rn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=A,rn.__COMPILER_RUNTIME={__proto__:null,c:function(U){return A.H.useMemoCache(U)}},rn.cache=function(U){return function(){return U.apply(null,arguments)}},rn.cacheSignal=function(){return null},rn.cloneElement=function(U,K,H){if(U==null)throw Error("The argument must be a React element, but you passed "+U+".");var B=T({},U.props),ce=U.key;if(K!=null)for(ve in K.key!==void 0&&(ce=""+K.key),K)!I.call(K,ve)||ve==="key"||ve==="__self"||ve==="__source"||ve==="ref"&&K.ref===void 0||(B[ve]=K[ve]);var ve=arguments.length-2;if(ve===1)B.children=H;else if(1<ve){for(var Pe=Array(ve),ze=0;ze<ve;ze++)Pe[ze]=arguments[ze+2];B.children=Pe}return W(U.type,ce,B)},rn.createContext=function(U){return U={$$typeof:c,_currentValue:U,_currentValue2:U,_threadCount:0,Provider:null,Consumer:null},U.Provider=U,U.Consumer={$$typeof:l,_context:U},U},rn.createElement=function(U,K,H){var B,ce={},ve=null;if(K!=null)for(B in K.key!==void 0&&(ve=""+K.key),K)I.call(K,B)&&B!=="key"&&B!=="__self"&&B!=="__source"&&(ce[B]=K[B]);var Pe=arguments.length-2;if(Pe===1)ce.children=H;else if(1<Pe){for(var ze=Array(Pe),Ze=0;Ze<Pe;Ze++)ze[Ze]=arguments[Ze+2];ce.children=ze}if(U&&U.defaultProps)for(B in Pe=U.defaultProps,Pe)ce[B]===void 0&&(ce[B]=Pe[B]);return W(U,ve,ce)},rn.createRef=function(){return{current:null}},rn.forwardRef=function(U){return{$$typeof:u,render:U}},rn.isValidElement=q,rn.lazy=function(U){return{$$typeof:m,_payload:{_status:-1,_result:U},_init:ie}},rn.memo=function(U,K){return{$$typeof:f,type:U,compare:K===void 0?null:K}},rn.startTransition=function(U){var K=A.T,H={};A.T=H;try{var B=U(),ce=A.S;ce!==null&&ce(H,B),typeof B=="object"&&B!==null&&typeof B.then=="function"&&B.then(P,he)}catch(ve){he(ve)}finally{K!==null&&H.types!==null&&(K.types=H.types),A.T=K}},rn.unstable_useCacheRefresh=function(){return A.H.useCacheRefresh()},rn.use=function(U){return A.H.use(U)},rn.useActionState=function(U,K,H){return A.H.useActionState(U,K,H)},rn.useCallback=function(U,K){return A.H.useCallback(U,K)},rn.useContext=function(U){return A.H.useContext(U)},rn.useDebugValue=function(){},rn.useDeferredValue=function(U,K){return A.H.useDeferredValue(U,K)},rn.useEffect=function(U,K){return A.H.useEffect(U,K)},rn.useEffectEvent=function(U){return A.H.useEffectEvent(U)},rn.useId=function(){return A.H.useId()},rn.useImperativeHandle=function(U,K,H){return A.H.useImperativeHandle(U,K,H)},rn.useInsertionEffect=function(U,K){return A.H.useInsertionEffect(U,K)},rn.useLayoutEffect=function(U,K){return A.H.useLayoutEffect(U,K)},rn.useMemo=function(U,K){return A.H.useMemo(U,K)},rn.useOptimistic=function(U,K){return A.H.useOptimistic(U,K)},rn.useReducer=function(U,K,H){return A.H.useReducer(U,K,H)},rn.useRef=function(U){return A.H.useRef(U)},rn.useState=function(U){return A.H.useState(U)},rn.useSyncExternalStore=function(U,K,H){return A.H.useSyncExternalStore(U,K,H)},rn.useTransition=function(){return A.H.useTransition()},rn.version="19.2.4",rn}var nb;function R0(){return nb||(nb=1,Wg.exports=BC()),Wg.exports}var Me=R0(),Hg={exports:{}},Bp={},qg={exports:{}},Kg={};var ab;function UC(){return ab||(ab=1,(function(e){function n(R,ee){var ie=R.length;R.push(ee);e:for(;0<ie;){var he=ie-1>>>1,_e=R[he];if(0<i(_e,ee))R[he]=ee,R[ie]=_e,ie=he;else break e}}function t(R){return R.length===0?null:R[0]}function s(R){if(R.length===0)return null;var ee=R[0],ie=R.pop();if(ie!==ee){R[0]=ie;e:for(var he=0,_e=R.length,U=_e>>>1;he<U;){var K=2*(he+1)-1,H=R[K],B=K+1,ce=R[B];if(0>i(H,ie))B<_e&&0>i(ce,H)?(R[he]=ce,R[B]=ie,he=B):(R[he]=H,R[K]=ie,he=K);else if(B<_e&&0>i(ce,ie))R[he]=ce,R[B]=ie,he=B;else break e}}return ee}function i(R,ee){var ie=R.sortIndex-ee.sortIndex;return ie!==0?ie:R.id-ee.id}if(e.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var c=Date,u=c.now();e.unstable_now=function(){return c.now()-u}}var d=[],f=[],m=1,_=null,p=3,y=!1,v=!1,T=!1,k=!1,b=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,$=typeof setImmediate<"u"?setImmediate:null;function w(R){for(var ee=t(f);ee!==null;){if(ee.callback===null)s(f);else if(ee.startTime<=R)s(f),ee.sortIndex=ee.expirationTime,n(d,ee);else break;ee=t(f)}}function C(R){if(T=!1,w(R),!v)if(t(d)!==null)v=!0,P||(P=!0,Z());else{var ee=t(f);ee!==null&&te(C,ee.startTime-R)}}var P=!1,A=-1,I=5,W=-1;function G(){return k?!0:!(e.unstable_now()-W<I)}function q(){if(k=!1,P){var R=e.unstable_now();W=R;var ee=!0;try{e:{v=!1,T&&(T=!1,S(A),A=-1),y=!0;var ie=p;try{t:{for(w(R),_=t(d);_!==null&&!(_.expirationTime>R&&G());){var he=_.callback;if(typeof he=="function"){_.callback=null,p=_.priorityLevel;var _e=he(_.expirationTime<=R);if(R=e.unstable_now(),typeof _e=="function"){_.callback=_e,w(R),ee=!0;break t}_===t(d)&&s(d),w(R)}else s(d);_=t(d)}if(_!==null)ee=!0;else{var U=t(f);U!==null&&te(C,U.startTime-R),ee=!1}}break e}finally{_=null,p=ie,y=!1}ee=void 0}}finally{ee?Z():P=!1}}}var Z;if(typeof $=="function")Z=function(){$(q)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,Q=X.port2;X.port1.onmessage=q,Z=function(){Q.postMessage(null)}}else Z=function(){b(q,0)};function te(R,ee){A=b(function(){R(e.unstable_now())},ee)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(R){R.callback=null},e.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<R?Math.floor(1e3/R):5},e.unstable_getCurrentPriorityLevel=function(){return p},e.unstable_next=function(R){switch(p){case 1:case 2:case 3:var ee=3;break;default:ee=p}var ie=p;p=ee;try{return R()}finally{p=ie}},e.unstable_requestPaint=function(){k=!0},e.unstable_runWithPriority=function(R,ee){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var ie=p;p=R;try{return ee()}finally{p=ie}},e.unstable_scheduleCallback=function(R,ee,ie){var he=e.unstable_now();switch(typeof ie=="object"&&ie!==null?(ie=ie.delay,ie=typeof ie=="number"&&0<ie?he+ie:he):ie=he,R){case 1:var _e=-1;break;case 2:_e=250;break;case 5:_e=1073741823;break;case 4:_e=1e4;break;default:_e=5e3}return _e=ie+_e,R={id:m++,callback:ee,priorityLevel:R,startTime:ie,expirationTime:_e,sortIndex:-1},ie>he?(R.sortIndex=ie,n(f,R),t(d)===null&&R===t(f)&&(T?(S(A),A=-1):T=!0,te(C,ie-he))):(R.sortIndex=_e,n(d,R),v||y||(v=!0,P||(P=!0,Z()))),R},e.unstable_shouldYield=G,e.unstable_wrapCallback=function(R){var ee=p;return function(){var ie=p;p=ee;try{return R.apply(this,arguments)}finally{p=ie}}}})(Kg)),Kg}var sb;function VC(){return sb||(sb=1,qg.exports=UC()),qg.exports}var Qg={exports:{}},Cs={};var rb;function GC(){if(rb)return Cs;rb=1;var e=R0();function n(d){var f="https://react.dev/errors/"+d;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)f+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+d+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var s={d:{f:t,r:function(){throw Error(n(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function l(d,f,m){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:_==null?null:""+_,children:d,containerInfo:f,implementation:m}}var c=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function u(d,f){if(d==="font")return"";if(typeof f=="string")return f==="use-credentials"?f:""}return Cs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=s,Cs.createPortal=function(d,f){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)throw Error(n(299));return l(d,f,null,m)},Cs.flushSync=function(d){var f=c.T,m=s.p;try{if(c.T=null,s.p=2,d)return d()}finally{c.T=f,s.p=m,s.d.f()}},Cs.preconnect=function(d,f){typeof d=="string"&&(f?(f=f.crossOrigin,f=typeof f=="string"?f==="use-credentials"?f:"":void 0):f=null,s.d.C(d,f))},Cs.prefetchDNS=function(d){typeof d=="string"&&s.d.D(d)},Cs.preinit=function(d,f){if(typeof d=="string"&&f&&typeof f.as=="string"){var m=f.as,_=u(m,f.crossOrigin),p=typeof f.integrity=="string"?f.integrity:void 0,y=typeof f.fetchPriority=="string"?f.fetchPriority:void 0;m==="style"?s.d.S(d,typeof f.precedence=="string"?f.precedence:void 0,{crossOrigin:_,integrity:p,fetchPriority:y}):m==="script"&&s.d.X(d,{crossOrigin:_,integrity:p,fetchPriority:y,nonce:typeof f.nonce=="string"?f.nonce:void 0})}},Cs.preinitModule=function(d,f){if(typeof d=="string")if(typeof f=="object"&&f!==null){if(f.as==null||f.as==="script"){var m=u(f.as,f.crossOrigin);s.d.M(d,{crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0})}}else f==null&&s.d.M(d)},Cs.preload=function(d,f){if(typeof d=="string"&&typeof f=="object"&&f!==null&&typeof f.as=="string"){var m=f.as,_=u(m,f.crossOrigin);s.d.L(d,m,{crossOrigin:_,integrity:typeof f.integrity=="string"?f.integrity:void 0,nonce:typeof f.nonce=="string"?f.nonce:void 0,type:typeof f.type=="string"?f.type:void 0,fetchPriority:typeof f.fetchPriority=="string"?f.fetchPriority:void 0,referrerPolicy:typeof f.referrerPolicy=="string"?f.referrerPolicy:void 0,imageSrcSet:typeof f.imageSrcSet=="string"?f.imageSrcSet:void 0,imageSizes:typeof f.imageSizes=="string"?f.imageSizes:void 0,media:typeof f.media=="string"?f.media:void 0})}},Cs.preloadModule=function(d,f){if(typeof d=="string")if(f){var m=u(f.as,f.crossOrigin);s.d.m(d,{as:typeof f.as=="string"&&f.as!=="script"?f.as:void 0,crossOrigin:m,integrity:typeof f.integrity=="string"?f.integrity:void 0})}else s.d.m(d)},Cs.requestFormReset=function(d){s.d.r(d)},Cs.unstable_batchedUpdates=function(d,f){return d(f)},Cs.useFormState=function(d,f,m){return c.H.useFormState(d,f,m)},Cs.useFormStatus=function(){return c.H.useHostTransitionStatus()},Cs.version="19.2.4",Cs}var ib;function WC(){if(ib)return Qg.exports;ib=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),Qg.exports=GC(),Qg.exports}var ob;function HC(){if(ob)return Bp;ob=1;var e=VC(),n=R0(),t=WC();function s(a){var r="https://react.dev/errors/"+a;if(1<arguments.length){r+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)r+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+a+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(a){return!(!a||a.nodeType!==1&&a.nodeType!==9&&a.nodeType!==11)}function l(a){var r=a,o=a;if(a.alternate)for(;r.return;)r=r.return;else{a=r;do r=a,(r.flags&4098)!==0&&(o=r.return),a=r.return;while(a)}return r.tag===3?o:null}function c(a){if(a.tag===13){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function u(a){if(a.tag===31){var r=a.memoizedState;if(r===null&&(a=a.alternate,a!==null&&(r=a.memoizedState)),r!==null)return r.dehydrated}return null}function d(a){if(l(a)!==a)throw Error(s(188))}function f(a){var r=a.alternate;if(!r){if(r=l(a),r===null)throw Error(s(188));return r!==a?null:a}for(var o=a,h=r;;){var g=o.return;if(g===null)break;var x=g.alternate;if(x===null){if(h=g.return,h!==null){o=h;continue}break}if(g.child===x.child){for(x=g.child;x;){if(x===o)return d(g),a;if(x===h)return d(g),r;x=x.sibling}throw Error(s(188))}if(o.return!==h.return)o=g,h=x;else{for(var j=!1,ae=g.child;ae;){if(ae===o){j=!0,o=g,h=x;break}if(ae===h){j=!0,h=g,o=x;break}ae=ae.sibling}if(!j){for(ae=x.child;ae;){if(ae===o){j=!0,o=x,h=g;break}if(ae===h){j=!0,h=x,o=g;break}ae=ae.sibling}if(!j)throw Error(s(189))}}if(o.alternate!==h)throw Error(s(190))}if(o.tag!==3)throw Error(s(188));return o.stateNode.current===o?a:r}function m(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a;for(a=a.child;a!==null;){if(r=m(a),r!==null)return r;a=a.sibling}return null}var _=Object.assign,p=Symbol.for("react.element"),y=Symbol.for("react.transitional.element"),v=Symbol.for("react.portal"),T=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),b=Symbol.for("react.profiler"),S=Symbol.for("react.consumer"),$=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),A=Symbol.for("react.memo"),I=Symbol.for("react.lazy"),W=Symbol.for("react.activity"),G=Symbol.for("react.memo_cache_sentinel"),q=Symbol.iterator;function Z(a){return a===null||typeof a!="object"?null:(a=q&&a[q]||a["@@iterator"],typeof a=="function"?a:null)}var X=Symbol.for("react.client.reference");function Q(a){if(a==null)return null;if(typeof a=="function")return a.$$typeof===X?null:a.displayName||a.name||null;if(typeof a=="string")return a;switch(a){case T:return"Fragment";case b:return"Profiler";case k:return"StrictMode";case C:return"Suspense";case P:return"SuspenseList";case W:return"Activity"}if(typeof a=="object")switch(a.$$typeof){case v:return"Portal";case $:return a.displayName||"Context";case S:return(a._context.displayName||"Context")+".Consumer";case w:var r=a.render;return a=a.displayName,a||(a=r.displayName||r.name||"",a=a!==""?"ForwardRef("+a+")":"ForwardRef"),a;case A:return r=a.displayName||null,r!==null?r:Q(a.type)||"Memo";case I:r=a._payload,a=a._init;try{return Q(a(r))}catch{}}return null}var te=Array.isArray,R=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ee=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ie={pending:!1,data:null,method:null,action:null},he=[],_e=-1;function U(a){return{current:a}}function K(a){0>_e||(a.current=he[_e],he[_e]=null,_e--)}function H(a,r){_e++,he[_e]=a.current,a.current=r}var B=U(null),ce=U(null),ve=U(null),Pe=U(null);function ze(a,r){switch(H(ve,r),H(ce,a),H(B,null),r.nodeType){case 9:case 11:a=(a=r.documentElement)&&(a=a.namespaceURI)?Yt(a):0;break;default:if(a=r.tagName,r=r.namespaceURI)r=Yt(r),a=Dt(r,a);else switch(a){case"svg":a=1;break;case"math":a=2;break;default:a=0}}K(B),H(B,a)}function Ze(){K(B),K(ce),K(ve)}function Re(a){a.memoizedState!==null&&H(Pe,a);var r=B.current,o=Dt(r,a.type);r!==o&&(H(ce,a),H(B,o))}function de(a){ce.current===a&&(K(B),K(ce)),Pe.current===a&&(K(Pe),Lp._currentValue=ie)}var J,Ce;function Fe(a){if(J===void 0)try{throw Error()}catch(o){var r=o.stack.trim().match(/\n( *(at )?)/);J=r&&r[1]||"",Ce=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+J+a+Ce}var Be=!1;function Ue(a,r){if(!a||Be)return"";Be=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var h={DetermineComponentFrameRoot:function(){try{if(r){var tt=function(){throw Error()};if(Object.defineProperty(tt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(tt,[])}catch(Ve){var Le=Ve}Reflect.construct(a,[],tt)}else{try{tt.call()}catch(Ve){Le=Ve}a.call(tt.prototype)}}else{try{throw Error()}catch(Ve){Le=Ve}(tt=a())&&typeof tt.catch=="function"&&tt.catch(function(){})}}catch(Ve){if(Ve&&Le&&typeof Ve.stack=="string")return[Ve.stack,Le.stack]}return[null,null]}};h.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(h.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(h.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=h.DetermineComponentFrameRoot(),j=x[0],ae=x[1];if(j&&ae){var ye=j.split(`
`),Oe=ae.split(`
`);for(g=h=0;h<ye.length&&!ye[h].includes("DetermineComponentFrameRoot");)h++;for(;g<Oe.length&&!Oe[g].includes("DetermineComponentFrameRoot");)g++;if(h===ye.length||g===Oe.length)for(h=ye.length-1,g=Oe.length-1;1<=h&&0<=g&&ye[h]!==Oe[g];)g--;for(;1<=h&&0<=g;h--,g--)if(ye[h]!==Oe[g]){if(h!==1||g!==1)do if(h--,g--,0>g||ye[h]!==Oe[g]){var Xe=`
`+ye[h].replace(" at new "," at ");return a.displayName&&Xe.includes("<anonymous>")&&(Xe=Xe.replace("<anonymous>",a.displayName)),Xe}while(1<=h&&0<=g);break}}}finally{Be=!1,Error.prepareStackTrace=o}return(o=a?a.displayName||a.name:"")?Fe(o):""}function He(a,r){switch(a.tag){case 26:case 27:case 5:return Fe(a.type);case 16:return Fe("Lazy");case 13:return a.child!==r&&r!==null?Fe("Suspense Fallback"):Fe("Suspense");case 19:return Fe("SuspenseList");case 0:case 15:return Ue(a.type,!1);case 11:return Ue(a.type.render,!1);case 1:return Ue(a.type,!0);case 31:return Fe("Activity");default:return""}}function De(a){try{var r="",o=null;do r+=He(a,o),o=a,a=a.return;while(a);return r}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}var nt=Object.prototype.hasOwnProperty,ke=e.unstable_scheduleCallback,Ge=e.unstable_cancelCallback,dt=e.unstable_shouldYield,Ye=e.unstable_requestPaint,mt=e.unstable_now,it=e.unstable_getCurrentPriorityLevel,Mt=e.unstable_ImmediatePriority,wt=e.unstable_UserBlockingPriority,ot=e.unstable_NormalPriority,Je=e.unstable_LowPriority,St=e.unstable_IdlePriority,Lt=e.log,wn=e.unstable_setDisableYieldValue,Ht=null,Mn=null;function fa(a){if(typeof Lt=="function"&&wn(a),Mn&&typeof Mn.setStrictMode=="function")try{Mn.setStrictMode(Ht,a)}catch{}}var Jt=Math.clz32?Math.clz32:Mi,ss=Math.log,wi=Math.LN2;function Mi(a){return a>>>=0,a===0?32:31-(ss(a)/wi|0)|0}var Xs=256,Wn=262144,wa=4194304;function Ra(a){var r=a&42;if(r!==0)return r;switch(a&-a){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return a&261888;case 262144:case 524288:case 1048576:case 2097152:return a&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return a&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return a}}function Bs(a,r,o){var h=a.pendingLanes;if(h===0)return 0;var g=0,x=a.suspendedLanes,j=a.pingedLanes;a=a.warmLanes;var ae=h&134217727;return ae!==0?(h=ae&~x,h!==0?g=Ra(h):(j&=ae,j!==0?g=Ra(j):o||(o=ae&~a,o!==0&&(g=Ra(o))))):(ae=h&~x,ae!==0?g=Ra(ae):j!==0?g=Ra(j):o||(o=h&~a,o!==0&&(g=Ra(o)))),g===0?0:r!==0&&r!==g&&(r&x)===0&&(x=g&-g,o=r&-r,x>=o||x===32&&(o&4194048)!==0)?r:g}function Ft(a,r){return(a.pendingLanes&~(a.suspendedLanes&~a.pingedLanes)&r)===0}function Fn(a,r){switch(a){case 1:case 2:case 4:case 8:case 64:return r+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ys(){var a=wa;return wa<<=1,(wa&62914560)===0&&(wa=4194304),a}function Us(a){for(var r=[],o=0;31>o;o++)r.push(a);return r}function Ua(a,r){a.pendingLanes|=r,r!==268435456&&(a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0)}function qt(a,r,o,h,g,x){var j=a.pendingLanes;a.pendingLanes=o,a.suspendedLanes=0,a.pingedLanes=0,a.warmLanes=0,a.expiredLanes&=o,a.entangledLanes&=o,a.errorRecoveryDisabledLanes&=o,a.shellSuspendCounter=0;var ae=a.entanglements,ye=a.expirationTimes,Oe=a.hiddenUpdates;for(o=j&~o;0<o;){var Xe=31-Jt(o),tt=1<<Xe;ae[Xe]=0,ye[Xe]=-1;var Le=Oe[Xe];if(Le!==null)for(Oe[Xe]=null,Xe=0;Xe<Le.length;Xe++){var Ve=Le[Xe];Ve!==null&&(Ve.lane&=-536870913)}o&=~tt}h!==0&&Zs(a,h,0),x!==0&&g===0&&a.tag!==0&&(a.suspendedLanes|=x&~(j&~r))}function Zs(a,r,o){a.pendingLanes|=r,a.suspendedLanes&=~r;var h=31-Jt(r);a.entangledLanes|=r,a.entanglements[h]=a.entanglements[h]|1073741824|o&261930}function F(a,r){var o=a.entangledLanes|=r;for(a=a.entanglements;o;){var h=31-Jt(o),g=1<<h;g&r|a[h]&r&&(a[h]|=r),o&=~g}}function ue(a,r){var o=r&-r;return o=(o&42)!==0?1:ne(o),(o&(a.suspendedLanes|r))!==0?0:o}function ne(a){switch(a){case 2:a=1;break;case 8:a=4;break;case 32:a=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:a=128;break;case 268435456:a=134217728;break;default:a=0}return a}function le(a){return a&=-a,2<a?8<a?(a&134217727)!==0?32:268435456:8:2}function fe(){var a=ee.p;return a!==0?a:(a=window.event,a===void 0?32:Hv(a.type))}function xe(a,r){var o=ee.p;try{return ee.p=a,r()}finally{ee.p=o}}var Ne=Math.random().toString(36).slice(2),ut="__reactFiber$"+Ne,xt="__reactProps$"+Ne,ht="__reactContainer$"+Ne,Rt="__reactEvents$"+Ne,_t="__reactListeners$"+Ne,Zt="__reactHandles$"+Ne,nn="__reactResources$"+Ne,sa="__reactMarker$"+Ne;function ra(a){delete a[ut],delete a[xt],delete a[Rt],delete a[_t],delete a[Zt]}function Nn(a){var r=a[ut];if(r)return r;for(var o=a.parentNode;o;){if(r=o[ht]||o[ut]){if(o=r.alternate,r.child!==null||o!==null&&o.child!==null)for(a=za(a);a!==null;){if(o=a[ut])return o;a=za(a)}return r}a=o,o=a.parentNode}return null}function ia(a){if(a=a[ut]||a[ht]){var r=a.tag;if(r===5||r===6||r===13||r===31||r===26||r===27||r===3)return a}return null}function gs(a){var r=a.tag;if(r===5||r===26||r===27||r===6)return a.stateNode;throw Error(s(33))}function Ma(a){var r=a[nn];return r||(r=a[nn]={hoistableStyles:new Map,hoistableScripts:new Map}),r}function Hn(a){a[sa]=!0}var Va=new Set,Ga={};function Wa(a,r){Zn(a,r),Zn(a+"Capture",r)}function Zn(a,r){for(Ga[a]=r,a=0;a<r.length;a++)Va.add(r[a])}var ha=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),us={},ks={};function Vr(a){return nt.call(ks,a)?!0:nt.call(us,a)?!1:ha.test(a)?ks[a]=!0:(us[a]=!0,!1)}function $s(a,r,o){if(Vr(r))if(o===null)a.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":a.removeAttribute(r);return;case"boolean":var h=r.toLowerCase().slice(0,5);if(h!=="data-"&&h!=="aria-"){a.removeAttribute(r);return}}a.setAttribute(r,""+o)}}function Ds(a,r,o){if(o===null)a.removeAttribute(r);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(r);return}a.setAttribute(r,""+o)}}function Ha(a,r,o,h){if(h===null)a.removeAttribute(o);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":a.removeAttribute(o);return}a.setAttributeNS(r,o,""+h)}}function _a(a){switch(typeof a){case"bigint":case"boolean":case"number":case"string":case"undefined":return a;case"object":return a;default:return""}}function Ya(a){var r=a.type;return(a=a.nodeName)&&a.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function st(a,r,o){var h=Object.getOwnPropertyDescriptor(a.constructor.prototype,r);if(!a.hasOwnProperty(r)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var g=h.get,x=h.set;return Object.defineProperty(a,r,{configurable:!0,get:function(){return g.call(this)},set:function(j){o=""+j,x.call(this,j)}}),Object.defineProperty(a,r,{enumerable:h.enumerable}),{getValue:function(){return o},setValue:function(j){o=""+j},stopTracking:function(){a._valueTracker=null,delete a[r]}}}}function lt(a){if(!a._valueTracker){var r=Ya(a)?"checked":"value";a._valueTracker=st(a,r,""+a[r])}}function Et(a){if(!a)return!1;var r=a._valueTracker;if(!r)return!0;var o=r.getValue(),h="";return a&&(h=Ya(a)?a.checked?"true":"false":a.value),a=h,a!==o?(r.setValue(a),!0):!1}function xn(a){if(a=a||(typeof document<"u"?document:void 0),typeof a>"u")return null;try{return a.activeElement||a.body}catch{return a.body}}var Gr=/[\n"\\]/g;function Ca(a){return a.replace(Gr,function(r){return"\\"+r.charCodeAt(0).toString(16)+" "})}function Js(a,r,o,h,g,x,j,ae){a.name="",j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?a.type=j:a.removeAttribute("type"),r!=null?j==="number"?(r===0&&a.value===""||a.value!=r)&&(a.value=""+_a(r)):a.value!==""+_a(r)&&(a.value=""+_a(r)):j!=="submit"&&j!=="reset"||a.removeAttribute("value"),r!=null?Te(a,j,_a(r)):o!=null?Te(a,j,_a(o)):h!=null&&a.removeAttribute("value"),g==null&&x!=null&&(a.defaultChecked=!!x),g!=null&&(a.checked=g&&typeof g!="function"&&typeof g!="symbol"),ae!=null&&typeof ae!="function"&&typeof ae!="symbol"&&typeof ae!="boolean"?a.name=""+_a(ae):a.removeAttribute("name")}function ao(a,r,o,h,g,x,j,ae){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(a.type=x),r!=null||o!=null){if(!(x!=="submit"&&x!=="reset"||r!=null)){lt(a);return}o=o!=null?""+_a(o):"",r=r!=null?""+_a(r):o,ae||r===a.value||(a.value=r),a.defaultValue=r}h=h??g,h=typeof h!="function"&&typeof h!="symbol"&&!!h,a.checked=ae?a.checked:!!h,a.defaultChecked=!!h,j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(a.name=j),lt(a)}function Te(a,r,o){r==="number"&&xn(a.ownerDocument)===a||a.defaultValue===""+o||(a.defaultValue=""+o)}function N(a,r,o,h){if(a=a.options,r){r={};for(var g=0;g<o.length;g++)r["$"+o[g]]=!0;for(o=0;o<a.length;o++)g=r.hasOwnProperty("$"+a[o].value),a[o].selected!==g&&(a[o].selected=g),g&&h&&(a[o].defaultSelected=!0)}else{for(o=""+_a(o),r=null,g=0;g<a.length;g++){if(a[g].value===o){a[g].selected=!0,h&&(a[g].defaultSelected=!0);return}r!==null||a[g].disabled||(r=a[g])}r!==null&&(r.selected=!0)}}function oe(a,r,o){if(r!=null&&(r=""+_a(r),r!==a.value&&(a.value=r),o==null)){a.defaultValue!==r&&(a.defaultValue=r);return}a.defaultValue=o!=null?""+_a(o):""}function pe(a,r,o,h){if(r==null){if(h!=null){if(o!=null)throw Error(s(92));if(te(h)){if(1<h.length)throw Error(s(93));h=h[0]}o=h}o==null&&(o=""),r=o}o=_a(r),a.defaultValue=o,h=a.textContent,h===o&&h!==""&&h!==null&&(a.value=h),lt(a)}function me(a,r){if(r){var o=a.firstChild;if(o&&o===a.lastChild&&o.nodeType===3){o.nodeValue=r;return}}a.textContent=r}var Ie=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function qe(a,r,o){var h=r.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?h?a.setProperty(r,""):r==="float"?a.cssFloat="":a[r]="":h?a.setProperty(r,o):typeof o!="number"||o===0||Ie.has(r)?r==="float"?a.cssFloat=o:a[r]=(""+o).trim():a[r]=o+"px"}function vt(a,r,o){if(r!=null&&typeof r!="object")throw Error(s(62));if(a=a.style,o!=null){for(var h in o)!o.hasOwnProperty(h)||r!=null&&r.hasOwnProperty(h)||(h.indexOf("--")===0?a.setProperty(h,""):h==="float"?a.cssFloat="":a[h]="");for(var g in r)h=r[g],r.hasOwnProperty(g)&&o[g]!==h&&qe(a,g,h)}else for(var x in r)r.hasOwnProperty(x)&&qe(a,x,r[x])}function gt(a){if(a.indexOf("-")===-1)return!1;switch(a){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bt=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),pt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Xt(a){return pt.test(""+a)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":a}function jt(){}var qn=null;function ga(a){return a=a.target||a.srcElement||window,a.correspondingUseElement&&(a=a.correspondingUseElement),a.nodeType===3?a.parentNode:a}var Tn=null,Dn=null;function An(a){var r=ia(a);if(r&&(a=r.stateNode)){var o=a[xt]||null;e:switch(a=r.stateNode,r.type){case"input":if(Js(a,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),r=o.name,o.type==="radio"&&r!=null){for(o=a;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Ca(""+r)+'"][type="radio"]'),r=0;r<o.length;r++){var h=o[r];if(h!==a&&h.form===a.form){var g=h[xt]||null;if(!g)throw Error(s(90));Js(h,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(r=0;r<o.length;r++)h=o[r],h.form===a.form&&Et(h)}break e;case"textarea":oe(a,o.value,o.defaultValue);break e;case"select":r=o.value,r!=null&&N(a,!!o.multiple,r,!1)}}}var rs=!1;function Os(a,r,o){if(rs)return a(r,o);rs=!0;try{var h=a(r);return h}finally{if(rs=!1,(Tn!==null||Dn!==null)&&(su(),Tn&&(r=Tn,a=Dn,Dn=Tn=null,An(r),a)))for(r=0;r<a.length;r++)An(a[r])}}function pa(a,r){var o=a.stateNode;if(o===null)return null;var h=o[xt]||null;if(h===null)return null;o=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(a=a.type,h=!(a==="button"||a==="input"||a==="select"||a==="textarea")),a=!h;break e;default:a=!1}if(a)return null;if(o&&typeof o!="function")throw Error(s(231,r,typeof o));return o}var Ba=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Vn=!1;if(Ba)try{var Jn={};Object.defineProperty(Jn,"passive",{get:function(){Vn=!0}}),window.addEventListener("test",Jn,Jn),window.removeEventListener("test",Jn,Jn)}catch{Vn=!1}var ea=null,ds=null,ys=null;function xa(){if(ys)return ys;var a,r=ds,o=r.length,h,g="value"in ea?ea.value:ea.textContent,x=g.length;for(a=0;a<o&&r[a]===g[a];a++);var j=o-a;for(h=1;h<=j&&r[o-h]===g[x-h];h++);return ys=g.slice(a,1<h?1-h:void 0)}function fs(a){var r=a.keyCode;return"charCode"in a?(a=a.charCode,a===0&&r===13&&(a=13)):a=r,a===10&&(a=13),32<=a||a===13?a:0}function ma(){return!0}function Kn(){return!1}function gn(a){function r(o,h,g,x,j){this._reactName=o,this._targetInst=g,this.type=h,this.nativeEvent=x,this.target=j,this.currentTarget=null;for(var ae in a)a.hasOwnProperty(ae)&&(o=a[ae],this[ae]=o?o(x):x[ae]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?ma:Kn,this.isPropagationStopped=Kn,this}return _(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=ma)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=ma)},persist:function(){},isPersistent:ma}),r}var On={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(a){return a.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qa=gn(On),Vs=_({},On,{view:0,detail:0}),br=gn(Vs),so,tl,xi,ro=_({},Vs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:io,button:0,buttons:0,relatedTarget:function(a){return a.relatedTarget===void 0?a.fromElement===a.srcElement?a.toElement:a.fromElement:a.relatedTarget},movementX:function(a){return"movementX"in a?a.movementX:(a!==xi&&(xi&&a.type==="mousemove"?(so=a.screenX-xi.screenX,tl=a.screenY-xi.screenY):tl=so=0,xi=a),so)},movementY:function(a){return"movementY"in a?a.movementY:tl}}),dc=gn(ro),Ti=_({},ro,{dataTransfer:0}),Du=gn(Ti),Ou=_({},Vs,{relatedTarget:0}),nl=gn(Ou),Iu=_({},On,{animationName:0,elapsedTime:0,pseudoElement:0}),zu=gn(Iu),Ei=_({},On,{clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),Lu=gn(Ei),fc=_({},On,{data:0}),al=gn(fc),hc={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Fu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mc(a){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(a):(a=pc[a])?!!r[a]:!1}function io(){return mc}var Wr=_({},Vs,{key:function(a){if(a.key){var r=hc[a.key]||a.key;if(r!=="Unidentified")return r}return a.type==="keypress"?(a=fs(a),a===13?"Enter":String.fromCharCode(a)):a.type==="keydown"||a.type==="keyup"?Fu[a.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:io,charCode:function(a){return a.type==="keypress"?fs(a):0},keyCode:function(a){return a.type==="keydown"||a.type==="keyup"?a.keyCode:0},which:function(a){return a.type==="keypress"?fs(a):a.type==="keydown"||a.type==="keyup"?a.keyCode:0}}),Nu=gn(Wr),sl=_({},ro,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_c=gn(sl),gc=_({},Vs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:io}),Sf=gn(gc),rl=_({},On,{propertyName:0,elapsedTime:0,pseudoElement:0}),il=gn(rl),yc=_({},ro,{deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?-a.wheelDelta:0},deltaZ:0,deltaMode:0}),ol=gn(yc),ju=_({},On,{newState:0,oldState:0}),Ru=gn(ju),Bu=[9,13,27,32],ll=Ba&&"CompositionEvent"in window,Si=null;Ba&&"documentMode"in document&&(Si=document.documentMode);var Uu=Ba&&"TextEvent"in window&&!Si,cl=Ba&&(!ll||Si&&8<Si&&11>=Si),Ci=" ",Hr=!1;function oo(a,r){switch(a){case"keyup":return Bu.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function vc(a){return a=a.detail,typeof a=="object"&&"data"in a?a.data:null}var er=!1;function lo(a,r){switch(a){case"compositionend":return vc(r);case"keypress":return r.which!==32?null:(Hr=!0,Ci);case"textInput":return a=r.data,a===Ci&&Hr?null:a;default:return null}}function ul(a,r){if(er)return a==="compositionend"||!ll&&oo(a,r)?(a=xa(),ys=ds=ea=null,er=!1,a):null;switch(a){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return cl&&r.locale!=="ko"?null:r.data;default:return null}}var dl={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tr(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r==="input"?!!dl[a.type]:r==="textarea"}function fl(a,r,o,h){Tn?Dn?Dn.push(h):Dn=[h]:Tn=h,r=hr(r,"onChange"),0<r.length&&(o=new qa("onChange","change",null,o,h),a.push({event:o,listeners:r}))}var Ai=null,qr=null;function Vu(a){a_(a,0)}function co(a){var r=gs(a);if(Et(r))return a}function uo(a,r){if(a==="change")return r}var hl=!1;if(Ba){var Kr;if(Ba){var Pt="oninput"in document;if(!Pt){var bc=document.createElement("div");bc.setAttribute("oninput","return;"),Pt=typeof bc.oninput=="function"}Kr=Pt}else Kr=!1;hl=Kr&&(!document.documentMode||9<document.documentMode)}function pl(){Ai&&(Ai.detachEvent("onpropertychange",Pi),qr=Ai=null)}function Pi(a){if(a.propertyName==="value"&&co(qr)){var r=[];fl(r,qr,a,ga(a)),Os(Vu,r)}}function fo(a,r,o){a==="focusin"?(pl(),Ai=r,qr=o,Ai.attachEvent("onpropertychange",Pi)):a==="focusout"&&pl()}function Is(a){if(a==="selectionchange"||a==="keyup"||a==="keydown")return co(qr)}function ho(a,r){if(a==="click")return co(r)}function po(a,r){if(a==="input"||a==="change")return co(r)}function wc(a,r){return a===r&&(a!==0||1/a===1/r)||a!==a&&r!==r}var Za=typeof Object.is=="function"?Object.is:wc;function wr(a,r){if(Za(a,r))return!0;if(typeof a!="object"||a===null||typeof r!="object"||r===null)return!1;var o=Object.keys(a),h=Object.keys(r);if(o.length!==h.length)return!1;for(h=0;h<o.length;h++){var g=o[h];if(!nt.call(r,g)||!Za(a[g],r[g]))return!1}return!0}function mo(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ml(a,r){var o=mo(a);a=0;for(var h;o;){if(o.nodeType===3){if(h=a+o.textContent.length,a<=r&&h>=r)return{node:o,offset:r-a};a=h}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=mo(o)}}function _o(a,r){return a&&r?a===r?!0:a&&a.nodeType===3?!1:r&&r.nodeType===3?_o(a,r.parentNode):"contains"in a?a.contains(r):a.compareDocumentPosition?!!(a.compareDocumentPosition(r)&16):!1:!1}function _l(a){a=a!=null&&a.ownerDocument!=null&&a.ownerDocument.defaultView!=null?a.ownerDocument.defaultView:window;for(var r=xn(a.document);r instanceof a.HTMLIFrameElement;){try{var o=typeof r.contentWindow.location.href=="string"}catch{o=!1}if(o)a=r.contentWindow;else break;r=xn(a.document)}return r}function Qr(a){var r=a&&a.nodeName&&a.nodeName.toLowerCase();return r&&(r==="input"&&(a.type==="text"||a.type==="search"||a.type==="tel"||a.type==="url"||a.type==="password")||r==="textarea"||a.contentEditable==="true")}var go=Ba&&"documentMode"in document&&11>=document.documentMode,nr=null,yo=null,Mr=null,vo=!1;function gl(a,r,o){var h=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;vo||nr==null||nr!==xn(h)||(h=nr,"selectionStart"in h&&Qr(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Mr&&wr(Mr,h)||(Mr=h,h=hr(yo,"onSelect"),0<h.length&&(r=new qa("onSelect","select",null,r,o),a.push({event:r,listeners:h}),r.target=nr)))}function Gs(a,r){var o={};return o[a.toLowerCase()]=r.toLowerCase(),o["Webkit"+a]="webkit"+r,o["Moz"+a]="moz"+r,o}var M={animationend:Gs("Animation","AnimationEnd"),animationiteration:Gs("Animation","AnimationIteration"),animationstart:Gs("Animation","AnimationStart"),transitionrun:Gs("Transition","TransitionRun"),transitionstart:Gs("Transition","TransitionStart"),transitioncancel:Gs("Transition","TransitionCancel"),transitionend:Gs("Transition","TransitionEnd")},z={},V={};Ba&&(V=document.createElement("div").style,"AnimationEvent"in window||(delete M.animationend.animation,delete M.animationiteration.animation,delete M.animationstart.animation),"TransitionEvent"in window||delete M.transitionend.transition);function Y(a){if(z[a])return z[a];if(!M[a])return a;var r=M[a],o;for(o in r)if(r.hasOwnProperty(o)&&o in V)return z[a]=r[o];return a}var re=Y("animationend"),be=Y("animationiteration"),We=Y("animationstart"),rt=Y("transitionrun"),yt=Y("transitionstart"),Ct=Y("transitioncancel"),Kt=Y("transitionend"),dn=new Map,vn="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");vn.push("scrollEnd");function Pn(a,r){dn.set(a,r),Wa(r,[a])}var Ws=typeof reportError=="function"?reportError:function(a){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var r=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof a=="object"&&a!==null&&typeof a.message=="string"?String(a.message):String(a),error:a});if(!window.dispatchEvent(r))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",a);return}console.error(a)},hs=[],ki=0,Gu=0;function Mc(){for(var a=ki,r=Gu=ki=0;r<a;){var o=hs[r];hs[r++]=null;var h=hs[r];hs[r++]=null;var g=hs[r];hs[r++]=null;var x=hs[r];if(hs[r++]=null,h!==null&&g!==null){var j=h.pending;j===null?g.next=g:(g.next=j.next,j.next=g),h.pending=g}x!==0&&Hu(o,g,x)}}function yl(a,r,o,h){hs[ki++]=a,hs[ki++]=r,hs[ki++]=o,hs[ki++]=h,Gu|=h,a.lanes|=h,a=a.alternate,a!==null&&(a.lanes|=h)}function Wu(a,r,o,h){return yl(a,r,o,h),xc(a)}function $i(a,r){return yl(a,null,null,r),xc(a)}function Hu(a,r,o){a.lanes|=o;var h=a.alternate;h!==null&&(h.lanes|=o);for(var g=!1,x=a.return;x!==null;)x.childLanes|=o,h=x.alternate,h!==null&&(h.childLanes|=o),x.tag===22&&(a=x.stateNode,a===null||a._visibility&1||(g=!0)),a=x,x=x.return;return a.tag===3?(x=a.stateNode,g&&r!==null&&(g=31-Jt(o),a=x.hiddenUpdates,h=a[g],h===null?a[g]=[r]:h.push(r),r.lane=o|536870912),x):null}function xc(a){if(50<nu)throw nu=0,au=null,Error(s(185));for(var r=a.return;r!==null;)a=r,r=a.return;return a.tag===3?a.stateNode:null}var bo={};function Cf(a,r,o,h){this.tag=a,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vs(a,r,o,h){return new Cf(a,r,o,h)}function qu(a){return a=a.prototype,!(!a||!a.isReactComponent)}function ar(a,r){var o=a.alternate;return o===null?(o=vs(a.tag,r,a.key,a.mode),o.elementType=a.elementType,o.type=a.type,o.stateNode=a.stateNode,o.alternate=a,a.alternate=o):(o.pendingProps=r,o.type=a.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=a.flags&65011712,o.childLanes=a.childLanes,o.lanes=a.lanes,o.child=a.child,o.memoizedProps=a.memoizedProps,o.memoizedState=a.memoizedState,o.updateQueue=a.updateQueue,r=a.dependencies,o.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},o.sibling=a.sibling,o.index=a.index,o.ref=a.ref,o.refCleanup=a.refCleanup,o}function Af(a,r){a.flags&=65011714;var o=a.alternate;return o===null?(a.childLanes=0,a.lanes=r,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=o.childLanes,a.lanes=o.lanes,a.child=o.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=o.memoizedProps,a.memoizedState=o.memoizedState,a.updateQueue=o.updateQueue,a.type=o.type,r=o.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext}),a}function Tc(a,r,o,h,g,x){var j=0;if(h=a,typeof a=="function")qu(a)&&(j=1);else if(typeof a=="string")j=CC(a,o,B.current)?26:a==="html"||a==="head"||a==="body"?27:5;else e:switch(a){case W:return a=vs(31,o,r,g),a.elementType=W,a.lanes=x,a;case T:return Xr(o.children,g,x,r);case k:j=8,g|=24;break;case b:return a=vs(12,o,r,g|2),a.elementType=b,a.lanes=x,a;case C:return a=vs(13,o,r,g),a.elementType=C,a.lanes=x,a;case P:return a=vs(19,o,r,g),a.elementType=P,a.lanes=x,a;default:if(typeof a=="object"&&a!==null)switch(a.$$typeof){case $:j=10;break e;case S:j=9;break e;case w:j=11;break e;case A:j=14;break e;case I:j=16,h=null;break e}j=29,o=Error(s(130,a===null?"null":typeof a,"")),h=null}return r=vs(j,o,r,g),r.elementType=a,r.type=h,r.lanes=x,r}function Xr(a,r,o,h){return a=vs(7,a,h,r),a.lanes=o,a}function Ku(a,r,o){return a=vs(6,a,null,r),a.lanes=o,a}function Pf(a){var r=vs(18,null,null,0);return r.stateNode=a,r}function Ec(a,r,o){return r=vs(4,a.children!==null?a.children:[],a.key,r),r.lanes=o,r.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation},r}var kf=new WeakMap;function zs(a,r){if(typeof a=="object"&&a!==null){var o=kf.get(a);return o!==void 0?o:(r={value:a,source:r,stack:De(r)},kf.set(a,r),r)}return{value:a,source:r,stack:De(r)}}var Di=[],wo=0,Sc=null,Mo=0,Ls=[],Fs=0,xr=null,sr=1,rr="";function ir(a,r){Di[wo++]=Mo,Di[wo++]=Sc,Sc=a,Mo=r}function $f(a,r,o){Ls[Fs++]=sr,Ls[Fs++]=rr,Ls[Fs++]=xr,xr=a;var h=sr;a=rr;var g=32-Jt(h)-1;h&=~(1<<g),o+=1;var x=32-Jt(r)+g;if(30<x){var j=g-g%5;x=(h&(1<<j)-1).toString(32),h>>=j,g-=j,sr=1<<32-Jt(r)+g|o<<g|h,rr=x+a}else sr=1<<x|o<<g|h,rr=a}function Qu(a){a.return!==null&&(ir(a,1),$f(a,1,0))}function Cc(a){for(;a===Sc;)Sc=Di[--wo],Di[wo]=null,Mo=Di[--wo],Di[wo]=null;for(;a===xr;)xr=Ls[--Fs],Ls[Fs]=null,rr=Ls[--Fs],Ls[Fs]=null,sr=Ls[--Fs],Ls[Fs]=null}function Df(a,r){Ls[Fs++]=sr,Ls[Fs++]=rr,Ls[Fs++]=xr,sr=r.id,rr=r.overflow,xr=a}var Ka=null,Qn=null,_n=!1,Yr=null,bs=!1,Xu=Error(s(519));function Zr(a){var r=Error(s(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw vl(zs(r,a)),Xu}function Yu(a){var r=a.stateNode,o=a.type,h=a.memoizedProps;switch(r[ut]=a,r[xt]=h,o){case"dialog":hn("cancel",r),hn("close",r);break;case"iframe":case"object":case"embed":hn("load",r);break;case"video":case"audio":for(o=0;o<cu.length;o++)hn(cu[o],r);break;case"source":hn("error",r);break;case"img":case"image":case"link":hn("error",r),hn("load",r);break;case"details":hn("toggle",r);break;case"input":hn("invalid",r),ao(r,h.value,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name,!0);break;case"select":hn("invalid",r);break;case"textarea":hn("invalid",r),pe(r,h.value,h.defaultValue,h.children)}o=h.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||r.textContent===""+o||h.suppressHydrationWarning===!0||se(r.textContent,o)?(h.popover!=null&&(hn("beforetoggle",r),hn("toggle",r)),h.onScroll!=null&&hn("scroll",r),h.onScrollEnd!=null&&hn("scrollend",r),h.onClick!=null&&(r.onclick=jt),r=!0):r=!1,r||Zr(a,!0)}function Of(a){for(Ka=a.return;Ka;)switch(Ka.tag){case 5:case 31:case 13:bs=!1;return;case 27:case 3:bs=!0;return;default:Ka=Ka.return}}function xo(a){if(a!==Ka)return!1;if(!_n)return Of(a),_n=!0,!1;var r=a.tag,o;if((o=r!==3&&r!==27)&&((o=r===5)&&(o=a.type,o=!(o!=="form"&&o!=="button")||pn(a.type,a.memoizedProps)),o=!o),o&&Qn&&Zr(a),Of(a),r===13){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));Qn=Yn(a)}else if(r===31){if(a=a.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(317));Qn=Yn(a)}else r===27?(r=Qn,Bn(a.type)?(a=kp,kp=null,Qn=a):Qn=r):Qn=Ka?os(a.stateNode.nextSibling):null;return!0}function Jr(){Qn=Ka=null,_n=!1}function Zu(){var a=Yr;return a!==null&&(ts===null?ts=a:ts.push.apply(ts,a),Yr=null),a}function vl(a){Yr===null?Yr=[a]:Yr.push(a)}var Ac=U(null),Oi=null,Tr=null;function Er(a,r,o){H(Ac,r._currentValue),r._currentValue=o}function Sr(a){a._currentValue=Ac.current,K(Ac)}function Ju(a,r,o){for(;a!==null;){var h=a.alternate;if((a.childLanes&r)!==r?(a.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),a===o)break;a=a.return}}function Pc(a,r,o,h){var g=a.child;for(g!==null&&(g.return=a);g!==null;){var x=g.dependencies;if(x!==null){var j=g.child;x=x.firstContext;e:for(;x!==null;){var ae=x;x=g;for(var ye=0;ye<r.length;ye++)if(ae.context===r[ye]){x.lanes|=o,ae=x.alternate,ae!==null&&(ae.lanes|=o),Ju(x.return,o,a),h||(j=null);break e}x=ae.next}}else if(g.tag===18){if(j=g.return,j===null)throw Error(s(341));j.lanes|=o,x=j.alternate,x!==null&&(x.lanes|=o),Ju(j,o,a),j=null}else j=g.child;if(j!==null)j.return=g;else for(j=g;j!==null;){if(j===a){j=null;break}if(g=j.sibling,g!==null){g.return=j.return,j=g;break}j=j.return}g=j}}function To(a,r,o,h){a=null;for(var g=r,x=!1;g!==null;){if(!x){if((g.flags&524288)!==0)x=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var j=g.alternate;if(j===null)throw Error(s(387));if(j=j.memoizedProps,j!==null){var ae=g.type;Za(g.pendingProps.value,j.value)||(a!==null?a.push(ae):a=[ae])}}else if(g===Pe.current){if(j=g.alternate,j===null)throw Error(s(387));j.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(a!==null?a.push(Lp):a=[Lp])}g=g.return}a!==null&&Pc(r,a,o,h),r.flags|=262144}function kc(a){for(a=a.firstContext;a!==null;){if(!Za(a.context._currentValue,a.memoizedValue))return!0;a=a.next}return!1}function Ii(a){Oi=a,Tr=null,a=a.dependencies,a!==null&&(a.firstContext=null)}function Qa(a){return If(Oi,a)}function bl(a,r){return Oi===null&&Ii(a),If(a,r)}function If(a,r){var o=r._currentValue;if(r={context:r,memoizedValue:o,next:null},Tr===null){if(a===null)throw Error(s(308));Tr=r,a.dependencies={lanes:0,firstContext:r},a.flags|=524288}else Tr=Tr.next=r;return o}var Am=typeof AbortController<"u"?AbortController:function(){var a=[],r=this.signal={aborted:!1,addEventListener:function(o,h){a.push(h)}};this.abort=function(){r.aborted=!0,a.forEach(function(o){return o()})}},zf=e.unstable_scheduleCallback,Pm=e.unstable_NormalPriority,Aa={$$typeof:$,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function $c(){return{controller:new Am,data:new Map,refCount:0}}function wl(a){a.refCount--,a.refCount===0&&zf(Pm,function(){a.controller.abort()})}var Ml=null,Dc=0,Eo=0,So=null;function Lf(a,r){if(Ml===null){var o=Ml=[];Dc=0,Eo=Ep(),So={status:"pending",value:void 0,then:function(h){o.push(h)}}}return Dc++,r.then(Ff,Ff),r}function Ff(){if(--Dc===0&&Ml!==null){So!==null&&(So.status="fulfilled");var a=Ml;Ml=null,Eo=0,So=null;for(var r=0;r<a.length;r++)(0,a[r])()}}function km(a,r){var o=[],h={status:"pending",value:null,reason:null,then:function(g){o.push(g)}};return a.then(function(){h.status="fulfilled",h.value=r;for(var g=0;g<o.length;g++)(0,o[g])(r)},function(g){for(h.status="rejected",h.reason=g,g=0;g<o.length;g++)(0,o[g])(void 0)}),h}var ed=R.S;R.S=function(a,r){rp=mt(),typeof r=="object"&&r!==null&&typeof r.then=="function"&&Lf(a,r),ed!==null&&ed(a,r)};var zi=U(null);function td(){var a=zi.current;return a!==null?a:Gn.pooledCache}function xl(a,r){r===null?H(zi,zi.current):H(zi,r.pool)}function Nf(){var a=td();return a===null?null:{parent:Aa._currentValue,pool:a}}var Co=Error(s(460)),nd=Error(s(474)),Oc=Error(s(542)),Tl={then:function(){}};function jf(a){return a=a.status,a==="fulfilled"||a==="rejected"}function Rf(a,r,o){switch(o=a[o],o===void 0?a.push(r):o!==r&&(r.then(jt,jt),r=o),r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,Bf(a),a;default:if(typeof r.status=="string")r.then(jt,jt);else{if(a=Gn,a!==null&&100<a.shellSuspendCounter)throw Error(s(482));a=r,a.status="pending",a.then(function(h){if(r.status==="pending"){var g=r;g.status="fulfilled",g.value=h}},function(h){if(r.status==="pending"){var g=r;g.status="rejected",g.reason=h}})}switch(r.status){case"fulfilled":return r.value;case"rejected":throw a=r.reason,Bf(a),a}throw Fi=r,Co}}function Li(a){try{var r=a._init;return r(a._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(Fi=o,Co):o}}var Fi=null;function ad(){if(Fi===null)throw Error(s(459));var a=Fi;return Fi=null,a}function Bf(a){if(a===Co||a===Oc)throw Error(s(483))}var Ao=null,El=0;function Ic(a){var r=El;return El+=1,Ao===null&&(Ao=[]),Rf(Ao,a,r)}function Po(a,r){r=r.props.ref,a.ref=r!==void 0?r:null}function zc(a,r){throw r.$$typeof===p?Error(s(525)):(a=Object.prototype.toString.call(r),Error(s(31,a==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":a)))}function Uf(a){function r(Ee,we){if(a){var $e=Ee.deletions;$e===null?(Ee.deletions=[we],Ee.flags|=16):$e.push(we)}}function o(Ee,we){if(!a)return null;for(;we!==null;)r(Ee,we),we=we.sibling;return null}function h(Ee){for(var we=new Map;Ee!==null;)Ee.key!==null?we.set(Ee.key,Ee):we.set(Ee.index,Ee),Ee=Ee.sibling;return we}function g(Ee,we){return Ee=ar(Ee,we),Ee.index=0,Ee.sibling=null,Ee}function x(Ee,we,$e){return Ee.index=$e,a?($e=Ee.alternate,$e!==null?($e=$e.index,$e<we?(Ee.flags|=67108866,we):$e):(Ee.flags|=67108866,we)):(Ee.flags|=1048576,we)}function j(Ee){return a&&Ee.alternate===null&&(Ee.flags|=67108866),Ee}function ae(Ee,we,$e,et){return we===null||we.tag!==6?(we=Ku($e,Ee.mode,et),we.return=Ee,we):(we=g(we,$e),we.return=Ee,we)}function ye(Ee,we,$e,et){var Ut=$e.type;return Ut===T?Xe(Ee,we,$e.props.children,et,$e.key):we!==null&&(we.elementType===Ut||typeof Ut=="object"&&Ut!==null&&Ut.$$typeof===I&&Li(Ut)===we.type)?(we=g(we,$e.props),Po(we,$e),we.return=Ee,we):(we=Tc($e.type,$e.key,$e.props,null,Ee.mode,et),Po(we,$e),we.return=Ee,we)}function Oe(Ee,we,$e,et){return we===null||we.tag!==4||we.stateNode.containerInfo!==$e.containerInfo||we.stateNode.implementation!==$e.implementation?(we=Ec($e,Ee.mode,et),we.return=Ee,we):(we=g(we,$e.children||[]),we.return=Ee,we)}function Xe(Ee,we,$e,et,Ut){return we===null||we.tag!==7?(we=Xr($e,Ee.mode,et,Ut),we.return=Ee,we):(we=g(we,$e),we.return=Ee,we)}function tt(Ee,we,$e){if(typeof we=="string"&&we!==""||typeof we=="number"||typeof we=="bigint")return we=Ku(""+we,Ee.mode,$e),we.return=Ee,we;if(typeof we=="object"&&we!==null){switch(we.$$typeof){case y:return $e=Tc(we.type,we.key,we.props,null,Ee.mode,$e),Po($e,we),$e.return=Ee,$e;case v:return we=Ec(we,Ee.mode,$e),we.return=Ee,we;case I:return we=Li(we),tt(Ee,we,$e)}if(te(we)||Z(we))return we=Xr(we,Ee.mode,$e,null),we.return=Ee,we;if(typeof we.then=="function")return tt(Ee,Ic(we),$e);if(we.$$typeof===$)return tt(Ee,bl(Ee,we),$e);zc(Ee,we)}return null}function Le(Ee,we,$e,et){var Ut=we!==null?we.key:null;if(typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint")return Ut!==null?null:ae(Ee,we,""+$e,et);if(typeof $e=="object"&&$e!==null){switch($e.$$typeof){case y:return $e.key===Ut?ye(Ee,we,$e,et):null;case v:return $e.key===Ut?Oe(Ee,we,$e,et):null;case I:return $e=Li($e),Le(Ee,we,$e,et)}if(te($e)||Z($e))return Ut!==null?null:Xe(Ee,we,$e,et,null);if(typeof $e.then=="function")return Le(Ee,we,Ic($e),et);if($e.$$typeof===$)return Le(Ee,we,bl(Ee,$e),et);zc(Ee,$e)}return null}function Ve(Ee,we,$e,et,Ut){if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return Ee=Ee.get($e)||null,ae(we,Ee,""+et,Ut);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case y:return Ee=Ee.get(et.key===null?$e:et.key)||null,ye(we,Ee,et,Ut);case v:return Ee=Ee.get(et.key===null?$e:et.key)||null,Oe(we,Ee,et,Ut);case I:return et=Li(et),Ve(Ee,we,$e,et,Ut)}if(te(et)||Z(et))return Ee=Ee.get($e)||null,Xe(we,Ee,et,Ut,null);if(typeof et.then=="function")return Ve(Ee,we,$e,Ic(et),Ut);if(et.$$typeof===$)return Ve(Ee,we,$e,bl(we,et),Ut);zc(we,et)}return null}function kt(Ee,we,$e,et){for(var Ut=null,zn=null,Nt=we,un=we=0,bn=null;Nt!==null&&un<$e.length;un++){Nt.index>un?(bn=Nt,Nt=null):bn=Nt.sibling;var Ln=Le(Ee,Nt,$e[un],et);if(Ln===null){Nt===null&&(Nt=bn);break}a&&Nt&&Ln.alternate===null&&r(Ee,Nt),we=x(Ln,we,un),zn===null?Ut=Ln:zn.sibling=Ln,zn=Ln,Nt=bn}if(un===$e.length)return o(Ee,Nt),_n&&ir(Ee,un),Ut;if(Nt===null){for(;un<$e.length;un++)Nt=tt(Ee,$e[un],et),Nt!==null&&(we=x(Nt,we,un),zn===null?Ut=Nt:zn.sibling=Nt,zn=Nt);return _n&&ir(Ee,un),Ut}for(Nt=h(Nt);un<$e.length;un++)bn=Ve(Nt,Ee,un,$e[un],et),bn!==null&&(a&&bn.alternate!==null&&Nt.delete(bn.key===null?un:bn.key),we=x(bn,we,un),zn===null?Ut=bn:zn.sibling=bn,zn=bn);return a&&Nt.forEach(function(ec){return r(Ee,ec)}),_n&&ir(Ee,un),Ut}function Qt(Ee,we,$e,et){if($e==null)throw Error(s(151));for(var Ut=null,zn=null,Nt=we,un=we=0,bn=null,Ln=$e.next();Nt!==null&&!Ln.done;un++,Ln=$e.next()){Nt.index>un?(bn=Nt,Nt=null):bn=Nt.sibling;var ec=Le(Ee,Nt,Ln.value,et);if(ec===null){Nt===null&&(Nt=bn);break}a&&Nt&&ec.alternate===null&&r(Ee,Nt),we=x(ec,we,un),zn===null?Ut=ec:zn.sibling=ec,zn=ec,Nt=bn}if(Ln.done)return o(Ee,Nt),_n&&ir(Ee,un),Ut;if(Nt===null){for(;!Ln.done;un++,Ln=$e.next())Ln=tt(Ee,Ln.value,et),Ln!==null&&(we=x(Ln,we,un),zn===null?Ut=Ln:zn.sibling=Ln,zn=Ln);return _n&&ir(Ee,un),Ut}for(Nt=h(Nt);!Ln.done;un++,Ln=$e.next())Ln=Ve(Nt,Ee,un,Ln.value,et),Ln!==null&&(a&&Ln.alternate!==null&&Nt.delete(Ln.key===null?un:Ln.key),we=x(Ln,we,un),zn===null?Ut=Ln:zn.sibling=Ln,zn=Ln);return a&&Nt.forEach(function(NC){return r(Ee,NC)}),_n&&ir(Ee,un),Ut}function na(Ee,we,$e,et){if(typeof $e=="object"&&$e!==null&&$e.type===T&&$e.key===null&&($e=$e.props.children),typeof $e=="object"&&$e!==null){switch($e.$$typeof){case y:e:{for(var Ut=$e.key;we!==null;){if(we.key===Ut){if(Ut=$e.type,Ut===T){if(we.tag===7){o(Ee,we.sibling),et=g(we,$e.props.children),et.return=Ee,Ee=et;break e}}else if(we.elementType===Ut||typeof Ut=="object"&&Ut!==null&&Ut.$$typeof===I&&Li(Ut)===we.type){o(Ee,we.sibling),et=g(we,$e.props),Po(et,$e),et.return=Ee,Ee=et;break e}o(Ee,we);break}else r(Ee,we);we=we.sibling}$e.type===T?(et=Xr($e.props.children,Ee.mode,et,$e.key),et.return=Ee,Ee=et):(et=Tc($e.type,$e.key,$e.props,null,Ee.mode,et),Po(et,$e),et.return=Ee,Ee=et)}return j(Ee);case v:e:{for(Ut=$e.key;we!==null;){if(we.key===Ut)if(we.tag===4&&we.stateNode.containerInfo===$e.containerInfo&&we.stateNode.implementation===$e.implementation){o(Ee,we.sibling),et=g(we,$e.children||[]),et.return=Ee,Ee=et;break e}else{o(Ee,we);break}else r(Ee,we);we=we.sibling}et=Ec($e,Ee.mode,et),et.return=Ee,Ee=et}return j(Ee);case I:return $e=Li($e),na(Ee,we,$e,et)}if(te($e))return kt(Ee,we,$e,et);if(Z($e)){if(Ut=Z($e),typeof Ut!="function")throw Error(s(150));return $e=Ut.call($e),Qt(Ee,we,$e,et)}if(typeof $e.then=="function")return na(Ee,we,Ic($e),et);if($e.$$typeof===$)return na(Ee,we,bl(Ee,$e),et);zc(Ee,$e)}return typeof $e=="string"&&$e!==""||typeof $e=="number"||typeof $e=="bigint"?($e=""+$e,we!==null&&we.tag===6?(o(Ee,we.sibling),et=g(we,$e),et.return=Ee,Ee=et):(o(Ee,we),et=Ku($e,Ee.mode,et),et.return=Ee,Ee=et),j(Ee)):o(Ee,we)}return function(Ee,we,$e,et){try{El=0;var Ut=na(Ee,we,$e,et);return Ao=null,Ut}catch(Nt){if(Nt===Co||Nt===Oc)throw Nt;var zn=vs(29,Nt,null,Ee.mode);return zn.lanes=et,zn.return=Ee,zn}}}var Ni=Uf(!0),Vf=Uf(!1),Cr=!1;function sd(a){a.updateQueue={baseState:a.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function rd(a,r){a=a.updateQueue,r.updateQueue===a&&(r.updateQueue={baseState:a.baseState,firstBaseUpdate:a.firstBaseUpdate,lastBaseUpdate:a.lastBaseUpdate,shared:a.shared,callbacks:null})}function Ar(a){return{lane:a,tag:0,payload:null,callback:null,next:null}}function ei(a,r,o){var h=a.updateQueue;if(h===null)return null;if(h=h.shared,(En&2)!==0){var g=h.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),h.pending=r,r=xc(a),Hu(a,null,o),r}return yl(a,h,r,o),xc(a)}function Sl(a,r,o){if(r=r.updateQueue,r!==null&&(r=r.shared,(o&4194048)!==0)){var h=r.lanes;h&=a.pendingLanes,o|=h,r.lanes=o,F(a,o)}}function Lc(a,r){var o=a.updateQueue,h=a.alternate;if(h!==null&&(h=h.updateQueue,o===h)){var g=null,x=null;if(o=o.firstBaseUpdate,o!==null){do{var j={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};x===null?g=x=j:x=x.next=j,o=o.next}while(o!==null);x===null?g=x=r:x=x.next=r}else g=x=r;o={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:x,shared:h.shared,callbacks:h.callbacks},a.updateQueue=o;return}a=o.lastBaseUpdate,a===null?o.firstBaseUpdate=r:a.next=r,o.lastBaseUpdate=r}var id=!1;function Cl(){if(id){var a=So;if(a!==null)throw a}}function ko(a,r,o,h){id=!1;var g=a.updateQueue;Cr=!1;var x=g.firstBaseUpdate,j=g.lastBaseUpdate,ae=g.shared.pending;if(ae!==null){g.shared.pending=null;var ye=ae,Oe=ye.next;ye.next=null,j===null?x=Oe:j.next=Oe,j=ye;var Xe=a.alternate;Xe!==null&&(Xe=Xe.updateQueue,ae=Xe.lastBaseUpdate,ae!==j&&(ae===null?Xe.firstBaseUpdate=Oe:ae.next=Oe,Xe.lastBaseUpdate=ye))}if(x!==null){var tt=g.baseState;j=0,Xe=Oe=ye=null,ae=x;do{var Le=ae.lane&-536870913,Ve=Le!==ae.lane;if(Ve?(fn&Le)===Le:(h&Le)===Le){Le!==0&&Le===Eo&&(id=!0),Xe!==null&&(Xe=Xe.next={lane:0,tag:ae.tag,payload:ae.payload,callback:null,next:null});e:{var kt=a,Qt=ae;Le=r;var na=o;switch(Qt.tag){case 1:if(kt=Qt.payload,typeof kt=="function"){tt=kt.call(na,tt,Le);break e}tt=kt;break e;case 3:kt.flags=kt.flags&-65537|128;case 0:if(kt=Qt.payload,Le=typeof kt=="function"?kt.call(na,tt,Le):kt,Le==null)break e;tt=_({},tt,Le);break e;case 2:Cr=!0}}Le=ae.callback,Le!==null&&(a.flags|=64,Ve&&(a.flags|=8192),Ve=g.callbacks,Ve===null?g.callbacks=[Le]:Ve.push(Le))}else Ve={lane:Le,tag:ae.tag,payload:ae.payload,callback:ae.callback,next:null},Xe===null?(Oe=Xe=Ve,ye=tt):Xe=Xe.next=Ve,j|=Le;if(ae=ae.next,ae===null){if(ae=g.shared.pending,ae===null)break;Ve=ae,ae=Ve.next,Ve.next=null,g.lastBaseUpdate=Ve,g.shared.pending=null}}while(!0);Xe===null&&(ye=tt),g.baseState=ye,g.firstBaseUpdate=Oe,g.lastBaseUpdate=Xe,x===null&&(g.shared.lanes=0),dr|=j,a.lanes=j,a.memoizedState=tt}}function Gf(a,r){if(typeof a!="function")throw Error(s(191,a));a.call(r)}function Wf(a,r){var o=a.callbacks;if(o!==null)for(a.callbacks=null,a=0;a<o.length;a++)Gf(o[a],r)}var ji=U(null),Fc=U(0);function Hf(a,r){a=ur,H(Fc,a),H(ji,r),ur=a|r.baseLanes}function Al(){H(Fc,ur),H(ji,ji.current)}function od(){ur=Fc.current,K(ji),K(Fc)}var ws=U(null),Ms=null;function Pr(a){var r=a.alternate;H(oa,oa.current&1),H(ws,a),Ms===null&&(r===null||ji.current!==null||r.memoizedState!==null)&&(Ms=a)}function ld(a){H(oa,oa.current),H(ws,a),Ms===null&&(Ms=a)}function cd(a){a.tag===22?(H(oa,oa.current),H(ws,a),Ms===null&&(Ms=a)):ti()}function ti(){H(oa,oa.current),H(ws,ws.current)}function xs(a){K(ws),Ms===a&&(Ms=null),K(oa)}var oa=U(0);function Pl(a){for(var r=a;r!==null;){if(r.tag===13){var o=r.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||Qi(o)||Xi(o)))return r}else if(r.tag===19&&(r.memoizedProps.revealOrder==="forwards"||r.memoizedProps.revealOrder==="backwards"||r.memoizedProps.revealOrder==="unstable_legacy-backwards"||r.memoizedProps.revealOrder==="together")){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var kr=0,an=null,jn=null,Ta=null,Nc=!1,$o=!1,Ri=!1,kl=0,$l=0,Do=null,qf=0;function ya(){throw Error(s(321))}function ud(a,r){if(r===null)return!1;for(var o=0;o<r.length&&o<a.length;o++)if(!Za(a[o],r[o]))return!1;return!0}function dd(a,r,o,h,g,x){return kr=x,an=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,R.H=a===null||a.memoizedState===null?Sh:Pd,Ri=!1,x=o(h,g),Ri=!1,$o&&(x=Kf(r,o,h,g)),fd(a),x}function fd(a){R.H=zo;var r=jn!==null&&jn.next!==null;if(kr=0,Ta=jn=an=null,Nc=!1,$l=0,Do=null,r)throw Error(s(300));a===null||Pa||(a=a.dependencies,a!==null&&kc(a)&&(Pa=!0))}function Kf(a,r,o,h){an=a;var g=0;do{if($o&&(Do=null),$l=0,$o=!1,25<=g)throw Error(s(301));if(g+=1,Ta=jn=null,a.updateQueue!=null){var x=a.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}R.H=kd,x=r(o,h)}while($o);return x}function $m(){var a=R.H,r=a.useState()[0];return r=typeof r.then=="function"?Bi(r):r,a=a.useState()[0],(jn!==null?jn.memoizedState:null)!==a&&(an.flags|=1024),r}function jc(){var a=kl!==0;return kl=0,a}function hd(a,r,o){r.updateQueue=a.updateQueue,r.flags&=-2053,a.lanes&=~o}function pd(a){if(Nc){for(a=a.memoizedState;a!==null;){var r=a.queue;r!==null&&(r.pending=null),a=a.next}Nc=!1}kr=0,Ta=jn=an=null,$o=!1,$l=kl=0,Do=null}function Ja(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ta===null?an.memoizedState=Ta=a:Ta=Ta.next=a,Ta}function Ea(){if(jn===null){var a=an.alternate;a=a!==null?a.memoizedState:null}else a=jn.next;var r=Ta===null?an.memoizedState:Ta.next;if(r!==null)Ta=r,jn=a;else{if(a===null)throw an.alternate===null?Error(s(467)):Error(s(310));jn=a,a={memoizedState:jn.memoizedState,baseState:jn.baseState,baseQueue:jn.baseQueue,queue:jn.queue,next:null},Ta===null?an.memoizedState=Ta=a:Ta=Ta.next=a}return Ta}function Rc(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Bi(a){var r=$l;return $l+=1,Do===null&&(Do=[]),a=Rf(Do,a,r),r=an,(Ta===null?r.memoizedState:Ta.next)===null&&(r=r.alternate,R.H=r===null||r.memoizedState===null?Sh:Pd),a}function Bc(a){if(a!==null&&typeof a=="object"){if(typeof a.then=="function")return Bi(a);if(a.$$typeof===$)return Qa(a)}throw Error(s(438,String(a)))}function md(a){var r=null,o=an.updateQueue;if(o!==null&&(r=o.memoCache),r==null){var h=an.alternate;h!==null&&(h=h.updateQueue,h!==null&&(h=h.memoCache,h!=null&&(r={data:h.data.map(function(g){return g.slice()}),index:0})))}if(r==null&&(r={data:[],index:0}),o===null&&(o=Rc(),an.updateQueue=o),o.memoCache=r,o=r.data[r.index],o===void 0)for(o=r.data[r.index]=Array(a),h=0;h<a;h++)o[h]=G;return r.index++,o}function $r(a,r){return typeof r=="function"?r(a):r}function Dl(a){var r=Ea();return _d(r,jn,a)}function _d(a,r,o){var h=a.queue;if(h===null)throw Error(s(311));h.lastRenderedReducer=o;var g=a.baseQueue,x=h.pending;if(x!==null){if(g!==null){var j=g.next;g.next=x.next,x.next=j}r.baseQueue=g=x,h.pending=null}if(x=a.baseState,g===null)a.memoizedState=x;else{r=g.next;var ae=j=null,ye=null,Oe=r,Xe=!1;do{var tt=Oe.lane&-536870913;if(tt!==Oe.lane?(fn&tt)===tt:(kr&tt)===tt){var Le=Oe.revertLane;if(Le===0)ye!==null&&(ye=ye.next={lane:0,revertLane:0,gesture:null,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null}),tt===Eo&&(Xe=!0);else if((kr&Le)===Le){Oe=Oe.next,Le===Eo&&(Xe=!0);continue}else tt={lane:0,revertLane:Oe.revertLane,gesture:null,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null},ye===null?(ae=ye=tt,j=x):ye=ye.next=tt,an.lanes|=Le,dr|=Le;tt=Oe.action,Ri&&o(x,tt),x=Oe.hasEagerState?Oe.eagerState:o(x,tt)}else Le={lane:tt,revertLane:Oe.revertLane,gesture:Oe.gesture,action:Oe.action,hasEagerState:Oe.hasEagerState,eagerState:Oe.eagerState,next:null},ye===null?(ae=ye=Le,j=x):ye=ye.next=Le,an.lanes|=tt,dr|=tt;Oe=Oe.next}while(Oe!==null&&Oe!==r);if(ye===null?j=x:ye.next=ae,!Za(x,a.memoizedState)&&(Pa=!0,Xe&&(o=So,o!==null)))throw o;a.memoizedState=x,a.baseState=j,a.baseQueue=ye,h.lastRenderedState=x}return g===null&&(h.lanes=0),[a.memoizedState,h.dispatch]}function gd(a){var r=Ea(),o=r.queue;if(o===null)throw Error(s(311));o.lastRenderedReducer=a;var h=o.dispatch,g=o.pending,x=r.memoizedState;if(g!==null){o.pending=null;var j=g=g.next;do x=a(x,j.action),j=j.next;while(j!==g);Za(x,r.memoizedState)||(Pa=!0),r.memoizedState=x,r.baseQueue===null&&(r.baseState=x),o.lastRenderedState=x}return[x,h]}function yd(a,r,o){var h=an,g=Ea(),x=_n;if(x){if(o===void 0)throw Error(s(407));o=o()}else o=r();var j=!Za((jn||g).memoizedState,o);if(j&&(g.memoizedState=o,Pa=!0),g=g.queue,Md(Yf.bind(null,h,g,a),[a]),g.getSnapshot!==r||j||Ta!==null&&Ta.memoizedState.tag&1){if(h.flags|=2048,Oo(9,{destroy:void 0},Xf.bind(null,h,g,o,r),null),Gn===null)throw Error(s(349));x||(kr&127)!==0||Qf(h,r,o)}return o}function Qf(a,r,o){a.flags|=16384,a={getSnapshot:r,value:o},r=an.updateQueue,r===null?(r=Rc(),an.updateQueue=r,r.stores=[a]):(o=r.stores,o===null?r.stores=[a]:o.push(a))}function Xf(a,r,o,h){r.value=o,r.getSnapshot=h,Zf(r)&&Uc(a)}function Yf(a,r,o){return o(function(){Zf(r)&&Uc(a)})}function Zf(a){var r=a.getSnapshot;a=a.value;try{var o=r();return!Za(a,o)}catch{return!0}}function Uc(a){var r=$i(a,2);r!==null&&ms(r,a,2)}function vd(a){var r=Ja();if(typeof a=="function"){var o=a;if(a=o(),Ri){fa(!0);try{o()}finally{fa(!1)}}}return r.memoizedState=r.baseState=a,r.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$r,lastRenderedState:a},r}function Jf(a,r,o,h){return a.baseState=o,_d(a,jn,typeof h=="function"?h:$r)}function Dm(a,r,o,h,g){if(Io(a))throw Error(s(485));if(a=r.action,a!==null){var x={payload:g,action:a,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(j){x.listeners.push(j)}};R.T!==null?o(!0):x.isTransition=!1,h(x),o=r.pending,o===null?(x.next=r.pending=x,eh(r,x)):(x.next=o.next,r.pending=o.next=x)}}function eh(a,r){var o=r.action,h=r.payload,g=a.state;if(r.isTransition){var x=R.T,j={};R.T=j;try{var ae=o(g,h),ye=R.S;ye!==null&&ye(j,ae),th(a,r,ae)}catch(Oe){bd(a,r,Oe)}finally{x!==null&&j.types!==null&&(x.types=j.types),R.T=x}}else try{x=o(g,h),th(a,r,x)}catch(Oe){bd(a,r,Oe)}}function th(a,r,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(h){nh(a,r,h)},function(h){return bd(a,r,h)}):nh(a,r,o)}function nh(a,r,o){r.status="fulfilled",r.value=o,ah(r),a.state=o,r=a.pending,r!==null&&(o=r.next,o===r?a.pending=null:(o=o.next,r.next=o,eh(a,o)))}function bd(a,r,o){var h=a.pending;if(a.pending=null,h!==null){h=h.next;do r.status="rejected",r.reason=o,ah(r),r=r.next;while(r!==h)}a.action=null}function ah(a){a=a.listeners;for(var r=0;r<a.length;r++)(0,a[r])()}function sh(a,r){return r}function wd(a,r){if(_n){var o=Gn.formState;if(o!==null){e:{var h=an;if(_n){if(Qn){t:{for(var g=Qn,x=bs;g.nodeType!==8;){if(!x){g=null;break t}if(g=os(g.nextSibling),g===null){g=null;break t}}x=g.data,g=x==="F!"||x==="F"?g:null}if(g){Qn=os(g.nextSibling),h=g.data==="F!";break e}}Zr(h)}h=!1}h&&(r=o[0])}}return o=Ja(),o.memoizedState=o.baseState=r,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:sh,lastRenderedState:r},o.queue=h,o=xh.bind(null,an,h),h.dispatch=o,h=vd(!1),x=Ad.bind(null,an,!1,h.queue),h=Ja(),g={state:r,dispatch:null,action:a,pending:null},h.queue=g,o=Dm.bind(null,an,g,x,o),g.dispatch=o,h.memoizedState=a,[r,o,!1]}function rh(a){var r=Ea();return ih(r,jn,a)}function ih(a,r,o){if(r=_d(a,r,sh)[0],a=Dl($r)[0],typeof r=="object"&&r!==null&&typeof r.then=="function")try{var h=Bi(r)}catch(j){throw j===Co?Oc:j}else h=r;r=Ea();var g=r.queue,x=g.dispatch;return o!==r.memoizedState&&(an.flags|=2048,Oo(9,{destroy:void 0},oh.bind(null,g,o),null)),[h,x,a]}function oh(a,r){a.action=r}function lh(a){var r=Ea(),o=jn;if(o!==null)return ih(r,o,a);Ea(),r=r.memoizedState,o=Ea();var h=o.queue.dispatch;return o.memoizedState=a,[r,h,!1]}function Oo(a,r,o,h){return a={tag:a,create:o,deps:h,inst:r,next:null},r=an.updateQueue,r===null&&(r=Rc(),an.updateQueue=r),o=r.lastEffect,o===null?r.lastEffect=a.next=a:(h=o.next,o.next=a,a.next=h,r.lastEffect=a),a}function ch(){return Ea().memoizedState}function Vc(a,r,o,h){var g=Ja();an.flags|=a,g.memoizedState=Oo(1|r,{destroy:void 0},o,h===void 0?null:h)}function Ol(a,r,o,h){var g=Ea();h=h===void 0?null:h;var x=g.memoizedState.inst;jn!==null&&h!==null&&ud(h,jn.memoizedState.deps)?g.memoizedState=Oo(r,x,o,h):(an.flags|=a,g.memoizedState=Oo(1|r,x,o,h))}function uh(a,r){Vc(8390656,8,a,r)}function Md(a,r){Ol(2048,8,a,r)}function dh(a){an.flags|=4;var r=an.updateQueue;if(r===null)r=Rc(),an.updateQueue=r,r.events=[a];else{var o=r.events;o===null?r.events=[a]:o.push(a)}}function fh(a){var r=Ea().memoizedState;return dh({ref:r,nextImpl:a}),function(){if((En&2)!==0)throw Error(s(440));return r.impl.apply(void 0,arguments)}}function hh(a,r){return Ol(4,2,a,r)}function xd(a,r){return Ol(4,4,a,r)}function ph(a,r){if(typeof r=="function"){a=a();var o=r(a);return function(){typeof o=="function"?o():r(null)}}if(r!=null)return a=a(),r.current=a,function(){r.current=null}}function mh(a,r,o){o=o!=null?o.concat([a]):null,Ol(4,4,ph.bind(null,r,a),o)}function Gc(){}function _h(a,r){var o=Ea();r=r===void 0?null:r;var h=o.memoizedState;return r!==null&&ud(r,h[1])?h[0]:(o.memoizedState=[a,r],a)}function gh(a,r){var o=Ea();r=r===void 0?null:r;var h=o.memoizedState;if(r!==null&&ud(r,h[1]))return h[0];if(h=a(),Ri){fa(!0);try{a()}finally{fa(!1)}}return o.memoizedState=[h,r],h}function Td(a,r,o){return o===void 0||(kr&1073741824)!==0&&(fn&261930)===0?a.memoizedState=r:(a.memoizedState=o,a=lp(),an.lanes|=a,dr|=a,o)}function yh(a,r,o,h){return Za(o,r)?o:ji.current!==null?(a=Td(a,o,h),Za(a,r)||(Pa=!0),a):(kr&42)===0||(kr&1073741824)!==0&&(fn&261930)===0?(Pa=!0,a.memoizedState=o):(a=lp(),an.lanes|=a,dr|=a,r)}function vh(a,r,o,h,g){var x=ee.p;ee.p=x!==0&&8>x?x:8;var j=R.T,ae={};R.T=ae,Ad(a,!1,r,o);try{var ye=g(),Oe=R.S;if(Oe!==null&&Oe(ae,ye),ye!==null&&typeof ye=="object"&&typeof ye.then=="function"){var Xe=km(ye,h);Il(a,r,Xe,Ss(a))}else Il(a,r,h,Ss(a))}catch(tt){Il(a,r,{then:function(){},status:"rejected",reason:tt},Ss())}finally{ee.p=x,j!==null&&ae.types!==null&&(j.types=ae.types),R.T=j}}function Om(){}function Ed(a,r,o,h){if(a.tag!==5)throw Error(s(476));var g=bh(a).queue;vh(a,g,r,ie,o===null?Om:function(){return Sd(a),o(h)})}function bh(a){var r=a.memoizedState;if(r!==null)return r;r={memoizedState:ie,baseState:ie,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$r,lastRenderedState:ie},next:null};var o={};return r.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$r,lastRenderedState:o},next:null},a.memoizedState=r,a=a.alternate,a!==null&&(a.memoizedState=r),r}function Sd(a){var r=bh(a);r.next===null&&(r=a.alternate.memoizedState),Il(a,r.next.queue,{},Ss())}function Cd(){return Qa(Lp)}function wh(){return Ea().memoizedState}function Mh(){return Ea().memoizedState}function Im(a){for(var r=a.return;r!==null;){switch(r.tag){case 24:case 3:var o=Ss();a=Ar(o);var h=ei(r,a,o);h!==null&&(ms(h,r,o),Sl(h,r,o)),r={cache:$c()},a.payload=r;return}r=r.return}}function zm(a,r,o){var h=Ss();o={lane:h,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},Io(a)?Th(r,o):(o=Wu(a,r,o,h),o!==null&&(ms(o,a,h),Eh(o,r,h)))}function xh(a,r,o){var h=Ss();Il(a,r,o,h)}function Il(a,r,o,h){var g={lane:h,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(Io(a))Th(r,g);else{var x=a.alternate;if(a.lanes===0&&(x===null||x.lanes===0)&&(x=r.lastRenderedReducer,x!==null))try{var j=r.lastRenderedState,ae=x(j,o);if(g.hasEagerState=!0,g.eagerState=ae,Za(ae,j))return yl(a,r,g,0),Gn===null&&Mc(),!1}catch{}if(o=Wu(a,r,g,h),o!==null)return ms(o,a,h),Eh(o,r,h),!0}return!1}function Ad(a,r,o,h){if(h={lane:2,revertLane:Ep(),gesture:null,action:h,hasEagerState:!1,eagerState:null,next:null},Io(a)){if(r)throw Error(s(479))}else r=Wu(a,o,h,2),r!==null&&ms(r,a,2)}function Io(a){var r=a.alternate;return a===an||r!==null&&r===an}function Th(a,r){$o=Nc=!0;var o=a.pending;o===null?r.next=r:(r.next=o.next,o.next=r),a.pending=r}function Eh(a,r,o){if((o&4194048)!==0){var h=r.lanes;h&=a.pendingLanes,o|=h,r.lanes=o,F(a,o)}}var zo={readContext:Qa,use:Bc,useCallback:ya,useContext:ya,useEffect:ya,useImperativeHandle:ya,useLayoutEffect:ya,useInsertionEffect:ya,useMemo:ya,useReducer:ya,useRef:ya,useState:ya,useDebugValue:ya,useDeferredValue:ya,useTransition:ya,useSyncExternalStore:ya,useId:ya,useHostTransitionStatus:ya,useFormState:ya,useActionState:ya,useOptimistic:ya,useMemoCache:ya,useCacheRefresh:ya};zo.useEffectEvent=ya;var Sh={readContext:Qa,use:Bc,useCallback:function(a,r){return Ja().memoizedState=[a,r===void 0?null:r],a},useContext:Qa,useEffect:uh,useImperativeHandle:function(a,r,o){o=o!=null?o.concat([a]):null,Vc(4194308,4,ph.bind(null,r,a),o)},useLayoutEffect:function(a,r){return Vc(4194308,4,a,r)},useInsertionEffect:function(a,r){Vc(4,2,a,r)},useMemo:function(a,r){var o=Ja();r=r===void 0?null:r;var h=a();if(Ri){fa(!0);try{a()}finally{fa(!1)}}return o.memoizedState=[h,r],h},useReducer:function(a,r,o){var h=Ja();if(o!==void 0){var g=o(r);if(Ri){fa(!0);try{o(r)}finally{fa(!1)}}}else g=r;return h.memoizedState=h.baseState=g,a={pending:null,lanes:0,dispatch:null,lastRenderedReducer:a,lastRenderedState:g},h.queue=a,a=a.dispatch=zm.bind(null,an,a),[h.memoizedState,a]},useRef:function(a){var r=Ja();return a={current:a},r.memoizedState=a},useState:function(a){a=vd(a);var r=a.queue,o=xh.bind(null,an,r);return r.dispatch=o,[a.memoizedState,o]},useDebugValue:Gc,useDeferredValue:function(a,r){var o=Ja();return Td(o,a,r)},useTransition:function(){var a=vd(!1);return a=vh.bind(null,an,a.queue,!0,!1),Ja().memoizedState=a,[!1,a]},useSyncExternalStore:function(a,r,o){var h=an,g=Ja();if(_n){if(o===void 0)throw Error(s(407));o=o()}else{if(o=r(),Gn===null)throw Error(s(349));(fn&127)!==0||Qf(h,r,o)}g.memoizedState=o;var x={value:o,getSnapshot:r};return g.queue=x,uh(Yf.bind(null,h,x,a),[a]),h.flags|=2048,Oo(9,{destroy:void 0},Xf.bind(null,h,x,o,r),null),o},useId:function(){var a=Ja(),r=Gn.identifierPrefix;if(_n){var o=rr,h=sr;o=(h&~(1<<32-Jt(h)-1)).toString(32)+o,r="_"+r+"R_"+o,o=kl++,0<o&&(r+="H"+o.toString(32)),r+="_"}else o=qf++,r="_"+r+"r_"+o.toString(32)+"_";return a.memoizedState=r},useHostTransitionStatus:Cd,useFormState:wd,useActionState:wd,useOptimistic:function(a){var r=Ja();r.memoizedState=r.baseState=a;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return r.queue=o,r=Ad.bind(null,an,!0,o),o.dispatch=r,[a,r]},useMemoCache:md,useCacheRefresh:function(){return Ja().memoizedState=Im.bind(null,an)},useEffectEvent:function(a){var r=Ja(),o={impl:a};return r.memoizedState=o,function(){if((En&2)!==0)throw Error(s(440));return o.impl.apply(void 0,arguments)}}},Pd={readContext:Qa,use:Bc,useCallback:_h,useContext:Qa,useEffect:Md,useImperativeHandle:mh,useInsertionEffect:hh,useLayoutEffect:xd,useMemo:gh,useReducer:Dl,useRef:ch,useState:function(){return Dl($r)},useDebugValue:Gc,useDeferredValue:function(a,r){var o=Ea();return yh(o,jn.memoizedState,a,r)},useTransition:function(){var a=Dl($r)[0],r=Ea().memoizedState;return[typeof a=="boolean"?a:Bi(a),r]},useSyncExternalStore:yd,useId:wh,useHostTransitionStatus:Cd,useFormState:rh,useActionState:rh,useOptimistic:function(a,r){var o=Ea();return Jf(o,jn,a,r)},useMemoCache:md,useCacheRefresh:Mh};Pd.useEffectEvent=fh;var kd={readContext:Qa,use:Bc,useCallback:_h,useContext:Qa,useEffect:Md,useImperativeHandle:mh,useInsertionEffect:hh,useLayoutEffect:xd,useMemo:gh,useReducer:gd,useRef:ch,useState:function(){return gd($r)},useDebugValue:Gc,useDeferredValue:function(a,r){var o=Ea();return jn===null?Td(o,a,r):yh(o,jn.memoizedState,a,r)},useTransition:function(){var a=gd($r)[0],r=Ea().memoizedState;return[typeof a=="boolean"?a:Bi(a),r]},useSyncExternalStore:yd,useId:wh,useHostTransitionStatus:Cd,useFormState:lh,useActionState:lh,useOptimistic:function(a,r){var o=Ea();return jn!==null?Jf(o,jn,a,r):(o.baseState=a,[a,o.queue.dispatch])},useMemoCache:md,useCacheRefresh:Mh};kd.useEffectEvent=fh;function $d(a,r,o,h){r=a.memoizedState,o=o(h,r),o=o==null?r:_({},r,o),a.memoizedState=o,a.lanes===0&&(a.updateQueue.baseState=o)}var Dd={enqueueSetState:function(a,r,o){a=a._reactInternals;var h=Ss(),g=Ar(h);g.payload=r,o!=null&&(g.callback=o),r=ei(a,g,h),r!==null&&(ms(r,a,h),Sl(r,a,h))},enqueueReplaceState:function(a,r,o){a=a._reactInternals;var h=Ss(),g=Ar(h);g.tag=1,g.payload=r,o!=null&&(g.callback=o),r=ei(a,g,h),r!==null&&(ms(r,a,h),Sl(r,a,h))},enqueueForceUpdate:function(a,r){a=a._reactInternals;var o=Ss(),h=Ar(o);h.tag=2,r!=null&&(h.callback=r),r=ei(a,h,o),r!==null&&(ms(r,a,o),Sl(r,a,o))}};function ni(a,r,o,h,g,x,j){return a=a.stateNode,typeof a.shouldComponentUpdate=="function"?a.shouldComponentUpdate(h,x,j):r.prototype&&r.prototype.isPureReactComponent?!wr(o,h)||!wr(g,x):!0}function Ch(a,r,o,h){a=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(o,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(o,h),r.state!==a&&Dd.enqueueReplaceState(r,r.state,null)}function Ui(a,r){var o=r;if("ref"in r){o={};for(var h in r)h!=="ref"&&(o[h]=r[h])}if(a=a.defaultProps){o===r&&(o=_({},o));for(var g in a)o[g]===void 0&&(o[g]=a[g])}return o}function Ah(a){Ws(a)}function Ph(a){console.error(a)}function kh(a){Ws(a)}function Wc(a,r){try{var o=a.onUncaughtError;o(r.value,{componentStack:r.stack})}catch(h){setTimeout(function(){throw h})}}function Od(a,r,o){try{var h=a.onCaughtError;h(o.value,{componentStack:o.stack,errorBoundary:r.tag===1?r.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function Id(a,r,o){return o=Ar(o),o.tag=3,o.payload={element:null},o.callback=function(){Wc(a,r)},o}function $h(a){return a=Ar(a),a.tag=3,a}function Dh(a,r,o,h){var g=o.type.getDerivedStateFromError;if(typeof g=="function"){var x=h.value;a.payload=function(){return g(x)},a.callback=function(){Od(r,o,h)}}var j=o.stateNode;j!==null&&typeof j.componentDidCatch=="function"&&(a.callback=function(){Od(r,o,h),typeof g!="function"&&(fr===null?fr=new Set([this]):fr.add(this));var ae=h.stack;this.componentDidCatch(h.value,{componentStack:ae!==null?ae:""})})}function Lm(a,r,o,h,g){if(o.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){if(r=o.alternate,r!==null&&To(r,o,g,!0),o=ws.current,o!==null){switch(o.tag){case 31:case 13:return Ms===null?ru():o.alternate===null&&va===0&&(va=3),o.flags&=-257,o.flags|=65536,o.lanes=g,h===Tl?o.flags|=16384:(r=o.updateQueue,r===null?o.updateQueue=new Set([h]):r.add(h),af(a,h,g)),!1;case 22:return o.flags|=65536,h===Tl?o.flags|=16384:(r=o.updateQueue,r===null?(r={transitions:null,markerInstances:null,retryQueue:new Set([h])},o.updateQueue=r):(o=r.retryQueue,o===null?r.retryQueue=new Set([h]):o.add(h)),af(a,h,g)),!1}throw Error(s(435,o.tag))}return af(a,h,g),ru(),!1}if(_n)return r=ws.current,r!==null?((r.flags&65536)===0&&(r.flags|=256),r.flags|=65536,r.lanes=g,h!==Xu&&(a=Error(s(422),{cause:h}),vl(zs(a,o)))):(h!==Xu&&(r=Error(s(423),{cause:h}),vl(zs(r,o))),a=a.current.alternate,a.flags|=65536,g&=-g,a.lanes|=g,h=zs(h,o),g=Id(a.stateNode,h,g),Lc(a,g),va!==4&&(va=2)),!1;var x=Error(s(520),{cause:h});if(x=zs(x,o),Hl===null?Hl=[x]:Hl.push(x),va!==4&&(va=2),r===null)return!0;h=zs(h,o),o=r;do{switch(o.tag){case 3:return o.flags|=65536,a=g&-g,o.lanes|=a,a=Id(o.stateNode,h,a),Lc(o,a),!1;case 1:if(r=o.type,x=o.stateNode,(o.flags&128)===0&&(typeof r.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(fr===null||!fr.has(x))))return o.flags|=65536,g&=-g,o.lanes|=g,g=$h(g),Dh(g,a,o,h),Lc(o,g),!1}o=o.return}while(o!==null);return!1}var zl=Error(s(461)),Pa=!1;function Xa(a,r,o,h){r.child=a===null?Vf(r,null,o,h):Ni(r,a.child,o,h)}function Oh(a,r,o,h,g){o=o.render;var x=r.ref;if("ref"in h){var j={};for(var ae in h)ae!=="ref"&&(j[ae]=h[ae])}else j=h;return Ii(r),h=dd(a,r,o,j,x,g),ae=jc(),a!==null&&!Pa?(hd(a,r,g),Dr(a,r,g)):(_n&&ae&&Qu(r),r.flags|=1,Xa(a,r,h,g),r.child)}function Ll(a,r,o,h,g){if(a===null){var x=o.type;return typeof x=="function"&&!qu(x)&&x.defaultProps===void 0&&o.compare===null?(r.tag=15,r.type=x,Ih(a,r,x,h,g)):(a=Tc(o.type,null,h,r,r.mode,g),a.ref=r.ref,a.return=r,r.child=a)}if(x=a.child,!jd(a,g)){var j=x.memoizedProps;if(o=o.compare,o=o!==null?o:wr,o(j,h)&&a.ref===r.ref)return Dr(a,r,g)}return r.flags|=1,a=ar(x,h),a.ref=r.ref,a.return=r,r.child=a}function Ih(a,r,o,h,g){if(a!==null){var x=a.memoizedProps;if(wr(x,h)&&a.ref===r.ref)if(Pa=!1,r.pendingProps=h=x,jd(a,g))(a.flags&131072)!==0&&(Pa=!0);else return r.lanes=a.lanes,Dr(a,r,g)}return Nh(a,r,o,h,g)}function zh(a,r,o,h){var g=h.children,x=a!==null?a.memoizedState:null;if(a===null&&r.stateNode===null&&(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),h.mode==="hidden"){if((r.flags&128)!==0){if(x=x!==null?x.baseLanes|o:o,a!==null){for(h=r.child=a.child,g=0;h!==null;)g=g|h.lanes|h.childLanes,h=h.sibling;h=g&~x}else h=0,r.child=null;return Lh(a,r,x,o,h)}if((o&536870912)!==0)r.memoizedState={baseLanes:0,cachePool:null},a!==null&&xl(r,x!==null?x.cachePool:null),x!==null?Hf(r,x):Al(),cd(r);else return h=r.lanes=536870912,Lh(a,r,x!==null?x.baseLanes|o:o,o,h)}else x!==null?(xl(r,x.cachePool),Hf(r,x),ti(),r.memoizedState=null):(a!==null&&xl(r,null),Al(),ti());return Xa(a,r,g,o),r.child}function Fl(a,r){return a!==null&&a.tag===22||r.stateNode!==null||(r.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),r.sibling}function Lh(a,r,o,h,g){var x=td();return x=x===null?null:{parent:Aa._currentValue,pool:x},r.memoizedState={baseLanes:o,cachePool:x},a!==null&&xl(r,null),Al(),cd(r),a!==null&&To(a,r,h,!0),r.childLanes=g,null}function Lo(a,r){return r=qc({mode:r.mode,children:r.children},a.mode),r.ref=a.ref,a.child=r,r.return=a,r}function Fh(a,r,o){return Ni(r,a.child,null,o),a=Lo(r,r.pendingProps),a.flags|=2,xs(r),r.memoizedState=null,a}function Fm(a,r,o){var h=r.pendingProps,g=(r.flags&128)!==0;if(r.flags&=-129,a===null){if(_n){if(h.mode==="hidden")return a=Lo(r,h),r.lanes=536870912,Fl(null,a);if(ld(r),(a=Qn)?(a=Ks(a,bs),a=a!==null&&a.data==="&"?a:null,a!==null&&(r.memoizedState={dehydrated:a,treeContext:xr!==null?{id:sr,overflow:rr}:null,retryLane:536870912,hydrationErrors:null},o=Pf(a),o.return=r,r.child=o,Ka=r,Qn=null)):a=null,a===null)throw Zr(r);return r.lanes=536870912,null}return Lo(r,h)}var x=a.memoizedState;if(x!==null){var j=x.dehydrated;if(ld(r),g)if(r.flags&256)r.flags&=-257,r=Fh(a,r,o);else if(r.memoizedState!==null)r.child=a.child,r.flags|=128,r=null;else throw Error(s(558));else if(Pa||To(a,r,o,!1),g=(o&a.childLanes)!==0,Pa||g){if(h=Gn,h!==null&&(j=ue(h,o),j!==0&&j!==x.retryLane))throw x.retryLane=j,$i(a,j),ms(h,a,j),zl;ru(),r=Fh(a,r,o)}else a=x.treeContext,Qn=os(j.nextSibling),Ka=r,_n=!0,Yr=null,bs=!1,a!==null&&Df(r,a),r=Lo(r,h),r.flags|=4096;return r}return a=ar(a.child,{mode:h.mode,children:h.children}),a.ref=r.ref,r.child=a,a.return=r,a}function Hc(a,r){var o=r.ref;if(o===null)a!==null&&a.ref!==null&&(r.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(s(284));(a===null||a.ref!==o)&&(r.flags|=4194816)}}function Nh(a,r,o,h,g){return Ii(r),o=dd(a,r,o,h,void 0,g),h=jc(),a!==null&&!Pa?(hd(a,r,g),Dr(a,r,g)):(_n&&h&&Qu(r),r.flags|=1,Xa(a,r,o,g),r.child)}function jh(a,r,o,h,g,x){return Ii(r),r.updateQueue=null,o=Kf(r,h,o,g),fd(a),h=jc(),a!==null&&!Pa?(hd(a,r,x),Dr(a,r,x)):(_n&&h&&Qu(r),r.flags|=1,Xa(a,r,o,x),r.child)}function Rh(a,r,o,h,g){if(Ii(r),r.stateNode===null){var x=bo,j=o.contextType;typeof j=="object"&&j!==null&&(x=Qa(j)),x=new o(h,x),r.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Dd,r.stateNode=x,x._reactInternals=r,x=r.stateNode,x.props=h,x.state=r.memoizedState,x.refs={},sd(r),j=o.contextType,x.context=typeof j=="object"&&j!==null?Qa(j):bo,x.state=r.memoizedState,j=o.getDerivedStateFromProps,typeof j=="function"&&($d(r,o,j,h),x.state=r.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(j=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),j!==x.state&&Dd.enqueueReplaceState(x,x.state,null),ko(r,h,x,g),Cl(),x.state=r.memoizedState),typeof x.componentDidMount=="function"&&(r.flags|=4194308),h=!0}else if(a===null){x=r.stateNode;var ae=r.memoizedProps,ye=Ui(o,ae);x.props=ye;var Oe=x.context,Xe=o.contextType;j=bo,typeof Xe=="object"&&Xe!==null&&(j=Qa(Xe));var tt=o.getDerivedStateFromProps;Xe=typeof tt=="function"||typeof x.getSnapshotBeforeUpdate=="function",ae=r.pendingProps!==ae,Xe||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(ae||Oe!==j)&&Ch(r,x,h,j),Cr=!1;var Le=r.memoizedState;x.state=Le,ko(r,h,x,g),Cl(),Oe=r.memoizedState,ae||Le!==Oe||Cr?(typeof tt=="function"&&($d(r,o,tt,h),Oe=r.memoizedState),(ye=Cr||ni(r,o,ye,h,Le,Oe,j))?(Xe||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(r.flags|=4194308)):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=Oe),x.props=h,x.state=Oe,x.context=j,h=ye):(typeof x.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{x=r.stateNode,rd(a,r),j=r.memoizedProps,Xe=Ui(o,j),x.props=Xe,tt=r.pendingProps,Le=x.context,Oe=o.contextType,ye=bo,typeof Oe=="object"&&Oe!==null&&(ye=Qa(Oe)),ae=o.getDerivedStateFromProps,(Oe=typeof ae=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(j!==tt||Le!==ye)&&Ch(r,x,h,ye),Cr=!1,Le=r.memoizedState,x.state=Le,ko(r,h,x,g),Cl();var Ve=r.memoizedState;j!==tt||Le!==Ve||Cr||a!==null&&a.dependencies!==null&&kc(a.dependencies)?(typeof ae=="function"&&($d(r,o,ae,h),Ve=r.memoizedState),(Xe=Cr||ni(r,o,Xe,h,Le,Ve,ye)||a!==null&&a.dependencies!==null&&kc(a.dependencies))?(Oe||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(h,Ve,ye),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(h,Ve,ye)),typeof x.componentDidUpdate=="function"&&(r.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof x.componentDidUpdate!="function"||j===a.memoizedProps&&Le===a.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||j===a.memoizedProps&&Le===a.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=Ve),x.props=h,x.state=Ve,x.context=ye,h=Xe):(typeof x.componentDidUpdate!="function"||j===a.memoizedProps&&Le===a.memoizedState||(r.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||j===a.memoizedProps&&Le===a.memoizedState||(r.flags|=1024),h=!1)}return x=h,Hc(a,r),h=(r.flags&128)!==0,x||h?(x=r.stateNode,o=h&&typeof o.getDerivedStateFromError!="function"?null:x.render(),r.flags|=1,a!==null&&h?(r.child=Ni(r,a.child,null,g),r.child=Ni(r,null,o,g)):Xa(a,r,o,g),r.memoizedState=x.state,a=r.child):a=Dr(a,r,g),a}function Bh(a,r,o,h){return Jr(),r.flags|=256,Xa(a,r,o,h),r.child}var Vi={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function zd(a){return{baseLanes:a,cachePool:Nf()}}function Ld(a,r,o){return a=a!==null?a.childLanes&~o:0,r&&(a|=Es),a}function Uh(a,r,o){var h=r.pendingProps,g=!1,x=(r.flags&128)!==0,j;if((j=x)||(j=a!==null&&a.memoizedState===null?!1:(oa.current&2)!==0),j&&(g=!0,r.flags&=-129),j=(r.flags&32)!==0,r.flags&=-33,a===null){if(_n){if(g?Pr(r):ti(),(a=Qn)?(a=Ks(a,bs),a=a!==null&&a.data!=="&"?a:null,a!==null&&(r.memoizedState={dehydrated:a,treeContext:xr!==null?{id:sr,overflow:rr}:null,retryLane:536870912,hydrationErrors:null},o=Pf(a),o.return=r,r.child=o,Ka=r,Qn=null)):a=null,a===null)throw Zr(r);return Xi(a)?r.lanes=32:r.lanes=536870912,null}var ae=h.children;return h=h.fallback,g?(ti(),g=r.mode,ae=qc({mode:"hidden",children:ae},g),h=Xr(h,g,o,null),ae.return=r,h.return=r,ae.sibling=h,r.child=ae,h=r.child,h.memoizedState=zd(o),h.childLanes=Ld(a,j,o),r.memoizedState=Vi,Fl(null,h)):(Pr(r),Fd(r,ae))}var ye=a.memoizedState;if(ye!==null&&(ae=ye.dehydrated,ae!==null)){if(x)r.flags&256?(Pr(r),r.flags&=-257,r=Nd(a,r,o)):r.memoizedState!==null?(ti(),r.child=a.child,r.flags|=128,r=null):(ti(),ae=h.fallback,g=r.mode,h=qc({mode:"visible",children:h.children},g),ae=Xr(ae,g,o,null),ae.flags|=2,h.return=r,ae.return=r,h.sibling=ae,r.child=h,Ni(r,a.child,null,o),h=r.child,h.memoizedState=zd(o),h.childLanes=Ld(a,j,o),r.memoizedState=Vi,r=Fl(null,h));else if(Pr(r),Xi(ae)){if(j=ae.nextSibling&&ae.nextSibling.dataset,j)var Oe=j.dgst;j=Oe,h=Error(s(419)),h.stack="",h.digest=j,vl({value:h,source:null,stack:null}),r=Nd(a,r,o)}else if(Pa||To(a,r,o,!1),j=(o&a.childLanes)!==0,Pa||j){if(j=Gn,j!==null&&(h=ue(j,o),h!==0&&h!==ye.retryLane))throw ye.retryLane=h,$i(a,h),ms(j,a,h),zl;Qi(ae)||ru(),r=Nd(a,r,o)}else Qi(ae)?(r.flags|=192,r.child=a.child,r=null):(a=ye.treeContext,Qn=os(ae.nextSibling),Ka=r,_n=!0,Yr=null,bs=!1,a!==null&&Df(r,a),r=Fd(r,h.children),r.flags|=4096);return r}return g?(ti(),ae=h.fallback,g=r.mode,ye=a.child,Oe=ye.sibling,h=ar(ye,{mode:"hidden",children:h.children}),h.subtreeFlags=ye.subtreeFlags&65011712,Oe!==null?ae=ar(Oe,ae):(ae=Xr(ae,g,o,null),ae.flags|=2),ae.return=r,h.return=r,h.sibling=ae,r.child=h,Fl(null,h),h=r.child,ae=a.child.memoizedState,ae===null?ae=zd(o):(g=ae.cachePool,g!==null?(ye=Aa._currentValue,g=g.parent!==ye?{parent:ye,pool:ye}:g):g=Nf(),ae={baseLanes:ae.baseLanes|o,cachePool:g}),h.memoizedState=ae,h.childLanes=Ld(a,j,o),r.memoizedState=Vi,Fl(a.child,h)):(Pr(r),o=a.child,a=o.sibling,o=ar(o,{mode:"visible",children:h.children}),o.return=r,o.sibling=null,a!==null&&(j=r.deletions,j===null?(r.deletions=[a],r.flags|=16):j.push(a)),r.child=o,r.memoizedState=null,o)}function Fd(a,r){return r=qc({mode:"visible",children:r},a.mode),r.return=a,a.child=r}function qc(a,r){return a=vs(22,a,null,r),a.lanes=0,a}function Nd(a,r,o){return Ni(r,a.child,null,o),a=Fd(r,r.pendingProps.children),a.flags|=2,r.memoizedState=null,a}function Vh(a,r,o){a.lanes|=r;var h=a.alternate;h!==null&&(h.lanes|=r),Ju(a.return,r,o)}function Nl(a,r,o,h,g,x){var j=a.memoizedState;j===null?a.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:o,tailMode:g,treeForkCount:x}:(j.isBackwards=r,j.rendering=null,j.renderingStartTime=0,j.last=h,j.tail=o,j.tailMode=g,j.treeForkCount=x)}function Nm(a,r,o){var h=r.pendingProps,g=h.revealOrder,x=h.tail;h=h.children;var j=oa.current,ae=(j&2)!==0;if(ae?(j=j&1|2,r.flags|=128):j&=1,H(oa,j),Xa(a,r,h,o),h=_n?Mo:0,!ae&&a!==null&&(a.flags&128)!==0)e:for(a=r.child;a!==null;){if(a.tag===13)a.memoizedState!==null&&Vh(a,o,r);else if(a.tag===19)Vh(a,o,r);else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}switch(g){case"forwards":for(o=r.child,g=null;o!==null;)a=o.alternate,a!==null&&Pl(a)===null&&(g=o),o=o.sibling;o=g,o===null?(g=r.child,r.child=null):(g=o.sibling,o.sibling=null),Nl(r,!1,g,o,x,h);break;case"backwards":case"unstable_legacy-backwards":for(o=null,g=r.child,r.child=null;g!==null;){if(a=g.alternate,a!==null&&Pl(a)===null){r.child=g;break}a=g.sibling,g.sibling=o,o=g,g=a}Nl(r,!0,o,null,x,h);break;case"together":Nl(r,!1,null,null,void 0,h);break;default:r.memoizedState=null}return r.child}function Dr(a,r,o){if(a!==null&&(r.dependencies=a.dependencies),dr|=r.lanes,(o&r.childLanes)===0)if(a!==null){if(To(a,r,o,!1),(o&r.childLanes)===0)return null}else return null;if(a!==null&&r.child!==a.child)throw Error(s(153));if(r.child!==null){for(a=r.child,o=ar(a,a.pendingProps),r.child=o,o.return=r;a.sibling!==null;)a=a.sibling,o=o.sibling=ar(a,a.pendingProps),o.return=r;o.sibling=null}return r.child}function jd(a,r){return(a.lanes&r)!==0?!0:(a=a.dependencies,!!(a!==null&&kc(a)))}function jm(a,r,o){switch(r.tag){case 3:ze(r,r.stateNode.containerInfo),Er(r,Aa,a.memoizedState.cache),Jr();break;case 27:case 5:Re(r);break;case 4:ze(r,r.stateNode.containerInfo);break;case 10:Er(r,r.type,r.memoizedProps.value);break;case 31:if(r.memoizedState!==null)return r.flags|=128,ld(r),null;break;case 13:var h=r.memoizedState;if(h!==null)return h.dehydrated!==null?(Pr(r),r.flags|=128,null):(o&r.child.childLanes)!==0?Uh(a,r,o):(Pr(r),a=Dr(a,r,o),a!==null?a.sibling:null);Pr(r);break;case 19:var g=(a.flags&128)!==0;if(h=(o&r.childLanes)!==0,h||(To(a,r,o,!1),h=(o&r.childLanes)!==0),g){if(h)return Nm(a,r,o);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),H(oa,oa.current),h)break;return null;case 22:return r.lanes=0,zh(a,r,o,r.pendingProps);case 24:Er(r,Aa,a.memoizedState.cache)}return Dr(a,r,o)}function Gh(a,r,o){if(a!==null)if(a.memoizedProps!==r.pendingProps)Pa=!0;else{if(!jd(a,o)&&(r.flags&128)===0)return Pa=!1,jm(a,r,o);Pa=(a.flags&131072)!==0}else Pa=!1,_n&&(r.flags&1048576)!==0&&$f(r,Mo,r.index);switch(r.lanes=0,r.tag){case 16:e:{var h=r.pendingProps;if(a=Li(r.elementType),r.type=a,typeof a=="function")qu(a)?(h=Ui(a,h),r.tag=1,r=Rh(null,r,a,h,o)):(r.tag=0,r=Nh(null,r,a,h,o));else{if(a!=null){var g=a.$$typeof;if(g===w){r.tag=11,r=Oh(null,r,a,h,o);break e}else if(g===A){r.tag=14,r=Ll(null,r,a,h,o);break e}}throw r=Q(a)||a,Error(s(306,r,""))}}return r;case 0:return Nh(a,r,r.type,r.pendingProps,o);case 1:return h=r.type,g=Ui(h,r.pendingProps),Rh(a,r,h,g,o);case 3:e:{if(ze(r,r.stateNode.containerInfo),a===null)throw Error(s(387));h=r.pendingProps;var x=r.memoizedState;g=x.element,rd(a,r),ko(r,h,null,o);var j=r.memoizedState;if(h=j.cache,Er(r,Aa,h),h!==x.cache&&Pc(r,[Aa],o,!0),Cl(),h=j.element,x.isDehydrated)if(x={element:h,isDehydrated:!1,cache:j.cache},r.updateQueue.baseState=x,r.memoizedState=x,r.flags&256){r=Bh(a,r,h,o);break e}else if(h!==g){g=zs(Error(s(424)),r),vl(g),r=Bh(a,r,h,o);break e}else for(a=r.stateNode.containerInfo,a.nodeType===9?a=a.body:a=a.nodeName==="HTML"?a.ownerDocument.body:a,Qn=os(a.firstChild),Ka=r,_n=!0,Yr=null,bs=!0,o=Vf(r,null,h,o),r.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Jr(),h===g){r=Dr(a,r,o);break e}Xa(a,r,h,o)}r=r.child}return r;case 26:return Hc(a,r),a===null?(o=Zi(r.type,null,r.pendingProps,null))?r.memoizedState=o:_n||(o=r.type,a=r.pendingProps,h=Bt(ve.current).createElement(o),h[ut]=r,h[xt]=a,Se(h,o,a),Hn(h),r.stateNode=h):r.memoizedState=Zi(r.type,a.memoizedProps,r.pendingProps,a.memoizedState),null;case 27:return Re(r),a===null&&_n&&(h=r.stateNode=oi(r.type,r.pendingProps,ve.current),Ka=r,bs=!0,g=Qn,Bn(r.type)?(kp=g,Qn=os(h.firstChild)):Qn=g),Xa(a,r,r.pendingProps.children,o),Hc(a,r),a===null&&(r.flags|=4194304),r.child;case 5:return a===null&&_n&&((g=h=Qn)&&(h=Vo(h,r.type,r.pendingProps,bs),h!==null?(r.stateNode=h,Ka=r,Qn=os(h.firstChild),bs=!1,g=!0):g=!1),g||Zr(r)),Re(r),g=r.type,x=r.pendingProps,j=a!==null?a.memoizedProps:null,h=x.children,pn(g,x)?h=null:j!==null&&pn(g,j)&&(r.flags|=32),r.memoizedState!==null&&(g=dd(a,r,$m,null,null,o),Lp._currentValue=g),Hc(a,r),Xa(a,r,h,o),r.child;case 6:return a===null&&_n&&((a=o=Qn)&&(o=_s(o,r.pendingProps,bs),o!==null?(r.stateNode=o,Ka=r,Qn=null,a=!0):a=!1),a||Zr(r)),null;case 13:return Uh(a,r,o);case 4:return ze(r,r.stateNode.containerInfo),h=r.pendingProps,a===null?r.child=Ni(r,null,h,o):Xa(a,r,h,o),r.child;case 11:return Oh(a,r,r.type,r.pendingProps,o);case 7:return Xa(a,r,r.pendingProps,o),r.child;case 8:return Xa(a,r,r.pendingProps.children,o),r.child;case 12:return Xa(a,r,r.pendingProps.children,o),r.child;case 10:return h=r.pendingProps,Er(r,r.type,h.value),Xa(a,r,h.children,o),r.child;case 9:return g=r.type._context,h=r.pendingProps.children,Ii(r),g=Qa(g),h=h(g),r.flags|=1,Xa(a,r,h,o),r.child;case 14:return Ll(a,r,r.type,r.pendingProps,o);case 15:return Ih(a,r,r.type,r.pendingProps,o);case 19:return Nm(a,r,o);case 31:return Fm(a,r,o);case 22:return zh(a,r,o,r.pendingProps);case 24:return Ii(r),h=Qa(Aa),a===null?(g=td(),g===null&&(g=Gn,x=$c(),g.pooledCache=x,x.refCount++,x!==null&&(g.pooledCacheLanes|=o),g=x),r.memoizedState={parent:h,cache:g},sd(r),Er(r,Aa,g)):((a.lanes&o)!==0&&(rd(a,r),ko(r,null,null,o),Cl()),g=a.memoizedState,x=r.memoizedState,g.parent!==h?(g={parent:h,cache:h},r.memoizedState=g,r.lanes===0&&(r.memoizedState=r.updateQueue.baseState=g),Er(r,Aa,h)):(h=x.cache,Er(r,Aa,h),h!==g.cache&&Pc(r,[Aa],o,!0))),Xa(a,r,r.pendingProps.children,o),r.child;case 29:throw r.pendingProps}throw Error(s(156,r.tag))}function or(a){a.flags|=4}function Rd(a,r,o,h,g){if((r=(a.mode&32)!==0)&&(r=!1),r){if(a.flags|=16777216,(g&335544128)===g)if(a.stateNode.complete)a.flags|=8192;else if(fp())a.flags|=8192;else throw Fi=Tl,nd}else a.flags&=-16777217}function Wh(a,r){if(r.type!=="stylesheet"||(r.state.loading&4)!==0)a.flags&=-16777217;else if(a.flags|=16777216,!jv(r))if(fp())a.flags|=8192;else throw Fi=Tl,nd}function jl(a,r){r!==null&&(a.flags|=4),a.flags&16384&&(r=a.tag!==22?Ys():536870912,a.lanes|=r,Ro|=r)}function Rl(a,r){if(!_n)switch(a.tailMode){case"hidden":r=a.tail;for(var o=null;r!==null;)r.alternate!==null&&(o=r),r=r.sibling;o===null?a.tail=null:o.sibling=null;break;case"collapsed":o=a.tail;for(var h=null;o!==null;)o.alternate!==null&&(h=o),o=o.sibling;h===null?r||a.tail===null?a.tail=null:a.tail.sibling=null:h.sibling=null}}function ta(a){var r=a.alternate!==null&&a.alternate.child===a.child,o=0,h=0;if(r)for(var g=a.child;g!==null;)o|=g.lanes|g.childLanes,h|=g.subtreeFlags&65011712,h|=g.flags&65011712,g.return=a,g=g.sibling;else for(g=a.child;g!==null;)o|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=a,g=g.sibling;return a.subtreeFlags|=h,a.childLanes=o,r}function Hh(a,r,o){var h=r.pendingProps;switch(Cc(r),r.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ta(r),null;case 1:return ta(r),null;case 3:return o=r.stateNode,h=null,a!==null&&(h=a.memoizedState.cache),r.memoizedState.cache!==h&&(r.flags|=2048),Sr(Aa),Ze(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(a===null||a.child===null)&&(xo(r)?or(r):a===null||a.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Zu())),ta(r),null;case 26:var g=r.type,x=r.memoizedState;return a===null?(or(r),x!==null?(ta(r),Wh(r,x)):(ta(r),Rd(r,g,null,h,o))):x?x!==a.memoizedState?(or(r),ta(r),Wh(r,x)):(ta(r),r.flags&=-16777217):(a=a.memoizedProps,a!==h&&or(r),ta(r),Rd(r,g,a,h,o)),null;case 27:if(de(r),o=ve.current,g=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==h&&or(r);else{if(!h){if(r.stateNode===null)throw Error(s(166));return ta(r),null}a=B.current,xo(r)?Yu(r):(a=oi(g,h,o),r.stateNode=a,or(r))}return ta(r),null;case 5:if(de(r),g=r.type,a!==null&&r.stateNode!=null)a.memoizedProps!==h&&or(r);else{if(!h){if(r.stateNode===null)throw Error(s(166));return ta(r),null}if(x=B.current,xo(r))Yu(r);else{var j=Bt(ve.current);switch(x){case 1:x=j.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:x=j.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":x=j.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":x=j.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":x=j.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof h.is=="string"?j.createElement("select",{is:h.is}):j.createElement("select"),h.multiple?x.multiple=!0:h.size&&(x.size=h.size);break;default:x=typeof h.is=="string"?j.createElement(g,{is:h.is}):j.createElement(g)}}x[ut]=r,x[xt]=h;e:for(j=r.child;j!==null;){if(j.tag===5||j.tag===6)x.appendChild(j.stateNode);else if(j.tag!==4&&j.tag!==27&&j.child!==null){j.child.return=j,j=j.child;continue}if(j===r)break e;for(;j.sibling===null;){if(j.return===null||j.return===r)break e;j=j.return}j.sibling.return=j.return,j=j.sibling}r.stateNode=x;e:switch(Se(x,g,h),g){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}h&&or(r)}}return ta(r),Rd(r,r.type,a===null?null:a.memoizedProps,r.pendingProps,o),null;case 6:if(a&&r.stateNode!=null)a.memoizedProps!==h&&or(r);else{if(typeof h!="string"&&r.stateNode===null)throw Error(s(166));if(a=ve.current,xo(r)){if(a=r.stateNode,o=r.memoizedProps,h=null,g=Ka,g!==null)switch(g.tag){case 27:case 5:h=g.memoizedProps}a[ut]=r,a=!!(a.nodeValue===o||h!==null&&h.suppressHydrationWarning===!0||se(a.nodeValue,o)),a||Zr(r,!0)}else a=Bt(a).createTextNode(h),a[ut]=r,r.stateNode=a}return ta(r),null;case 31:if(o=r.memoizedState,a===null||a.memoizedState!==null){if(h=xo(r),o!==null){if(a===null){if(!h)throw Error(s(318));if(a=r.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(s(557));a[ut]=r}else Jr(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;ta(r),a=!1}else o=Zu(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=o),a=!0;if(!a)return r.flags&256?(xs(r),r):(xs(r),null);if((r.flags&128)!==0)throw Error(s(558))}return ta(r),null;case 13:if(h=r.memoizedState,a===null||a.memoizedState!==null&&a.memoizedState.dehydrated!==null){if(g=xo(r),h!==null&&h.dehydrated!==null){if(a===null){if(!g)throw Error(s(318));if(g=r.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(s(317));g[ut]=r}else Jr(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;ta(r),g=!1}else g=Zu(),a!==null&&a.memoizedState!==null&&(a.memoizedState.hydrationErrors=g),g=!0;if(!g)return r.flags&256?(xs(r),r):(xs(r),null)}return xs(r),(r.flags&128)!==0?(r.lanes=o,r):(o=h!==null,a=a!==null&&a.memoizedState!==null,o&&(h=r.child,g=null,h.alternate!==null&&h.alternate.memoizedState!==null&&h.alternate.memoizedState.cachePool!==null&&(g=h.alternate.memoizedState.cachePool.pool),x=null,h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(x=h.memoizedState.cachePool.pool),x!==g&&(h.flags|=2048)),o!==a&&o&&(r.child.flags|=8192),jl(r,r.updateQueue),ta(r),null);case 4:return Ze(),a===null&&of(r.stateNode.containerInfo),ta(r),null;case 10:return Sr(r.type),ta(r),null;case 19:if(K(oa),h=r.memoizedState,h===null)return ta(r),null;if(g=(r.flags&128)!==0,x=h.rendering,x===null)if(g)Rl(h,!1);else{if(va!==0||a!==null&&(a.flags&128)!==0)for(a=r.child;a!==null;){if(x=Pl(a),x!==null){for(r.flags|=128,Rl(h,!1),a=x.updateQueue,r.updateQueue=a,jl(r,a),r.subtreeFlags=0,a=o,o=r.child;o!==null;)Af(o,a),o=o.sibling;return H(oa,oa.current&1|2),_n&&ir(r,h.treeForkCount),r.child}a=a.sibling}h.tail!==null&&mt()>eu&&(r.flags|=128,g=!0,Rl(h,!1),r.lanes=4194304)}else{if(!g)if(a=Pl(x),a!==null){if(r.flags|=128,g=!0,a=a.updateQueue,r.updateQueue=a,jl(r,a),Rl(h,!0),h.tail===null&&h.tailMode==="hidden"&&!x.alternate&&!_n)return ta(r),null}else 2*mt()-h.renderingStartTime>eu&&o!==536870912&&(r.flags|=128,g=!0,Rl(h,!1),r.lanes=4194304);h.isBackwards?(x.sibling=r.child,r.child=x):(a=h.last,a!==null?a.sibling=x:r.child=x,h.last=x)}return h.tail!==null?(a=h.tail,h.rendering=a,h.tail=a.sibling,h.renderingStartTime=mt(),a.sibling=null,o=oa.current,H(oa,g?o&1|2:o&1),_n&&ir(r,h.treeForkCount),a):(ta(r),null);case 22:case 23:return xs(r),od(),h=r.memoizedState!==null,a!==null?a.memoizedState!==null!==h&&(r.flags|=8192):h&&(r.flags|=8192),h?(o&536870912)!==0&&(r.flags&128)===0&&(ta(r),r.subtreeFlags&6&&(r.flags|=8192)):ta(r),o=r.updateQueue,o!==null&&jl(r,o.retryQueue),o=null,a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(o=a.memoizedState.cachePool.pool),h=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(h=r.memoizedState.cachePool.pool),h!==o&&(r.flags|=2048),a!==null&&K(zi),null;case 24:return o=null,a!==null&&(o=a.memoizedState.cache),r.memoizedState.cache!==o&&(r.flags|=2048),Sr(Aa),ta(r),null;case 25:return null;case 30:return null}throw Error(s(156,r.tag))}function Rm(a,r){switch(Cc(r),r.tag){case 1:return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 3:return Sr(Aa),Ze(),a=r.flags,(a&65536)!==0&&(a&128)===0?(r.flags=a&-65537|128,r):null;case 26:case 27:case 5:return de(r),null;case 31:if(r.memoizedState!==null){if(xs(r),r.alternate===null)throw Error(s(340));Jr()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 13:if(xs(r),a=r.memoizedState,a!==null&&a.dehydrated!==null){if(r.alternate===null)throw Error(s(340));Jr()}return a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 19:return K(oa),null;case 4:return Ze(),null;case 10:return Sr(r.type),null;case 22:case 23:return xs(r),od(),a!==null&&K(zi),a=r.flags,a&65536?(r.flags=a&-65537|128,r):null;case 24:return Sr(Aa),null;case 25:return null;default:return null}}function qh(a,r){switch(Cc(r),r.tag){case 3:Sr(Aa),Ze();break;case 26:case 27:case 5:de(r);break;case 4:Ze();break;case 31:r.memoizedState!==null&&xs(r);break;case 13:xs(r);break;case 19:K(oa);break;case 10:Sr(r.type);break;case 22:case 23:xs(r),od(),a!==null&&K(zi);break;case 24:Sr(Aa)}}function Fo(a,r){try{var o=r.updateQueue,h=o!==null?o.lastEffect:null;if(h!==null){var g=h.next;o=g;do{if((o.tag&a)===a){h=void 0;var x=o.create,j=o.inst;h=x(),j.destroy=h}o=o.next}while(o!==g)}}catch(ae){Rn(r,r.return,ae)}}function ai(a,r,o){try{var h=r.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var x=g.next;h=x;do{if((h.tag&a)===a){var j=h.inst,ae=j.destroy;if(ae!==void 0){j.destroy=void 0,g=r;var ye=o,Oe=ae;try{Oe()}catch(Xe){Rn(g,ye,Xe)}}}h=h.next}while(h!==x)}}catch(Xe){Rn(r,r.return,Xe)}}function Kh(a){var r=a.updateQueue;if(r!==null){var o=a.stateNode;try{Wf(r,o)}catch(h){Rn(a,a.return,h)}}}function Bd(a,r,o){o.props=Ui(a.type,a.memoizedProps),o.state=a.memoizedState;try{o.componentWillUnmount()}catch(h){Rn(a,r,h)}}function Bl(a,r){try{var o=a.ref;if(o!==null){switch(a.tag){case 26:case 27:case 5:var h=a.stateNode;break;case 30:h=a.stateNode;break;default:h=a.stateNode}typeof o=="function"?a.refCleanup=o(h):o.current=h}}catch(g){Rn(a,r,g)}}function lr(a,r){var o=a.ref,h=a.refCleanup;if(o!==null)if(typeof h=="function")try{h()}catch(g){Rn(a,r,g)}finally{a.refCleanup=null,a=a.alternate,a!=null&&(a.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(g){Rn(a,r,g)}else o.current=null}function Ud(a){var r=a.type,o=a.memoizedProps,h=a.stateNode;try{e:switch(r){case"button":case"input":case"select":case"textarea":o.autoFocus&&h.focus();break e;case"img":o.src?h.src=o.src:o.srcSet&&(h.srcset=o.srcSet)}}catch(g){Rn(a,a.return,g)}}function Vd(a,r,o){try{var h=a.stateNode;Ke(h,a.type,o,r),h[xt]=r}catch(g){Rn(a,a.return,g)}}function Qh(a){return a.tag===5||a.tag===3||a.tag===26||a.tag===27&&Bn(a.type)||a.tag===4}function Kc(a){e:for(;;){for(;a.sibling===null;){if(a.return===null||Qh(a.return))return null;a=a.return}for(a.sibling.return=a.return,a=a.sibling;a.tag!==5&&a.tag!==6&&a.tag!==18;){if(a.tag===27&&Bn(a.type)||a.flags&2||a.child===null||a.tag===4)continue e;a.child.return=a,a=a.child}if(!(a.flags&2))return a.stateNode}}function Gd(a,r,o){var h=a.tag;if(h===5||h===6)a=a.stateNode,r?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(a,r):(r=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,r.appendChild(a),o=o._reactRootContainer,o!=null||r.onclick!==null||(r.onclick=jt));else if(h!==4&&(h===27&&Bn(a.type)&&(o=a.stateNode,r=null),a=a.child,a!==null))for(Gd(a,r,o),a=a.sibling;a!==null;)Gd(a,r,o),a=a.sibling}function Qc(a,r,o){var h=a.tag;if(h===5||h===6)a=a.stateNode,r?o.insertBefore(a,r):o.appendChild(a);else if(h!==4&&(h===27&&Bn(a.type)&&(o=a.stateNode),a=a.child,a!==null))for(Qc(a,r,o),a=a.sibling;a!==null;)Qc(a,r,o),a=a.sibling}function Xc(a){var r=a.stateNode,o=a.memoizedProps;try{for(var h=a.type,g=r.attributes;g.length;)r.removeAttributeNode(g[0]);Se(r,h,o),r[ut]=a,r[xt]=o}catch(x){Rn(a,a.return,x)}}var Or=!1,ka=!1,Wd=!1,Xh=typeof WeakSet=="function"?WeakSet:Set,Na=null;function Hd(a,r){if(a=a.containerInfo,Tt=d_,a=_l(a),Qr(a)){if("selectionStart"in a)var o={start:a.selectionStart,end:a.selectionEnd};else e:{o=(o=a.ownerDocument)&&o.defaultView||window;var h=o.getSelection&&o.getSelection();if(h&&h.rangeCount!==0){o=h.anchorNode;var g=h.anchorOffset,x=h.focusNode;h=h.focusOffset;try{o.nodeType,x.nodeType}catch{o=null;break e}var j=0,ae=-1,ye=-1,Oe=0,Xe=0,tt=a,Le=null;t:for(;;){for(var Ve;tt!==o||g!==0&&tt.nodeType!==3||(ae=j+g),tt!==x||h!==0&&tt.nodeType!==3||(ye=j+h),tt.nodeType===3&&(j+=tt.nodeValue.length),(Ve=tt.firstChild)!==null;)Le=tt,tt=Ve;for(;;){if(tt===a)break t;if(Le===o&&++Oe===g&&(ae=j),Le===x&&++Xe===h&&(ye=j),(Ve=tt.nextSibling)!==null)break;tt=Le,Le=tt.parentNode}tt=Ve}o=ae===-1||ye===-1?null:{start:ae,end:ye}}else o=null}o=o||{start:0,end:0}}else o=null;for(Vt={focusedElem:a,selectionRange:o},d_=!1,Na=r;Na!==null;)if(r=Na,a=r.child,(r.subtreeFlags&1028)!==0&&a!==null)a.return=r,Na=a;else for(;Na!==null;){switch(r=Na,x=r.alternate,a=r.flags,r.tag){case 0:if((a&4)!==0&&(a=r.updateQueue,a=a!==null?a.events:null,a!==null))for(o=0;o<a.length;o++)g=a[o],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((a&1024)!==0&&x!==null){a=void 0,o=r,g=x.memoizedProps,x=x.memoizedState,h=o.stateNode;try{var kt=Ui(o.type,g);a=h.getSnapshotBeforeUpdate(kt,x),h.__reactInternalSnapshotBeforeUpdate=a}catch(Qt){Rn(o,o.return,Qt)}}break;case 3:if((a&1024)!==0){if(a=r.stateNode.containerInfo,o=a.nodeType,o===9)Ia(a);else if(o===1)switch(a.nodeName){case"HEAD":case"HTML":case"BODY":Ia(a);break;default:a.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((a&1024)!==0)throw Error(s(163))}if(a=r.sibling,a!==null){a.return=r.return,Na=a;break}Na=r.return}}function Bm(a,r,o){var h=o.flags;switch(o.tag){case 0:case 11:case 15:zr(a,o),h&4&&Fo(5,o);break;case 1:if(zr(a,o),h&4)if(a=o.stateNode,r===null)try{a.componentDidMount()}catch(j){Rn(o,o.return,j)}else{var g=Ui(o.type,r.memoizedProps);r=r.memoizedState;try{a.componentDidUpdate(g,r,a.__reactInternalSnapshotBeforeUpdate)}catch(j){Rn(o,o.return,j)}}h&64&&Kh(o),h&512&&Bl(o,o.return);break;case 3:if(zr(a,o),h&64&&(a=o.updateQueue,a!==null)){if(r=null,o.child!==null)switch(o.child.tag){case 27:case 5:r=o.child.stateNode;break;case 1:r=o.child.stateNode}try{Wf(a,r)}catch(j){Rn(o,o.return,j)}}break;case 27:r===null&&h&4&&Xc(o);case 26:case 5:zr(a,o),r===null&&h&4&&Ud(o),h&512&&Bl(o,o.return);break;case 12:zr(a,o);break;case 31:zr(a,o),h&4&&qd(a,o);break;case 13:zr(a,o),h&4&&Jh(a,o),h&64&&(a=o.memoizedState,a!==null&&(a=a.dehydrated,a!==null&&(o=wg.bind(null,o),lf(a,o))));break;case 22:if(h=o.memoizedState!==null||Or,!h){r=r!==null&&r.memoizedState!==null||ka,g=Or;var x=ka;Or=h,(ka=r)&&!x?Hs(a,o,(o.subtreeFlags&8772)!==0):zr(a,o),Or=g,ka=x}break;case 30:break;default:zr(a,o)}}function Yh(a){var r=a.alternate;r!==null&&(a.alternate=null,Yh(r)),a.child=null,a.deletions=null,a.sibling=null,a.tag===5&&(r=a.stateNode,r!==null&&ra(r)),a.stateNode=null,a.return=null,a.dependencies=null,a.memoizedProps=null,a.memoizedState=null,a.pendingProps=null,a.stateNode=null,a.updateQueue=null}var la=null,is=!1;function Ir(a,r,o){for(o=o.child;o!==null;)Zh(a,r,o),o=o.sibling}function Zh(a,r,o){if(Mn&&typeof Mn.onCommitFiberUnmount=="function")try{Mn.onCommitFiberUnmount(Ht,o)}catch{}switch(o.tag){case 26:ka||lr(o,r),Ir(a,r,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:ka||lr(o,r);var h=la,g=is;Bn(o.type)&&(la=o.stateNode,is=!1),Ir(a,r,o),pr(o.stateNode),la=h,is=g;break;case 5:ka||lr(o,r);case 6:if(h=la,g=is,la=null,Ir(a,r,o),la=h,is=g,la!==null)if(is)try{(la.nodeType===9?la.body:la.nodeName==="HTML"?la.ownerDocument.body:la).removeChild(o.stateNode)}catch(x){Rn(o,r,x)}else try{la.removeChild(o.stateNode)}catch(x){Rn(o,r,x)}break;case 18:la!==null&&(is?(a=la,sn(a.nodeType===9?a.body:a.nodeName==="HTML"?a.ownerDocument.body:a,o.stateNode),df(a)):sn(la,o.stateNode));break;case 4:h=la,g=is,la=o.stateNode.containerInfo,is=!0,Ir(a,r,o),la=h,is=g;break;case 0:case 11:case 14:case 15:ai(2,o,r),ka||ai(4,o,r),Ir(a,r,o);break;case 1:ka||(lr(o,r),h=o.stateNode,typeof h.componentWillUnmount=="function"&&Bd(o,r,h)),Ir(a,r,o);break;case 21:Ir(a,r,o);break;case 22:ka=(h=ka)||o.memoizedState!==null,Ir(a,r,o),ka=h;break;default:Ir(a,r,o)}}function qd(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null))){a=a.dehydrated;try{df(a)}catch(o){Rn(r,r.return,o)}}}function Jh(a,r){if(r.memoizedState===null&&(a=r.alternate,a!==null&&(a=a.memoizedState,a!==null&&(a=a.dehydrated,a!==null))))try{df(a)}catch(o){Rn(r,r.return,o)}}function Um(a){switch(a.tag){case 31:case 13:case 19:var r=a.stateNode;return r===null&&(r=a.stateNode=new Xh),r;case 22:return a=a.stateNode,r=a._retryCache,r===null&&(r=a._retryCache=new Xh),r;default:throw Error(s(435,a.tag))}}function Ul(a,r){var o=Um(a);r.forEach(function(h){if(!o.has(h)){o.add(h);var g=Mg.bind(null,a,h);h.then(g,g)}})}function Ts(a,r){var o=r.deletions;if(o!==null)for(var h=0;h<o.length;h++){var g=o[h],x=a,j=r,ae=j;e:for(;ae!==null;){switch(ae.tag){case 27:if(Bn(ae.type)){la=ae.stateNode,is=!1;break e}break;case 5:la=ae.stateNode,is=!1;break e;case 3:case 4:la=ae.stateNode.containerInfo,is=!0;break e}ae=ae.return}if(la===null)throw Error(s(160));Zh(x,j,g),la=null,is=!1,x=g.alternate,x!==null&&(x.return=null),g.return=null}if(r.subtreeFlags&13886)for(r=r.child;r!==null;)Kd(r,a),r=r.sibling}var cr=null;function Kd(a,r){var o=a.alternate,h=a.flags;switch(a.tag){case 0:case 11:case 14:case 15:Ts(r,a),es(a),h&4&&(ai(3,a,a.return),Fo(3,a),ai(5,a,a.return));break;case 1:Ts(r,a),es(a),h&512&&(ka||o===null||lr(o,o.return)),h&64&&Or&&(a=a.updateQueue,a!==null&&(h=a.callbacks,h!==null&&(o=a.shared.hiddenCallbacks,a.shared.hiddenCallbacks=o===null?h:o.concat(h))));break;case 26:var g=cr;if(Ts(r,a),es(a),h&512&&(ka||o===null||lr(o,o.return)),h&4){var x=o!==null?o.memoizedState:null;if(h=a.memoizedState,o===null)if(h===null)if(a.stateNode===null){e:{h=a.type,o=a.memoizedProps,g=g.ownerDocument||g;t:switch(h){case"title":x=g.getElementsByTagName("title")[0],(!x||x[sa]||x[ut]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=g.createElement(h),g.head.insertBefore(x,g.querySelector("head > title"))),Se(x,h,o),x[ut]=a,Hn(x),h=x;break e;case"link":var j=Fv("link","href",g).get(h+(o.href||""));if(j){for(var ae=0;ae<j.length;ae++)if(x=j[ae],x.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&x.getAttribute("rel")===(o.rel==null?null:o.rel)&&x.getAttribute("title")===(o.title==null?null:o.title)&&x.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){j.splice(ae,1);break t}}x=g.createElement(h),Se(x,h,o),g.head.appendChild(x);break;case"meta":if(j=Fv("meta","content",g).get(h+(o.content||""))){for(ae=0;ae<j.length;ae++)if(x=j[ae],x.getAttribute("content")===(o.content==null?null:""+o.content)&&x.getAttribute("name")===(o.name==null?null:o.name)&&x.getAttribute("property")===(o.property==null?null:o.property)&&x.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&x.getAttribute("charset")===(o.charSet==null?null:o.charSet)){j.splice(ae,1);break t}}x=g.createElement(h),Se(x,h,o),g.head.appendChild(x);break;default:throw Error(s(468,h))}x[ut]=a,Hn(x),h=x}a.stateNode=h}else Nv(g,a.type,a.stateNode);else a.stateNode=Lv(g,h,a.memoizedProps);else x!==h?(x===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):x.count--,h===null?Nv(g,a.type,a.stateNode):Lv(g,h,a.memoizedProps)):h===null&&a.stateNode!==null&&Vd(a,a.memoizedProps,o.memoizedProps)}break;case 27:Ts(r,a),es(a),h&512&&(ka||o===null||lr(o,o.return)),o!==null&&h&4&&Vd(a,a.memoizedProps,o.memoizedProps);break;case 5:if(Ts(r,a),es(a),h&512&&(ka||o===null||lr(o,o.return)),a.flags&32){g=a.stateNode;try{me(g,"")}catch(kt){Rn(a,a.return,kt)}}h&4&&a.stateNode!=null&&(g=a.memoizedProps,Vd(a,g,o!==null?o.memoizedProps:g)),h&1024&&(Wd=!0);break;case 6:if(Ts(r,a),es(a),h&4){if(a.stateNode===null)throw Error(s(162));h=a.memoizedProps,o=a.stateNode;try{o.nodeValue=h}catch(kt){Rn(a,a.return,kt)}}break;case 3:if(o_=null,g=cr,cr=Ql(r.containerInfo),Ts(r,a),cr=g,es(a),h&4&&o!==null&&o.memoizedState.isDehydrated)try{df(r.containerInfo)}catch(kt){Rn(a,a.return,kt)}Wd&&(Wd=!1,ep(a));break;case 4:h=cr,cr=Ql(a.stateNode.containerInfo),Ts(r,a),es(a),cr=h;break;case 12:Ts(r,a),es(a);break;case 31:Ts(r,a),es(a),h&4&&(h=a.updateQueue,h!==null&&(a.updateQueue=null,Ul(a,h)));break;case 13:Ts(r,a),es(a),a.child.flags&8192&&a.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Jc=mt()),h&4&&(h=a.updateQueue,h!==null&&(a.updateQueue=null,Ul(a,h)));break;case 22:g=a.memoizedState!==null;var ye=o!==null&&o.memoizedState!==null,Oe=Or,Xe=ka;if(Or=Oe||g,ka=Xe||ye,Ts(r,a),ka=Xe,Or=Oe,es(a),h&8192)e:for(r=a.stateNode,r._visibility=g?r._visibility&-2:r._visibility|1,g&&(o===null||ye||Or||ka||Gi(a)),o=null,r=a;;){if(r.tag===5||r.tag===26){if(o===null){ye=o=r;try{if(x=ye.stateNode,g)j=x.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none";else{ae=ye.stateNode;var tt=ye.memoizedProps.style,Le=tt!=null&&tt.hasOwnProperty("display")?tt.display:null;ae.style.display=Le==null||typeof Le=="boolean"?"":(""+Le).trim()}}catch(kt){Rn(ye,ye.return,kt)}}}else if(r.tag===6){if(o===null){ye=r;try{ye.stateNode.nodeValue=g?"":ye.memoizedProps}catch(kt){Rn(ye,ye.return,kt)}}}else if(r.tag===18){if(o===null){ye=r;try{var Ve=ye.stateNode;g?ua(Ve,!0):ua(ye.stateNode,!1)}catch(kt){Rn(ye,ye.return,kt)}}}else if((r.tag!==22&&r.tag!==23||r.memoizedState===null||r===a)&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;o===r&&(o=null),r=r.return}o===r&&(o=null),r.sibling.return=r.return,r=r.sibling}h&4&&(h=a.updateQueue,h!==null&&(o=h.retryQueue,o!==null&&(h.retryQueue=null,Ul(a,o))));break;case 19:Ts(r,a),es(a),h&4&&(h=a.updateQueue,h!==null&&(a.updateQueue=null,Ul(a,h)));break;case 30:break;case 21:break;default:Ts(r,a),es(a)}}function es(a){var r=a.flags;if(r&2){try{for(var o,h=a.return;h!==null;){if(Qh(h)){o=h;break}h=h.return}if(o==null)throw Error(s(160));switch(o.tag){case 27:var g=o.stateNode,x=Kc(a);Qc(a,x,g);break;case 5:var j=o.stateNode;o.flags&32&&(me(j,""),o.flags&=-33);var ae=Kc(a);Qc(a,ae,j);break;case 3:case 4:var ye=o.stateNode.containerInfo,Oe=Kc(a);Gd(a,Oe,ye);break;default:throw Error(s(161))}}catch(Xe){Rn(a,a.return,Xe)}a.flags&=-3}r&4096&&(a.flags&=-4097)}function ep(a){if(a.subtreeFlags&1024)for(a=a.child;a!==null;){var r=a;ep(r),r.tag===5&&r.flags&1024&&r.stateNode.reset(),a=a.sibling}}function zr(a,r){if(r.subtreeFlags&8772)for(r=r.child;r!==null;)Bm(a,r.alternate,r),r=r.sibling}function Gi(a){for(a=a.child;a!==null;){var r=a;switch(r.tag){case 0:case 11:case 14:case 15:ai(4,r,r.return),Gi(r);break;case 1:lr(r,r.return);var o=r.stateNode;typeof o.componentWillUnmount=="function"&&Bd(r,r.return,o),Gi(r);break;case 27:pr(r.stateNode);case 26:case 5:lr(r,r.return),Gi(r);break;case 22:r.memoizedState===null&&Gi(r);break;case 30:Gi(r);break;default:Gi(r)}a=a.sibling}}function Hs(a,r,o){for(o=o&&(r.subtreeFlags&8772)!==0,r=r.child;r!==null;){var h=r.alternate,g=a,x=r,j=x.flags;switch(x.tag){case 0:case 11:case 15:Hs(g,x,o),Fo(4,x);break;case 1:if(Hs(g,x,o),h=x,g=h.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(Oe){Rn(h,h.return,Oe)}if(h=x,g=h.updateQueue,g!==null){var ae=h.stateNode;try{var ye=g.shared.hiddenCallbacks;if(ye!==null)for(g.shared.hiddenCallbacks=null,g=0;g<ye.length;g++)Gf(ye[g],ae)}catch(Oe){Rn(h,h.return,Oe)}}o&&j&64&&Kh(x),Bl(x,x.return);break;case 27:Xc(x);case 26:case 5:Hs(g,x,o),o&&h===null&&j&4&&Ud(x),Bl(x,x.return);break;case 12:Hs(g,x,o);break;case 31:Hs(g,x,o),o&&j&4&&qd(g,x);break;case 13:Hs(g,x,o),o&&j&4&&Jh(g,x);break;case 22:x.memoizedState===null&&Hs(g,x,o),Bl(x,x.return);break;case 30:break;default:Hs(g,x,o)}r=r.sibling}}function Qd(a,r){var o=null;a!==null&&a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(o=a.memoizedState.cachePool.pool),a=null,r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(a=r.memoizedState.cachePool.pool),a!==o&&(a!=null&&a.refCount++,o!=null&&wl(o))}function Xd(a,r){a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&wl(a))}function qs(a,r,o,h){if(r.subtreeFlags&10256)for(r=r.child;r!==null;)Yc(a,r,o,h),r=r.sibling}function Yc(a,r,o,h){var g=r.flags;switch(r.tag){case 0:case 11:case 15:qs(a,r,o,h),g&2048&&Fo(9,r);break;case 1:qs(a,r,o,h);break;case 3:qs(a,r,o,h),g&2048&&(a=null,r.alternate!==null&&(a=r.alternate.memoizedState.cache),r=r.memoizedState.cache,r!==a&&(r.refCount++,a!=null&&wl(a)));break;case 12:if(g&2048){qs(a,r,o,h),a=r.stateNode;try{var x=r.memoizedProps,j=x.id,ae=x.onPostCommit;typeof ae=="function"&&ae(j,r.alternate===null?"mount":"update",a.passiveEffectDuration,-0)}catch(ye){Rn(r,r.return,ye)}}else qs(a,r,o,h);break;case 31:qs(a,r,o,h);break;case 13:qs(a,r,o,h);break;case 23:break;case 22:x=r.stateNode,j=r.alternate,r.memoizedState!==null?x._visibility&2?qs(a,r,o,h):Vl(a,r):x._visibility&2?qs(a,r,o,h):(x._visibility|=2,No(a,r,o,h,(r.subtreeFlags&10256)!==0||!1)),g&2048&&Qd(j,r);break;case 24:qs(a,r,o,h),g&2048&&Xd(r.alternate,r);break;default:qs(a,r,o,h)}}function No(a,r,o,h,g){for(g=g&&((r.subtreeFlags&10256)!==0||!1),r=r.child;r!==null;){var x=a,j=r,ae=o,ye=h,Oe=j.flags;switch(j.tag){case 0:case 11:case 15:No(x,j,ae,ye,g),Fo(8,j);break;case 23:break;case 22:var Xe=j.stateNode;j.memoizedState!==null?Xe._visibility&2?No(x,j,ae,ye,g):Vl(x,j):(Xe._visibility|=2,No(x,j,ae,ye,g)),g&&Oe&2048&&Qd(j.alternate,j);break;case 24:No(x,j,ae,ye,g),g&&Oe&2048&&Xd(j.alternate,j);break;default:No(x,j,ae,ye,g)}r=r.sibling}}function Vl(a,r){if(r.subtreeFlags&10256)for(r=r.child;r!==null;){var o=a,h=r,g=h.flags;switch(h.tag){case 22:Vl(o,h),g&2048&&Qd(h.alternate,h);break;case 24:Vl(o,h),g&2048&&Xd(h.alternate,h);break;default:Vl(o,h)}r=r.sibling}}var Gl=8192;function si(a,r,o){if(a.subtreeFlags&Gl)for(a=a.child;a!==null;)tp(a,r,o),a=a.sibling}function tp(a,r,o){switch(a.tag){case 26:si(a,r,o),a.flags&Gl&&a.memoizedState!==null&&AC(o,cr,a.memoizedState,a.memoizedProps);break;case 5:si(a,r,o);break;case 3:case 4:var h=cr;cr=Ql(a.stateNode.containerInfo),si(a,r,o),cr=h;break;case 22:a.memoizedState===null&&(h=a.alternate,h!==null&&h.memoizedState!==null?(h=Gl,Gl=16777216,si(a,r,o),Gl=h):si(a,r,o));break;default:si(a,r,o)}}function np(a){var r=a.alternate;if(r!==null&&(a=r.child,a!==null)){r.child=null;do r=a.sibling,a.sibling=null,a=r;while(a!==null)}}function Wl(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var o=0;o<r.length;o++){var h=r[o];Na=h,sp(h,a)}np(a)}if(a.subtreeFlags&10256)for(a=a.child;a!==null;)ap(a),a=a.sibling}function ap(a){switch(a.tag){case 0:case 11:case 15:Wl(a),a.flags&2048&&ai(9,a,a.return);break;case 3:Wl(a);break;case 12:Wl(a);break;case 22:var r=a.stateNode;a.memoizedState!==null&&r._visibility&2&&(a.return===null||a.return.tag!==13)?(r._visibility&=-3,Zc(a)):Wl(a);break;default:Wl(a)}}function Zc(a){var r=a.deletions;if((a.flags&16)!==0){if(r!==null)for(var o=0;o<r.length;o++){var h=r[o];Na=h,sp(h,a)}np(a)}for(a=a.child;a!==null;){switch(r=a,r.tag){case 0:case 11:case 15:ai(8,r,r.return),Zc(r);break;case 22:o=r.stateNode,o._visibility&2&&(o._visibility&=-3,Zc(r));break;default:Zc(r)}a=a.sibling}}function sp(a,r){for(;Na!==null;){var o=Na;switch(o.tag){case 0:case 11:case 15:ai(8,o,r);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var h=o.memoizedState.cachePool.pool;h!=null&&h.refCount++}break;case 24:wl(o.memoizedState.cache)}if(h=o.child,h!==null)h.return=o,Na=h;else e:for(o=a;Na!==null;){h=Na;var g=h.sibling,x=h.return;if(Yh(h),h===o){Na=null;break e}if(g!==null){g.return=x,Na=g;break e}Na=x}}}var Vm={getCacheForType:function(a){var r=Qa(Aa),o=r.data.get(a);return o===void 0&&(o=a(),r.data.set(a,o)),o},cacheSignal:function(){return Qa(Aa).controller.signal}},Gm=typeof WeakMap=="function"?WeakMap:Map,En=0,Gn=null,ln=null,fn=0,In=0,ps=null,ri=!1,jo=!1,Yd=!1,ur=0,va=0,dr=0,Wi=0,Zd=0,Es=0,Ro=0,Hl=null,ts=null,Jd=!1,Jc=0,rp=0,eu=1/0,tu=null,fr=null,ja=0,ii=null,Bo=null,on=0,ip=0,op=null,Wm=null,nu=0,au=null;function Ss(){return(En&2)!==0&&fn!==0?fn&-fn:R.T!==null?Ep():fe()}function lp(){if(Es===0)if((fn&536870912)===0||_n){var a=Wn;Wn<<=1,(Wn&3932160)===0&&(Wn=262144),Es=a}else Es=536870912;return a=ws.current,a!==null&&(a.flags|=32),Es}function ms(a,r,o){(a===Gn&&(In===2||In===9)||a.cancelPendingCommit!==null)&&(qi(a,0),Hi(a,fn,Es,!1)),Ua(a,o),((En&2)===0||a!==Gn)&&(a===Gn&&((En&2)===0&&(Wi|=o),va===4&&Hi(a,fn,Es,!1)),Lr(a))}function cp(a,r,o){if((En&6)!==0)throw Error(s(327));var h=!o&&(r&127)===0&&(r&a.expiredLanes)===0||Ft(a,r),g=h?qm(a,r):nf(a,r,!0),x=h;do{if(g===0){jo&&!h&&Hi(a,r,0,!1);break}else{if(o=a.current.alternate,x&&!up(o)){g=nf(a,r,!1),x=!1;continue}if(g===2){if(x=r,a.errorRecoveryDisabledLanes&x)var j=0;else j=a.pendingLanes&-536870913,j=j!==0?j:j&536870912?536870912:0;if(j!==0){r=j;e:{var ae=a;g=Hl;var ye=ae.current.memoizedState.isDehydrated;if(ye&&(qi(ae,j).flags|=256),j=nf(ae,j,!1),j!==2){if(Yd&&!ye){ae.errorRecoveryDisabledLanes|=x,Wi|=x,g=4;break e}x=ts,ts=g,x!==null&&(ts===null?ts=x:ts.push.apply(ts,x))}g=j}if(x=!1,g!==2)continue}}if(g===1){qi(a,0),Hi(a,r,0,!0);break}e:{switch(h=a,x=g,x){case 0:case 1:throw Error(s(345));case 4:if((r&4194048)!==r)break;case 6:Hi(h,r,Es,!ri);break e;case 2:ts=null;break;case 3:case 5:break;default:throw Error(s(329))}if((r&62914560)===r&&(g=Jc+300-mt(),10<g)){if(Hi(h,r,Es,!ri),Bs(h,0,!0)!==0)break e;on=r,h.timeoutHandle=cn(ef.bind(null,h,o,ts,tu,Jd,r,Es,Wi,Ro,ri,x,"Throttled",-0,0),g);break e}ef(h,o,ts,tu,Jd,r,Es,Wi,Ro,ri,x,null,-0,0)}}break}while(!0);Lr(a)}function ef(a,r,o,h,g,x,j,ae,ye,Oe,Xe,tt,Le,Ve){if(a.timeoutHandle=-1,tt=r.subtreeFlags,tt&8192||(tt&16785408)===16785408){tt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:jt},tp(r,x,tt);var kt=(x&62914560)===x?Jc-mt():(x&4194048)===x?rp-mt():0;if(kt=PC(tt,kt),kt!==null){on=x,a.cancelPendingCommit=kt(gp.bind(null,a,r,x,o,h,g,j,ae,ye,Xe,tt,null,Le,Ve)),Hi(a,x,j,!Oe);return}}gp(a,r,x,o,h,g,j,ae,ye)}function up(a){for(var r=a;;){var o=r.tag;if((o===0||o===11||o===15)&&r.flags&16384&&(o=r.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var h=0;h<o.length;h++){var g=o[h],x=g.getSnapshot;g=g.value;try{if(!Za(x(),g))return!1}catch{return!1}}if(o=r.child,r.subtreeFlags&16384&&o!==null)o.return=r,r=o;else{if(r===a)break;for(;r.sibling===null;){if(r.return===null||r.return===a)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Hi(a,r,o,h){r&=~Zd,r&=~Wi,a.suspendedLanes|=r,a.pingedLanes&=~r,h&&(a.warmLanes|=r),h=a.expirationTimes;for(var g=r;0<g;){var x=31-Jt(g),j=1<<x;h[x]=-1,g&=~j}o!==0&&Zs(a,o,r)}function su(){return(En&6)===0?(lu(0),!1):!0}function tf(){if(ln!==null){if(In===0)var a=ln.return;else a=ln,Tr=Oi=null,pd(a),Ao=null,El=0,a=ln;for(;a!==null;)qh(a.alternate,a),a=a.return;ln=null}}function qi(a,r){var o=a.timeoutHandle;o!==-1&&(a.timeoutHandle=-1,Sn(o)),o=a.cancelPendingCommit,o!==null&&(a.cancelPendingCommit=null,o()),on=0,tf(),Gn=a,ln=o=ar(a.current,null),fn=r,In=0,ps=null,ri=!1,jo=Ft(a,r),Yd=!1,Ro=Es=Zd=Wi=dr=va=0,ts=Hl=null,Jd=!1,(r&8)!==0&&(r|=r&32);var h=a.entangledLanes;if(h!==0)for(a=a.entanglements,h&=r;0<h;){var g=31-Jt(h),x=1<<g;r|=a[g],h&=~x}return ur=r,Mc(),o}function dp(a,r){an=null,R.H=zo,r===Co||r===Oc?(r=ad(),In=3):r===nd?(r=ad(),In=4):In=r===zl?8:r!==null&&typeof r=="object"&&typeof r.then=="function"?6:1,ps=r,ln===null&&(va=1,Wc(a,zs(r,a.current)))}function fp(){var a=ws.current;return a===null?!0:(fn&4194048)===fn?Ms===null:(fn&62914560)===fn||(fn&536870912)!==0?a===Ms:!1}function Hm(){var a=R.H;return R.H=zo,a===null?zo:a}function hp(){var a=R.A;return R.A=Vm,a}function ru(){va=4,ri||(fn&4194048)!==fn&&ws.current!==null||(jo=!0),(dr&134217727)===0&&(Wi&134217727)===0||Gn===null||Hi(Gn,fn,Es,!1)}function nf(a,r,o){var h=En;En|=2;var g=Hm(),x=hp();(Gn!==a||fn!==r)&&(tu=null,qi(a,r)),r=!1;var j=va;e:do try{if(In!==0&&ln!==null){var ae=ln,ye=ps;switch(In){case 8:tf(),j=6;break e;case 3:case 2:case 9:case 6:ws.current===null&&(r=!0);var Oe=In;if(In=0,ps=null,Uo(a,ae,ye,Oe),o&&jo){j=0;break e}break;default:Oe=In,In=0,ps=null,Uo(a,ae,ye,Oe)}}ql(),j=va;break}catch(Xe){dp(a,Xe)}while(!0);return r&&a.shellSuspendCounter++,Tr=Oi=null,En=h,R.H=g,R.A=x,ln===null&&(Gn=null,fn=0,Mc()),j}function ql(){for(;ln!==null;)pp(ln)}function qm(a,r){var o=En;En|=2;var h=Hm(),g=hp();Gn!==a||fn!==r?(tu=null,eu=mt()+500,qi(a,r)):jo=Ft(a,r);e:do try{if(In!==0&&ln!==null){r=ln;var x=ps;t:switch(In){case 1:In=0,ps=null,Uo(a,r,x,1);break;case 2:case 9:if(jf(x)){In=0,ps=null,mp(r);break}r=function(){In!==2&&In!==9||Gn!==a||(In=7),Lr(a)},x.then(r,r);break e;case 3:In=7;break e;case 4:In=5;break e;case 7:jf(x)?(In=0,ps=null,mp(r)):(In=0,ps=null,Uo(a,r,x,7));break;case 5:var j=null;switch(ln.tag){case 26:j=ln.memoizedState;case 5:case 27:var ae=ln;if(j?jv(j):ae.stateNode.complete){In=0,ps=null;var ye=ae.sibling;if(ye!==null)ln=ye;else{var Oe=ae.return;Oe!==null?(ln=Oe,iu(Oe)):ln=null}break t}}In=0,ps=null,Uo(a,r,x,5);break;case 6:In=0,ps=null,Uo(a,r,x,6);break;case 8:tf(),va=6;break e;default:throw Error(s(462))}}Km();break}catch(Xe){dp(a,Xe)}while(!0);return Tr=Oi=null,R.H=h,R.A=g,En=o,ln!==null?0:(Gn=null,fn=0,Mc(),va)}function Km(){for(;ln!==null&&!dt();)pp(ln)}function pp(a){var r=Gh(a.alternate,a,ur);a.memoizedProps=a.pendingProps,r===null?iu(a):ln=r}function mp(a){var r=a,o=r.alternate;switch(r.tag){case 15:case 0:r=jh(o,r,r.pendingProps,r.type,void 0,fn);break;case 11:r=jh(o,r,r.pendingProps,r.type.render,r.ref,fn);break;case 5:pd(r);default:qh(o,r),r=ln=Af(r,ur),r=Gh(o,r,ur)}a.memoizedProps=a.pendingProps,r===null?iu(a):ln=r}function Uo(a,r,o,h){Tr=Oi=null,pd(r),Ao=null,El=0;var g=r.return;try{if(Lm(a,g,r,o,fn)){va=1,Wc(a,zs(o,a.current)),ln=null;return}}catch(x){if(g!==null)throw ln=g,x;va=1,Wc(a,zs(o,a.current)),ln=null;return}r.flags&32768?(_n||h===1?a=!0:jo||(fn&536870912)!==0?a=!1:(ri=a=!0,(h===2||h===9||h===3||h===6)&&(h=ws.current,h!==null&&h.tag===13&&(h.flags|=16384))),_p(r,a)):iu(r)}function iu(a){var r=a;do{if((r.flags&32768)!==0){_p(r,ri);return}a=r.return;var o=Hh(r.alternate,r,ur);if(o!==null){ln=o;return}if(r=r.sibling,r!==null){ln=r;return}ln=r=a}while(r!==null);va===0&&(va=5)}function _p(a,r){do{var o=Rm(a.alternate,a);if(o!==null){o.flags&=32767,ln=o;return}if(o=a.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!r&&(a=a.sibling,a!==null)){ln=a;return}ln=a=o}while(a!==null);va=6,ln=null}function gp(a,r,o,h,g,x,j,ae,ye){a.cancelPendingCommit=null;do ou();while(ja!==0);if((En&6)!==0)throw Error(s(327));if(r!==null){if(r===a.current)throw Error(s(177));if(x=r.lanes|r.childLanes,x|=Gu,qt(a,o,x,j,ae,ye),a===Gn&&(ln=Gn=null,fn=0),Bo=r,ii=a,on=o,ip=x,op=g,Wm=h,(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?(a.callbackNode=null,a.callbackPriority=0,xg(ot,function(){return wp(),null})):(a.callbackNode=null,a.callbackPriority=0),h=(r.flags&13878)!==0,(r.subtreeFlags&13878)!==0||h){h=R.T,R.T=null,g=ee.p,ee.p=2,j=En,En|=4;try{Hd(a,r,o)}finally{En=j,ee.p=g,R.T=h}}ja=1,Qm(),yp(),vp()}}function Qm(){if(ja===1){ja=0;var a=ii,r=Bo,o=(r.flags&13878)!==0;if((r.subtreeFlags&13878)!==0||o){o=R.T,R.T=null;var h=ee.p;ee.p=2;var g=En;En|=4;try{Kd(r,a);var x=Vt,j=_l(a.containerInfo),ae=x.focusedElem,ye=x.selectionRange;if(j!==ae&&ae&&ae.ownerDocument&&_o(ae.ownerDocument.documentElement,ae)){if(ye!==null&&Qr(ae)){var Oe=ye.start,Xe=ye.end;if(Xe===void 0&&(Xe=Oe),"selectionStart"in ae)ae.selectionStart=Oe,ae.selectionEnd=Math.min(Xe,ae.value.length);else{var tt=ae.ownerDocument||document,Le=tt&&tt.defaultView||window;if(Le.getSelection){var Ve=Le.getSelection(),kt=ae.textContent.length,Qt=Math.min(ye.start,kt),na=ye.end===void 0?Qt:Math.min(ye.end,kt);!Ve.extend&&Qt>na&&(j=na,na=Qt,Qt=j);var Ee=ml(ae,Qt),we=ml(ae,na);if(Ee&&we&&(Ve.rangeCount!==1||Ve.anchorNode!==Ee.node||Ve.anchorOffset!==Ee.offset||Ve.focusNode!==we.node||Ve.focusOffset!==we.offset)){var $e=tt.createRange();$e.setStart(Ee.node,Ee.offset),Ve.removeAllRanges(),Qt>na?(Ve.addRange($e),Ve.extend(we.node,we.offset)):($e.setEnd(we.node,we.offset),Ve.addRange($e))}}}}for(tt=[],Ve=ae;Ve=Ve.parentNode;)Ve.nodeType===1&&tt.push({element:Ve,left:Ve.scrollLeft,top:Ve.scrollTop});for(typeof ae.focus=="function"&&ae.focus(),ae=0;ae<tt.length;ae++){var et=tt[ae];et.element.scrollLeft=et.left,et.element.scrollTop=et.top}}d_=!!Tt,Vt=Tt=null}finally{En=g,ee.p=h,R.T=o}}a.current=r,ja=2}}function yp(){if(ja===2){ja=0;var a=ii,r=Bo,o=(r.flags&8772)!==0;if((r.subtreeFlags&8772)!==0||o){o=R.T,R.T=null;var h=ee.p;ee.p=2;var g=En;En|=4;try{Bm(a,r.alternate,r)}finally{En=g,ee.p=h,R.T=o}}ja=3}}function vp(){if(ja===4||ja===3){ja=0,Ye();var a=ii,r=Bo,o=on,h=Wm;(r.subtreeFlags&10256)!==0||(r.flags&10256)!==0?ja=5:(ja=0,Bo=ii=null,bp(a,a.pendingLanes));var g=a.pendingLanes;if(g===0&&(fr=null),le(o),r=r.stateNode,Mn&&typeof Mn.onCommitFiberRoot=="function")try{Mn.onCommitFiberRoot(Ht,r,void 0,(r.current.flags&128)===128)}catch{}if(h!==null){r=R.T,g=ee.p,ee.p=2,R.T=null;try{for(var x=a.onRecoverableError,j=0;j<h.length;j++){var ae=h[j];x(ae.value,{componentStack:ae.stack})}}finally{R.T=r,ee.p=g}}(on&3)!==0&&ou(),Lr(a),g=a.pendingLanes,(o&261930)!==0&&(g&42)!==0?a===au?nu++:(nu=0,au=a):nu=0,lu(0)}}function bp(a,r){(a.pooledCacheLanes&=r)===0&&(r=a.pooledCache,r!=null&&(a.pooledCache=null,wl(r)))}function ou(){return Qm(),yp(),vp(),wp()}function wp(){if(ja!==5)return!1;var a=ii,r=ip;ip=0;var o=le(on),h=R.T,g=ee.p;try{ee.p=32>o?32:o,R.T=null,o=op,op=null;var x=ii,j=on;if(ja=0,Bo=ii=null,on=0,(En&6)!==0)throw Error(s(331));var ae=En;if(En|=4,ap(x.current),Yc(x,x.current,j,o),En=ae,lu(0,!1),Mn&&typeof Mn.onPostCommitFiberRoot=="function")try{Mn.onPostCommitFiberRoot(Ht,x)}catch{}return!0}finally{ee.p=g,R.T=h,bp(a,r)}}function Mp(a,r,o){r=zs(o,r),r=Id(a.stateNode,r,2),a=ei(a,r,2),a!==null&&(Ua(a,2),Lr(a))}function Rn(a,r,o){if(a.tag===3)Mp(a,a,o);else for(;r!==null;){if(r.tag===3){Mp(r,a,o);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(fr===null||!fr.has(h))){a=zs(o,a),o=$h(2),h=ei(r,o,2),h!==null&&(Dh(o,h,r,a),Ua(h,2),Lr(h));break}}r=r.return}}function af(a,r,o){var h=a.pingCache;if(h===null){h=a.pingCache=new Gm;var g=new Set;h.set(r,g)}else g=h.get(r),g===void 0&&(g=new Set,h.set(r,g));g.has(o)||(Yd=!0,g.add(o),a=bg.bind(null,a,r,o),r.then(a,a))}function bg(a,r,o){var h=a.pingCache;h!==null&&h.delete(r),a.pingedLanes|=a.suspendedLanes&o,a.warmLanes&=~o,Gn===a&&(fn&o)===o&&(va===4||va===3&&(fn&62914560)===fn&&300>mt()-Jc?(En&2)===0&&qi(a,0):Zd|=o,Ro===fn&&(Ro=0)),Lr(a)}function Xm(a,r){r===0&&(r=Ys()),a=$i(a,r),a!==null&&(Ua(a,r),Lr(a))}function wg(a){var r=a.memoizedState,o=0;r!==null&&(o=r.retryLane),Xm(a,o)}function Mg(a,r){var o=0;switch(a.tag){case 31:case 13:var h=a.stateNode,g=a.memoizedState;g!==null&&(o=g.retryLane);break;case 19:h=a.stateNode;break;case 22:h=a.stateNode._retryCache;break;default:throw Error(s(314))}h!==null&&h.delete(r),Xm(a,o)}function xg(a,r){return ke(a,r)}var sf=null,Kl=null,xp=!1,rf=!1,Tp=!1,Ki=0;function Lr(a){a!==Kl&&a.next===null&&(Kl===null?sf=Kl=a:Kl=Kl.next=a),rf=!0,xp||(xp=!0,Eg())}function lu(a,r){if(!Tp&&rf){Tp=!0;do for(var o=!1,h=sf;h!==null;){if(a!==0){var g=h.pendingLanes;if(g===0)var x=0;else{var j=h.suspendedLanes,ae=h.pingedLanes;x=(1<<31-Jt(42|a)+1)-1,x&=g&~(j&~ae),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(o=!0,e_(h,x))}else x=fn,x=Bs(h,h===Gn?x:0,h.cancelPendingCommit!==null||h.timeoutHandle!==-1),(x&3)===0||Ft(h,x)||(o=!0,e_(h,x));h=h.next}while(o);Tp=!1}}function Tg(){Ym()}function Ym(){rf=xp=!1;var a=0;Ki!==0&&It()&&(a=Ki);for(var r=mt(),o=null,h=sf;h!==null;){var g=h.next,x=Zm(h,r);x===0?(h.next=null,o===null?sf=g:o.next=g,g===null&&(Kl=o)):(o=h,(a!==0||(x&3)!==0)&&(rf=!0)),h=g}ja!==0&&ja!==5||lu(a),Ki!==0&&(Ki=0)}function Zm(a,r){for(var o=a.suspendedLanes,h=a.pingedLanes,g=a.expirationTimes,x=a.pendingLanes&-62914561;0<x;){var j=31-Jt(x),ae=1<<j,ye=g[j];ye===-1?((ae&o)===0||(ae&h)!==0)&&(g[j]=Fn(ae,r)):ye<=r&&(a.expiredLanes|=ae),x&=~ae}if(r=Gn,o=fn,o=Bs(a,a===r?o:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),h=a.callbackNode,o===0||a===r&&(In===2||In===9)||a.cancelPendingCommit!==null)return h!==null&&h!==null&&Ge(h),a.callbackNode=null,a.callbackPriority=0;if((o&3)===0||Ft(a,o)){if(r=o&-o,r===a.callbackPriority)return r;switch(h!==null&&Ge(h),le(o)){case 2:case 8:o=wt;break;case 32:o=ot;break;case 268435456:o=St;break;default:o=ot}return h=Jm.bind(null,a),o=ke(o,h),a.callbackPriority=r,a.callbackNode=o,r}return h!==null&&h!==null&&Ge(h),a.callbackPriority=2,a.callbackNode=null,2}function Jm(a,r){if(ja!==0&&ja!==5)return a.callbackNode=null,a.callbackPriority=0,null;var o=a.callbackNode;if(ou()&&a.callbackNode!==o)return null;var h=fn;return h=Bs(a,a===Gn?h:0,a.cancelPendingCommit!==null||a.timeoutHandle!==-1),h===0?null:(cp(a,h,r),Zm(a,mt()),a.callbackNode!=null&&a.callbackNode===o?Jm.bind(null,a):null)}function e_(a,r){if(ou())return null;cp(a,r,!0)}function Eg(){ca(function(){(En&6)!==0?ke(Mt,Tg):Ym()})}function Ep(){if(Ki===0){var a=Eo;a===0&&(a=Xs,Xs<<=1,(Xs&261888)===0&&(Xs=256)),Ki=a}return Ki}function t_(a){return a==null||typeof a=="symbol"||typeof a=="boolean"?null:typeof a=="function"?a:Xt(""+a)}function n_(a,r){var o=r.ownerDocument.createElement("input");return o.name=r.name,o.value=r.value,a.id&&o.setAttribute("form",a.id),r.parentNode.insertBefore(o,r),a=new FormData(a),o.parentNode.removeChild(o),a}function Sg(a,r,o,h,g){if(r==="submit"&&o&&o.stateNode===g){var x=t_((g[xt]||null).action),j=h.submitter;j&&(r=(r=j[xt]||null)?t_(r.formAction):j.getAttribute("formAction"),r!==null&&(x=r,j=null));var ae=new qa("action","action",null,h,g);a.push({event:ae,listeners:[{instance:null,listener:function(){if(h.defaultPrevented){if(Ki!==0){var ye=j?n_(g,j):new FormData(g);Ed(o,{pending:!0,data:ye,method:g.method,action:x},null,ye)}}else typeof x=="function"&&(ae.preventDefault(),ye=j?n_(g,j):new FormData(g),Ed(o,{pending:!0,data:ye,method:g.method,action:x},x,ye))},currentTarget:g}]})}}for(var Sp=0;Sp<vn.length;Sp++){var Cp=vn[Sp],Cg=Cp.toLowerCase(),Ag=Cp[0].toUpperCase()+Cp.slice(1);Pn(Cg,"on"+Ag)}Pn(re,"onAnimationEnd"),Pn(be,"onAnimationIteration"),Pn(We,"onAnimationStart"),Pn("dblclick","onDoubleClick"),Pn("focusin","onFocus"),Pn("focusout","onBlur"),Pn(rt,"onTransitionRun"),Pn(yt,"onTransitionStart"),Pn(Ct,"onTransitionCancel"),Pn(Kt,"onTransitionEnd"),Zn("onMouseEnter",["mouseout","mouseover"]),Zn("onMouseLeave",["mouseout","mouseover"]),Zn("onPointerEnter",["pointerout","pointerover"]),Zn("onPointerLeave",["pointerout","pointerover"]),Wa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Wa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Wa("onBeforeInput",["compositionend","keypress","textInput","paste"]),Wa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Wa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Wa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var cu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pg=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(cu));function a_(a,r){r=(r&4)!==0;for(var o=0;o<a.length;o++){var h=a[o],g=h.event;h=h.listeners;e:{var x=void 0;if(r)for(var j=h.length-1;0<=j;j--){var ae=h[j],ye=ae.instance,Oe=ae.currentTarget;if(ae=ae.listener,ye!==x&&g.isPropagationStopped())break e;x=ae,g.currentTarget=Oe;try{x(g)}catch(Xe){Ws(Xe)}g.currentTarget=null,x=ye}else for(j=0;j<h.length;j++){if(ae=h[j],ye=ae.instance,Oe=ae.currentTarget,ae=ae.listener,ye!==x&&g.isPropagationStopped())break e;x=ae,g.currentTarget=Oe;try{x(g)}catch(Xe){Ws(Xe)}g.currentTarget=null,x=ye}}}}function hn(a,r){var o=r[Rt];o===void 0&&(o=r[Rt]=new Set);var h=a+"__bubble";o.has(h)||($a(r,a,2,!1),o.add(h))}function Ap(a,r,o){var h=0;r&&(h|=4),$a(o,a,h,r)}var Gt="_reactListening"+Math.random().toString(36).slice(2);function of(a){if(!a[Gt]){a[Gt]=!0,Va.forEach(function(o){o!=="selectionchange"&&(Pg.has(o)||Ap(o,!1,a),Ap(o,!0,a))});var r=a.nodeType===9?a:a.ownerDocument;r===null||r[Gt]||(r[Gt]=!0,Ap("selectionchange",!1,r))}}function $a(a,r,o,h){switch(Hv(r)){case 2:var g=DC;break;case 8:g=OC;break;default:g=jg}o=g.bind(null,r,o,a),g=void 0,!Vn||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),h?g!==void 0?a.addEventListener(r,o,{capture:!0,passive:g}):a.addEventListener(r,o,!0):g!==void 0?a.addEventListener(r,o,{passive:g}):a.addEventListener(r,o,!1)}function Da(a,r,o,h,g){var x=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var j=h.tag;if(j===3||j===4){var ae=h.stateNode.containerInfo;if(ae===g)break;if(j===4)for(j=h.return;j!==null;){var ye=j.tag;if((ye===3||ye===4)&&j.stateNode.containerInfo===g)return;j=j.return}for(;ae!==null;){if(j=Nn(ae),j===null)return;if(ye=j.tag,ye===5||ye===6||ye===26||ye===27){h=x=j;continue e}ae=ae.parentNode}}h=h.return}Os(function(){var Oe=x,Xe=ga(o),tt=[];e:{var Le=dn.get(a);if(Le!==void 0){var Ve=qa,kt=a;switch(a){case"keypress":if(fs(o)===0)break e;case"keydown":case"keyup":Ve=Nu;break;case"focusin":kt="focus",Ve=nl;break;case"focusout":kt="blur",Ve=nl;break;case"beforeblur":case"afterblur":Ve=nl;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ve=dc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ve=Du;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ve=Sf;break;case re:case be:case We:Ve=zu;break;case Kt:Ve=il;break;case"scroll":case"scrollend":Ve=br;break;case"wheel":Ve=ol;break;case"copy":case"cut":case"paste":Ve=Lu;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ve=_c;break;case"toggle":case"beforetoggle":Ve=Ru}var Qt=(r&4)!==0,na=!Qt&&(a==="scroll"||a==="scrollend"),Ee=Qt?Le!==null?Le+"Capture":null:Le;Qt=[];for(var we=Oe,$e;we!==null;){var et=we;if($e=et.stateNode,et=et.tag,et!==5&&et!==26&&et!==27||$e===null||Ee===null||(et=pa(we,Ee),et!=null&&Qt.push(Oa(we,et,$e))),na)break;we=we.return}0<Qt.length&&(Le=new Ve(Le,kt,null,o,Xe),tt.push({event:Le,listeners:Qt}))}}if((r&7)===0){e:{if(Le=a==="mouseover"||a==="pointerover",Ve=a==="mouseout"||a==="pointerout",Le&&o!==qn&&(kt=o.relatedTarget||o.fromElement)&&(Nn(kt)||kt[ht]))break e;if((Ve||Le)&&(Le=Xe.window===Xe?Xe:(Le=Xe.ownerDocument)?Le.defaultView||Le.parentWindow:window,Ve?(kt=o.relatedTarget||o.toElement,Ve=Oe,kt=kt?Nn(kt):null,kt!==null&&(na=l(kt),Qt=kt.tag,kt!==na||Qt!==5&&Qt!==27&&Qt!==6)&&(kt=null)):(Ve=null,kt=Oe),Ve!==kt)){if(Qt=dc,et="onMouseLeave",Ee="onMouseEnter",we="mouse",(a==="pointerout"||a==="pointerover")&&(Qt=_c,et="onPointerLeave",Ee="onPointerEnter",we="pointer"),na=Ve==null?Le:gs(Ve),$e=kt==null?Le:gs(kt),Le=new Qt(et,we+"leave",Ve,o,Xe),Le.target=na,Le.relatedTarget=$e,et=null,Nn(Xe)===Oe&&(Qt=new Qt(Ee,we+"enter",kt,o,Xe),Qt.target=$e,Qt.relatedTarget=na,et=Qt),na=et,Ve&&kt)t:{for(Qt=kg,Ee=Ve,we=kt,$e=0,et=Ee;et;et=Qt(et))$e++;et=0;for(var Ut=we;Ut;Ut=Qt(Ut))et++;for(;0<$e-et;)Ee=Qt(Ee),$e--;for(;0<et-$e;)we=Qt(we),et--;for(;$e--;){if(Ee===we||we!==null&&Ee===we.alternate){Qt=Ee;break t}Ee=Qt(Ee),we=Qt(we)}Qt=null}else Qt=null;Ve!==null&&Pp(tt,Le,Ve,Qt,!1),kt!==null&&na!==null&&Pp(tt,na,kt,Qt,!0)}}e:{if(Le=Oe?gs(Oe):window,Ve=Le.nodeName&&Le.nodeName.toLowerCase(),Ve==="select"||Ve==="input"&&Le.type==="file")var zn=uo;else if(tr(Le))if(hl)zn=po;else{zn=Is;var Nt=fo}else Ve=Le.nodeName,!Ve||Ve.toLowerCase()!=="input"||Le.type!=="checkbox"&&Le.type!=="radio"?Oe&&gt(Oe.elementType)&&(zn=uo):zn=ho;if(zn&&(zn=zn(a,Oe))){fl(tt,zn,o,Xe);break e}Nt&&Nt(a,Le,Oe),a==="focusout"&&Oe&&Le.type==="number"&&Oe.memoizedProps.value!=null&&Te(Le,"number",Le.value)}switch(Nt=Oe?gs(Oe):window,a){case"focusin":(tr(Nt)||Nt.contentEditable==="true")&&(nr=Nt,yo=Oe,Mr=null);break;case"focusout":Mr=yo=nr=null;break;case"mousedown":vo=!0;break;case"contextmenu":case"mouseup":case"dragend":vo=!1,gl(tt,o,Xe);break;case"selectionchange":if(go)break;case"keydown":case"keyup":gl(tt,o,Xe)}var un;if(ll)e:{switch(a){case"compositionstart":var bn="onCompositionStart";break e;case"compositionend":bn="onCompositionEnd";break e;case"compositionupdate":bn="onCompositionUpdate";break e}bn=void 0}else er?oo(a,o)&&(bn="onCompositionEnd"):a==="keydown"&&o.keyCode===229&&(bn="onCompositionStart");bn&&(cl&&o.locale!=="ko"&&(er||bn!=="onCompositionStart"?bn==="onCompositionEnd"&&er&&(un=xa()):(ea=Xe,ds="value"in ea?ea.value:ea.textContent,er=!0)),Nt=hr(Oe,bn),0<Nt.length&&(bn=new al(bn,a,null,o,Xe),tt.push({event:bn,listeners:Nt}),un?bn.data=un:(un=vc(o),un!==null&&(bn.data=un)))),(un=Uu?lo(a,o):ul(a,o))&&(bn=hr(Oe,"onBeforeInput"),0<bn.length&&(Nt=new al("onBeforeInput","beforeinput",null,o,Xe),tt.push({event:Nt,listeners:bn}),Nt.data=un)),Sg(tt,a,Oe,o,Xe)}a_(tt,r)})}function Oa(a,r,o){return{instance:a,listener:r,currentTarget:o}}function hr(a,r){for(var o=r+"Capture",h=[];a!==null;){var g=a,x=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||x===null||(g=pa(a,o),g!=null&&h.unshift(Oa(a,g,x)),g=pa(a,r),g!=null&&h.push(Oa(a,g,x))),a.tag===3)return h;a=a.return}return[]}function kg(a){if(a===null)return null;do a=a.return;while(a&&a.tag!==5&&a.tag!==27);return a||null}function Pp(a,r,o,h,g){for(var x=r._reactName,j=[];o!==null&&o!==h;){var ae=o,ye=ae.alternate,Oe=ae.stateNode;if(ae=ae.tag,ye!==null&&ye===h)break;ae!==5&&ae!==26&&ae!==27||Oe===null||(ye=Oe,g?(Oe=pa(o,x),Oe!=null&&j.unshift(Oa(o,Oe,ye))):g||(Oe=pa(o,x),Oe!=null&&j.push(Oa(o,Oe,ye)))),o=o.return}j.length!==0&&a.push({event:r,listeners:j})}var s_=/\r\n?/g,D=/\u0000|\uFFFD/g;function O(a){return(typeof a=="string"?a:""+a).replace(s_,`
`).replace(D,"")}function se(a,r){return r=O(r),O(a)===r}function ge(a,r,o,h,g,x){switch(o){case"children":typeof h=="string"?r==="body"||r==="textarea"&&h===""||me(a,h):(typeof h=="number"||typeof h=="bigint")&&r!=="body"&&me(a,""+h);break;case"className":Ds(a,"class",h);break;case"tabIndex":Ds(a,"tabindex",h);break;case"dir":case"role":case"viewBox":case"width":case"height":Ds(a,o,h);break;case"style":vt(a,h,x);break;case"data":if(r!=="object"){Ds(a,"data",h);break}case"src":case"href":if(h===""&&(r!=="a"||o!=="href")){a.removeAttribute(o);break}if(h==null||typeof h=="function"||typeof h=="symbol"||typeof h=="boolean"){a.removeAttribute(o);break}h=Xt(""+h),a.setAttribute(o,h);break;case"action":case"formAction":if(typeof h=="function"){a.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(o==="formAction"?(r!=="input"&&ge(a,r,"name",g.name,g,null),ge(a,r,"formEncType",g.formEncType,g,null),ge(a,r,"formMethod",g.formMethod,g,null),ge(a,r,"formTarget",g.formTarget,g,null)):(ge(a,r,"encType",g.encType,g,null),ge(a,r,"method",g.method,g,null),ge(a,r,"target",g.target,g,null)));if(h==null||typeof h=="symbol"||typeof h=="boolean"){a.removeAttribute(o);break}h=Xt(""+h),a.setAttribute(o,h);break;case"onClick":h!=null&&(a.onclick=jt);break;case"onScroll":h!=null&&hn("scroll",a);break;case"onScrollEnd":h!=null&&hn("scrollend",a);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(s(61));if(o=h.__html,o!=null){if(g.children!=null)throw Error(s(60));a.innerHTML=o}}break;case"multiple":a.multiple=h&&typeof h!="function"&&typeof h!="symbol";break;case"muted":a.muted=h&&typeof h!="function"&&typeof h!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(h==null||typeof h=="function"||typeof h=="boolean"||typeof h=="symbol"){a.removeAttribute("xlink:href");break}o=Xt(""+h),a.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":h!=null&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(o,""+h):a.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":h&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(o,""):a.removeAttribute(o);break;case"capture":case"download":h===!0?a.setAttribute(o,""):h!==!1&&h!=null&&typeof h!="function"&&typeof h!="symbol"?a.setAttribute(o,h):a.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":h!=null&&typeof h!="function"&&typeof h!="symbol"&&!isNaN(h)&&1<=h?a.setAttribute(o,h):a.removeAttribute(o);break;case"rowSpan":case"start":h==null||typeof h=="function"||typeof h=="symbol"||isNaN(h)?a.removeAttribute(o):a.setAttribute(o,h);break;case"popover":hn("beforetoggle",a),hn("toggle",a),$s(a,"popover",h);break;case"xlinkActuate":Ha(a,"http://www.w3.org/1999/xlink","xlink:actuate",h);break;case"xlinkArcrole":Ha(a,"http://www.w3.org/1999/xlink","xlink:arcrole",h);break;case"xlinkRole":Ha(a,"http://www.w3.org/1999/xlink","xlink:role",h);break;case"xlinkShow":Ha(a,"http://www.w3.org/1999/xlink","xlink:show",h);break;case"xlinkTitle":Ha(a,"http://www.w3.org/1999/xlink","xlink:title",h);break;case"xlinkType":Ha(a,"http://www.w3.org/1999/xlink","xlink:type",h);break;case"xmlBase":Ha(a,"http://www.w3.org/XML/1998/namespace","xml:base",h);break;case"xmlLang":Ha(a,"http://www.w3.org/XML/1998/namespace","xml:lang",h);break;case"xmlSpace":Ha(a,"http://www.w3.org/XML/1998/namespace","xml:space",h);break;case"is":$s(a,"is",h);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=bt.get(o)||o,$s(a,o,h))}}function Ae(a,r,o,h,g,x){switch(o){case"style":vt(a,h,x);break;case"dangerouslySetInnerHTML":if(h!=null){if(typeof h!="object"||!("__html"in h))throw Error(s(61));if(o=h.__html,o!=null){if(g.children!=null)throw Error(s(60));a.innerHTML=o}}break;case"children":typeof h=="string"?me(a,h):(typeof h=="number"||typeof h=="bigint")&&me(a,""+h);break;case"onScroll":h!=null&&hn("scroll",a);break;case"onScrollEnd":h!=null&&hn("scrollend",a);break;case"onClick":h!=null&&(a.onclick=jt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ga.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(g=o.endsWith("Capture"),r=o.slice(2,g?o.length-7:void 0),x=a[xt]||null,x=x!=null?x[o]:null,typeof x=="function"&&a.removeEventListener(r,x,g),typeof h=="function")){typeof x!="function"&&x!==null&&(o in a?a[o]=null:a.hasAttribute(o)&&a.removeAttribute(o)),a.addEventListener(r,h,g);break e}o in a?a[o]=h:h===!0?a.setAttribute(o,""):$s(a,o,h)}}}function Se(a,r,o){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":hn("error",a),hn("load",a);var h=!1,g=!1,x;for(x in o)if(o.hasOwnProperty(x)){var j=o[x];if(j!=null)switch(x){case"src":h=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:ge(a,r,x,j,o,null)}}g&&ge(a,r,"srcSet",o.srcSet,o,null),h&&ge(a,r,"src",o.src,o,null);return;case"input":hn("invalid",a);var ae=x=j=g=null,ye=null,Oe=null;for(h in o)if(o.hasOwnProperty(h)){var Xe=o[h];if(Xe!=null)switch(h){case"name":g=Xe;break;case"type":j=Xe;break;case"checked":ye=Xe;break;case"defaultChecked":Oe=Xe;break;case"value":x=Xe;break;case"defaultValue":ae=Xe;break;case"children":case"dangerouslySetInnerHTML":if(Xe!=null)throw Error(s(137,r));break;default:ge(a,r,h,Xe,o,null)}}ao(a,x,ae,ye,Oe,j,g,!1);return;case"select":hn("invalid",a),h=j=x=null;for(g in o)if(o.hasOwnProperty(g)&&(ae=o[g],ae!=null))switch(g){case"value":x=ae;break;case"defaultValue":j=ae;break;case"multiple":h=ae;default:ge(a,r,g,ae,o,null)}r=x,o=j,a.multiple=!!h,r!=null?N(a,!!h,r,!1):o!=null&&N(a,!!h,o,!0);return;case"textarea":hn("invalid",a),x=g=h=null;for(j in o)if(o.hasOwnProperty(j)&&(ae=o[j],ae!=null))switch(j){case"value":h=ae;break;case"defaultValue":g=ae;break;case"children":x=ae;break;case"dangerouslySetInnerHTML":if(ae!=null)throw Error(s(91));break;default:ge(a,r,j,ae,o,null)}pe(a,h,g,x);return;case"option":for(ye in o)o.hasOwnProperty(ye)&&(h=o[ye],h!=null)&&(ye==="selected"?a.selected=h&&typeof h!="function"&&typeof h!="symbol":ge(a,r,ye,h,o,null));return;case"dialog":hn("beforetoggle",a),hn("toggle",a),hn("cancel",a),hn("close",a);break;case"iframe":case"object":hn("load",a);break;case"video":case"audio":for(h=0;h<cu.length;h++)hn(cu[h],a);break;case"image":hn("error",a),hn("load",a);break;case"details":hn("toggle",a);break;case"embed":case"source":case"link":hn("error",a),hn("load",a);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Oe in o)if(o.hasOwnProperty(Oe)&&(h=o[Oe],h!=null))switch(Oe){case"children":case"dangerouslySetInnerHTML":throw Error(s(137,r));default:ge(a,r,Oe,h,o,null)}return;default:if(gt(r)){for(Xe in o)o.hasOwnProperty(Xe)&&(h=o[Xe],h!==void 0&&Ae(a,r,Xe,h,o,void 0));return}}for(ae in o)o.hasOwnProperty(ae)&&(h=o[ae],h!=null&&ge(a,r,ae,h,o,null))}function Ke(a,r,o,h){switch(r){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,x=null,j=null,ae=null,ye=null,Oe=null,Xe=null;for(Ve in o){var tt=o[Ve];if(o.hasOwnProperty(Ve)&&tt!=null)switch(Ve){case"checked":break;case"value":break;case"defaultValue":ye=tt;default:h.hasOwnProperty(Ve)||ge(a,r,Ve,null,h,tt)}}for(var Le in h){var Ve=h[Le];if(tt=o[Le],h.hasOwnProperty(Le)&&(Ve!=null||tt!=null))switch(Le){case"type":x=Ve;break;case"name":g=Ve;break;case"checked":Oe=Ve;break;case"defaultChecked":Xe=Ve;break;case"value":j=Ve;break;case"defaultValue":ae=Ve;break;case"children":case"dangerouslySetInnerHTML":if(Ve!=null)throw Error(s(137,r));break;default:Ve!==tt&&ge(a,r,Le,Ve,h,tt)}}Js(a,j,ae,ye,Oe,Xe,x,g);return;case"select":Ve=j=ae=Le=null;for(x in o)if(ye=o[x],o.hasOwnProperty(x)&&ye!=null)switch(x){case"value":break;case"multiple":Ve=ye;default:h.hasOwnProperty(x)||ge(a,r,x,null,h,ye)}for(g in h)if(x=h[g],ye=o[g],h.hasOwnProperty(g)&&(x!=null||ye!=null))switch(g){case"value":Le=x;break;case"defaultValue":ae=x;break;case"multiple":j=x;default:x!==ye&&ge(a,r,g,x,h,ye)}r=ae,o=j,h=Ve,Le!=null?N(a,!!o,Le,!1):!!h!=!!o&&(r!=null?N(a,!!o,r,!0):N(a,!!o,o?[]:"",!1));return;case"textarea":Ve=Le=null;for(ae in o)if(g=o[ae],o.hasOwnProperty(ae)&&g!=null&&!h.hasOwnProperty(ae))switch(ae){case"value":break;case"children":break;default:ge(a,r,ae,null,h,g)}for(j in h)if(g=h[j],x=o[j],h.hasOwnProperty(j)&&(g!=null||x!=null))switch(j){case"value":Le=g;break;case"defaultValue":Ve=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(s(91));break;default:g!==x&&ge(a,r,j,g,h,x)}oe(a,Le,Ve);return;case"option":for(var kt in o)Le=o[kt],o.hasOwnProperty(kt)&&Le!=null&&!h.hasOwnProperty(kt)&&(kt==="selected"?a.selected=!1:ge(a,r,kt,null,h,Le));for(ye in h)Le=h[ye],Ve=o[ye],h.hasOwnProperty(ye)&&Le!==Ve&&(Le!=null||Ve!=null)&&(ye==="selected"?a.selected=Le&&typeof Le!="function"&&typeof Le!="symbol":ge(a,r,ye,Le,h,Ve));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Qt in o)Le=o[Qt],o.hasOwnProperty(Qt)&&Le!=null&&!h.hasOwnProperty(Qt)&&ge(a,r,Qt,null,h,Le);for(Oe in h)if(Le=h[Oe],Ve=o[Oe],h.hasOwnProperty(Oe)&&Le!==Ve&&(Le!=null||Ve!=null))switch(Oe){case"children":case"dangerouslySetInnerHTML":if(Le!=null)throw Error(s(137,r));break;default:ge(a,r,Oe,Le,h,Ve)}return;default:if(gt(r)){for(var na in o)Le=o[na],o.hasOwnProperty(na)&&Le!==void 0&&!h.hasOwnProperty(na)&&Ae(a,r,na,void 0,h,Le);for(Xe in h)Le=h[Xe],Ve=o[Xe],!h.hasOwnProperty(Xe)||Le===Ve||Le===void 0&&Ve===void 0||Ae(a,r,Xe,Le,h,Ve);return}}for(var Ee in o)Le=o[Ee],o.hasOwnProperty(Ee)&&Le!=null&&!h.hasOwnProperty(Ee)&&ge(a,r,Ee,null,h,Le);for(tt in h)Le=h[tt],Ve=o[tt],!h.hasOwnProperty(tt)||Le===Ve||Le==null&&Ve==null||ge(a,r,tt,Le,h,Ve)}function at(a){switch(a){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function ft(){if(typeof performance.getEntriesByType=="function"){for(var a=0,r=0,o=performance.getEntriesByType("resource"),h=0;h<o.length;h++){var g=o[h],x=g.transferSize,j=g.initiatorType,ae=g.duration;if(x&&ae&&at(j)){for(j=0,ae=g.responseEnd,h+=1;h<o.length;h++){var ye=o[h],Oe=ye.startTime;if(Oe>ae)break;var Xe=ye.transferSize,tt=ye.initiatorType;Xe&&at(tt)&&(ye=ye.responseEnd,j+=Xe*(ye<ae?1:(ae-Oe)/(ye-Oe)))}if(--h,r+=8*(x+j)/(g.duration/1e3),a++,10<a)break}}if(0<a)return r/a/1e6}return navigator.connection&&(a=navigator.connection.downlink,typeof a=="number")?a:5}var Tt=null,Vt=null;function Bt(a){return a.nodeType===9?a:a.ownerDocument}function Yt(a){switch(a){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Dt(a,r){if(a===0)switch(r){case"svg":return 1;case"math":return 2;default:return 0}return a===1&&r==="foreignObject"?0:a}function pn(a,r){return a==="textarea"||a==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.children=="bigint"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Ot=null;function It(){var a=window.event;return a&&a.type==="popstate"?a===Ot?!1:(Ot=a,!0):(Ot=null,!1)}var cn=typeof setTimeout=="function"?setTimeout:void 0,Sn=typeof clearTimeout=="function"?clearTimeout:void 0,Xn=typeof Promise=="function"?Promise:void 0,ca=typeof queueMicrotask=="function"?queueMicrotask:typeof Xn<"u"?function(a){return Xn.resolve(null).then(a).catch(ba)}:cn;function ba(a){setTimeout(function(){throw a})}function Bn(a){return a==="head"}function sn(a,r){var o=r,h=0;do{var g=o.nextSibling;if(a.removeChild(o),g&&g.nodeType===8)if(o=g.data,o==="/$"||o==="/&"){if(h===0){a.removeChild(g),df(r);return}h--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")h++;else if(o==="html")pr(a.ownerDocument.documentElement);else if(o==="head"){o=a.ownerDocument.head,pr(o);for(var x=o.firstChild;x;){var j=x.nextSibling,ae=x.nodeName;x[sa]||ae==="SCRIPT"||ae==="STYLE"||ae==="LINK"&&x.rel.toLowerCase()==="stylesheet"||o.removeChild(x),x=j}}else o==="body"&&pr(a.ownerDocument.body);o=g}while(o);df(r)}function ua(a,r){var o=a;a=0;do{var h=o.nextSibling;if(o.nodeType===1?r?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(r?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),h&&h.nodeType===8)if(o=h.data,o==="/$"){if(a===0)break;a--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||a++;o=h}while(o)}function Ia(a){var r=a.firstChild;for(r&&r.nodeType===10&&(r=r.nextSibling);r;){var o=r;switch(r=r.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Ia(o),ra(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}a.removeChild(o)}}function Vo(a,r,o,h){for(;a.nodeType===1;){var g=o;if(a.nodeName.toLowerCase()!==r.toLowerCase()){if(!h&&(a.nodeName!=="INPUT"||a.type!=="hidden"))break}else if(h){if(!a[sa])switch(r){case"meta":if(!a.hasAttribute("itemprop"))break;return a;case"link":if(x=a.getAttribute("rel"),x==="stylesheet"&&a.hasAttribute("data-precedence"))break;if(x!==g.rel||a.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||a.getAttribute("title")!==(g.title==null?null:g.title))break;return a;case"style":if(a.hasAttribute("data-precedence"))break;return a;case"script":if(x=a.getAttribute("src"),(x!==(g.src==null?null:g.src)||a.getAttribute("type")!==(g.type==null?null:g.type)||a.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&x&&a.hasAttribute("async")&&!a.hasAttribute("itemprop"))break;return a;default:return a}}else if(r==="input"&&a.type==="hidden"){var x=g.name==null?null:""+g.name;if(g.type==="hidden"&&a.getAttribute("name")===x)return a}else return a;if(a=os(a.nextSibling),a===null)break}return null}function _s(a,r,o){if(r==="")return null;for(;a.nodeType!==3;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!o||(a=os(a.nextSibling),a===null))return null;return a}function Ks(a,r){for(;a.nodeType!==8;)if((a.nodeType!==1||a.nodeName!=="INPUT"||a.type!=="hidden")&&!r||(a=os(a.nextSibling),a===null))return null;return a}function Qi(a){return a.data==="$?"||a.data==="$~"}function Xi(a){return a.data==="$!"||a.data==="$?"&&a.ownerDocument.readyState!=="loading"}function lf(a,r){var o=a.ownerDocument;if(a.data==="$~")a._reactRetry=r;else if(a.data!=="$?"||o.readyState!=="loading")r();else{var h=function(){r(),o.removeEventListener("DOMContentLoaded",h)};o.addEventListener("DOMContentLoaded",h),a._reactRetry=h}}function os(a){for(;a!=null;a=a.nextSibling){var r=a.nodeType;if(r===1||r===3)break;if(r===8){if(r=a.data,r==="$"||r==="$!"||r==="$?"||r==="$~"||r==="&"||r==="F!"||r==="F")break;if(r==="/$"||r==="/&")return null}}return a}var kp=null;function Yn(a){a=a.nextSibling;for(var r=0;a;){if(a.nodeType===8){var o=a.data;if(o==="/$"||o==="/&"){if(r===0)return os(a.nextSibling);r--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||r++}a=a.nextSibling}return null}function za(a){a=a.previousSibling;for(var r=0;a;){if(a.nodeType===8){var o=a.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(r===0)return a;r--}else o!=="/$"&&o!=="/&"||r++}a=a.previousSibling}return null}function oi(a,r,o){switch(r=Bt(o),a){case"html":if(a=r.documentElement,!a)throw Error(s(452));return a;case"head":if(a=r.head,!a)throw Error(s(453));return a;case"body":if(a=r.body,!a)throw Error(s(454));return a;default:throw Error(s(451))}}function pr(a){for(var r=a.attributes;r.length;)a.removeAttributeNode(r[0]);ra(a)}var ns=new Map,uu=new Set;function Ql(a){return typeof a.getRootNode=="function"?a.getRootNode():a.nodeType===9?a:a.ownerDocument}var mr=ee.d;ee.d={f:$p,r:$g,D:Dp,C:r_,L:Op,m:cf,X:Og,S:Dg,M:Ig};function $p(){var a=mr.f(),r=su();return a||r}function $g(a){var r=ia(a);r!==null&&r.tag===5&&r.type==="form"?Sd(r):mr.r(a)}var Yi=typeof document>"u"?null:document;function du(a,r,o){var h=Yi;if(h&&typeof r=="string"&&r){var g=Ca(r);g='link[rel="'+a+'"][href="'+g+'"]',typeof o=="string"&&(g+='[crossorigin="'+o+'"]'),uu.has(g)||(uu.add(g),a={rel:a,crossOrigin:o,href:r},h.querySelector(g)===null&&(r=h.createElement("link"),Se(r,"link",a),Hn(r),h.head.appendChild(r)))}}function Dp(a){mr.D(a),du("dns-prefetch",a,null)}function r_(a,r){mr.C(a,r),du("preconnect",a,r)}function Op(a,r,o){mr.L(a,r,o);var h=Yi;if(h&&a&&r){var g='link[rel="preload"][as="'+Ca(r)+'"]';r==="image"&&o&&o.imageSrcSet?(g+='[imagesrcset="'+Ca(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(g+='[imagesizes="'+Ca(o.imageSizes)+'"]')):g+='[href="'+Ca(a)+'"]';var x=g;switch(r){case"style":x=ls(a);break;case"script":x=uf(a)}ns.has(x)||(a=_({rel:"preload",href:r==="image"&&o&&o.imageSrcSet?void 0:a,as:r},o),ns.set(x,a),h.querySelector(g)!==null||r==="style"&&h.querySelector(Ip(x))||r==="script"&&h.querySelector(zp(x))||(r=h.createElement("link"),Se(r,"link",a),Hn(r),h.head.appendChild(r)))}}function cf(a,r){mr.m(a,r);var o=Yi;if(o&&a){var h=r&&typeof r.as=="string"?r.as:"script",g='link[rel="modulepreload"][as="'+Ca(h)+'"][href="'+Ca(a)+'"]',x=g;switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=uf(a)}if(!ns.has(x)&&(a=_({rel:"modulepreload",href:a},r),ns.set(x,a),o.querySelector(g)===null)){switch(h){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(zp(x)))return}h=o.createElement("link"),Se(h,"link",a),Hn(h),o.head.appendChild(h)}}}function Dg(a,r,o){mr.S(a,r,o);var h=Yi;if(h&&a){var g=Ma(h).hoistableStyles,x=ls(a);r=r||"default";var j=g.get(x);if(!j){var ae={loading:0,preload:null};if(j=h.querySelector(Ip(x)))ae.loading=5;else{a=_({rel:"stylesheet",href:a,"data-precedence":r},o),(o=ns.get(x))&&zg(a,o);var ye=j=h.createElement("link");Hn(ye),Se(ye,"link",a),ye._p=new Promise(function(Oe,Xe){ye.onload=Oe,ye.onerror=Xe}),ye.addEventListener("load",function(){ae.loading|=1}),ye.addEventListener("error",function(){ae.loading|=2}),ae.loading|=4,i_(j,r,h)}j={type:"stylesheet",instance:j,count:1,state:ae},g.set(x,j)}}}function Og(a,r){mr.X(a,r);var o=Yi;if(o&&a){var h=Ma(o).hoistableScripts,g=uf(a),x=h.get(g);x||(x=o.querySelector(zp(g)),x||(a=_({src:a,async:!0},r),(r=ns.get(g))&&Lg(a,r),x=o.createElement("script"),Hn(x),Se(x,"link",a),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},h.set(g,x))}}function Ig(a,r){mr.M(a,r);var o=Yi;if(o&&a){var h=Ma(o).hoistableScripts,g=uf(a),x=h.get(g);x||(x=o.querySelector(zp(g)),x||(a=_({src:a,async:!0,type:"module"},r),(r=ns.get(g))&&Lg(a,r),x=o.createElement("script"),Hn(x),Se(x,"link",a),o.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},h.set(g,x))}}function Zi(a,r,o,h){var g=(g=ve.current)?Ql(g):null;if(!g)throw Error(s(446));switch(a){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(r=ls(o.href),o=Ma(g).hoistableStyles,h=o.get(r),h||(h={type:"style",instance:null,count:0,state:null},o.set(r,h)),h):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){a=ls(o.href);var x=Ma(g).hoistableStyles,j=x.get(a);if(j||(g=g.ownerDocument||g,j={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(a,j),(x=g.querySelector(Ip(a)))&&!x._p&&(j.instance=x,j.state.loading=5),ns.has(a)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},ns.set(a,o),x||SC(g,a,o,j.state))),r&&h===null)throw Error(s(528,""));return j}if(r&&h!==null)throw Error(s(529,""));return null;case"script":return r=o.async,o=o.src,typeof o=="string"&&r&&typeof r!="function"&&typeof r!="symbol"?(r=uf(o),o=Ma(g).hoistableScripts,h=o.get(r),h||(h={type:"script",instance:null,count:0,state:null},o.set(r,h)),h):{type:"void",instance:null,count:0,state:null};default:throw Error(s(444,a))}}function ls(a){return'href="'+Ca(a)+'"'}function Ip(a){return'link[rel="stylesheet"]['+a+"]"}function zv(a){return _({},a,{"data-precedence":a.precedence,precedence:null})}function SC(a,r,o,h){a.querySelector('link[rel="preload"][as="style"]['+r+"]")?h.loading=1:(r=a.createElement("link"),h.preload=r,r.addEventListener("load",function(){return h.loading|=1}),r.addEventListener("error",function(){return h.loading|=2}),Se(r,"link",o),Hn(r),a.head.appendChild(r))}function uf(a){return'[src="'+Ca(a)+'"]'}function zp(a){return"script[async]"+a}function Lv(a,r,o){if(r.count++,r.instance===null)switch(r.type){case"style":var h=a.querySelector('style[data-href~="'+Ca(o.href)+'"]');if(h)return r.instance=h,Hn(h),h;var g=_({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return h=(a.ownerDocument||a).createElement("style"),Hn(h),Se(h,"style",g),i_(h,o.precedence,a),r.instance=h;case"stylesheet":g=ls(o.href);var x=a.querySelector(Ip(g));if(x)return r.state.loading|=4,r.instance=x,Hn(x),x;h=zv(o),(g=ns.get(g))&&zg(h,g),x=(a.ownerDocument||a).createElement("link"),Hn(x);var j=x;return j._p=new Promise(function(ae,ye){j.onload=ae,j.onerror=ye}),Se(x,"link",h),r.state.loading|=4,i_(x,o.precedence,a),r.instance=x;case"script":return x=uf(o.src),(g=a.querySelector(zp(x)))?(r.instance=g,Hn(g),g):(h=o,(g=ns.get(x))&&(h=_({},o),Lg(h,g)),a=a.ownerDocument||a,g=a.createElement("script"),Hn(g),Se(g,"link",h),a.head.appendChild(g),r.instance=g);case"void":return null;default:throw Error(s(443,r.type))}else r.type==="stylesheet"&&(r.state.loading&4)===0&&(h=r.instance,r.state.loading|=4,i_(h,o.precedence,a));return r.instance}function i_(a,r,o){for(var h=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=h.length?h[h.length-1]:null,x=g,j=0;j<h.length;j++){var ae=h[j];if(ae.dataset.precedence===r)x=ae;else if(x!==g)break}x?x.parentNode.insertBefore(a,x.nextSibling):(r=o.nodeType===9?o.head:o,r.insertBefore(a,r.firstChild))}function zg(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.title==null&&(a.title=r.title)}function Lg(a,r){a.crossOrigin==null&&(a.crossOrigin=r.crossOrigin),a.referrerPolicy==null&&(a.referrerPolicy=r.referrerPolicy),a.integrity==null&&(a.integrity=r.integrity)}var o_=null;function Fv(a,r,o){if(o_===null){var h=new Map,g=o_=new Map;g.set(o,h)}else g=o_,h=g.get(o),h||(h=new Map,g.set(o,h));if(h.has(a))return h;for(h.set(a,null),o=o.getElementsByTagName(a),g=0;g<o.length;g++){var x=o[g];if(!(x[sa]||x[ut]||a==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var j=x.getAttribute(r)||"";j=a+j;var ae=h.get(j);ae?ae.push(x):h.set(j,[x])}}return h}function Nv(a,r,o){a=a.ownerDocument||a,a.head.insertBefore(o,r==="title"?a.querySelector("head > title"):null)}function CC(a,r,o){if(o===1||r.itemProp!=null)return!1;switch(a){case"meta":case"title":return!0;case"style":if(typeof r.precedence!="string"||typeof r.href!="string"||r.href==="")break;return!0;case"link":if(typeof r.rel!="string"||typeof r.href!="string"||r.href===""||r.onLoad||r.onError)break;return r.rel==="stylesheet"?(a=r.disabled,typeof r.precedence=="string"&&a==null):!0;case"script":if(r.async&&typeof r.async!="function"&&typeof r.async!="symbol"&&!r.onLoad&&!r.onError&&r.src&&typeof r.src=="string")return!0}return!1}function jv(a){return!(a.type==="stylesheet"&&(a.state.loading&3)===0)}function AC(a,r,o,h){if(o.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=ls(h.href),x=r.querySelector(Ip(g));if(x){r=x._p,r!==null&&typeof r=="object"&&typeof r.then=="function"&&(a.count++,a=l_.bind(a),r.then(a,a)),o.state.loading|=4,o.instance=x,Hn(x);return}x=r.ownerDocument||r,h=zv(h),(g=ns.get(g))&&zg(h,g),x=x.createElement("link"),Hn(x);var j=x;j._p=new Promise(function(ae,ye){j.onload=ae,j.onerror=ye}),Se(x,"link",h),o.instance=x}a.stylesheets===null&&(a.stylesheets=new Map),a.stylesheets.set(o,r),(r=o.state.preload)&&(o.state.loading&3)===0&&(a.count++,o=l_.bind(a),r.addEventListener("load",o),r.addEventListener("error",o))}}var Fg=0;function PC(a,r){return a.stylesheets&&a.count===0&&u_(a,a.stylesheets),0<a.count||0<a.imgCount?function(o){var h=setTimeout(function(){if(a.stylesheets&&u_(a,a.stylesheets),a.unsuspend){var x=a.unsuspend;a.unsuspend=null,x()}},6e4+r);0<a.imgBytes&&Fg===0&&(Fg=62500*ft());var g=setTimeout(function(){if(a.waitingForImages=!1,a.count===0&&(a.stylesheets&&u_(a,a.stylesheets),a.unsuspend)){var x=a.unsuspend;a.unsuspend=null,x()}},(a.imgBytes>Fg?50:800)+r);return a.unsuspend=o,function(){a.unsuspend=null,clearTimeout(h),clearTimeout(g)}}:null}function l_(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)u_(this,this.stylesheets);else if(this.unsuspend){var a=this.unsuspend;this.unsuspend=null,a()}}}var c_=null;function u_(a,r){a.stylesheets=null,a.unsuspend!==null&&(a.count++,c_=new Map,r.forEach(kC,a),c_=null,l_.call(a))}function kC(a,r){if(!(r.state.loading&4)){var o=c_.get(a);if(o)var h=o.get(null);else{o=new Map,c_.set(a,o);for(var g=a.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<g.length;x++){var j=g[x];(j.nodeName==="LINK"||j.getAttribute("media")!=="not all")&&(o.set(j.dataset.precedence,j),h=j)}h&&o.set(null,h)}g=r.instance,j=g.getAttribute("data-precedence"),x=o.get(j)||h,x===h&&o.set(null,g),o.set(j,g),this.count++,h=l_.bind(this),g.addEventListener("load",h),g.addEventListener("error",h),x?x.parentNode.insertBefore(g,x.nextSibling):(a=a.nodeType===9?a.head:a,a.insertBefore(g,a.firstChild)),r.state.loading|=4}}var Lp={$$typeof:$,Provider:null,Consumer:null,_currentValue:ie,_currentValue2:ie,_threadCount:0};function $C(a,r,o,h,g,x,j,ae,ye){this.tag=1,this.containerInfo=a,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Us(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Us(0),this.hiddenUpdates=Us(null),this.identifierPrefix=h,this.onUncaughtError=g,this.onCaughtError=x,this.onRecoverableError=j,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=ye,this.incompleteTransitions=new Map}function Rv(a,r,o,h,g,x,j,ae,ye,Oe,Xe,tt){return a=new $C(a,r,o,j,ye,Oe,Xe,tt,ae),r=1,x===!0&&(r|=24),x=vs(3,null,null,r),a.current=x,x.stateNode=a,r=$c(),r.refCount++,a.pooledCache=r,r.refCount++,x.memoizedState={element:h,isDehydrated:o,cache:r},sd(x),a}function Bv(a){return a?(a=bo,a):bo}function Uv(a,r,o,h,g,x){g=Bv(g),h.context===null?h.context=g:h.pendingContext=g,h=Ar(r),h.payload={element:o},x=x===void 0?null:x,x!==null&&(h.callback=x),o=ei(a,h,r),o!==null&&(ms(o,a,r),Sl(o,a,r))}function Vv(a,r){if(a=a.memoizedState,a!==null&&a.dehydrated!==null){var o=a.retryLane;a.retryLane=o!==0&&o<r?o:r}}function Ng(a,r){Vv(a,r),(a=a.alternate)&&Vv(a,r)}function Gv(a){if(a.tag===13||a.tag===31){var r=$i(a,67108864);r!==null&&ms(r,a,67108864),Ng(a,67108864)}}function Wv(a){if(a.tag===13||a.tag===31){var r=Ss();r=ne(r);var o=$i(a,r);o!==null&&ms(o,a,r),Ng(a,r)}}var d_=!0;function DC(a,r,o,h){var g=R.T;R.T=null;var x=ee.p;try{ee.p=2,jg(a,r,o,h)}finally{ee.p=x,R.T=g}}function OC(a,r,o,h){var g=R.T;R.T=null;var x=ee.p;try{ee.p=8,jg(a,r,o,h)}finally{ee.p=x,R.T=g}}function jg(a,r,o,h){if(d_){var g=Rg(h);if(g===null)Da(a,r,h,f_,o),qv(a,h);else if(zC(g,a,r,o,h))h.stopPropagation();else if(qv(a,h),r&4&&-1<IC.indexOf(a)){for(;g!==null;){var x=ia(g);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var j=Ra(x.pendingLanes);if(j!==0){var ae=x;for(ae.pendingLanes|=2,ae.entangledLanes|=2;j;){var ye=1<<31-Jt(j);ae.entanglements[1]|=ye,j&=~ye}Lr(x),(En&6)===0&&(eu=mt()+500,lu(0))}}break;case 31:case 13:ae=$i(x,2),ae!==null&&ms(ae,x,2),su(),Ng(x,2)}if(x=Rg(h),x===null&&Da(a,r,h,f_,o),x===g)break;g=x}g!==null&&h.stopPropagation()}else Da(a,r,h,null,o)}}function Rg(a){return a=ga(a),Bg(a)}var f_=null;function Bg(a){if(f_=null,a=Nn(a),a!==null){var r=l(a);if(r===null)a=null;else{var o=r.tag;if(o===13){if(a=c(r),a!==null)return a;a=null}else if(o===31){if(a=u(r),a!==null)return a;a=null}else if(o===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;a=null}else r!==a&&(a=null)}}return f_=a,null}function Hv(a){switch(a){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(it()){case Mt:return 2;case wt:return 8;case ot:case Je:return 32;case St:return 268435456;default:return 32}default:return 32}}var Ug=!1,Xl=null,Yl=null,Zl=null,Fp=new Map,Np=new Map,Jl=[],IC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function qv(a,r){switch(a){case"focusin":case"focusout":Xl=null;break;case"dragenter":case"dragleave":Yl=null;break;case"mouseover":case"mouseout":Zl=null;break;case"pointerover":case"pointerout":Fp.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Np.delete(r.pointerId)}}function jp(a,r,o,h,g,x){return a===null||a.nativeEvent!==x?(a={blockedOn:r,domEventName:o,eventSystemFlags:h,nativeEvent:x,targetContainers:[g]},r!==null&&(r=ia(r),r!==null&&Gv(r)),a):(a.eventSystemFlags|=h,r=a.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),a)}function zC(a,r,o,h,g){switch(r){case"focusin":return Xl=jp(Xl,a,r,o,h,g),!0;case"dragenter":return Yl=jp(Yl,a,r,o,h,g),!0;case"mouseover":return Zl=jp(Zl,a,r,o,h,g),!0;case"pointerover":var x=g.pointerId;return Fp.set(x,jp(Fp.get(x)||null,a,r,o,h,g)),!0;case"gotpointercapture":return x=g.pointerId,Np.set(x,jp(Np.get(x)||null,a,r,o,h,g)),!0}return!1}function Kv(a){var r=Nn(a.target);if(r!==null){var o=l(r);if(o!==null){if(r=o.tag,r===13){if(r=c(o),r!==null){a.blockedOn=r,xe(a.priority,function(){Wv(o)});return}}else if(r===31){if(r=u(o),r!==null){a.blockedOn=r,xe(a.priority,function(){Wv(o)});return}}else if(r===3&&o.stateNode.current.memoizedState.isDehydrated){a.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}a.blockedOn=null}function h_(a){if(a.blockedOn!==null)return!1;for(var r=a.targetContainers;0<r.length;){var o=Rg(a.nativeEvent);if(o===null){o=a.nativeEvent;var h=new o.constructor(o.type,o);qn=h,o.target.dispatchEvent(h),qn=null}else return r=ia(o),r!==null&&Gv(r),a.blockedOn=o,!1;r.shift()}return!0}function Qv(a,r,o){h_(a)&&o.delete(r)}function LC(){Ug=!1,Xl!==null&&h_(Xl)&&(Xl=null),Yl!==null&&h_(Yl)&&(Yl=null),Zl!==null&&h_(Zl)&&(Zl=null),Fp.forEach(Qv),Np.forEach(Qv)}function p_(a,r){a.blockedOn===r&&(a.blockedOn=null,Ug||(Ug=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,LC)))}var m_=null;function Xv(a){m_!==a&&(m_=a,e.unstable_scheduleCallback(e.unstable_NormalPriority,function(){m_===a&&(m_=null);for(var r=0;r<a.length;r+=3){var o=a[r],h=a[r+1],g=a[r+2];if(typeof h!="function"){if(Bg(h||o)===null)continue;break}var x=ia(o);x!==null&&(a.splice(r,3),r-=3,Ed(x,{pending:!0,data:g,method:o.method,action:h},h,g))}}))}function df(a){function r(ye){return p_(ye,a)}Xl!==null&&p_(Xl,a),Yl!==null&&p_(Yl,a),Zl!==null&&p_(Zl,a),Fp.forEach(r),Np.forEach(r);for(var o=0;o<Jl.length;o++){var h=Jl[o];h.blockedOn===a&&(h.blockedOn=null)}for(;0<Jl.length&&(o=Jl[0],o.blockedOn===null);)Kv(o),o.blockedOn===null&&Jl.shift();if(o=(a.ownerDocument||a).$$reactFormReplay,o!=null)for(h=0;h<o.length;h+=3){var g=o[h],x=o[h+1],j=g[xt]||null;if(typeof x=="function")j||Xv(o);else if(j){var ae=null;if(x&&x.hasAttribute("formAction")){if(g=x,j=x[xt]||null)ae=j.formAction;else if(Bg(g)!==null)continue}else ae=j.action;typeof ae=="function"?o[h+1]=ae:(o.splice(h,3),h-=3),Xv(o)}}}function Yv(){function a(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(j){return g=j})},focusReset:"manual",scroll:"manual"})}function r(){g!==null&&(g(),g=null),h||setTimeout(o,20)}function o(){if(!h&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var h=!1,g=null;return navigation.addEventListener("navigate",a),navigation.addEventListener("navigatesuccess",r),navigation.addEventListener("navigateerror",r),setTimeout(o,100),function(){h=!0,navigation.removeEventListener("navigate",a),navigation.removeEventListener("navigatesuccess",r),navigation.removeEventListener("navigateerror",r),g!==null&&(g(),g=null)}}}function Vg(a){this._internalRoot=a}__.prototype.render=Vg.prototype.render=function(a){var r=this._internalRoot;if(r===null)throw Error(s(409));var o=r.current,h=Ss();Uv(o,h,a,r,null,null)},__.prototype.unmount=Vg.prototype.unmount=function(){var a=this._internalRoot;if(a!==null){this._internalRoot=null;var r=a.containerInfo;Uv(a.current,2,null,a,null,null),su(),r[ht]=null}};function __(a){this._internalRoot=a}__.prototype.unstable_scheduleHydration=function(a){if(a){var r=fe();a={blockedOn:null,target:a,priority:r};for(var o=0;o<Jl.length&&r!==0&&r<Jl[o].priority;o++);Jl.splice(o,0,a),o===0&&Kv(a)}};var Zv=n.version;if(Zv!=="19.2.4")throw Error(s(527,Zv,"19.2.4"));ee.findDOMNode=function(a){var r=a._reactInternals;if(r===void 0)throw typeof a.render=="function"?Error(s(188)):(a=Object.keys(a).join(","),Error(s(268,a)));return a=f(r),a=a!==null?m(a):null,a=a===null?null:a.stateNode,a};var FC={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:R,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var g_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!g_.isDisabled&&g_.supportsFiber)try{Ht=g_.inject(FC),Mn=g_}catch{}}return Bp.createRoot=function(a,r){if(!i(a))throw Error(s(299));var o=!1,h="",g=Ah,x=Ph,j=kh;return r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onUncaughtError!==void 0&&(g=r.onUncaughtError),r.onCaughtError!==void 0&&(x=r.onCaughtError),r.onRecoverableError!==void 0&&(j=r.onRecoverableError)),r=Rv(a,1,!1,null,null,o,h,null,g,x,j,Yv),a[ht]=r.current,of(a),new Vg(r)},Bp.hydrateRoot=function(a,r,o){if(!i(a))throw Error(s(299));var h=!1,g="",x=Ah,j=Ph,ae=kh,ye=null;return o!=null&&(o.unstable_strictMode===!0&&(h=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onUncaughtError!==void 0&&(x=o.onUncaughtError),o.onCaughtError!==void 0&&(j=o.onCaughtError),o.onRecoverableError!==void 0&&(ae=o.onRecoverableError),o.formState!==void 0&&(ye=o.formState)),r=Rv(a,1,!0,r,o??null,h,g,ye,x,j,ae,Yv),r.context=Bv(null),o=r.current,h=Ss(),h=ne(h),g=Ar(h),g.callback=null,ei(o,g,h),o=h,r.current.lanes=o,Ua(r,o),Lr(r),a[ht]=r.current,of(a),new __(r)},Bp.version="19.2.4",Bp}var lb;function qC(){if(lb)return Hg.exports;lb=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(n){console.error(n)}}return e(),Hg.exports=HC(),Hg.exports}var KC=qC();var cb="popstate";function ub(e){return typeof e=="object"&&e!=null&&"pathname"in e&&"search"in e&&"hash"in e&&"state"in e&&"key"in e}function QC(e={}){function n(i,l){let{pathname:c="/",search:u="",hash:d=""}=Pu(i.location.hash.substring(1));return!c.startsWith("/")&&!c.startsWith(".")&&(c="/"+c),i0("",{pathname:c,search:u,hash:d},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function t(i,l){let c=i.document.querySelector("base"),u="";if(c&&c.getAttribute("href")){let d=i.location.href,f=d.indexOf("#");u=f===-1?d:d.slice(0,f)}return u+"#"+(typeof l=="string"?l:fm(l))}function s(i,l){Br(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(l)})`)}return YC(n,t,s,e)}function La(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function Br(e,n){if(!e){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function XC(){return Math.random().toString(36).substring(2,10)}function db(e,n){return{usr:e.state,key:e.key,idx:n,masked:e.unstable_mask?{pathname:e.pathname,search:e.search,hash:e.hash}:void 0}}function i0(e,n,t=null,s,i){return{pathname:typeof e=="string"?e:e.pathname,search:"",hash:"",...typeof n=="string"?Pu(n):n,state:t,key:n&&n.key||s||XC(),unstable_mask:i}}function fm({pathname:e="/",search:n="",hash:t=""}){return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),t&&t!=="#"&&(e+=t.charAt(0)==="#"?t:"#"+t),e}function Pu(e){let n={};if(e){let t=e.indexOf("#");t>=0&&(n.hash=e.substring(t),e=e.substring(0,t));let s=e.indexOf("?");s>=0&&(n.search=e.substring(s),e=e.substring(0,s)),e&&(n.pathname=e)}return n}function YC(e,n,t,s={}){let{window:i=document.defaultView,v5Compat:l=!1}=s,c=i.history,u="POP",d=null,f=m();f==null&&(f=0,c.replaceState({...c.state,idx:f},""));function m(){return(c.state||{idx:null}).idx}function _(){u="POP";let k=m(),b=k==null?null:k-f;f=k,d&&d({action:u,location:T.location,delta:b})}function p(k,b){u="PUSH";let S=ub(k)?k:i0(T.location,k,b);t&&t(S,k),f=m()+1;let $=db(S,f),w=T.createHref(S.unstable_mask||S);try{c.pushState($,"",w)}catch(C){if(C instanceof DOMException&&C.name==="DataCloneError")throw C;i.location.assign(w)}l&&d&&d({action:u,location:T.location,delta:1})}function y(k,b){u="REPLACE";let S=ub(k)?k:i0(T.location,k,b);t&&t(S,k),f=m();let $=db(S,f),w=T.createHref(S.unstable_mask||S);c.replaceState($,"",w),l&&d&&d({action:u,location:T.location,delta:0})}function v(k){return ZC(k)}let T={get action(){return u},get location(){return e(i,c)},listen(k){if(d)throw new Error("A history only accepts one active listener");return i.addEventListener(cb,_),d=k,()=>{i.removeEventListener(cb,_),d=null}},createHref(k){return n(i,k)},createURL:v,encodeLocation(k){let b=v(k);return{pathname:b.pathname,search:b.search,hash:b.hash}},push:p,replace:y,go(k){return c.go(k)}};return T}function ZC(e,n=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),La(t,"No window.location.(origin|href) available to create URL");let s=typeof e=="string"?e:fm(e);return s=s.replace(/ $/,"%20"),!n&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function Ox(e,n,t="/"){return JC(e,n,t,!1)}function JC(e,n,t,s){let i=typeof n=="string"?Pu(n):n,l=Qo(i.pathname||"/",t);if(l==null)return null;let c=Ix(e);eA(c);let u=null;for(let d=0;u==null&&d<c.length;++d){let f=dA(l);u=cA(c[d],f,s)}return u}function Ix(e,n=[],t=[],s="",i=!1){let l=(c,u,d=i,f)=>{let m={relativePath:f===void 0?c.path||"":f,caseSensitive:c.caseSensitive===!0,childrenIndex:u,route:c};if(m.relativePath.startsWith("/")){if(!m.relativePath.startsWith(s)&&d)return;La(m.relativePath.startsWith(s),`Absolute route path "${m.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),m.relativePath=m.relativePath.slice(s.length)}let _=eo([s,m.relativePath]),p=t.concat(m);c.children&&c.children.length>0&&(La(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${_}".`),Ix(c.children,n,p,_,d)),!(c.path==null&&!c.index)&&n.push({path:_,score:oA(_,c.index),routesMeta:p})};return e.forEach((c,u)=>{if(c.path===""||!c.path?.includes("?"))l(c,u);else for(let d of zx(c.path))l(c,u,!0,d)}),n}function zx(e){let n=e.split("/");if(n.length===0)return[];let[t,...s]=n,i=t.endsWith("?"),l=t.replace(/\?$/,"");if(s.length===0)return i?[l,""]:[l];let c=zx(s.join("/")),u=[];return u.push(...c.map(d=>d===""?l:[l,d].join("/"))),i&&u.push(...c),u.map(d=>e.startsWith("/")&&d===""?"/":d)}function eA(e){e.sort((n,t)=>n.score!==t.score?t.score-n.score:lA(n.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var tA=/^:[\w-]+$/,nA=3,aA=2,sA=1,rA=10,iA=-2,fb=e=>e==="*";function oA(e,n){let t=e.split("/"),s=t.length;return t.some(fb)&&(s+=iA),n&&(s+=aA),t.filter(i=>!fb(i)).reduce((i,l)=>i+(tA.test(l)?nA:l===""?sA:rA),s)}function lA(e,n){return e.length===n.length&&e.slice(0,-1).every((s,i)=>s===n[i])?e[e.length-1]-n[n.length-1]:0}function cA(e,n,t=!1){let{routesMeta:s}=e,i={},l="/",c=[];for(let u=0;u<s.length;++u){let d=s[u],f=u===s.length-1,m=l==="/"?n:n.slice(l.length)||"/",_=J_({path:d.relativePath,caseSensitive:d.caseSensitive,end:f},m),p=d.route;if(!_&&f&&t&&!s[s.length-1].route.index&&(_=J_({path:d.relativePath,caseSensitive:d.caseSensitive,end:!1},m)),!_)return null;Object.assign(i,_.params),c.push({params:i,pathname:eo([l,_.pathname]),pathnameBase:mA(eo([l,_.pathnameBase])),route:p}),_.pathnameBase!=="/"&&(l=eo([l,_.pathnameBase]))}return c}function J_(e,n){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[t,s]=uA(e.path,e.caseSensitive,e.end),i=n.match(t);if(!i)return null;let l=i[0],c=l.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:s.reduce((f,{paramName:m,isOptional:_},p)=>{if(m==="*"){let v=u[p]||"";c=l.slice(0,l.length-v.length).replace(/(.)\/+$/,"$1")}const y=u[p];return _&&!y?f[m]=void 0:f[m]=(y||"").replace(/%2F/g,"/"),f},{}),pathname:l,pathnameBase:c,pattern:e}}function uA(e,n=!1,t=!0){Br(e==="*"||!e.endsWith("*")||e.endsWith("/*"),`Route path "${e}" will be treated as if it were "${e.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${e.replace(/\*$/,"/*")}".`);let s=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,u,d,f,m)=>{if(s.push({paramName:u,isOptional:d!=null}),d){let _=m.charAt(f+c.length);return _&&_!=="/"?"/([^\\/]*)":"(?:/([^\\/]*))?"}return"/([^\\/]+)"}).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(s.push({paramName:"*"}),i+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":e!==""&&e!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,n?void 0:"i"),s]}function dA(e){try{return e.split("/").map(n=>decodeURIComponent(n).replace(/\//g,"%2F")).join("/")}catch(n){return Br(!1,`The URL path "${e}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${n}).`),e}}function Qo(e,n){if(n==="/")return e;if(!e.toLowerCase().startsWith(n.toLowerCase()))return null;let t=n.endsWith("/")?n.length-1:n.length,s=e.charAt(t);return s&&s!=="/"?null:e.slice(t)||"/"}var fA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function hA(e,n="/"){let{pathname:t,search:s="",hash:i=""}=typeof e=="string"?Pu(e):e,l;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?l=hb(t.substring(1),"/"):l=hb(t,n)):l=n,{pathname:l,search:_A(s),hash:gA(i)}}function hb(e,n){let t=n.replace(/\/+$/,"").split("/");return e.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Xg(e,n,t,s){return`Cannot include a '${e}' character in a manually specified \`to.${n}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function pA(e){return e.filter((n,t)=>t===0||n.route.path&&n.route.path.length>0)}function Lx(e){let n=pA(e);return n.map((t,s)=>s===n.length-1?t.pathname:t.pathnameBase)}function B0(e,n,t,s=!1){let i;typeof e=="string"?i=Pu(e):(i={...e},La(!i.pathname||!i.pathname.includes("?"),Xg("?","pathname","search",i)),La(!i.pathname||!i.pathname.includes("#"),Xg("#","pathname","hash",i)),La(!i.search||!i.search.includes("#"),Xg("#","search","hash",i)));let l=e===""||i.pathname==="",c=l?"/":i.pathname,u;if(c==null)u=t;else{let _=n.length-1;if(!s&&c.startsWith("..")){let p=c.split("/");for(;p[0]==="..";)p.shift(),_-=1;i.pathname=p.join("/")}u=_>=0?n[_]:"/"}let d=hA(i,u),f=c&&c!=="/"&&c.endsWith("/"),m=(l||c===".")&&t.endsWith("/");return!d.pathname.endsWith("/")&&(f||m)&&(d.pathname+="/"),d}var eo=e=>e.join("/").replace(/\/\/+/g,"/"),mA=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),_A=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,gA=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e,yA=class{constructor(e,n,t,s=!1){this.status=e,this.statusText=n||"",this.internal=s,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function vA(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}function bA(e){return e.map(n=>n.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Fx=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Nx(e,n){let t=e;if(typeof t!="string"||!fA.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let s=t,i=!1;if(Fx)try{let l=new URL(window.location.href),c=t.startsWith("//")?new URL(l.protocol+t):new URL(t),u=Qo(c.pathname,n);c.origin===l.origin&&u!=null?t=u+c.search+c.hash:i=!0}catch{Br(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:i,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var jx=["POST","PUT","PATCH","DELETE"];new Set(jx);var wA=["GET",...jx];new Set(wA);var Tf=Me.createContext(null);Tf.displayName="DataRouter";var pg=Me.createContext(null);pg.displayName="DataRouterState";var MA=Me.createContext(!1),Rx=Me.createContext({isTransitioning:!1});Rx.displayName="ViewTransition";var xA=Me.createContext(new Map);xA.displayName="Fetchers";var TA=Me.createContext(null);TA.displayName="Await";var Ur=Me.createContext(null);Ur.displayName="Navigation";var wm=Me.createContext(null);wm.displayName="Location";var Yo=Me.createContext({outlet:null,matches:[],isDataRoute:!1});Yo.displayName="Route";var U0=Me.createContext(null);U0.displayName="RouteError";var Bx="REACT_ROUTER_ERROR",EA="REDIRECT",SA="ROUTE_ERROR_RESPONSE";function CA(e){if(e.startsWith(`${Bx}:${EA}:{`))try{let n=JSON.parse(e.slice(28));if(typeof n=="object"&&n&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.location=="string"&&typeof n.reloadDocument=="boolean"&&typeof n.replace=="boolean")return n}catch{}}function AA(e){if(e.startsWith(`${Bx}:${SA}:{`))try{let n=JSON.parse(e.slice(40));if(typeof n=="object"&&n&&typeof n.status=="number"&&typeof n.statusText=="string")return new yA(n.status,n.statusText,n.data)}catch{}}function PA(e,{relative:n}={}){La(Mm(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=Me.useContext(Ur),{hash:i,pathname:l,search:c}=Tm(e,{relative:n}),u=l;return t!=="/"&&(u=l==="/"?t:eo([t,l])),s.createHref({pathname:u,search:c,hash:i})}function Mm(){return Me.useContext(wm)!=null}function Zo(){return La(Mm(),"useLocation() may be used only in the context of a <Router> component."),Me.useContext(wm).location}var Ux="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Vx(e){Me.useContext(Ur).static||Me.useLayoutEffect(e)}function xm(){let{isDataRoute:e}=Me.useContext(Yo);return e?UA():kA()}function kA(){La(Mm(),"useNavigate() may be used only in the context of a <Router> component.");let e=Me.useContext(Tf),{basename:n,navigator:t}=Me.useContext(Ur),{matches:s}=Me.useContext(Yo),{pathname:i}=Zo(),l=JSON.stringify(Lx(s)),c=Me.useRef(!1);return Vx(()=>{c.current=!0}),Me.useCallback((d,f={})=>{if(Br(c.current,Ux),!c.current)return;if(typeof d=="number"){t.go(d);return}let m=B0(d,JSON.parse(l),i,f.relative==="path");e==null&&n!=="/"&&(m.pathname=m.pathname==="/"?n:eo([n,m.pathname])),(f.replace?t.replace:t.push)(m,f.state,f)},[n,t,l,i,e])}Me.createContext(null);function Tm(e,{relative:n}={}){let{matches:t}=Me.useContext(Yo),{pathname:s}=Zo(),i=JSON.stringify(Lx(t));return Me.useMemo(()=>B0(e,JSON.parse(i),s,n==="path"),[e,i,s,n])}function $A(e,n){return Gx(e,n)}function Gx(e,n,t){La(Mm(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=Me.useContext(Ur),{matches:i}=Me.useContext(Yo),l=i[i.length-1],c=l?l.params:{},u=l?l.pathname:"/",d=l?l.pathnameBase:"/",f=l&&l.route;{let k=f&&f.path||"";Hx(u,!f||k.endsWith("*")||k.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${k}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${k}"> to <Route path="${k==="/"?"*":`${k}/*`}">.`)}let m=Zo(),_;if(n){let k=typeof n=="string"?Pu(n):n;La(d==="/"||k.pathname?.startsWith(d),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${k.pathname}" was given in the \`location\` prop.`),_=k}else _=m;let p=_.pathname||"/",y=p;if(d!=="/"){let k=d.replace(/^\//,"").split("/");y="/"+p.replace(/^\//,"").split("/").slice(k.length).join("/")}let v=Ox(e,{pathname:y});Br(f||v!=null,`No routes matched location "${_.pathname}${_.search}${_.hash}" `),Br(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${_.pathname}${_.search}${_.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let T=LA(v&&v.map(k=>Object.assign({},k,{params:Object.assign({},c,k.params),pathname:eo([d,s.encodeLocation?s.encodeLocation(k.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?d:eo([d,s.encodeLocation?s.encodeLocation(k.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:k.pathnameBase])})),i,t);return n&&T?Me.createElement(wm.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",unstable_mask:void 0,..._},navigationType:"POP"}},T):T}function DA(){let e=BA(),n=vA(e)?`${e.status} ${e.statusText}`:e instanceof Error?e.message:JSON.stringify(e),t=e instanceof Error?e.stack:null,s="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:s},l={padding:"2px 4px",backgroundColor:s},c=null;return console.error("Error handled by React Router default ErrorBoundary:",e),c=Me.createElement(Me.Fragment,null,Me.createElement("p",null," Hey developer "),Me.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Me.createElement("code",{style:l},"ErrorBoundary")," or"," ",Me.createElement("code",{style:l},"errorElement")," prop on your route.")),Me.createElement(Me.Fragment,null,Me.createElement("h2",null,"Unexpected Application Error!"),Me.createElement("h3",{style:{fontStyle:"italic"}},n),t?Me.createElement("pre",{style:i},t):null,c)}var OA=Me.createElement(DA,null),Wx=class extends Me.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){this.props.onError?this.props.onError(e,n):console.error("React Router caught the following error during render",e)}render(){let e=this.state.error;if(this.context&&typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){const t=AA(e.digest);t&&(e=t)}let n=e!==void 0?Me.createElement(Yo.Provider,{value:this.props.routeContext},Me.createElement(U0.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?Me.createElement(IA,{error:e},n):n}};Wx.contextType=MA;var Yg=new WeakMap;function IA({children:e,error:n}){let{basename:t}=Me.useContext(Ur);if(typeof n=="object"&&n&&"digest"in n&&typeof n.digest=="string"){let s=CA(n.digest);if(s){let i=Yg.get(n);if(i)throw i;let l=Nx(s.location,t);if(Fx&&!Yg.get(n))if(l.isExternal||s.reloadDocument)window.location.href=l.absoluteURL||l.to;else{const c=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(l.to,{replace:s.replace}));throw Yg.set(n,c),c}return Me.createElement("meta",{httpEquiv:"refresh",content:`0;url=${l.absoluteURL||l.to}`})}}return e}function zA({routeContext:e,match:n,children:t}){let s=Me.useContext(Tf);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),Me.createElement(Yo.Provider,{value:e},t)}function LA(e,n=[],t){let s=t?.state;if(e==null){if(!s)return null;if(s.errors)e=s.matches;else if(n.length===0&&!s.initialized&&s.matches.length>0)e=s.matches;else return null}let i=e,l=s?.errors;if(l!=null){let m=i.findIndex(_=>_.route.id&&l?.[_.route.id]!==void 0);La(m>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(l).join(",")}`),i=i.slice(0,Math.min(i.length,m+1))}let c=!1,u=-1;if(t&&s){c=s.renderFallback;for(let m=0;m<i.length;m++){let _=i[m];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(u=m),_.route.id){let{loaderData:p,errors:y}=s,v=_.route.loader&&!p.hasOwnProperty(_.route.id)&&(!y||y[_.route.id]===void 0);if(_.route.lazy||v){t.isStatic&&(c=!0),u>=0?i=i.slice(0,u+1):i=[i[0]];break}}}}let d=t?.onError,f=s&&d?(m,_)=>{d(m,{location:s.location,params:s.matches?.[0]?.params??{},unstable_pattern:bA(s.matches),errorInfo:_})}:void 0;return i.reduceRight((m,_,p)=>{let y,v=!1,T=null,k=null;s&&(y=l&&_.route.id?l[_.route.id]:void 0,T=_.route.errorElement||OA,c&&(u<0&&p===0?(Hx("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),v=!0,k=null):u===p&&(v=!0,k=_.route.hydrateFallbackElement||null)));let b=n.concat(i.slice(0,p+1)),S=()=>{let $;return y?$=T:v?$=k:_.route.Component?$=Me.createElement(_.route.Component,null):_.route.element?$=_.route.element:$=m,Me.createElement(zA,{match:_,routeContext:{outlet:m,matches:b,isDataRoute:s!=null},children:$})};return s&&(_.route.ErrorBoundary||_.route.errorElement||p===0)?Me.createElement(Wx,{location:s.location,revalidation:s.revalidation,component:T,error:y,children:S(),routeContext:{outlet:null,matches:b,isDataRoute:!0},onError:f}):S()},null)}function V0(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function FA(e){let n=Me.useContext(Tf);return La(n,V0(e)),n}function NA(e){let n=Me.useContext(pg);return La(n,V0(e)),n}function jA(e){let n=Me.useContext(Yo);return La(n,V0(e)),n}function G0(e){let n=jA(e),t=n.matches[n.matches.length-1];return La(t.route.id,`${e} can only be used on routes that contain a unique "id"`),t.route.id}function RA(){return G0("useRouteId")}function BA(){let e=Me.useContext(U0),n=NA("useRouteError"),t=G0("useRouteError");return e!==void 0?e:n.errors?.[t]}function UA(){let{router:e}=FA("useNavigate"),n=G0("useNavigate"),t=Me.useRef(!1);return Vx(()=>{t.current=!0}),Me.useCallback(async(i,l={})=>{Br(t.current,Ux),t.current&&(typeof i=="number"?await e.navigate(i):await e.navigate(i,{fromRouteId:n,...l}))},[e,n])}var pb={};function Hx(e,n,t){!n&&!pb[e]&&(pb[e]=!0,Br(!1,t))}Me.memo(VA);function VA({routes:e,future:n,state:t,isStatic:s,onError:i}){return Gx(e,void 0,{state:t,isStatic:s,onError:i})}function sc(e){La(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function GA({basename:e="/",children:n=null,location:t,navigationType:s="POP",navigator:i,static:l=!1,unstable_useTransitions:c}){La(!Mm(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let u=e.replace(/^\/*/,"/"),d=Me.useMemo(()=>({basename:u,navigator:i,static:l,unstable_useTransitions:c,future:{}}),[u,i,l,c]);typeof t=="string"&&(t=Pu(t));let{pathname:f="/",search:m="",hash:_="",state:p=null,key:y="default",unstable_mask:v}=t,T=Me.useMemo(()=>{let k=Qo(f,u);return k==null?null:{location:{pathname:k,search:m,hash:_,state:p,key:y,unstable_mask:v},navigationType:s}},[u,f,m,_,p,y,s,v]);return Br(T!=null,`<Router basename="${u}"> is not able to match the URL "${f}${m}${_}" because it does not start with the basename, so the <Router> won't render anything.`),T==null?null:Me.createElement(Ur.Provider,{value:d},Me.createElement(wm.Provider,{children:n,value:T}))}function WA({children:e,location:n}){return $A(o0(e),n)}function o0(e,n=[]){let t=[];return Me.Children.forEach(e,(s,i)=>{if(!Me.isValidElement(s))return;let l=[...n,i];if(s.type===Me.Fragment){t.push.apply(t,o0(s.props.children,l));return}La(s.type===sc,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),La(!s.props.index||!s.props.children,"An index route cannot have child routes.");let c={id:s.props.id||l.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(c.children=o0(s.props.children,l)),t.push(c)}),t}var B_="get",U_="application/x-www-form-urlencoded";function mg(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement}function HA(e){return mg(e)&&e.tagName.toLowerCase()==="button"}function qA(e){return mg(e)&&e.tagName.toLowerCase()==="form"}function KA(e){return mg(e)&&e.tagName.toLowerCase()==="input"}function QA(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function XA(e,n){return e.button===0&&(!n||n==="_self")&&!QA(e)}function l0(e=""){return new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((n,t)=>{let s=e[t];return n.concat(Array.isArray(s)?s.map(i=>[t,i]):[[t,s]])},[]))}function YA(e,n){let t=l0(e);return n&&n.forEach((s,i)=>{t.has(i)||n.getAll(i).forEach(l=>{t.append(i,l)})}),t}var y_=null;function ZA(){if(y_===null)try{new FormData(document.createElement("form"),0),y_=!1}catch{y_=!0}return y_}var JA=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Zg(e){return e!=null&&!JA.has(e)?(Br(!1,`"${e}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${U_}"`),null):e}function eP(e,n){let t,s,i,l,c;if(qA(e)){let u=e.getAttribute("action");s=u?Qo(u,n):null,t=e.getAttribute("method")||B_,i=Zg(e.getAttribute("enctype"))||U_,l=new FormData(e)}else if(HA(e)||KA(e)&&(e.type==="submit"||e.type==="image")){let u=e.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let d=e.getAttribute("formaction")||u.getAttribute("action");if(s=d?Qo(d,n):null,t=e.getAttribute("formmethod")||u.getAttribute("method")||B_,i=Zg(e.getAttribute("formenctype"))||Zg(u.getAttribute("enctype"))||U_,l=new FormData(u,e),!ZA()){let{name:f,type:m,value:_}=e;if(m==="image"){let p=f?`${f}.`:"";l.append(`${p}x`,"0"),l.append(`${p}y`,"0")}else f&&l.append(f,_)}}else{if(mg(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=B_,s=null,i=U_,c=e}return l&&i==="text/plain"&&(c=l,l=void 0),{action:s,method:t.toLowerCase(),encType:i,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function W0(e,n){if(e===!1||e===null||typeof e>"u")throw new Error(n)}function tP(e,n,t,s){let i=typeof e=="string"?new URL(e,typeof window>"u"?"server://singlefetch/":window.location.origin):e;return t?i.pathname.endsWith("/")?i.pathname=`${i.pathname}_.${s}`:i.pathname=`${i.pathname}.${s}`:i.pathname==="/"?i.pathname=`_root.${s}`:n&&Qo(i.pathname,n)==="/"?i.pathname=`${n.replace(/\/$/,"")}/_root.${s}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${s}`,i}async function nP(e,n){if(e.id in n)return n[e.id];try{let t=await import(e.module);return n[e.id]=t,t}catch(t){return console.error(`Error loading route module \`${e.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function aP(e){return e==null?!1:e.href==null?e.rel==="preload"&&typeof e.imageSrcSet=="string"&&typeof e.imageSizes=="string":typeof e.rel=="string"&&typeof e.href=="string"}async function sP(e,n,t){let s=await Promise.all(e.map(async i=>{let l=n.routes[i.route.id];if(l){let c=await nP(l,t);return c.links?c.links():[]}return[]}));return lP(s.flat(1).filter(aP).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function mb(e,n,t,s,i,l){let c=(d,f)=>t[f]?d.route.id!==t[f].route.id:!0,u=(d,f)=>t[f].pathname!==d.pathname||t[f].route.path?.endsWith("*")&&t[f].params["*"]!==d.params["*"];return l==="assets"?n.filter((d,f)=>c(d,f)||u(d,f)):l==="data"?n.filter((d,f)=>{let m=s.routes[d.route.id];if(!m||!m.hasLoader)return!1;if(c(d,f)||u(d,f))return!0;if(d.route.shouldRevalidate){let _=d.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(e,window.origin),nextParams:d.params,defaultShouldRevalidate:!0});if(typeof _=="boolean")return _}return!0}):[]}function rP(e,n,{includeHydrateFallback:t}={}){return iP(e.map(s=>{let i=n.routes[s.route.id];if(!i)return[];let l=[i.module];return i.clientActionModule&&(l=l.concat(i.clientActionModule)),i.clientLoaderModule&&(l=l.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(l=l.concat(i.hydrateFallbackModule)),i.imports&&(l=l.concat(i.imports)),l}).flat(1))}function iP(e){return[...new Set(e)]}function oP(e){let n={},t=Object.keys(e).sort();for(let s of t)n[s]=e[s];return n}function lP(e,n){let t=new Set;return new Set(n),e.reduce((s,i)=>{let l=JSON.stringify(oP(i));return t.has(l)||(t.add(l),s.push({key:l,link:i})),s},[])}function qx(){let e=Me.useContext(Tf);return W0(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function cP(){let e=Me.useContext(pg);return W0(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var H0=Me.createContext(void 0);H0.displayName="FrameworkContext";function Kx(){let e=Me.useContext(H0);return W0(e,"You must render this element inside a <HydratedRouter> element"),e}function uP(e,n){let t=Me.useContext(H0),[s,i]=Me.useState(!1),[l,c]=Me.useState(!1),{onFocus:u,onBlur:d,onMouseEnter:f,onMouseLeave:m,onTouchStart:_}=n,p=Me.useRef(null);Me.useEffect(()=>{if(e==="render"&&c(!0),e==="viewport"){let T=b=>{b.forEach(S=>{c(S.isIntersecting)})},k=new IntersectionObserver(T,{threshold:.5});return p.current&&k.observe(p.current),()=>{k.disconnect()}}},[e]),Me.useEffect(()=>{if(s){let T=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(T)}}},[s]);let y=()=>{i(!0)},v=()=>{i(!1),c(!1)};return t?e!=="intent"?[l,p,{}]:[l,p,{onFocus:Up(u,y),onBlur:Up(d,v),onMouseEnter:Up(f,y),onMouseLeave:Up(m,v),onTouchStart:Up(_,y)}]:[!1,p,{}]}function Up(e,n){return t=>{e&&e(t),t.defaultPrevented||n(t)}}function dP({page:e,...n}){let{router:t}=qx(),s=Me.useMemo(()=>Ox(t.routes,e,t.basename),[t.routes,e,t.basename]);return s?Me.createElement(hP,{page:e,matches:s,...n}):null}function fP(e){let{manifest:n,routeModules:t}=Kx(),[s,i]=Me.useState([]);return Me.useEffect(()=>{let l=!1;return sP(e,n,t).then(c=>{l||i(c)}),()=>{l=!0}},[e,n,t]),s}function hP({page:e,matches:n,...t}){let s=Zo(),{future:i,manifest:l,routeModules:c}=Kx(),{basename:u}=qx(),{loaderData:d,matches:f}=cP(),m=Me.useMemo(()=>mb(e,n,f,l,s,"data"),[e,n,f,l,s]),_=Me.useMemo(()=>mb(e,n,f,l,s,"assets"),[e,n,f,l,s]),p=Me.useMemo(()=>{if(e===s.pathname+s.search+s.hash)return[];let T=new Set,k=!1;if(n.forEach(S=>{let $=l.routes[S.route.id];!$||!$.hasLoader||(!m.some(w=>w.route.id===S.route.id)&&S.route.id in d&&c[S.route.id]?.shouldRevalidate||$.hasClientLoader?k=!0:T.add(S.route.id))}),T.size===0)return[];let b=tP(e,u,i.unstable_trailingSlashAwareDataRequests,"data");return k&&T.size>0&&b.searchParams.set("_routes",n.filter(S=>T.has(S.route.id)).map(S=>S.route.id).join(",")),[b.pathname+b.search]},[u,i.unstable_trailingSlashAwareDataRequests,d,s,l,m,n,e,c]),y=Me.useMemo(()=>rP(_,l),[_,l]),v=fP(_);return Me.createElement(Me.Fragment,null,p.map(T=>Me.createElement("link",{key:T,rel:"prefetch",as:"fetch",href:T,...t})),y.map(T=>Me.createElement("link",{key:T,rel:"modulepreload",href:T,...t})),v.map(({key:T,link:k})=>Me.createElement("link",{key:T,nonce:t.nonce,...k,crossOrigin:k.crossOrigin??t.crossOrigin})))}function pP(...e){return n=>{e.forEach(t=>{typeof t=="function"?t(n):t!=null&&(t.current=n)})}}var mP=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{mP&&(window.__reactRouterVersion="7.13.1")}catch{}function _P({basename:e,children:n,unstable_useTransitions:t,window:s}){let i=Me.useRef();i.current==null&&(i.current=QC({window:s,v5Compat:!0}));let l=i.current,[c,u]=Me.useState({action:l.action,location:l.location}),d=Me.useCallback(f=>{t===!1?u(f):Me.startTransition(()=>u(f))},[t]);return Me.useLayoutEffect(()=>l.listen(d),[l,d]),Me.createElement(GA,{basename:e,children:n,location:c.location,navigationType:c.action,navigator:l,unstable_useTransitions:t})}var Qx=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Xx=Me.forwardRef(function({onClick:n,discover:t="render",prefetch:s="none",relative:i,reloadDocument:l,replace:c,unstable_mask:u,state:d,target:f,to:m,preventScrollReset:_,viewTransition:p,unstable_defaultShouldRevalidate:y,...v},T){let{basename:k,navigator:b,unstable_useTransitions:S}=Me.useContext(Ur),$=typeof m=="string"&&Qx.test(m),w=Nx(m,k);m=w.to;let C=PA(m,{relative:i}),P=Zo(),A=null;if(u){let te=B0(u,[],P.unstable_mask?P.unstable_mask.pathname:"/",!0);k!=="/"&&(te.pathname=te.pathname==="/"?k:eo([k,te.pathname])),A=b.createHref(te)}let[I,W,G]=uP(s,v),q=vP(m,{replace:c,unstable_mask:u,state:d,target:f,preventScrollReset:_,relative:i,viewTransition:p,unstable_defaultShouldRevalidate:y,unstable_useTransitions:S});function Z(te){n&&n(te),te.defaultPrevented||q(te)}let X=!(w.isExternal||l),Q=Me.createElement("a",{...v,...G,href:(X?A:void 0)||w.absoluteURL||C,onClick:X?Z:n,ref:pP(T,W),target:f,"data-discover":!$&&t==="render"?"true":void 0});return I&&!$?Me.createElement(Me.Fragment,null,Q,Me.createElement(dP,{page:C})):Q});Xx.displayName="Link";var rc=Me.forwardRef(function({"aria-current":n="page",caseSensitive:t=!1,className:s="",end:i=!1,style:l,to:c,viewTransition:u,children:d,...f},m){let _=Tm(c,{relative:f.relative}),p=Zo(),y=Me.useContext(pg),{navigator:v,basename:T}=Me.useContext(Ur),k=y!=null&&TP(_)&&u===!0,b=v.encodeLocation?v.encodeLocation(_).pathname:_.pathname,S=p.pathname,$=y&&y.navigation&&y.navigation.location?y.navigation.location.pathname:null;t||(S=S.toLowerCase(),$=$?$.toLowerCase():null,b=b.toLowerCase()),$&&T&&($=Qo($,T)||$);const w=b!=="/"&&b.endsWith("/")?b.length-1:b.length;let C=S===b||!i&&S.startsWith(b)&&S.charAt(w)==="/",P=$!=null&&($===b||!i&&$.startsWith(b)&&$.charAt(b.length)==="/"),A={isActive:C,isPending:P,isTransitioning:k},I=C?n:void 0,W;typeof s=="function"?W=s(A):W=[s,C?"active":null,P?"pending":null,k?"transitioning":null].filter(Boolean).join(" ");let G=typeof l=="function"?l(A):l;return Me.createElement(Xx,{...f,"aria-current":I,className:W,ref:m,style:G,to:c,viewTransition:u},typeof d=="function"?d(A):d)});rc.displayName="NavLink";var gP=Me.forwardRef(({discover:e="render",fetcherKey:n,navigate:t,reloadDocument:s,replace:i,state:l,method:c=B_,action:u,onSubmit:d,relative:f,preventScrollReset:m,viewTransition:_,unstable_defaultShouldRevalidate:p,...y},v)=>{let{unstable_useTransitions:T}=Me.useContext(Ur),k=MP(),b=xP(u,{relative:f}),S=c.toLowerCase()==="get"?"get":"post",$=typeof u=="string"&&Qx.test(u),w=C=>{if(d&&d(C),C.defaultPrevented)return;C.preventDefault();let P=C.nativeEvent.submitter,A=P?.getAttribute("formmethod")||c,I=()=>k(P||C.currentTarget,{fetcherKey:n,method:A,navigate:t,replace:i,state:l,relative:f,preventScrollReset:m,viewTransition:_,unstable_defaultShouldRevalidate:p});T&&t!==!1?Me.startTransition(()=>I()):I()};return Me.createElement("form",{ref:v,method:S,action:b,onSubmit:s?d:w,...y,"data-discover":!$&&e==="render"?"true":void 0})});gP.displayName="Form";function yP(e){return`${e} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Yx(e){let n=Me.useContext(Tf);return La(n,yP(e)),n}function vP(e,{target:n,replace:t,unstable_mask:s,state:i,preventScrollReset:l,relative:c,viewTransition:u,unstable_defaultShouldRevalidate:d,unstable_useTransitions:f}={}){let m=xm(),_=Zo(),p=Tm(e,{relative:c});return Me.useCallback(y=>{if(XA(y,n)){y.preventDefault();let v=t!==void 0?t:fm(_)===fm(p),T=()=>m(e,{replace:v,unstable_mask:s,state:i,preventScrollReset:l,relative:c,viewTransition:u,unstable_defaultShouldRevalidate:d});f?Me.startTransition(()=>T()):T()}},[_,m,p,t,s,i,n,e,l,c,u,d,f])}function Zx(e){Br(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let n=Me.useRef(l0(e)),t=Me.useRef(!1),s=Zo(),i=Me.useMemo(()=>YA(s.search,t.current?null:n.current),[s.search]),l=xm(),c=Me.useCallback((u,d)=>{const f=l0(typeof u=="function"?u(new URLSearchParams(i)):u);t.current=!0,l("?"+f,d)},[l,i]);return[i,c]}var bP=0,wP=()=>`__${String(++bP)}__`;function MP(){let{router:e}=Yx("useSubmit"),{basename:n}=Me.useContext(Ur),t=RA(),s=e.fetch,i=e.navigate;return Me.useCallback(async(l,c={})=>{let{action:u,method:d,encType:f,formData:m,body:_}=eP(l,n);if(c.navigate===!1){let p=c.fetcherKey||wP();await s(p,t,c.action||u,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:m,body:_,formMethod:c.method||d,formEncType:c.encType||f,flushSync:c.flushSync})}else await i(c.action||u,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:m,body:_,formMethod:c.method||d,formEncType:c.encType||f,replace:c.replace,state:c.state,fromRouteId:t,flushSync:c.flushSync,viewTransition:c.viewTransition})},[s,i,n,t])}function xP(e,{relative:n}={}){let{basename:t}=Me.useContext(Ur),s=Me.useContext(Yo);La(s,"useFormAction must be used inside a RouteContext");let[i]=s.matches.slice(-1),l={...Tm(e||".",{relative:n})},c=Zo();if(e==null){l.search=c.search;let u=new URLSearchParams(l.search),d=u.getAll("index");if(d.some(m=>m==="")){u.delete("index"),d.filter(_=>_).forEach(_=>u.append("index",_));let m=u.toString();l.search=m?`?${m}`:""}}return(!e||e===".")&&i.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(l.pathname=l.pathname==="/"?t:eo([t,l.pathname])),fm(l)}function TP(e,{relative:n}={}){let t=Me.useContext(Rx);La(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=Yx("useViewTransitionState"),i=Tm(e,{relative:n});if(!t.isTransitioning)return!1;let l=Qo(t.currentLocation.pathname,s)||t.currentLocation.pathname,c=Qo(t.nextLocation.pathname,s)||t.nextLocation.pathname;return J_(i.pathname,c)!=null||J_(i.pathname,l)!=null}const EP={en:{nav:{dashboard:"Dashboard",deepAnalyze:"Deep Analyze",ecosystem:"Ecosystem",blocklist:"Blocklist",howItWorks:"How It Works",contact:"Contact",scanUrl:"Scan URL"},dashboard:{breadcrumb:["Detection","Graph","Blocklist"],heroTitle:"Find not one site ",heroTitleAccent:"find the whole network.",heroSubtitle:'QalqanAI shows risk, reasons, and the "digital DNA" of a resource. Infrastructure-level threat detection powered by graph mapping.',placeholder:"Enter URL to analyze...",scanning:"Scanning...",analyze:"Analyze",categories:["Casino","Pyramid","Scam / Fraud","Mirrors","Affiliate"],shortcuts:"Shortcuts:",shortcutChat:" chat,",shortcutAnalysis:" to analysis",threatFeed:"Threat Feed",feedDesc:"Event stream: new mirrors, marker coincidences, cluster growth.",newMirror:"New mirror detected",trackerReused:"Tracker reused",redirectAnomaly:"Redirect anomaly",risk:"risk",scannedToday:"Scanned Today",suspicious:"Suspicious",newMirrors:"New Mirrors",clusters:"Clusters",vsYesterday:"+18% vs yesterday",tierAB:"Tier A/B",hours24:"24 hours",operatorFingerprints:"Operator fingerprints",footerLine1:"QalqanAI does not chase websites.",footerLine2:"It maps the infrastructure behind them."},analysis:{title:"Analysis Result",scannedIn:"Scanned in",completedIn:"Completed in",viewEcosystem:"View Ecosystem",whyUnsafe:"Why This Site Is Unsafe",whyAnalyzed:"Why This Site Is Analyzed",noRiskIndicators:" No significant risk indicators detected",evidenceLocation:"Evidence Location",rulesEvaluated:"Rules evaluated:",rulesTriggered:"Rules triggered:",mlTitle:"ML Model Classification",mlConfidence:"Confidence:",mlNote:"Secondary classification by TF-IDF + Random Forest model trained on suspicious URL patterns.",clonesTitle:"Clone / Variant Domains Found",clonesDesc:"Live domains with similar names detected via DNS probing (TLD swaps, typosquatting, character substitution).",clonesNote:"Clone detection uses real DNS lookups  only domains that resolve to an active IP are shown.",redirectChain:"Redirect Chain Timeline",extractedMarkers:"Extracted Digital Markers",infrastructure:"Infrastructure Markers",tracking:"Tracking & Marketing",financial:"Financial Indicators",contacts:"Contact & Operator",registration:"Registration & WHOIS",highRisk:"HIGH RISK",mediumRisk:"MEDIUM RISK",lowRisk:"LOW RISK",confidence:"Confidence:",analyzing:"Analyzing",analysisFailed:"Analysis failed for",backToDashboard:" Back to Dashboard",domainNotFound:"Domain Not Found",dnsLookup:"DNS lookup returned",nxdomain:" this domain does not exist or has been taken down. It cannot be analyzed because there is no active web server responding at this address.",analyzeAnother:" Analyze Another Domain",initScan:"Initializing scan...",statusChecking:"Checking domain existence (DNS)...",statusDNS:"Resolving DNS records...",statusTLS:"Probing TLS certificate...",statusFingerprints:"Extracting infrastructure fingerprints...",statusHeuristic:"Running heuristic analysis...",statusRisk:"Evaluating risk rules...",statusEcosystem:"Checking ecosystem graph..."},blocklist:{title:"Blocklist & Reports",subtitle:"entries  AI-classified threat database",of:"of",loading:"Loading blocklist data...",exportCSV:"Export CSV",exportJSON:"Export JSON",searchPlaceholder:"Search domain or cluster...",allTiers:"All Tiers",domain:"Domain",category:"Category",risk:"Risk",tier:"Tier",status:"Status",detected:"Detected",cluster:"Cluster",markers:"Markers",disclaimer:"All classifications are AI-generated and should be reviewed by a human analyst before enforcement. QalqanAI provides intelligence to support decisions  not replace them."},howItWorks:{title:"How It Works",subtitle:"Understanding QalqanAI's infrastructure-level detection methodology",corePrinciple:"Core Principle",corePrincipleText:"Unsafe platforms can change their appearance, but they cannot easily change their entire digital infrastructure. QalqanAI detects shared technical fingerprints, repeated trackers, reused payment endpoints, identical redirect funnels, and operator behavior patterns  revealing entire illegal ecosystems, not single sites.",traditionalDetection:"Traditional Detection",qalqanDetection:"QalqanAI Detection",traditionalItems:["Analyzes page text","Keyword matching","Static blacklists","Fails when content changes"],qalqanItems:["Infrastructure fingerprinting","Behavioral analysis","Graph-based clustering","Resistant to evasion"],whyInfraBeatsContent:"Why Infrastructure Beats Content",whyInfraText:"Content is cheap to change  a scam site can rewrite its text in minutes. But infrastructure is expensive and complex: IP addresses, TLS certificates, tracking IDs, payment integrations, and redirect architectures are deeply embedded. By targeting these invariants, QalqanAI detects threats that evade every content-based system.",totalRiskScore:"Total Risk Score",steps:[{title:"URL Intake",description:"A user submits a website URL or domain name. The system begins a controlled, read-only, non-intrusive scan. No interaction with the target site beyond what a normal browser would do.",details:["Website URL submission","Domain name lookup","Controlled read-only scanning","No intrusive probing"]},{title:"Full Page Rendering",description:"Many scam and casino sites hide content behind JavaScript. QalqanAI loads the site as a real browser, captures the final rendered HTML, and records redirect chains and hidden scripts.",details:["Headless browser rendering","JavaScript execution capture","Redirect chain recording","Hidden script detection"]},{title:"Digital Marker Extraction",description:"The system extracts hard-to-fake digital identifiers grouped into categories: infrastructure markers, tracking IDs, funnel patterns, financial indicators, and operator signals.",categories:[{label:"Infrastructure",items:["IP address","Hosting / ASN","TLS certificate","CDN behavior"]},{label:"Tracking",items:["Google Analytics ID","Facebook Pixel","TikTok Pixel","Affiliate params"]},{label:"Funnel Patterns",items:["Redirect count","Landing  pre-landing","Conversion sequence"]},{label:"Financial",items:["Crypto wallets","Payment gateways","Card top-up flows"]},{label:"Contact Signals",items:["Telegram handles","WhatsApp numbers","Email reuse"]}]},{title:"Risk Scoring (Explainable AI)",description:'Each extracted marker adds weighted risk. The system produces a transparent score from 0100, a threat category, and a human-readable explanation. No "black box" decisions.',scoreExample:[{reason:"Shared TLS fingerprint with known scam",weight:"+25"},{reason:"Reused GA ID across 10 domains",weight:"+30"},{reason:"Crypto wallet detected",weight:"+15"},{reason:"Aggressive conversion language",weight:"+10"}]},{title:"Graph & Ecosystem Detection",description:"All analyzed sites are stored as nodes in a graph database. Shared markers create edges between nodes. This reveals mirror sites, operator clusters, affiliate networks, and infrastructure reuse.",details:["Mirror site detection","Operator clustering","Affiliate network mapping","Risk propagation through clusters"]},{title:"Action Output",description:"The system generates structured blocklists, evidence packs, cluster reports, and monitoring alerts for new mirrors. Results are ready for regulatory action or automated blocking.",details:["Structured blocklists","Evidence documentation","Cluster reports","New mirror alerts"]}]},contact:{title:"Get In Touch",subtitle:"Have questions about QalqanAI? Want to partner with us? We'd love to hear from you.",email:"Email",github:"GitHub",location:"Location",locationValue:"Shymkent, Kazakhstan",responseTime:"Response Time",responseTimeValue:"Within 24 hours",coreTeam:"Core Team",team:[{name:"Akim Alikhan",initials:"AA",role:"Programmer"},{name:"Otan Alissultan",initials:"OA",role:"Coder"},{name:"Abzelbek Nurkeldi",initials:"AN",role:"Captain"},{name:"Amanbek Alzhan",initials:"A",role:"Manager"}],sendMessage:"Send a Message",messageSent:"Message Sent!",messageReply:"We'll get back to you within 24 hours.",name:"Name",namePlaceholder:"Your name",emailLabel:"Email",emailPlaceholder:"you@example.com",subject:"Subject",subjectPlaceholder:"What's this about?",message:"Message",messagePlaceholder:"Tell us more...",send:"Send Message"},deepAnalyze:{title:"Deep Analyze",subtitle:"Typosquatting & homoglyph scanner  find malicious clones of any domain",placeholder:"Enter domain to scan (e.g. google.com, paypal.com)",stop:"Stop",deepScan:"Deep Scan",checksVariants:"Checks up to 10,000 domain variants",realDNS:"Real DNS verification via Cloudflare",strategies:"Homoglyphs, typos, TLD swaps & more",scanning:"Scanning...",scanComplete:"Scan Complete",variants:"variants",foundAlive:"Found Alive",highRisk:"High Risk",mediumRisk:"Medium Risk",lowRisk:"Low Risk",foundDomains:"Found Domains",allStrategies:"All Strategies",domain:"Domain",strategy:"Strategy",risk:"Risk",noClonesFound:"No clones found",noClonesDesc:"None of the generated domain variants resolved to an active IP address. This domain appears clean."},ecosystem:{title:"Ecosystem Graph",subtitle:"Interactive visualization of infrastructure clusters and shared markers",clusterSummary:"Cluster Summary",nodeTypes:"Node Types",websites:"Websites",totalNodes:"Total Nodes",connections:"Connections",nodeLabels:{website:"Website",domain:"IP / Domain",tracker:"Tracker ID",certificate:"TLS Certificate",wallet:"Crypto Wallet",contact:"Contact / Operator"},detailTitle:"Node Details",risk:"Risk:",detectedOn:"Detected on:"}},ru:{nav:{dashboard:"",deepAnalyze:" ",ecosystem:"",blocklist:"",howItWorks:"  ",contact:"",scanUrl:""},dashboard:{breadcrumb:["","",""],heroTitle:"    ",heroTitleAccent:"  .",heroSubtitle:"QalqanAI  ,     .         .",placeholder:" URL  ...",scanning:"...",analyze:"",categories:["","","","",""],shortcuts:" :",shortcutChat:" ,",shortcutAnalysis:"  ",threatFeed:" ",feedDesc:" :  ,  ,  .",newMirror:"  ",trackerReused:"  ",redirectAnomaly:" ",risk:"",scannedToday:" ",suspicious:"",newMirrors:" ",clusters:"",vsYesterday:"+18%  ",tierAB:" A/B",hours24:"24 ",operatorFingerprints:" ",footerLine1:"QalqanAI    .",footerLine2:"    ."},analysis:{title:" ",scannedIn:" ",completedIn:" ",viewEcosystem:"",whyUnsafe:"   ",whyAnalyzed:"   ",noRiskIndicators:"     ",evidenceLocation:" ",rulesEvaluated:" :",rulesTriggered:" :",mlTitle:" ML-",mlConfidence:":",mlNote:"   TF-IDF + Random Forest,    URL-.",clonesTitle:"  /  ",clonesDesc:"    ,   DNS- ( TLD, ,  ).",clonesNote:"    DNS-       IP-.",redirectChain:" ",extractedMarkers:"  ",infrastructure:" ",tracking:"  ",financial:" ",contacts:"  ",registration:"  WHOIS",highRisk:" ",mediumRisk:" ",lowRisk:" ",confidence:":",analyzing:"",analysisFailed:"   ",backToDashboard:"   ",domainNotFound:"  ",dnsLookup:"DNS- ",nxdomain:"       .  ,     -   .",analyzeAnother:"   ",initScan:" ...",statusChecking:"   (DNS)...",statusDNS:" DNS-...",statusTLS:" TLS-...",statusFingerprints:"  ...",statusHeuristic:"  ...",statusRisk:"  ...",statusEcosystem:"  ..."},blocklist:{title:"  ",subtitle:"     AI-",of:"",loading:"  ...",exportCSV:" CSV",exportJSON:" JSON",searchPlaceholder:"    ...",allTiers:" ",domain:"",category:"",risk:"",tier:"",status:"",detected:"",cluster:"",markers:"",disclaimer:"   AI       . QalqanAI          ."},howItWorks:{title:"  ",subtitle:"      QalqanAI",corePrinciple:" ",corePrincipleText:"     ,        . QalqanAI    ,  ,     ,            ,    .",traditionalDetection:" ",qalqanDetection:" QalqanAI",traditionalItems:["  ","   ","  ","    "],qalqanItems:[" "," ","   ","  "],whyInfraBeatsContent:"   ",whyInfraText:"          .     : IP-, TLS-,  ,       .    , QalqanAI  ,       .",totalRiskScore:"  ",steps:[{title:" URL",description:"  URL   .   ,     .       ,    .",details:[" URL ","  "," ","  "]},{title:"  ",description:"   -    JavaScript. QalqanAI     ,   HTML       .",details:["  headless-","  JavaScript","  ","  "]},{title:"  ",description:"    ,   :  , ID ,  ,     .",categories:[{label:"",items:["IP-"," / ASN","TLS-"," CDN"]},{label:"",items:["Google Analytics ID","Facebook Pixel","TikTok Pixel"," "]},{label:" ",items:[" ","  "," "]},{label:"",items:[""," ","  "]},{label:" ",items:["Telegram-","WhatsApp-","  email"]}]},{title:"  ( AI)",description:"     .      0  100,     .    .",scoreExample:[{reason:" TLS-   ",weight:"+25"},{reason:"  GA ID  10 ",weight:"+30"},{reason:" ",weight:"+15"},{reason:"  ",weight:"+10"}]},{title:"   ",description:"         .      .   ,  ,      .",details:[" "," ","  ","   "]},{title:" ",description:"   ,  ,        .        .",details:[" "," ","  ","   "]}]},contact:{title:"  ",subtitle:"   QalqanAI?  ?     .",email:". ",github:"GitHub",location:"",locationValue:", ",responseTime:" ",responseTimeValue:"  24 ",coreTeam:"",team:[{name:"Akim Alikhan",initials:"AA",role:""},{name:"Otan Alissultan",initials:"OA",role:""},{name:"Abzelbek Nurkeldi",initials:"AN",role:""},{name:"Amanbek Alzhan",initials:"A",role:""}],sendMessage:" ",messageSent:" !",messageReply:"     24 .",name:"",namePlaceholder:" ",emailLabel:". ",emailPlaceholder:"you@example.com",subject:"",subjectPlaceholder:"  ?",message:"",messagePlaceholder:" ...",send:""},deepAnalyze:{title:" ",subtitle:"         ",placeholder:"    (. google.com, paypal.com)",stop:"",deepScan:" ",checksVariants:"  10 000  ",realDNS:" DNS-  Cloudflare",strategies:", ,  TLD  ",scanning:"...",scanComplete:" ",variants:"",foundAlive:" ",highRisk:" ",mediumRisk:" ",lowRisk:" ",foundDomains:" ",allStrategies:" ",domain:"",strategy:"",risk:"",noClonesFound:"  ",noClonesDesc:"          IP-.    ."},ecosystem:{title:" ",subtitle:"      ",clusterSummary:" ",nodeTypes:" ",websites:"",totalNodes:" ",connections:"",nodeLabels:{website:"",domain:"IP / ",tracker:"ID ",certificate:"TLS-",wallet:"",contact:" / "},detailTitle:" ",risk:":",detectedOn:":"}}},Jx=Me.createContext();function SP({children:e}){const[n,t]=Me.useState(()=>localStorage.getItem("qalqanai-lang")||"en");Me.useEffect(()=>{localStorage.setItem("qalqanai-lang",n),document.documentElement.lang=n},[n]);const s=l=>{const c=l.split(".");let u=EP[n];for(const d of c)u=u?.[d];return u??l},i=()=>t(l=>l==="en"?"ru":"en");return L.jsx(Jx.Provider,{value:{lang:n,setLang:t,toggleLang:i,t:s},children:e})}function Jo(){return Me.useContext(Jx)}const eT=(...e)=>e.filter((n,t,s)=>!!n&&n.trim()!==""&&s.indexOf(n)===t).join(" ").trim();const CP=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase();const AP=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(n,t,s)=>s?s.toUpperCase():t.toLowerCase());const _b=e=>{const n=AP(e);return n.charAt(0).toUpperCase()+n.slice(1)};var PP={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const kP=e=>{for(const n in e)if(n.startsWith("aria-")||n==="role"||n==="title")return!0;return!1};const $P=Me.forwardRef(({color:e="currentColor",size:n=24,strokeWidth:t=2,absoluteStrokeWidth:s,className:i="",children:l,iconNode:c,...u},d)=>Me.createElement("svg",{ref:d,...PP,width:n,height:n,stroke:e,strokeWidth:s?Number(t)*24/Number(n):t,className:eT("lucide",i),...!l&&!kP(u)&&{"aria-hidden":"true"},...u},[...c.map(([f,m])=>Me.createElement(f,m)),...Array.isArray(l)?l:[l]]));const mn=(e,n)=>{const t=Me.forwardRef(({className:s,...i},l)=>Me.createElement($P,{ref:l,iconNode:n,className:eT(`lucide-${CP(_b(e))}`,`lucide-${e}`,s),...i}));return t.displayName=_b(e),t};const DP=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],tT=mn("activity",DP);const OP=[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]],Jg=mn("bot",OP);const IP=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],nT=mn("chart-column",IP);const zP=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],cm=mn("chevron-down",zP);const LP=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],FP=mn("chevron-right",LP);const NP=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],V_=mn("chevron-up",NP);const jP=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 6v6l4 2",key:"mmk7yg"}]],c0=mn("clock",jP);const RP=[["path",{d:"m18 16 4-4-4-4",key:"1inbqp"}],["path",{d:"m6 8-4 4 4 4",key:"15zrgr"}],["path",{d:"m14.5 4-5 16",key:"e7oirm"}]],BP=mn("code-xml",RP);const UP=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],VP=mn("copy",UP);const GP=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],gb=mn("download",GP);const WP=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],aT=mn("external-link",WP);const HP=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],u0=mn("eye",HP);const qP=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["circle",{cx:"11.5",cy:"14.5",r:"2.5",key:"1bq0ko"}],["path",{d:"M13.3 16.3 15 18",key:"2quom7"}]],yb=mn("file-search",qP);const KP=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],QP=mn("file-text",KP);const XP=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],sT=mn("fingerprint-pattern",XP);const YP=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ZP=mn("funnel",YP);const JP=[["path",{d:"M15 6a9 9 0 0 0-9 9V3",key:"1cii5b"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}]],ek=mn("git-branch",JP);const tk=[["path",{d:"M15 22v-4a4.8 4.8 0 0 0-1-3.5c3 0 6-2 6-5.5.08-1.25-.27-2.48-1-3.5.28-1.15.28-2.35 0-3.5 0 0-1 0-3 1.5-2.64-.5-5.36-.5-8 0C6 2 5 2 5 2c-.3 1.15-.3 2.35 0 3.5A5.403 5.403 0 0 0 4 9c0 3.5 3 5.5 6 5.5-.39.49-.68 1.05-.85 1.65-.17.6-.22 1.23-.15 1.85v4",key:"tonef"}],["path",{d:"M9 18c-4.51 2-5-2-7-2",key:"9comsn"}]],nk=mn("github",tk);const ak=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],eg=mn("globe",ak);const sk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],rk=mn("info",sk);const ik=[["path",{d:"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7",key:"132q7q"}],["rect",{x:"2",y:"4",width:"20",height:"16",rx:"2",key:"izxlao"}]],ok=mn("mail",ik);const lk=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],ck=mn("map-pin",lk);const uk=[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]],dk=mn("menu",uk);const fk=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],rT=mn("message-circle",fk);const hk=[["rect",{x:"16",y:"16",width:"6",height:"6",rx:"1",key:"4q2zg0"}],["rect",{x:"2",y:"16",width:"6",height:"6",rx:"1",key:"8cvhb9"}],["rect",{x:"9",y:"2",width:"6",height:"6",rx:"1",key:"1egb70"}],["path",{d:"M5 16v-3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v3",key:"1jsf9p"}],["path",{d:"M12 12V8",key:"2874zd"}]],d0=mn("network",hk);const pk=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],_g=mn("search",pk);const mk=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],f0=mn("send",mk);const _k=[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]],q0=mn("server",_k);const gk=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],yk=mn("shield-alert",gk);const vk=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]],bk=mn("shield-x",vk);const wk=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],um=mn("shield",wk);const Mk=[["path",{d:"M11.017 2.814a1 1 0 0 1 1.966 0l1.051 5.558a2 2 0 0 0 1.594 1.594l5.558 1.051a1 1 0 0 1 0 1.966l-5.558 1.051a2 2 0 0 0-1.594 1.594l-1.051 5.558a1 1 0 0 1-1.966 0l-1.051-5.558a2 2 0 0 0-1.594-1.594l-5.558-1.051a1 1 0 0 1 0-1.966l5.558-1.051a2 2 0 0 0 1.594-1.594z",key:"1s2grr"}],["path",{d:"M20 2v4",key:"1rf3ol"}],["path",{d:"M22 4h-4",key:"gwowj6"}],["circle",{cx:"4",cy:"20",r:"2",key:"6kqj1y"}]],xk=mn("sparkles",Mk);const Tk=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Ek=mn("target",Tk);const Sk=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Ck=mn("trending-up",Sk);const Ak=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],Tu=mn("triangle-alert",Ak);const Pk=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],iT=mn("user",Pk);const kk=[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]],oT=mn("wallet",kk);const $k=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],K0=mn("x",$k);const Dk=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],Ok=mn("zap",Dk);function Ik(){const[e,n]=Me.useState(!1),[t,s]=Me.useState(!1),i=xm(),{lang:l,setLang:c,t:u}=Jo();Me.useEffect(()=>{const f=()=>n(window.scrollY>10);return window.addEventListener("scroll",f),()=>window.removeEventListener("scroll",f)},[]);const d=()=>s(!1);return L.jsx("nav",{className:`navbar ${e?"scrolled":""}`,children:L.jsxs("div",{className:"navbar-inner",children:[L.jsxs(rc,{to:"/",className:"navbar-logo",onClick:d,children:[L.jsx("img",{src:"/QalqanAI/team-logo.png",alt:"Team Logo",className:"logo-team"}),L.jsx("span",{className:"logo-divider",children:"|"}),L.jsx("img",{src:"/QalqanAI/qalqan-logo.png",alt:"QalqanAI",className:"logo-qalqan"})]}),L.jsxs("div",{className:`navbar-links ${t?"open":""}`,children:[L.jsx(rc,{to:"/",className:"nav-link",onClick:d,children:u("nav.dashboard")}),L.jsx(rc,{to:"/deep-analyze",className:"nav-link",onClick:d,children:u("nav.deepAnalyze")}),L.jsx(rc,{to:"/ecosystem",className:"nav-link",onClick:d,children:u("nav.ecosystem")}),L.jsx(rc,{to:"/blocklist",className:"nav-link",onClick:d,children:u("nav.blocklist")}),L.jsx(rc,{to:"/how-it-works",className:"nav-link",onClick:d,children:u("nav.howItWorks")}),L.jsx(rc,{to:"/contact",className:"nav-link",onClick:d,children:u("nav.contact")})]}),L.jsxs("div",{className:"navbar-actions",children:[L.jsxs("div",{className:"lang-switcher",children:[L.jsx("button",{className:`lang-btn ${l==="en"?"active":""}`,onClick:()=>c("en"),children:"EN"}),L.jsx("span",{className:"lang-divider",children:"/"}),L.jsx("button",{className:`lang-btn ${l==="ru"?"active":""}`,onClick:()=>c("ru"),children:"RU"})]}),L.jsxs("button",{className:"nav-cta",onClick:()=>i("/"),children:[L.jsx(_g,{size:14})," ",u("nav.scanUrl")]}),L.jsx("button",{className:"mobile-toggle",onClick:()=>s(!t),children:t?L.jsx(K0,{size:20}):L.jsx(dk,{size:20})})]})]})})}const zk=280,Lk=35,vb=60;function Fk(){const e=Me.useRef(null),n=Me.useRef([]),t=Me.useRef(0),s=Me.useCallback(()=>{const i=[];for(let l=0;l<zk;l++){const c=Math.random()*Math.PI*2,u=Math.random()*.4+.05,d=Math.random()*6;i.push({baseX:.5+Math.cos(c+d*u)*u,baseY:.5+Math.sin(c+d*u)*u*.4,size:Math.random()*1.8+.2,opacity:Math.random()*.5+.05,speed:Math.random()*.3+.1,phase:Math.random()*Math.PI*2,drift:(Math.random()-.5)*3e-4,baseAngle:c,baseRadius:u})}for(let l=0;l<Lk;l++){const c=Math.random()*Math.PI*2,u=Math.random()*.3+.1;i.push({baseX:.5+Math.cos(c)*u,baseY:.5+Math.sin(c)*u*.35,size:Math.random()*2.5+1,opacity:Math.random()*.4+.3,speed:Math.random()*.2+.15,phase:Math.random()*Math.PI*2,drift:(Math.random()-.5)*2e-4,isAccent:!0,baseAngle:c,baseRadius:u})}n.current=i},[]);return Me.useEffect(()=>{const i=e.current;if(!i)return;const l=i.getContext("2d"),c=()=>{i.width=window.innerWidth,i.height=window.innerHeight};c(),window.addEventListener("resize",c),s();let u=0;const d=()=>{u+=.008;const f=window.scrollY||0,m=f*.15,_=f*4e-4;l.clearRect(0,0,i.width,i.height),l.save(),l.globalCompositeOperation="lighter";for(let p=0;p<vb;p++){const y=p/vb,T=y*Math.PI*2+_,k=Math.sin(y*Math.PI*3+u*.3)*30,b=Math.cos(y*Math.PI*2+u*.2)*15,S=.15+y*.25,$=(.5+Math.cos(T)*S)*i.width+k,C=(((.5+Math.sin(T)*S*.35)*i.height+b-m*.08)%i.height+i.height)%i.height,P=l.createRadialGradient($,C,0,$,C,60+Math.sin(u+p)*20);P.addColorStop(0,`rgba(180, 200, 255, ${.015+Math.sin(u+y*6)*.008})`),P.addColorStop(1,"rgba(180, 200, 255, 0)"),l.fillStyle=P,l.fillRect($-80,C-80,160,160)}l.restore();for(const p of n.current){const y=Math.sin(u*p.speed*4+p.phase)*.3+.7,v=Math.sin(u*p.drift*100+p.phase)*20,T=p.baseAngle+_,k=.5+Math.cos(T+Math.sin(u*.1)*.02)*p.baseRadius,b=.5+Math.sin(T+Math.sin(u*.1)*.02)*p.baseRadius*.4,S=m*p.speed,$=k*i.width+v,C=((b*i.height-S)%i.height+i.height)%i.height,P=p.opacity*y;if(p.isAccent){const A=l.createRadialGradient($,C,0,$,C,p.size*3);A.addColorStop(0,`rgba(200, 220, 255, ${P*.6})`),A.addColorStop(1,"rgba(200, 220, 255, 0)"),l.fillStyle=A,l.fillRect($-p.size*3,C-p.size*3,p.size*6,p.size*6)}l.beginPath(),l.arc($,C,p.size,0,Math.PI*2),l.fillStyle=`rgba(220, 230, 255, ${P})`,l.fill()}t.current=requestAnimationFrame(d)};return d(),()=>{cancelAnimationFrame(t.current),window.removeEventListener("resize",c)}},[s]),L.jsx("canvas",{ref:e,style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:0,pointerEvents:"none",opacity:.6}})}const Nk=new Set(["bet","casino","poker","xyz","top","club","icu","buzz","monster","click","link","tk","ml","ga","cf","gq","work","cam","loan","racing","win","download","stream","bid","trade","date","faith","review","party","science"]),jk=["slot","casino","poker","jackpot","spin","roulette","bet","gambl","lucky","bonus","freespin","megawin","bigwin","aviator","1xbet","mostbet","pinup","parimatch","melbet"],Rk=["login","signin","verify","secure","account","update","confirm","suspend","unlock","recover","alert","urgent","bank","paypal","amazon","apple","microsoft","google","facebook","instagram","netflix","whatsapp","telegram"],Bk=["free","prize","winner","gift","reward","claim","offer","limited","hurry","act-now","congratulations","selected","crypto","bitcoin","invest","profit","earn","income","double","fast-money","rich","wealth","trading","forex"],Uk=["mlm","referral","affiliate","network","passive-income","downline","upline","recruit","team-build","matrix","binary","unilevel","cashback","revshare"],Vk=new Set(["AS48031","AS49505","AS62088","AS208091","AS60781","AS394711","AS14061","AS62240","AS51167","AS35916"]),Gk=["bulletproof","hostkey","shinjiru","servidor","offshorededi","ecatel","quasi","novogara"],h0=new Set(["google.com","youtube.com","facebook.com","twitter.com","instagram.com","linkedin.com","github.com","microsoft.com","apple.com","amazon.com","netflix.com","reddit.com","wikipedia.org","whatsapp.com","telegram.org","yahoo.com","bing.com","zoom.us","twitch.tv","spotify.com","stackoverflow.com","medium.com","cloudflare.com","mozilla.org","wordpress.com","shopify.com","paypal.com","stripe.com","slack.com","notion.so","figma.com","vercel.com"]),Wk=["google","apple","amazon","microsoft","facebook","instagram","netflix","paypal","twitter","whatsapp","telegram","youtube","linkedin","spotify","tiktok"];function Ps(e,n=8){let t=0;for(let i=0;i<e.length;i++){const l=e.charCodeAt(i);t=(t<<5)-t+l,t=t&t}return Math.abs(t).toString(16).padStart(n,"0").slice(0,n)}function Hk(e){let n=e.trim().toLowerCase();return n=n.replace(/^https?:\/\//,"").replace(/^www\./,""),n.split("/")[0].split("?")[0].split("#")[0]}function qk(e){const n=e.split("."),t=n[n.length-1],s=n.slice(0,-1).join("."),i=(s.match(/-/g)||[]).length,l=(s.match(/\d/g)||[]).length,c=new Set(s.split("")).size/Math.max(s.length,1),d=parseInt(Ps(e+"age",4),16)%3e3;return{tld:t,name:s,length:e.length,dashCount:i,numberCount:l,entropy:Math.round(c*100)/100,isSuspiciousTLD:Nk.has(t),isLegitimate:h0.has(e),domainAge:{days:d,label:d<90?"Very New":d<365?"Recent":"Established",risky:d<90}}}function Kk(e,n){if(n)return n;const t=Ps(e+"ip",8),s=parseInt(t.slice(0,2),16)%223+1,i=parseInt(t.slice(2,4),16)%256,l=parseInt(t.slice(4,6),16)%256,c=parseInt(t.slice(6,8),16)%256;return`${s}.${i}.${l}.${c}`}function Qk(e,n){const t=Ps(n+"hosting",4),s=parseInt(t,16),i=[{name:"Cloudflare",country:"US",type:"CDN"},{name:"DigitalOcean",country:"US",type:"Cloud"},{name:"Hetzner",country:"DE",type:"Dedicated"},{name:"OVH",country:"FR",type:"Cloud"},{name:"Hostkey",country:"NL",type:"Bulletproof"},{name:"Shinjiru",country:"MY",type:"Offshore"},{name:"Amazon AWS",country:"US",type:"Cloud"},{name:"Google Cloud",country:"US",type:"Cloud"},{name:"Quasi Networks",country:"NL",type:"Bulletproof"},{name:"Linode",country:"US",type:"Cloud"}],l=i[s%i.length],c=1e4+s%9e4;return{ip:e,provider:l.name,country:l.country,type:l.type,asn:`AS${c}`}}function Xk(e){const n=Ps(e+"tls",16),t=["Let's Encrypt","DigiCert","Comodo","GeoTrust","Sectigo","Self-Signed CA"],s=parseInt(Ps(e+"issuer",2),16),i=t[s%t.length];return{fingerprint:n,issuer:i,selfSigned:i==="Self-Signed CA",valid:i!=="Self-Signed CA"}}function Yk(e){const n=Ps(e+"track",8),t=parseInt(n.slice(0,2),16)>80,s=parseInt(n.slice(2,4),16)>100,i=parseInt(n.slice(4,6),16)>150,l=parseInt(n.slice(6,8),16)>120;return{gaId:t?`UA-${parseInt(n.slice(0,4),16)%9e7+1e7}`:null,fbPixel:s?`${parseInt(n.slice(2,6),16)%9e8+1e8}`:null,ttPixel:i?`TT-${parseInt(n.slice(4,8),16)%9e6+1e6}`:null,affiliateParams:l?{aff_id:parseInt(n.slice(0,4),16)%1e4,subid:Ps(e+"sub",6)}:null}}function Zk(e){const n=Ps(e+"fin",8),t=parseInt(n.slice(0,2),16)>100,s=parseInt(n.slice(2,4),16)>90,i=["BTC","ETH","USDT"],l=["FreekKassa","PayAdmit","Cryptomus","Payeer"];return{cryptoWallet:t?`bc1q${Ps(e+"wallet",12)}`:null,walletType:i[parseInt(n.slice(0,1),16)%i.length],paymentGateway:s?l[parseInt(n.slice(2,3),16)%l.length]:null,gatewayLicensed:parseInt(n.slice(4,5),16)>10}}function Jk(e){const n=Ps(e+"contact",8),t=parseInt(n.slice(0,2),16)>80,s=parseInt(n.slice(2,4),16)>140,i=parseInt(n.slice(4,6),16)>60,l=parseInt(n.slice(6,8),16)>100,c=e.split(".")[0].replace(/-/g,"");return{telegram:t?`@${c}_support`:null,whatsapp:s?`+7${parseInt(n.slice(2,6),16)%9e9+1e9}`:null,email:i?`support@${e}`:null,abuseEmail:l?`abuse@${e}`:`abuse@${e.split(".").slice(-2).join(".")}`,registrarAbuse:`abuse@registrar-${Ps(e+"reg",4)}.com`}}function e$(e){const n=Ps(e+"whois",8),t=["GoDaddy","Namecheap","Tucows","Gandi.net","Name.com","NameSilo","PDR Ltd","HostGator"],s=["US","RU","CN","TR","BR","NG","PH","IN","UA","CY","PA","SC"],i=parseInt(n.slice(0,2),16),c=parseInt(Ps(e+"age",4),16)%3e3,u=new Date(Date.now()-c*864e5);return{registrar:t[i%t.length],created:u.toISOString().split("T")[0],registrantCountry:s[parseInt(n.slice(2,4),16)%s.length],dnssec:parseInt(n.slice(4,5),16)>8?"unsigned":"signedDelegation",privacy:parseInt(n.slice(5,6),16)>6}}function t$(e,n){const t=Ps(e+"redirect",4),s=n.isSuspiciousTLD?3+parseInt(t.slice(0,1),16)%3:1+parseInt(t.slice(0,1),16)%2,i=["HTTP Redirect","JS Redirect","Meta Refresh","Tracker Redirect","Landing Page"],l=[];for(let c=0;c<s;c++){const u=Ps(e+`step${c}`,6);l.push({step:c+1,url:c===0?`https://${e}/`:c===s-1?`https://${e}/landing?ref=${u}`:`https://trk-${u}.${n.tld}/go`,status:c<s-1?302:200,type:i[c%i.length]})}return l}function bb(e,n){const t=Hk(e),s=qk(t),i=Kk(t,n),l=Qk(i,t),c=Xk(t),u=Yk(t),d=Zk(t),f=Jk(t),m=e$(t),_=t$(t,s);return{url:e,domain:t,domainAnalysis:s,dns:{success:!0,ip:i,reverse:`${Ps(t,6)}.host.net`},tls:c,hosting:l,trackers:u,financial:d,contacts:f,whois:m,redirectChain:_,extractedAt:new Date().toISOString()}}const ey=[{name:"legitimate_domain",evaluate:e=>e.domainAnalysis.isLegitimate?{score:-80,explanation:`${e.domain} is a verified legitimate domain`,type:"infrastructure",evidence:`Domain "${e.domain}" found in verified legitimate domains whitelist (${h0.size} entries)`}:null},{name:"suspicious_tld",evaluate:e=>e.domainAnalysis.isSuspiciousTLD?{score:12,explanation:`TLD ".${e.domainAnalysis.tld}" is commonly associated with malicious sites`,type:"infrastructure",evidence:`Found in domain name: "${e.domain}"  TLD ".${e.domainAnalysis.tld}" matches suspicious TLD database`}:null},{name:"gambling_keywords",evaluate:e=>{if(e.domainAnalysis.isLegitimate)return null;const n=e.domain.toLowerCase(),t=jk.filter(s=>n.includes(s));return t.length>0?{score:Math.min(t.length*10,30),explanation:`Domain contains gambling keywords: ${t.join(", ")}`,type:"content",category:"Casino",evidence:`Found in domain name "${e.domain}": keywords [${t.map(s=>`"${s}" at position ${n.indexOf(s)}`).join(", ")}]`}:null}},{name:"phishing_keywords",evaluate:e=>{if(e.domainAnalysis.isLegitimate)return null;const n=e.domain.toLowerCase(),t=Rk.filter(s=>n.includes(s));return t.length>0?{score:Math.min(t.length*12,35),explanation:`Domain contains phishing indicators: ${t.join(", ")}`,type:"content",category:"Phishing",evidence:`Found in domain name "${e.domain}": phishing patterns [${t.map(s=>`"${s}" at position ${n.indexOf(s)}`).join(", ")}]`}:null}},{name:"scam_keywords",evaluate:e=>{if(e.domainAnalysis.isLegitimate)return null;const n=e.domain.toLowerCase(),t=Bk.filter(s=>n.includes(s));return t.length>0?{score:Math.min(t.length*10,30),explanation:`Domain contains scam-related terms: ${t.join(", ")}`,type:"content",category:"Scam",evidence:`Found in domain name "${e.domain}": scam indicators [${t.map(s=>`"${s}"`).join(", ")}]`}:null}},{name:"pyramid_keywords",evaluate:e=>{if(e.domainAnalysis.isLegitimate)return null;const n=e.domain.toLowerCase(),t=Uk.filter(s=>n.includes(s));return t.length>0?{score:Math.min(t.length*10,25),explanation:`Domain contains investment/MLM patterns: ${t.join(", ")}`,type:"content",category:"Pyramid",evidence:`Found in domain name "${e.domain}": MLM/pyramid patterns [${t.map(s=>`"${s}"`).join(", ")}]`}:null}},{name:"brand_impersonation",evaluate:e=>{const n=e.domain.toLowerCase();for(const t of Wk)if(n.includes(t)&&!h0.has(e.domain))return{score:25,explanation:`Domain impersonates brand "${t}"  likely phishing attempt`,type:"content",category:"Phishing",evidence:`Found in domain name "${e.domain}": brand name "${t}" used in non-official domain. Official domain is "${t}.com"`};return null}},{name:"excessive_dashes",evaluate:e=>e.domainAnalysis.dashCount>=3?{score:10,explanation:`Domain uses ${e.domainAnalysis.dashCount} dashes  common in generated malicious domains`,type:"infrastructure",evidence:`Found in domain structure: "${e.domain}" contains ${e.domainAnalysis.dashCount} hyphen characters, typical of algorithmically-generated domains`}:null},{name:"excessive_numbers",evaluate:e=>e.domainAnalysis.numberCount>=3?{score:8,explanation:`Domain contains ${e.domainAnalysis.numberCount} numeric characters  suspicious pattern`,type:"infrastructure",evidence:`Found in domain name: "${e.domain}" has ${e.domainAnalysis.numberCount} digits  numeric sequences in domains correlate with auto-generated malicious sites`}:null},{name:"long_domain",evaluate:e=>e.domainAnalysis.length>30?{score:6,explanation:`Unusually long domain name (${e.domainAnalysis.length} chars)`,type:"infrastructure",evidence:`Domain length: "${e.domain}" is ${e.domainAnalysis.length} characters. Average legitimate domain is 10-15 characters.`}:null},{name:"new_domain",evaluate:e=>e.domainAnalysis.domainAge.risky?{score:15,explanation:`Domain is very new (~${e.domainAnalysis.domainAge.days} days old)  high risk indicator`,type:"infrastructure",evidence:`Found in WHOIS data: domain registered approximately ${e.domainAnalysis.domainAge.days} days ago. 78% of malicious domains are less than 90 days old.`}:null},{name:"self_signed_cert",evaluate:e=>e.tls.selfSigned?{score:12,explanation:"TLS certificate is self-signed  no trusted CA verification",type:"infrastructure",evidence:`Found in TLS certificate: issuer="${e.tls.issuer}", fingerprint="${e.tls.fingerprint.slice(0,16)}...". Self-signed certificates bypass trusted CA validation.`}:null},{name:"free_cert_on_suspicious",evaluate:e=>e.tls.issuer==="Let's Encrypt"&&e.domainAnalysis.isSuspiciousTLD?{score:5,explanation:"Free Let's Encrypt certificate on suspicious TLD  minimal investment in legitimacy",type:"infrastructure",evidence:`Found in TLS certificate: free CA "Let's Encrypt" combined with suspicious TLD ".${e.domainAnalysis.tld}"  low-effort security setup typical of throwaway malicious sites`}:null},{name:"suspicious_hosting",evaluate:e=>{const n=e.hosting.provider.toLowerCase();return Gk.some(s=>n.includes(s))||e.hosting.type==="Bulletproof"||e.hosting.type==="Offshore"?{score:18,explanation:`Hosted on ${e.hosting.provider} (${e.hosting.country})  ${e.hosting.type} hosting provider`,type:"infrastructure",evidence:`Found in hosting infrastructure: IP ${e.hosting.ip}  provider "${e.hosting.provider}" (${e.hosting.country}), ASN ${e.hosting.asn}. Classified as "${e.hosting.type}" hosting  known to ignore abuse complaints.`}:null}},{name:"known_bad_asn",evaluate:e=>Vk.has(e.hosting.asn)?{score:15,explanation:`Hosting ASN ${e.hosting.asn} is associated with malicious activity`,type:"infrastructure",evidence:`Found in network data: ASN ${e.hosting.asn} appears in threat intelligence databases as a network frequently hosting malicious content.`}:null},{name:"has_affiliate_params",evaluate:e=>e.trackers.affiliateParams?{score:10,explanation:`Affiliate tracking parameters detected (aff_id=${e.trackers.affiliateParams.aff_id})`,type:"tracking",evidence:`Found in URL parameters: affiliate tracking IDs "aff_id=${e.trackers.affiliateParams.aff_id}", "subid=${e.trackers.affiliateParams.subid}"  indicates paid traffic acquisition typical of scam operations.`}:null},{name:"multiple_trackers",evaluate:e=>{const n=[];return e.trackers.gaId&&n.push(`Google Analytics: ${e.trackers.gaId}`),e.trackers.fbPixel&&n.push(`Facebook Pixel: ${e.trackers.fbPixel}`),e.trackers.ttPixel&&n.push(`TikTok Pixel: ${e.trackers.ttPixel}`),n.length>=2?{score:5,explanation:`${n.length} tracking pixels detected  aggressive marketing instrumentation`,type:"tracking",evidence:`Found in page source: ${n.join("; ")}  multi-platform ad tracking indicates aggressive paid promotion.`}:null}},{name:"crypto_wallet",evaluate:e=>e.financial.cryptoWallet?{score:15,explanation:`Cryptocurrency wallet address detected (${e.financial.walletType}: ${e.financial.cryptoWallet.slice(0,12)}...)`,type:"financial",evidence:`Found in page source/meta tags: ${e.financial.walletType} wallet "${e.financial.cryptoWallet}"  cryptocurrency payments enable anonymous transactions often used by malicious sites.`}:null},{name:"unlicensed_payment",evaluate:e=>e.financial.paymentGateway&&!e.financial.gatewayLicensed?{score:12,explanation:`Unlicensed payment gateway "${e.financial.paymentGateway}" detected`,type:"financial",evidence:`Found in page scripts/forms: payment gateway "${e.financial.paymentGateway}" not found in licensed payment processor registries. Unlicensed gateways often enable fraud.`}:null},{name:"complex_redirect",evaluate:e=>e.redirectChain.length>=3?{score:10,explanation:`Complex redirect chain with ${e.redirectChain.length} steps  conversion funnel detected`,type:"funnel",evidence:`Found in HTTP response chain: ${e.redirectChain.length} redirects [${e.redirectChain.map(n=>n.type).join("  ")}]. Multi-step funnels are used to evade detection and track referrals.`}:null},{name:"tracker_redirect",evaluate:e=>e.redirectChain.some(t=>t.type==="Tracker Redirect")?{score:8,explanation:"Redirect chain includes external tracker hop  affiliate funnel pattern",type:"funnel",evidence:"Found at redirect step: one or more hops route through external tracking domains before landing. This pattern is used by affiliate scam networks to attribute conversions."}:null}];function n$(e){const n={Casino:0,Scam:0,Phishing:0,Pyramid:0};for(const u of e)u.category&&(n[u.category]+=u.score);const t=e.filter(u=>!u.category).reduce((u,d)=>u+Math.max(d.score,0),0),s=Object.entries(n).filter(([,u])=>u>0);if(s.length>0){const u=t*.3/s.length;s.forEach(([d])=>{n[d]+=u})}const i=Object.values(n).reduce((u,d)=>u+d,0),l=Object.entries(n).sort((u,d)=>d[1]-u[1]);if(i===0)return{category:"Unknown",confidence:0,probabilities:n};const c={};for(const[u,d]of l)c[u]=Math.round(d/i*100)/100;return{category:l[0][0],confidence:Math.round(Math.min(l[0][1]/i,.99)*100)/100,probabilities:c}}function wb(e){const n=[];for(const i of ey){const l=i.evaluate(e);l&&n.push({name:i.name,...l})}const t=Math.max(0,Math.min(100,n.reduce((i,l)=>i+l.score,0)));if(e.domainAnalysis.isLegitimate||t<=5)return{riskScore:t,category:"Safe",confidence:.99,probabilities:{Casino:0,Scam:0,Phishing:0,Pyramid:0},explanations:[],tier:"C",status:"Safe",rulesEvaluated:ey.length,rulesFired:n.length};const s=n$(n);return{riskScore:t,category:s.category,confidence:s.confidence,probabilities:s.probabilities,explanations:n.filter(i=>i.score>0).sort((i,l)=>l.score-i.score).map(i=>({label:i.explanation,weight:i.score,type:i.type,evidence:i.evidence})),tier:t>=80?"A":t>=50?"B":"C",status:t>=80?"Blocked":t>=50?"Under Review":"Monitoring",rulesEvaluated:ey.length,rulesFired:n.length}}const G_=new Map,_u=[],a$=(e,n,t)=>{if(n&&typeof n.init=="function"&&typeof n.createInferenceSessionHandler=="function"){const s=G_.get(e);if(s===void 0)G_.set(e,{backend:n,priority:t});else{if(s.priority>t)return;if(s.priority===t&&s.backend!==n)throw new Error(`cannot register backend "${e}" using priority ${t}`)}if(t>=0){const i=_u.indexOf(e);i!==-1&&_u.splice(i,1);for(let l=0;l<_u.length;l++)if(G_.get(_u[l]).priority<=t){_u.splice(l,0,e);return}_u.push(e)}return}throw new TypeError("not a valid backend")},s$=async e=>{const n=G_.get(e);if(!n)return"backend not found.";if(n.initialized)return n.backend;if(n.aborted)return n.error;{const t=!!n.initPromise;try{return t||(n.initPromise=n.backend.init(e)),await n.initPromise,n.initialized=!0,n.backend}catch(s){return t||(n.error=`${s}`,n.aborted=!0),n.error}finally{delete n.initPromise}}},r$=async e=>{const n=e.executionProviders||[],t=n.map(d=>typeof d=="string"?d:d.name),s=t.length===0?_u:t;let i;const l=[],c=new Set;for(const d of s){const f=await s$(d);typeof f=="string"?l.push({name:d,err:f}):(i||(i=f),i===f&&c.add(d))}if(!i)throw new Error(`no available backend found. ERR: ${l.map(d=>`[${d.name}] ${d.err}`).join(", ")}`);for(const{name:d,err:f}of l)t.includes(d)&&console.warn(`removing requested execution provider "${d}" from session options because it is not available: ${f}`);const u=n.filter(d=>c.has(typeof d=="string"?d:d.name));return[i,new Proxy(e,{get:(d,f)=>f==="executionProviders"?u:Reflect.get(d,f)})]},i$="1.21.0";let Mb="warning";const gi={wasm:{},webgl:{},webgpu:{},versions:{common:i$},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);Mb=e}},get logLevel(){return Mb}};Object.defineProperty(gi,"logLevel",{enumerable:!0});const o$=gi,l$=(e,n)=>{const t=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);t.width=e.dims[3],t.height=e.dims[2];const s=t.getContext("2d");if(s!=null){let i,l;n?.tensorLayout!==void 0&&n.tensorLayout==="NHWC"?(i=e.dims[2],l=e.dims[3]):(i=e.dims[3],l=e.dims[2]);const c=n?.format!==void 0?n.format:"RGB",u=n?.norm;let d,f;u===void 0||u.mean===void 0?d=[255,255,255,255]:typeof u.mean=="number"?d=[u.mean,u.mean,u.mean,u.mean]:(d=[u.mean[0],u.mean[1],u.mean[2],0],u.mean[3]!==void 0&&(d[3]=u.mean[3])),u===void 0||u.bias===void 0?f=[0,0,0,0]:typeof u.bias=="number"?f=[u.bias,u.bias,u.bias,u.bias]:(f=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(f[3]=u.bias[3]));const m=l*i;let _=0,p=m,y=m*2,v=-1;c==="RGBA"?(_=0,p=m,y=m*2,v=m*3):c==="RGB"?(_=0,p=m,y=m*2):c==="RBG"&&(_=0,y=m,p=m*2);for(let T=0;T<l;T++)for(let k=0;k<i;k++){const b=(e.data[_++]-f[0])*d[0],S=(e.data[p++]-f[1])*d[1],$=(e.data[y++]-f[2])*d[2],w=v===-1?255:(e.data[v++]-f[3])*d[3];s.fillStyle="rgba("+b+","+S+","+$+","+w+")",s.fillRect(k,T,1,1)}if("toDataURL"in t)return t.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},c$=(e,n)=>{const t=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d");let s;if(t!=null){let i,l,c;n?.tensorLayout!==void 0&&n.tensorLayout==="NHWC"?(i=e.dims[2],l=e.dims[1],c=e.dims[3]):(i=e.dims[3],l=e.dims[2],c=e.dims[1]);const u=n!==void 0&&n.format!==void 0?n.format:"RGB",d=n?.norm;let f,m;d===void 0||d.mean===void 0?f=[255,255,255,255]:typeof d.mean=="number"?f=[d.mean,d.mean,d.mean,d.mean]:(f=[d.mean[0],d.mean[1],d.mean[2],255],d.mean[3]!==void 0&&(f[3]=d.mean[3])),d===void 0||d.bias===void 0?m=[0,0,0,0]:typeof d.bias=="number"?m=[d.bias,d.bias,d.bias,d.bias]:(m=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(m[3]=d.bias[3]));const _=l*i;if(n!==void 0&&(n.format!==void 0&&c===4&&n.format!=="RGBA"||c===3&&n.format!=="RGB"&&n.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");const p=4;let y=0,v=1,T=2,k=3,b=0,S=_,$=_*2,w=-1;u==="RGBA"?(b=0,S=_,$=_*2,w=_*3):u==="RGB"?(b=0,S=_,$=_*2):u==="RBG"&&(b=0,$=_,S=_*2),s=t.createImageData(i,l);for(let C=0;C<l*i;y+=p,v+=p,T+=p,k+=p,C++)s.data[y]=(e.data[b++]-m[0])*f[0],s.data[v]=(e.data[S++]-m[1])*f[1],s.data[T]=(e.data[$++]-m[2])*f[2],s.data[k]=w===-1?255:(e.data[w++]-m[3])*f[3]}else throw new Error("Can not access image data");return s},ty=(e,n)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(n.height===void 0||n.width===void 0)throw new Error("Image height and width must be defined");if(n.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");const{height:t,width:s}=n,i=n.norm??{mean:255,bias:0};let l,c;typeof i.mean=="number"?l=[i.mean,i.mean,i.mean,i.mean]:l=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?c=[i.bias,i.bias,i.bias,i.bias]:c=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];const u=n.format!==void 0?n.format:"RGBA",d=n.tensorFormat!==void 0&&n.tensorFormat!==void 0?n.tensorFormat:"RGB",f=t*s,m=d==="RGBA"?new Float32Array(f*4):new Float32Array(f*3);let _=4,p=0,y=1,v=2,T=3,k=0,b=f,S=f*2,$=-1;u==="RGB"&&(_=3,p=0,y=1,v=2,T=-1),d==="RGBA"?$=f*3:d==="RBG"?(k=0,S=f,b=f*2):d==="BGR"&&(S=0,b=f,k=f*2);for(let C=0;C<f;C++,p+=_,v+=_,y+=_,T+=_)m[k++]=(e[p]+c[0])/l[0],m[b++]=(e[y]+c[1])/l[1],m[S++]=(e[v]+c[2])/l[2],$!==-1&&T!==-1&&(m[$++]=(e[T]+c[3])/l[3]);return d==="RGBA"?new jr("float32",m,[1,4,t,s]):new jr("float32",m,[1,3,t,s])},u$=async(e,n)=>{const t=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,s=typeof ImageData<"u"&&e instanceof ImageData,i=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,l=typeof e=="string";let c,u=n??{};const d=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},f=m=>typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement||m instanceof OffscreenCanvas?m.getContext("2d"):null;if(t){const m=d();m.width=e.width,m.height=e.height;const _=f(m);if(_!=null){let p=e.height,y=e.width;if(n!==void 0&&n.resizedHeight!==void 0&&n.resizedWidth!==void 0&&(p=n.resizedHeight,y=n.resizedWidth),n!==void 0){if(u=n,n.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");u.tensorFormat="RGBA",u.height=p,u.width=y}else u.tensorFormat="RGBA",u.height=p,u.width=y;_.drawImage(e,0,0),c=_.getImageData(0,0,y,p).data}else throw new Error("Can not access image data")}else if(s){let m,_;if(n!==void 0&&n.resizedWidth!==void 0&&n.resizedHeight!==void 0?(m=n.resizedHeight,_=n.resizedWidth):(m=e.height,_=e.width),n!==void 0&&(u=n),u.format="RGBA",u.height=m,u.width=_,n!==void 0){const p=d();p.width=_,p.height=m;const y=f(p);if(y!=null)y.putImageData(e,0,0),c=y.getImageData(0,0,_,m).data;else throw new Error("Can not access image data")}else c=e.data}else if(i){if(n===void 0)throw new Error("Please provide image config with format for Imagebitmap");const m=d();m.width=e.width,m.height=e.height;const _=f(m);if(_!=null){const p=e.height,y=e.width;return _.drawImage(e,0,0,y,p),c=_.getImageData(0,0,y,p).data,u.height=p,u.width=y,ty(c,u)}else throw new Error("Can not access image data")}else{if(l)return new Promise((m,_)=>{const p=d(),y=f(p);if(!e||!y)return _();const v=new Image;v.crossOrigin="Anonymous",v.src=e,v.onload=()=>{p.width=v.width,p.height=v.height,y.drawImage(v,0,0,p.width,p.height);const T=y.getImageData(0,0,p.width,p.height);u.height=p.height,u.width=p.width,m(ty(T.data,u))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(c!==void 0)return ty(c,u);throw new Error("Input data provided is not supported - aborted tensor creation")},d$=(e,n)=>{const{width:t,height:s,download:i,dispose:l}=n,c=[1,s,t,4];return new jr({location:"texture",type:"float32",texture:e,dims:c,download:i,dispose:l})},f$=(e,n)=>{const{dataType:t,dims:s,download:i,dispose:l}=n;return new jr({location:"gpu-buffer",type:t??"float32",gpuBuffer:e,dims:s,download:i,dispose:l})},h$=(e,n)=>{const{dataType:t,dims:s,download:i,dispose:l}=n;return new jr({location:"ml-tensor",type:t??"float32",mlTensor:e,dims:s,download:i,dispose:l})},p$=(e,n,t)=>new jr({location:"cpu-pinned",type:e,data:n,dims:t??[n.length]}),_f=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),W_=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]);let xb=!1;const m$=()=>{if(!xb){xb=!0;const e=typeof BigInt64Array<"u"&&BigInt64Array.from,n=typeof BigUint64Array<"u"&&BigUint64Array.from,t=globalThis.Float16Array,s=typeof t<"u"&&t.from;e&&(_f.set("int64",BigInt64Array),W_.set(BigInt64Array,"int64")),n&&(_f.set("uint64",BigUint64Array),W_.set(BigUint64Array,"uint64")),s?(_f.set("float16",t),W_.set(t,"float16")):_f.set("float16",Uint16Array)}},_$=e=>{let n=1;for(let t=0;t<e.length;t++){const s=e[t];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${t}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${t}] must be a non-negative integer, got: ${s}`);n*=s}return n},g$=(e,n)=>{switch(e.location){case"cpu":return new jr(e.type,e.data,n);case"cpu-pinned":return new jr({location:"cpu-pinned",data:e.data,type:e.type,dims:n});case"texture":return new jr({location:"texture",texture:e.texture,type:e.type,dims:n});case"gpu-buffer":return new jr({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:n});case"ml-tensor":return new jr({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:n});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}};let jr=class{constructor(n,t,s){m$();let i,l;if(typeof n=="object"&&"location"in n)switch(this.dataLocation=n.location,i=n.type,l=n.dims,n.location){case"cpu-pinned":{const u=_f.get(i);if(!u)throw new TypeError(`unsupported type "${i}" to create tensor from pinned buffer`);if(!(n.data instanceof u))throw new TypeError(`buffer should be of type ${u.name}`);this.cpuData=n.data;break}case"texture":{if(i!=="float32")throw new TypeError(`unsupported type "${i}" to create tensor from texture`);this.gpuTextureData=n.texture,this.downloader=n.download,this.disposer=n.dispose;break}case"gpu-buffer":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from gpu buffer`);this.gpuBufferData=n.gpuBuffer,this.downloader=n.download,this.disposer=n.dispose;break}case"ml-tensor":{if(i!=="float32"&&i!=="float16"&&i!=="int32"&&i!=="int64"&&i!=="uint32"&&i!=="uint64"&&i!=="int8"&&i!=="uint8"&&i!=="bool"&&i!=="uint4"&&i!=="int4")throw new TypeError(`unsupported type "${i}" to create tensor from MLTensor`);this.mlTensorData=n.mlTensor,this.downloader=n.download,this.disposer=n.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let u,d;if(typeof n=="string")if(i=n,d=s,n==="string"){if(!Array.isArray(t))throw new TypeError("A string tensor's data must be a string array.");u=t}else{const f=_f.get(n);if(f===void 0)throw new TypeError(`Unsupported tensor type: ${n}.`);if(Array.isArray(t)){if(n==="float16"&&f===Uint16Array||n==="uint4"||n==="int4")throw new TypeError(`Creating a ${n} tensor from number array is not supported. Please use ${f.name} as data.`);n==="uint64"||n==="int64"?u=f.from(t,BigInt):u=f.from(t)}else if(t instanceof f)u=t;else if(t instanceof Uint8ClampedArray)if(n==="uint8")u=Uint8Array.from(t);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(n==="float16"&&t instanceof Uint16Array&&f!==Uint16Array)u=new globalThis.Float16Array(t.buffer,t.byteOffset,t.length);else throw new TypeError(`A ${i} tensor's data must be type of ${f}`)}else if(d=t,Array.isArray(n)){if(n.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");const f=typeof n[0];if(f==="string")i="string",u=n;else if(f==="boolean")i="bool",u=Uint8Array.from(n);else throw new TypeError(`Invalid element type of data array: ${f}.`)}else if(n instanceof Uint8ClampedArray)i="uint8",u=Uint8Array.from(n);else{const f=W_.get(n.constructor);if(f===void 0)throw new TypeError(`Unsupported type for tensor data: ${n.constructor}.`);i=f,u=n}if(d===void 0)d=[u.length];else if(!Array.isArray(d))throw new TypeError("A tensor's dims must be a number array");l=d,this.cpuData=u,this.dataLocation="cpu"}const c=_$(l);if(this.cpuData&&c!==this.cpuData.length&&!((i==="uint4"||i==="int4")&&Math.ceil(c/2)===this.cpuData.length))throw new Error(`Tensor's size(${c}) does not match data length(${this.cpuData.length}).`);this.type=i,this.dims=l,this.size=c}static async fromImage(n,t){return u$(n,t)}static fromTexture(n,t){return d$(n,t)}static fromGpuBuffer(n,t){return f$(n,t)}static fromMLTensor(n,t){return h$(n,t)}static fromPinnedBuffer(n,t,s){return p$(n,t,s)}toDataURL(n){return l$(this,n)}toImageData(n){return c$(this,n)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(n){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;const t=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=t,n&&this.disposer&&(this.disposer(),this.disposer=void 0),t}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(n){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return g$(this,n)}};const pf=jr,lT=(e,n)=>{(typeof gi.trace>"u"?!gi.wasm.trace:!gi.trace)||console.timeStamp(`${e}::ORT::${n}`)},cT=(e,n)=>{const t=new Error().stack?.split(/\r\n|\r|\n/g)||[];let s=!1;for(let i=0;i<t.length;i++){if(s&&!t[i].includes("TRACE_FUNC")){let l=`FUNC_${e}::${t[i].trim().split(" ")[1]}`;n&&(l+=`::${n}`),lT("CPU",l);return}t[i].includes("TRACE_FUNC")&&(s=!0)}},p0=e=>{(typeof gi.trace>"u"?!gi.wasm.trace:!gi.trace)||cT("BEGIN",e)},m0=e=>{(typeof gi.trace>"u"?!gi.wasm.trace:!gi.trace)||cT("END",e)};let y$=class uT{constructor(n){this.handler=n}async run(n,t,s){p0();const i={};let l={};if(typeof n!="object"||n===null||n instanceof pf||Array.isArray(n))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let c=!0;if(typeof t=="object"){if(t===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof pf)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(t.length===0)throw new TypeError("'fetches' cannot be an empty array.");c=!1;for(const f of t){if(typeof f!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(f)===-1)throw new RangeError(`'fetches' contains invalid output name: ${f}.`);i[f]=null}if(typeof s=="object"&&s!==null)l=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else{let f=!1;const m=Object.getOwnPropertyNames(t);for(const _ of this.outputNames)if(m.indexOf(_)!==-1){const p=t[_];(p===null||p instanceof pf)&&(f=!0,c=!1,i[_]=p)}if(f){if(typeof s=="object"&&s!==null)l=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else l=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(const f of this.inputNames)if(typeof n[f]>"u")throw new Error(`input '${f}' is missing in 'feeds'.`);if(c)for(const f of this.outputNames)i[f]=null;const u=await this.handler.run(n,i,l),d={};for(const f in u)if(Object.hasOwnProperty.call(u,f)){const m=u[f];m instanceof pf?d[f]=m:d[f]=new pf(m.type,m.data,m.dims)}return m0(),d}async release(){return this.handler.dispose()}static async create(n,t,s,i){p0();let l,c={};if(typeof n=="string"){if(l=n,typeof t=="object"&&t!==null)c=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof Uint8Array){if(l=n,typeof t=="object"&&t!==null)c=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer){const m=n;let _=0,p=n.byteLength;if(typeof t=="object"&&t!==null)c=t;else if(typeof t=="number"){if(_=t,!Number.isSafeInteger(_))throw new RangeError("'byteOffset' must be an integer.");if(_<0||_>=m.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${m.byteLength}).`);if(p=n.byteLength-_,typeof s=="number"){if(p=s,!Number.isSafeInteger(p))throw new RangeError("'byteLength' must be an integer.");if(p<=0||_+p>m.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${m.byteLength-_}].`);if(typeof i=="object"&&i!==null)c=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof s<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof t<"u")throw new TypeError("'options' must be an object.");l=new Uint8Array(m,_,p)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");const[u,d]=await r$(c),f=await u.createInferenceSessionHandler(l,d);return m0(),new uT(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}};const v$=y$,b$=Object.freeze(Object.defineProperty({__proto__:null,InferenceSession:v$,TRACE:lT,TRACE_FUNC_BEGIN:p0,TRACE_FUNC_END:m0,Tensor:pf,env:o$,registerBackend:a$},Symbol.toStringTag,{value:"Module"}));var Q0=Object.defineProperty,w$=Object.getOwnPropertyDescriptor,M$=Object.getOwnPropertyNames,x$=Object.prototype.hasOwnProperty,T$=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(n,t)=>(typeof require<"u"?require:n)[t]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')}),ct=(e,n)=>()=>(e&&(n=e(e=0)),n),Ef=(e,n)=>{for(var t in n)Q0(e,t,{get:n[t],enumerable:!0})},E$=(e,n,t,s)=>{if(n&&typeof n=="object"||typeof n=="function")for(let i of M$(n))!x$.call(e,i)&&i!==t&&Q0(e,i,{get:()=>n[i],enumerable:!(s=w$(n,i))||s.enumerable});return e},hm=e=>E$(Q0({},"__esModule",{value:!0}),e),Vp,tc,bu,Tb,dT,fT=ct(()=>{Vp=new Map,tc=[],bu=(e,n,t)=>{if(n&&typeof n.init=="function"&&typeof n.createInferenceSessionHandler=="function"){let s=Vp.get(e);if(s===void 0)Vp.set(e,{backend:n,priority:t});else{if(s.priority>t)return;if(s.priority===t&&s.backend!==n)throw new Error(`cannot register backend "${e}" using priority ${t}`)}if(t>=0){let i=tc.indexOf(e);i!==-1&&tc.splice(i,1);for(let l=0;l<tc.length;l++)if(Vp.get(tc[l]).priority<=t){tc.splice(l,0,e);return}tc.push(e)}return}throw new TypeError("not a valid backend")},Tb=async e=>{let n=Vp.get(e);if(!n)return"backend not found.";if(n.initialized)return n.backend;if(n.aborted)return n.error;{let t=!!n.initPromise;try{return t||(n.initPromise=n.backend.init(e)),await n.initPromise,n.initialized=!0,n.backend}catch(s){return t||(n.error=`${s}`,n.aborted=!0),n.error}finally{delete n.initPromise}}},dT=async e=>{let n=e.executionProviders||[],t=n.map(d=>typeof d=="string"?d:d.name),s=t.length===0?tc:t,i,l=[],c=new Set;for(let d of s){let f=await Tb(d);typeof f=="string"?l.push({name:d,err:f}):(i||(i=f),i===f&&c.add(d))}if(!i)throw new Error(`no available backend found. ERR: ${l.map(d=>`[${d.name}] ${d.err}`).join(", ")}`);for(let{name:d,err:f}of l)t.includes(d)&&console.warn(`removing requested execution provider "${d}" from session options because it is not available: ${f}`);let u=n.filter(d=>c.has(typeof d=="string"?d:d.name));return[i,new Proxy(e,{get:(d,f)=>f==="executionProviders"?u:Reflect.get(d,f)})]}}),S$=ct(()=>{fT()}),hT,C$=ct(()=>{hT="1.22.0-dev.20250409-89f8206ba4"}),ny,Nr,pT=ct(()=>{C$(),ny="warning",Nr={wasm:{},webgl:{},webgpu:{},versions:{common:hT},set logLevel(e){if(e!==void 0){if(typeof e!="string"||["verbose","info","warning","error","fatal"].indexOf(e)===-1)throw new Error(`Unsupported logging level: ${e}`);ny=e}},get logLevel(){return ny}},Object.defineProperty(Nr,"logLevel",{enumerable:!0})}),da,A$=ct(()=>{pT(),da=Nr}),mT,_T,P$=ct(()=>{mT=(e,n)=>{let t=typeof document<"u"?document.createElement("canvas"):new OffscreenCanvas(1,1);t.width=e.dims[3],t.height=e.dims[2];let s=t.getContext("2d");if(s!=null){let i,l;n?.tensorLayout!==void 0&&n.tensorLayout==="NHWC"?(i=e.dims[2],l=e.dims[3]):(i=e.dims[3],l=e.dims[2]);let c=n?.format!==void 0?n.format:"RGB",u=n?.norm,d,f;u===void 0||u.mean===void 0?d=[255,255,255,255]:typeof u.mean=="number"?d=[u.mean,u.mean,u.mean,u.mean]:(d=[u.mean[0],u.mean[1],u.mean[2],0],u.mean[3]!==void 0&&(d[3]=u.mean[3])),u===void 0||u.bias===void 0?f=[0,0,0,0]:typeof u.bias=="number"?f=[u.bias,u.bias,u.bias,u.bias]:(f=[u.bias[0],u.bias[1],u.bias[2],0],u.bias[3]!==void 0&&(f[3]=u.bias[3]));let m=l*i,_=0,p=m,y=m*2,v=-1;c==="RGBA"?(_=0,p=m,y=m*2,v=m*3):c==="RGB"?(_=0,p=m,y=m*2):c==="RBG"&&(_=0,y=m,p=m*2);for(let T=0;T<l;T++)for(let k=0;k<i;k++){let b=(e.data[_++]-f[0])*d[0],S=(e.data[p++]-f[1])*d[1],$=(e.data[y++]-f[2])*d[2],w=v===-1?255:(e.data[v++]-f[3])*d[3];s.fillStyle="rgba("+b+","+S+","+$+","+w+")",s.fillRect(k,T,1,1)}if("toDataURL"in t)return t.toDataURL();throw new Error("toDataURL is not supported")}else throw new Error("Can not access image data")},_T=(e,n)=>{let t=typeof document<"u"?document.createElement("canvas").getContext("2d"):new OffscreenCanvas(1,1).getContext("2d"),s;if(t!=null){let i,l,c;n?.tensorLayout!==void 0&&n.tensorLayout==="NHWC"?(i=e.dims[2],l=e.dims[1],c=e.dims[3]):(i=e.dims[3],l=e.dims[2],c=e.dims[1]);let u=n!==void 0&&n.format!==void 0?n.format:"RGB",d=n?.norm,f,m;d===void 0||d.mean===void 0?f=[255,255,255,255]:typeof d.mean=="number"?f=[d.mean,d.mean,d.mean,d.mean]:(f=[d.mean[0],d.mean[1],d.mean[2],255],d.mean[3]!==void 0&&(f[3]=d.mean[3])),d===void 0||d.bias===void 0?m=[0,0,0,0]:typeof d.bias=="number"?m=[d.bias,d.bias,d.bias,d.bias]:(m=[d.bias[0],d.bias[1],d.bias[2],0],d.bias[3]!==void 0&&(m[3]=d.bias[3]));let _=l*i;if(n!==void 0&&(n.format!==void 0&&c===4&&n.format!=="RGBA"||c===3&&n.format!=="RGB"&&n.format!=="BGR"))throw new Error("Tensor format doesn't match input tensor dims");let p=4,y=0,v=1,T=2,k=3,b=0,S=_,$=_*2,w=-1;u==="RGBA"?(b=0,S=_,$=_*2,w=_*3):u==="RGB"?(b=0,S=_,$=_*2):u==="RBG"&&(b=0,$=_,S=_*2),s=t.createImageData(i,l);for(let C=0;C<l*i;y+=p,v+=p,T+=p,k+=p,C++)s.data[y]=(e.data[b++]-m[0])*f[0],s.data[v]=(e.data[S++]-m[1])*f[1],s.data[T]=(e.data[$++]-m[2])*f[2],s.data[k]=w===-1?255:(e.data[w++]-m[3])*f[3]}else throw new Error("Can not access image data");return s}}),v_,gT,yT,vT,bT,wT,k$=ct(()=>{X0(),v_=(e,n)=>{if(e===void 0)throw new Error("Image buffer must be defined");if(n.height===void 0||n.width===void 0)throw new Error("Image height and width must be defined");if(n.tensorLayout==="NHWC")throw new Error("NHWC Tensor layout is not supported yet");let{height:t,width:s}=n,i=n.norm??{mean:255,bias:0},l,c;typeof i.mean=="number"?l=[i.mean,i.mean,i.mean,i.mean]:l=[i.mean[0],i.mean[1],i.mean[2],i.mean[3]??255],typeof i.bias=="number"?c=[i.bias,i.bias,i.bias,i.bias]:c=[i.bias[0],i.bias[1],i.bias[2],i.bias[3]??0];let u=n.format!==void 0?n.format:"RGBA",d=n.tensorFormat!==void 0&&n.tensorFormat!==void 0?n.tensorFormat:"RGB",f=t*s,m=d==="RGBA"?new Float32Array(f*4):new Float32Array(f*3),_=4,p=0,y=1,v=2,T=3,k=0,b=f,S=f*2,$=-1;u==="RGB"&&(_=3,p=0,y=1,v=2,T=-1),d==="RGBA"?$=f*3:d==="RBG"?(k=0,S=f,b=f*2):d==="BGR"&&(S=0,b=f,k=f*2);for(let w=0;w<f;w++,p+=_,v+=_,y+=_,T+=_)m[k++]=(e[p]+c[0])/l[0],m[b++]=(e[y]+c[1])/l[1],m[S++]=(e[v]+c[2])/l[2],$!==-1&&T!==-1&&(m[$++]=(e[T]+c[3])/l[3]);return d==="RGBA"?new gr("float32",m,[1,4,t,s]):new gr("float32",m,[1,3,t,s])},gT=async(e,n)=>{let t=typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement,s=typeof ImageData<"u"&&e instanceof ImageData,i=typeof ImageBitmap<"u"&&e instanceof ImageBitmap,l=typeof e=="string",c,u=n??{},d=()=>{if(typeof document<"u")return document.createElement("canvas");if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(1,1);throw new Error("Canvas is not supported")},f=m=>typeof HTMLCanvasElement<"u"&&m instanceof HTMLCanvasElement||m instanceof OffscreenCanvas?m.getContext("2d"):null;if(t){let m=d();m.width=e.width,m.height=e.height;let _=f(m);if(_!=null){let p=e.height,y=e.width;if(n!==void 0&&n.resizedHeight!==void 0&&n.resizedWidth!==void 0&&(p=n.resizedHeight,y=n.resizedWidth),n!==void 0){if(u=n,n.tensorFormat!==void 0)throw new Error("Image input config format must be RGBA for HTMLImageElement");u.tensorFormat="RGBA",u.height=p,u.width=y}else u.tensorFormat="RGBA",u.height=p,u.width=y;_.drawImage(e,0,0),c=_.getImageData(0,0,y,p).data}else throw new Error("Can not access image data")}else if(s){let m,_;if(n!==void 0&&n.resizedWidth!==void 0&&n.resizedHeight!==void 0?(m=n.resizedHeight,_=n.resizedWidth):(m=e.height,_=e.width),n!==void 0&&(u=n),u.format="RGBA",u.height=m,u.width=_,n!==void 0){let p=d();p.width=_,p.height=m;let y=f(p);if(y!=null)y.putImageData(e,0,0),c=y.getImageData(0,0,_,m).data;else throw new Error("Can not access image data")}else c=e.data}else if(i){if(n===void 0)throw new Error("Please provide image config with format for Imagebitmap");let m=d();m.width=e.width,m.height=e.height;let _=f(m);if(_!=null){let p=e.height,y=e.width;return _.drawImage(e,0,0,y,p),c=_.getImageData(0,0,y,p).data,u.height=p,u.width=y,v_(c,u)}else throw new Error("Can not access image data")}else{if(l)return new Promise((m,_)=>{let p=d(),y=f(p);if(!e||!y)return _();let v=new Image;v.crossOrigin="Anonymous",v.src=e,v.onload=()=>{p.width=v.width,p.height=v.height,y.drawImage(v,0,0,p.width,p.height);let T=y.getImageData(0,0,p.width,p.height);u.height=p.height,u.width=p.width,m(v_(T.data,u))}});throw new Error("Input data provided is not supported - aborted tensor creation")}if(c!==void 0)return v_(c,u);throw new Error("Input data provided is not supported - aborted tensor creation")},yT=(e,n)=>{let{width:t,height:s,download:i,dispose:l}=n,c=[1,s,t,4];return new gr({location:"texture",type:"float32",texture:e,dims:c,download:i,dispose:l})},vT=(e,n)=>{let{dataType:t,dims:s,download:i,dispose:l}=n;return new gr({location:"gpu-buffer",type:t??"float32",gpuBuffer:e,dims:s,download:i,dispose:l})},bT=(e,n)=>{let{dataType:t,dims:s,download:i,dispose:l}=n;return new gr({location:"ml-tensor",type:t??"float32",mlTensor:e,dims:s,download:i,dispose:l})},wT=(e,n,t)=>new gr({location:"cpu-pinned",type:e,data:n,dims:t??[n.length]})}),yu,am,ay,MT,$$=ct(()=>{yu=new Map([["float32",Float32Array],["uint8",Uint8Array],["int8",Int8Array],["uint16",Uint16Array],["int16",Int16Array],["int32",Int32Array],["bool",Uint8Array],["float64",Float64Array],["uint32",Uint32Array],["int4",Uint8Array],["uint4",Uint8Array]]),am=new Map([[Float32Array,"float32"],[Uint8Array,"uint8"],[Int8Array,"int8"],[Uint16Array,"uint16"],[Int16Array,"int16"],[Int32Array,"int32"],[Float64Array,"float64"],[Uint32Array,"uint32"]]),ay=!1,MT=()=>{if(!ay){ay=!0;let e=typeof BigInt64Array<"u"&&BigInt64Array.from,n=typeof BigUint64Array<"u"&&BigUint64Array.from,t=globalThis.Float16Array,s=typeof t<"u"&&t.from;e&&(yu.set("int64",BigInt64Array),am.set(BigInt64Array,"int64")),n&&(yu.set("uint64",BigUint64Array),am.set(BigUint64Array,"uint64")),s?(yu.set("float16",t),am.set(t,"float16")):yu.set("float16",Uint16Array)}}}),xT,TT,D$=ct(()=>{X0(),xT=e=>{let n=1;for(let t=0;t<e.length;t++){let s=e[t];if(typeof s!="number"||!Number.isSafeInteger(s))throw new TypeError(`dims[${t}] must be an integer, got: ${s}`);if(s<0)throw new RangeError(`dims[${t}] must be a non-negative integer, got: ${s}`);n*=s}return n},TT=(e,n)=>{switch(e.location){case"cpu":return new gr(e.type,e.data,n);case"cpu-pinned":return new gr({location:"cpu-pinned",data:e.data,type:e.type,dims:n});case"texture":return new gr({location:"texture",texture:e.texture,type:e.type,dims:n});case"gpu-buffer":return new gr({location:"gpu-buffer",gpuBuffer:e.gpuBuffer,type:e.type,dims:n});case"ml-tensor":return new gr({location:"ml-tensor",mlTensor:e.mlTensor,type:e.type,dims:n});default:throw new Error(`tensorReshape: tensor location ${e.location} is not supported`)}}}),gr,X0=ct(()=>{P$(),k$(),$$(),D$(),gr=class{constructor(e,n,t){MT();let s,i;if(typeof e=="object"&&"location"in e)switch(this.dataLocation=e.location,s=e.type,i=e.dims,e.location){case"cpu-pinned":{let c=yu.get(s);if(!c)throw new TypeError(`unsupported type "${s}" to create tensor from pinned buffer`);if(!(e.data instanceof c))throw new TypeError(`buffer should be of type ${c.name}`);this.cpuData=e.data;break}case"texture":{if(s!=="float32")throw new TypeError(`unsupported type "${s}" to create tensor from texture`);this.gpuTextureData=e.texture,this.downloader=e.download,this.disposer=e.dispose;break}case"gpu-buffer":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from gpu buffer`);this.gpuBufferData=e.gpuBuffer,this.downloader=e.download,this.disposer=e.dispose;break}case"ml-tensor":{if(s!=="float32"&&s!=="float16"&&s!=="int32"&&s!=="int64"&&s!=="uint32"&&s!=="uint64"&&s!=="int8"&&s!=="uint8"&&s!=="bool"&&s!=="uint4"&&s!=="int4")throw new TypeError(`unsupported type "${s}" to create tensor from MLTensor`);this.mlTensorData=e.mlTensor,this.downloader=e.download,this.disposer=e.dispose;break}default:throw new Error(`Tensor constructor: unsupported location '${this.dataLocation}'`)}else{let c,u;if(typeof e=="string")if(s=e,u=t,e==="string"){if(!Array.isArray(n))throw new TypeError("A string tensor's data must be a string array.");c=n}else{let d=yu.get(e);if(d===void 0)throw new TypeError(`Unsupported tensor type: ${e}.`);if(Array.isArray(n)){if(e==="float16"&&d===Uint16Array||e==="uint4"||e==="int4")throw new TypeError(`Creating a ${e} tensor from number array is not supported. Please use ${d.name} as data.`);e==="uint64"||e==="int64"?c=d.from(n,BigInt):c=d.from(n)}else if(n instanceof d)c=n;else if(n instanceof Uint8ClampedArray)if(e==="uint8")c=Uint8Array.from(n);else throw new TypeError("A Uint8ClampedArray tensor's data must be type of uint8");else if(e==="float16"&&n instanceof Uint16Array&&d!==Uint16Array)c=new globalThis.Float16Array(n.buffer,n.byteOffset,n.length);else throw new TypeError(`A ${s} tensor's data must be type of ${d}`)}else if(u=n,Array.isArray(e)){if(e.length===0)throw new TypeError("Tensor type cannot be inferred from an empty array.");let d=typeof e[0];if(d==="string")s="string",c=e;else if(d==="boolean")s="bool",c=Uint8Array.from(e);else throw new TypeError(`Invalid element type of data array: ${d}.`)}else if(e instanceof Uint8ClampedArray)s="uint8",c=Uint8Array.from(e);else{let d=am.get(e.constructor);if(d===void 0)throw new TypeError(`Unsupported type for tensor data: ${e.constructor}.`);s=d,c=e}if(u===void 0)u=[c.length];else if(!Array.isArray(u))throw new TypeError("A tensor's dims must be a number array");i=u,this.cpuData=c,this.dataLocation="cpu"}let l=xT(i);if(this.cpuData&&l!==this.cpuData.length&&!((s==="uint4"||s==="int4")&&Math.ceil(l/2)===this.cpuData.length))throw new Error(`Tensor's size(${l}) does not match data length(${this.cpuData.length}).`);this.type=s,this.dims=i,this.size=l}static async fromImage(e,n){return gT(e,n)}static fromTexture(e,n){return yT(e,n)}static fromGpuBuffer(e,n){return vT(e,n)}static fromMLTensor(e,n){return bT(e,n)}static fromPinnedBuffer(e,n,t){return wT(e,n,t)}toDataURL(e){return mT(this,e)}toImageData(e){return _T(this,e)}get data(){if(this.ensureValid(),!this.cpuData)throw new Error("The data is not on CPU. Use `getData()` to download GPU data to CPU, or use `texture` or `gpuBuffer` property to access the GPU data directly.");return this.cpuData}get location(){return this.dataLocation}get texture(){if(this.ensureValid(),!this.gpuTextureData)throw new Error("The data is not stored as a WebGL texture.");return this.gpuTextureData}get gpuBuffer(){if(this.ensureValid(),!this.gpuBufferData)throw new Error("The data is not stored as a WebGPU buffer.");return this.gpuBufferData}get mlTensor(){if(this.ensureValid(),!this.mlTensorData)throw new Error("The data is not stored as a WebNN MLTensor.");return this.mlTensorData}async getData(e){switch(this.ensureValid(),this.dataLocation){case"cpu":case"cpu-pinned":return this.data;case"texture":case"gpu-buffer":case"ml-tensor":{if(!this.downloader)throw new Error("The current tensor is not created with a specified data downloader.");if(this.isDownloading)throw new Error("The current tensor is being downloaded.");try{this.isDownloading=!0;let n=await this.downloader();return this.downloader=void 0,this.dataLocation="cpu",this.cpuData=n,e&&this.disposer&&(this.disposer(),this.disposer=void 0),n}finally{this.isDownloading=!1}}default:throw new Error(`cannot get data from location: ${this.dataLocation}`)}}dispose(){if(this.isDownloading)throw new Error("The current tensor is being downloaded.");this.disposer&&(this.disposer(),this.disposer=void 0),this.cpuData=void 0,this.gpuTextureData=void 0,this.gpuBufferData=void 0,this.mlTensorData=void 0,this.downloader=void 0,this.isDownloading=void 0,this.dataLocation="none"}ensureValid(){if(this.dataLocation==="none")throw new Error("The tensor is disposed.")}reshape(e){if(this.ensureValid(),this.downloader||this.disposer)throw new Error("Cannot reshape a tensor that owns GPU resource.");return TT(this,e)}}}),pi,ET=ct(()=>{X0(),pi=gr}),pm,sy,yi,Rr,ST=ct(()=>{pT(),pm=(e,n)=>{(typeof Nr.trace>"u"?!Nr.wasm.trace:!Nr.trace)||console.timeStamp(`${e}::ORT::${n}`)},sy=(e,n)=>{let t=new Error().stack?.split(/\r\n|\r|\n/g)||[],s=!1;for(let i=0;i<t.length;i++){if(s&&!t[i].includes("TRACE_FUNC")){let l=`FUNC_${e}::${t[i].trim().split(" ")[1]}`;n&&(l+=`::${n}`),pm("CPU",l);return}t[i].includes("TRACE_FUNC")&&(s=!0)}},yi=e=>{(typeof Nr.trace>"u"?!Nr.wasm.trace:!Nr.trace)||sy("BEGIN",e)},Rr=e=>{(typeof Nr.trace>"u"?!Nr.wasm.trace:!Nr.trace)||sy("END",e)}}),CT,O$=ct(()=>{fT(),ET(),ST(),CT=class AT{constructor(n){this.handler=n}async run(n,t,s){yi();let i={},l={};if(typeof n!="object"||n===null||n instanceof pi||Array.isArray(n))throw new TypeError("'feeds' must be an object that use input names as keys and OnnxValue as corresponding values.");let c=!0;if(typeof t=="object"){if(t===null)throw new TypeError("Unexpected argument[1]: cannot be null.");if(t instanceof pi)throw new TypeError("'fetches' cannot be a Tensor");if(Array.isArray(t)){if(t.length===0)throw new TypeError("'fetches' cannot be an empty array.");c=!1;for(let f of t){if(typeof f!="string")throw new TypeError("'fetches' must be a string array or an object.");if(this.outputNames.indexOf(f)===-1)throw new RangeError(`'fetches' contains invalid output name: ${f}.`);i[f]=null}if(typeof s=="object"&&s!==null)l=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else{let f=!1,m=Object.getOwnPropertyNames(t);for(let _ of this.outputNames)if(m.indexOf(_)!==-1){let p=t[_];(p===null||p instanceof pi)&&(f=!0,c=!1,i[_]=p)}if(f){if(typeof s=="object"&&s!==null)l=s;else if(typeof s<"u")throw new TypeError("'options' must be an object.")}else l=t}}else if(typeof t<"u")throw new TypeError("Unexpected argument[1]: must be 'fetches' or 'options'.");for(let f of this.inputNames)if(typeof n[f]>"u")throw new Error(`input '${f}' is missing in 'feeds'.`);if(c)for(let f of this.outputNames)i[f]=null;let u=await this.handler.run(n,i,l),d={};for(let f in u)if(Object.hasOwnProperty.call(u,f)){let m=u[f];m instanceof pi?d[f]=m:d[f]=new pi(m.type,m.data,m.dims)}return Rr(),d}async release(){return this.handler.dispose()}static async create(n,t,s,i){yi();let l,c={};if(typeof n=="string"){if(l=n,typeof t=="object"&&t!==null)c=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof Uint8Array){if(l=n,typeof t=="object"&&t!==null)c=t;else if(typeof t<"u")throw new TypeError("'options' must be an object.")}else if(n instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&n instanceof SharedArrayBuffer){let m=n,_=0,p=n.byteLength;if(typeof t=="object"&&t!==null)c=t;else if(typeof t=="number"){if(_=t,!Number.isSafeInteger(_))throw new RangeError("'byteOffset' must be an integer.");if(_<0||_>=m.byteLength)throw new RangeError(`'byteOffset' is out of range [0, ${m.byteLength}).`);if(p=n.byteLength-_,typeof s=="number"){if(p=s,!Number.isSafeInteger(p))throw new RangeError("'byteLength' must be an integer.");if(p<=0||_+p>m.byteLength)throw new RangeError(`'byteLength' is out of range (0, ${m.byteLength-_}].`);if(typeof i=="object"&&i!==null)c=i;else if(typeof i<"u")throw new TypeError("'options' must be an object.")}else if(typeof s<"u")throw new TypeError("'byteLength' must be a number.")}else if(typeof t<"u")throw new TypeError("'options' must be an object.");l=new Uint8Array(m,_,p)}else throw new TypeError("Unexpected argument[0]: must be 'path' or 'buffer'.");let[u,d]=await dT(c),f=await u.createInferenceSessionHandler(l,d);return Rr(),new AT(f)}startProfiling(){this.handler.startProfiling()}endProfiling(){this.handler.endProfiling()}get inputNames(){return this.handler.inputNames}get outputNames(){return this.handler.outputNames}get inputMetadata(){return this.handler.inputMetadata}get outputMetadata(){return this.handler.outputMetadata}}}),Y0,I$=ct(()=>{O$(),Y0=CT}),z$=ct(()=>{}),L$=ct(()=>{}),F$=ct(()=>{}),N$=ct(()=>{}),PT={};Ef(PT,{InferenceSession:()=>Y0,TRACE:()=>pm,TRACE_FUNC_BEGIN:()=>yi,TRACE_FUNC_END:()=>Rr,Tensor:()=>pi,env:()=>da,registerBackend:()=>bu});var vi=ct(()=>{S$(),A$(),I$(),ET(),z$(),L$(),ST(),F$(),N$()}),Z0=ct(()=>{}),kT={};Ef(kT,{default:()=>$T});var ry,iy,$T,j$=ct(()=>{LS(),ku(),J0(),ry="ort-wasm-proxy-worker",iy=globalThis.self?.name===ry,iy&&(self.onmessage=e=>{let{type:n,in:t}=e.data;try{switch(n){case"init-wasm":ev(t.wasm).then(()=>{yv(t).then(()=>{postMessage({type:n})},s=>{postMessage({type:n,err:s})})},s=>{postMessage({type:n,err:s})});break;case"init-ep":{let{epName:s,env:i}=t;vv(i,s).then(()=>{postMessage({type:n})},l=>{postMessage({type:n,err:l})});break}case"copy-from":{let{buffer:s}=t,i=og(s);postMessage({type:n,out:i});break}case"create":{let{model:s,options:i}=t;bv(s,i).then(l=>{postMessage({type:n,out:l})},l=>{postMessage({type:n,err:l})});break}case"release":wv(t),postMessage({type:n});break;case"run":{let{sessionId:s,inputIndices:i,inputs:l,outputIndices:c,options:u}=t;Mv(s,i,l,c,new Array(c.length).fill(null),u).then(d=>{d.some(f=>f[3]!=="cpu")?postMessage({type:n,err:"Proxy does not support non-cpu tensor location."}):postMessage({type:n,out:d},Tv([...l,...d]))},d=>{postMessage({type:n,err:d})});break}case"end-profiling":xv(t),postMessage({type:n});break;default:}}catch(s){postMessage({type:n,err:s})}}),$T=iy?null:e=>new Worker(e??_r,{type:"module",name:ry})}),DT={};Ef(DT,{default:()=>OT});var oy,ly,OT,Eb,R$=ct(()=>{ly=(oy=import.meta.url,async function(e={}){var n,t,s=e,i=new Promise((M,z)=>{n=M,t=z}),l=typeof window=="object",c=typeof WorkerGlobalScope<"u",u=c&&self.name?.startsWith("em-pthread");s.mountExternalData=(M,z)=>{M.startsWith("./")&&(M=M.substring(2)),(s.Eb||(s.Eb=new Map)).set(M,z)},s.unmountExternalData=()=>{delete s.Eb};var d=globalThis.SharedArrayBuffer??new WebAssembly.Memory({initial:0,maximum:0,pc:!0}).buffer.constructor;let f=M=>async(...z)=>{try{if(s.Fb)throw Error("Session already started");let V=s.Fb={dc:z[0],errors:[]},Y=await M(...z);if(s.Fb!==V)throw Error("Session mismatch");s.Jb?.flush();let re=V.errors;if(0<re.length){let be=await Promise.all(re);if(be=be.filter(We=>We),0<be.length)throw Error(be.join(`
`))}return Y}finally{s.Fb=null}};s.jsepInit=(M,z)=>{if(M==="webgpu"){[s.Jb,s.Ub,s.Yb,s.Kb,s.Xb,s.jb,s.Zb,s.ac,s.Vb,s.Wb,s.$b]=z;let V=s.Jb;s.jsepRegisterBuffer=(Y,re,be,We)=>V.registerBuffer(Y,re,be,We),s.jsepGetBuffer=Y=>V.getBuffer(Y),s.jsepCreateDownloader=(Y,re,be)=>V.createDownloader(Y,re,be),s.jsepOnCreateSession=Y=>{V.onCreateSession(Y)},s.jsepOnReleaseSession=Y=>{V.onReleaseSession(Y)},s.jsepOnRunStart=Y=>V.onRunStart(Y),s.bc=(Y,re)=>{V.upload(Y,re)}}else if(M==="webnn"){let V=z[0];[s.nc,s.Nb,s.webnnEnsureTensor,s.Ob,s.webnnDownloadTensor]=z.slice(1),s.webnnReleaseTensorId=s.Nb,s.webnnUploadTensor=s.Ob,s.webnnOnRunStart=Y=>V.onRunStart(Y),s.webnnOnRunEnd=V.onRunEnd.bind(V),s.webnnRegisterMLContext=(Y,re)=>{V.registerMLContext(Y,re)},s.webnnOnReleaseSession=Y=>{V.onReleaseSession(Y)},s.webnnCreateMLTensorDownloader=(Y,re)=>V.createMLTensorDownloader(Y,re),s.webnnRegisterMLTensor=(Y,re,be,We)=>V.registerMLTensor(Y,re,be,We),s.webnnCreateMLContext=Y=>V.createMLContext(Y),s.webnnRegisterMLConstant=(Y,re,be,We,rt,yt)=>V.registerMLConstant(Y,re,be,We,rt,s.Eb,yt),s.webnnRegisterGraphInput=V.registerGraphInput.bind(V),s.webnnIsGraphInput=V.isGraphInput.bind(V),s.webnnCreateTemporaryTensor=V.createTemporaryTensor.bind(V),s.webnnIsInt64Supported=V.isInt64Supported.bind(V)}};let m=()=>{let M=(z,V,Y)=>(...re)=>{let be=An,We=V?.();re=z(...re);let rt=V?.();return We!==rt&&(z=rt,Y(We),V=Y=null),An!=be?new Promise((yt,Ct)=>{Jn={resolve:yt,reject:Ct}}):re};(()=>{for(let z of["_OrtAppendExecutionProvider","_OrtCreateSession","_OrtRun","_OrtRunWithBinding","_OrtBindInput"])s[z]=M(s[z],()=>s[z],V=>s[z]=V)})(),f!==void 0&&(s._OrtRun=f(s._OrtRun),s._OrtRunWithBinding=f(s._OrtRunWithBinding)),m=void 0};s.asyncInit=()=>{m?.()};var _,p,y=Object.assign({},s),v=(M,z)=>{throw z},T="";(l||c)&&(c?T=self.location.href:typeof document<"u"&&document.currentScript&&(T=document.currentScript.src),oy&&(T=oy),T=T.startsWith("blob:")?"":T.slice(0,T.replace(/[?#].*/,"").lastIndexOf("/")+1),c&&(p=M=>{var z=new XMLHttpRequest;return z.open("GET",M,!1),z.responseType="arraybuffer",z.send(null),new Uint8Array(z.response)}),_=async M=>{if(he(M))return new Promise((V,Y)=>{var re=new XMLHttpRequest;re.open("GET",M,!0),re.responseType="arraybuffer",re.onload=()=>{re.status==200||re.status==0&&re.response?V(re.response):Y(re.status)},re.onerror=Y,re.send(null)});var z=await fetch(M,{credentials:"same-origin"});if(z.ok)return z.arrayBuffer();throw Error(z.status+" : "+z.url)});var k=console.log.bind(console),b=console.error.bind(console),S=k,$=b;Object.assign(s,y),y=null;var w,C,P,A,I,W,G,q,Z,X,Q,te,R,ee=s.wasmBinary,ie=!1,he=M=>M.startsWith("file://");function _e(){return w.buffer!=A.buffer&&Re(),A}function U(){return w.buffer!=A.buffer&&Re(),I}function K(){return w.buffer!=A.buffer&&Re(),W}function H(){return w.buffer!=A.buffer&&Re(),G}function B(){return w.buffer!=A.buffer&&Re(),q}function ce(){return w.buffer!=A.buffer&&Re(),Z}function ve(){return w.buffer!=A.buffer&&Re(),X}function Pe(){return w.buffer!=A.buffer&&Re(),R}if(u){let M=function(z){try{var V=z.data,Y=V.Bb;if(Y==="load"){let re=[];self.onmessage=be=>re.push(be),self.startWorker=()=>{postMessage({Bb:"loaded"});for(let be of re)M(be);self.onmessage=M};for(let be of V.Rb)s[be]&&!s[be].proxy||(s[be]=(...We)=>{postMessage({Bb:"callHandler",Qb:be,args:We})},be=="print"&&(S=s[be]),be=="printErr"&&($=s[be]));w=V.kc,Re(),ze(V.lc)}else if(Y==="run"){wi(V.Ab),po(V.Ab,0,0,1,0,0),fa(),pe(V.Ab),Ze||(Pi(),Ze=!0);try{Mi(V.fc,V.Hb)}catch(re){if(re!="unwind")throw re}}else V.target!=="setimmediate"&&(Y==="checkMailbox"?Ze&&me():Y&&($(`worker: received unknown command ${Y}`),$(V)))}catch(re){throw wc(),re}};var ze,Ze=!1;$=function(...z){z=z.join(" "),console.error(z)},self.alert=function(...z){postMessage({Bb:"alert",text:z.join(" "),ic:fo()})},self.onunhandledrejection=z=>{throw z.reason||z},self.onmessage=M}function Re(){var M=w.buffer;s.HEAP8=A=new Int8Array(M),s.HEAP16=W=new Int16Array(M),s.HEAPU8=I=new Uint8Array(M),s.HEAPU16=G=new Uint16Array(M),s.HEAP32=q=new Int32Array(M),s.HEAPU32=Z=new Uint32Array(M),s.HEAPF32=X=new Float32Array(M),s.HEAPF64=R=new Float64Array(M),s.HEAP64=Q=new BigInt64Array(M),s.HEAPU64=te=new BigUint64Array(M)}function de(){u?startWorker(s):Pt.Ca()}u||(w=new WebAssembly.Memory({initial:256,maximum:65536,shared:!0}),Re());var J,Ce=0,Fe=null;function Be(){if(--Ce==0&&Fe){var M=Fe;Fe=null,M()}}function Ue(M){throw $(M="Aborted("+M+")"),ie=!0,M=new WebAssembly.RuntimeError(M+". Build with -sASSERTIONS for more info."),t(M),M}function He(){return{a:{L:ke,Aa:nt,b:Wn,$:Ra,A:Ys,pa:Us,X:Zs,Z:F,qa:ue,na:ne,ga:le,ma:fe,J:xe,Y:Ne,V:ut,oa:xt,W:ht,va:Zt,E:gs,Q:Hn,O:Vr,D:Ds,u:Ha,r:_a,P:Ya,z:ao,R:Te,ja:N,T:Ie,aa:vt,M:gt,F:bt,ia:pe,sa:pt,t:qn,Ba:ga,w:ys,o:fs,l:gn,c:Wa,n:qa,j:tl,v:xi,p:ro,f:dc,s:Ti,m:Du,e:Ou,k:nl,i:Iu,g:zu,d:Ei,da:Lu,ea:Fu,fa:pc,ba:mc,ca:io,N:sl,xa:_c,ua:Sf,h:yc,C:ol,G:ju,ta:gc,x:Ru,ra:Bu,U:ll,q:Nu,y:Si,K:Uu,S:cl,za:vc,ya:er,ka:tr,la:fl,_:Je,B:Ai,I:qr,ha:Vu,H:uo,a:w,wa:wt}}}var De={829644:(M,z,V,Y,re)=>{if(s===void 0||!s.Eb)return 1;if((M=Fn(Number(M>>>0))).startsWith("./")&&(M=M.substring(2)),!(M=s.Eb.get(M)))return 2;if(z=Number(z>>>0),V=Number(V>>>0),Y=Number(Y>>>0),z+V>M.byteLength)return 3;try{let be=M.subarray(z,z+V);switch(re){case 0:U().set(be,Y>>>0);break;case 1:s.mc?s.mc(Y,be):s.bc(Y,be);break;default:return 4}return 0}catch{return 4}},830468:(M,z,V)=>{s.Ob(M,U().subarray(z>>>0,z+V>>>0))},830532:()=>s.nc(),830574:M=>{s.Nb(M)},830611:()=>{s.Vb()},830642:()=>{s.Wb()},830671:()=>{s.$b()},830696:M=>s.Ub(M),830729:M=>s.Yb(M),830761:(M,z,V)=>{s.Kb(Number(M),Number(z),Number(V),!0)},830824:(M,z,V)=>{s.Kb(Number(M),Number(z),Number(V))},830881:()=>typeof wasmOffsetConverter<"u",830938:M=>{s.jb("Abs",M,void 0)},830989:M=>{s.jb("Neg",M,void 0)},831040:M=>{s.jb("Floor",M,void 0)},831093:M=>{s.jb("Ceil",M,void 0)},831145:M=>{s.jb("Reciprocal",M,void 0)},831203:M=>{s.jb("Sqrt",M,void 0)},831255:M=>{s.jb("Exp",M,void 0)},831306:M=>{s.jb("Erf",M,void 0)},831357:M=>{s.jb("Sigmoid",M,void 0)},831412:(M,z,V)=>{s.jb("HardSigmoid",M,{alpha:z,beta:V})},831491:M=>{s.jb("Log",M,void 0)},831542:M=>{s.jb("Sin",M,void 0)},831593:M=>{s.jb("Cos",M,void 0)},831644:M=>{s.jb("Tan",M,void 0)},831695:M=>{s.jb("Asin",M,void 0)},831747:M=>{s.jb("Acos",M,void 0)},831799:M=>{s.jb("Atan",M,void 0)},831851:M=>{s.jb("Sinh",M,void 0)},831903:M=>{s.jb("Cosh",M,void 0)},831955:M=>{s.jb("Asinh",M,void 0)},832008:M=>{s.jb("Acosh",M,void 0)},832061:M=>{s.jb("Atanh",M,void 0)},832114:M=>{s.jb("Tanh",M,void 0)},832166:M=>{s.jb("Not",M,void 0)},832217:(M,z,V)=>{s.jb("Clip",M,{min:z,max:V})},832286:M=>{s.jb("Clip",M,void 0)},832338:(M,z)=>{s.jb("Elu",M,{alpha:z})},832396:M=>{s.jb("Gelu",M,void 0)},832448:M=>{s.jb("Relu",M,void 0)},832500:(M,z)=>{s.jb("LeakyRelu",M,{alpha:z})},832564:(M,z)=>{s.jb("ThresholdedRelu",M,{alpha:z})},832634:(M,z)=>{s.jb("Cast",M,{to:z})},832692:M=>{s.jb("Add",M,void 0)},832743:M=>{s.jb("Sub",M,void 0)},832794:M=>{s.jb("Mul",M,void 0)},832845:M=>{s.jb("Div",M,void 0)},832896:M=>{s.jb("Pow",M,void 0)},832947:M=>{s.jb("Equal",M,void 0)},833e3:M=>{s.jb("Greater",M,void 0)},833055:M=>{s.jb("GreaterOrEqual",M,void 0)},833117:M=>{s.jb("Less",M,void 0)},833169:M=>{s.jb("LessOrEqual",M,void 0)},833228:(M,z,V,Y,re)=>{s.jb("ReduceMean",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},833403:(M,z,V,Y,re)=>{s.jb("ReduceMax",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},833577:(M,z,V,Y,re)=>{s.jb("ReduceMin",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},833751:(M,z,V,Y,re)=>{s.jb("ReduceProd",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},833926:(M,z,V,Y,re)=>{s.jb("ReduceSum",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},834100:(M,z,V,Y,re)=>{s.jb("ReduceL1",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},834273:(M,z,V,Y,re)=>{s.jb("ReduceL2",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},834446:(M,z,V,Y,re)=>{s.jb("ReduceLogSum",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},834623:(M,z,V,Y,re)=>{s.jb("ReduceSumSquare",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},834803:(M,z,V,Y,re)=>{s.jb("ReduceLogSumExp",M,{keepDims:!!z,noopWithEmptyAxes:!!V,axes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},834983:M=>{s.jb("Where",M,void 0)},835036:(M,z,V)=>{s.jb("Transpose",M,{perm:z?Array.from(B().subarray(Number(z)>>>0,Number(V)>>>0)):[]})},835160:(M,z,V,Y)=>{s.jb("DepthToSpace",M,{blocksize:z,mode:Fn(V),format:Y?"NHWC":"NCHW"})},835293:(M,z,V,Y)=>{s.jb("DepthToSpace",M,{blocksize:z,mode:Fn(V),format:Y?"NHWC":"NCHW"})},835426:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn,Ws)=>{s.jb("ConvTranspose",M,{format:yt?"NHWC":"NCHW",autoPad:z,dilations:[V],group:Y,kernelShape:[re],pads:[be,We],strides:[rt],wIsConst:()=>!!_e()[Ct>>>0],outputPadding:Kt?Array.from(B().subarray(Number(Kt)>>>0,Number(dn)>>>0)):[],outputShape:vn?Array.from(B().subarray(Number(vn)>>>0,Number(Pn)>>>0)):[],activation:Fn(Ws)})},835859:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn)=>{s.jb("ConvTranspose",M,{format:rt?"NHWC":"NCHW",autoPad:z,dilations:Array.from(B().subarray(Number(V)>>>0,2+(Number(V)>>>0)>>>0)),group:Y,kernelShape:Array.from(B().subarray(Number(re)>>>0,2+(Number(re)>>>0)>>>0)),pads:Array.from(B().subarray(Number(be)>>>0,4+(Number(be)>>>0)>>>0)),strides:Array.from(B().subarray(Number(We)>>>0,2+(Number(We)>>>0)>>>0)),wIsConst:()=>!!_e()[yt>>>0],outputPadding:Ct?Array.from(B().subarray(Number(Ct)>>>0,Number(Kt)>>>0)):[],outputShape:dn?Array.from(B().subarray(Number(dn)>>>0,Number(vn)>>>0)):[],activation:Fn(Pn)})},836520:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn,Ws)=>{s.jb("ConvTranspose",M,{format:yt?"NHWC":"NCHW",autoPad:z,dilations:[V],group:Y,kernelShape:[re],pads:[be,We],strides:[rt],wIsConst:()=>!!_e()[Ct>>>0],outputPadding:Kt?Array.from(B().subarray(Number(Kt)>>>0,Number(dn)>>>0)):[],outputShape:vn?Array.from(B().subarray(Number(vn)>>>0,Number(Pn)>>>0)):[],activation:Fn(Ws)})},836953:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn)=>{s.jb("ConvTranspose",M,{format:rt?"NHWC":"NCHW",autoPad:z,dilations:Array.from(B().subarray(Number(V)>>>0,2+(Number(V)>>>0)>>>0)),group:Y,kernelShape:Array.from(B().subarray(Number(re)>>>0,2+(Number(re)>>>0)>>>0)),pads:Array.from(B().subarray(Number(be)>>>0,4+(Number(be)>>>0)>>>0)),strides:Array.from(B().subarray(Number(We)>>>0,2+(Number(We)>>>0)>>>0)),wIsConst:()=>!!_e()[yt>>>0],outputPadding:Ct?Array.from(B().subarray(Number(Ct)>>>0,Number(Kt)>>>0)):[],outputShape:dn?Array.from(B().subarray(Number(dn)>>>0,Number(vn)>>>0)):[],activation:Fn(Pn)})},837614:(M,z)=>{s.jb("GlobalAveragePool",M,{format:z?"NHWC":"NCHW"})},837705:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn)=>{s.jb("AveragePool",M,{format:Pn?"NHWC":"NCHW",auto_pad:z,ceil_mode:V,count_include_pad:Y,storage_order:re,dilations:be?Array.from(B().subarray(Number(be)>>>0,Number(We)>>>0)):[],kernel_shape:rt?Array.from(B().subarray(Number(rt)>>>0,Number(yt)>>>0)):[],pads:Ct?Array.from(B().subarray(Number(Ct)>>>0,Number(Kt)>>>0)):[],strides:dn?Array.from(B().subarray(Number(dn)>>>0,Number(vn)>>>0)):[]})},838184:(M,z)=>{s.jb("GlobalAveragePool",M,{format:z?"NHWC":"NCHW"})},838275:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn)=>{s.jb("AveragePool",M,{format:Pn?"NHWC":"NCHW",auto_pad:z,ceil_mode:V,count_include_pad:Y,storage_order:re,dilations:be?Array.from(B().subarray(Number(be)>>>0,Number(We)>>>0)):[],kernel_shape:rt?Array.from(B().subarray(Number(rt)>>>0,Number(yt)>>>0)):[],pads:Ct?Array.from(B().subarray(Number(Ct)>>>0,Number(Kt)>>>0)):[],strides:dn?Array.from(B().subarray(Number(dn)>>>0,Number(vn)>>>0)):[]})},838754:(M,z)=>{s.jb("GlobalMaxPool",M,{format:z?"NHWC":"NCHW"})},838841:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn)=>{s.jb("MaxPool",M,{format:Pn?"NHWC":"NCHW",auto_pad:z,ceil_mode:V,count_include_pad:Y,storage_order:re,dilations:be?Array.from(B().subarray(Number(be)>>>0,Number(We)>>>0)):[],kernel_shape:rt?Array.from(B().subarray(Number(rt)>>>0,Number(yt)>>>0)):[],pads:Ct?Array.from(B().subarray(Number(Ct)>>>0,Number(Kt)>>>0)):[],strides:dn?Array.from(B().subarray(Number(dn)>>>0,Number(vn)>>>0)):[]})},839316:(M,z)=>{s.jb("GlobalMaxPool",M,{format:z?"NHWC":"NCHW"})},839403:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn)=>{s.jb("MaxPool",M,{format:Pn?"NHWC":"NCHW",auto_pad:z,ceil_mode:V,count_include_pad:Y,storage_order:re,dilations:be?Array.from(B().subarray(Number(be)>>>0,Number(We)>>>0)):[],kernel_shape:rt?Array.from(B().subarray(Number(rt)>>>0,Number(yt)>>>0)):[],pads:Ct?Array.from(B().subarray(Number(Ct)>>>0,Number(Kt)>>>0)):[],strides:dn?Array.from(B().subarray(Number(dn)>>>0,Number(vn)>>>0)):[]})},839878:(M,z,V,Y,re)=>{s.jb("Gemm",M,{alpha:z,beta:V,transA:Y,transB:re})},839982:M=>{s.jb("MatMul",M,void 0)},840036:(M,z,V,Y)=>{s.jb("ArgMax",M,{keepDims:!!z,selectLastIndex:!!V,axis:Y})},840144:(M,z,V,Y)=>{s.jb("ArgMin",M,{keepDims:!!z,selectLastIndex:!!V,axis:Y})},840252:(M,z)=>{s.jb("Softmax",M,{axis:z})},840315:(M,z)=>{s.jb("Concat",M,{axis:z})},840375:(M,z,V,Y,re)=>{s.jb("Split",M,{axis:z,numOutputs:V,splitSizes:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},840531:M=>{s.jb("Expand",M,void 0)},840585:(M,z)=>{s.jb("Gather",M,{axis:Number(z)})},840656:(M,z)=>{s.jb("GatherElements",M,{axis:Number(z)})},840735:(M,z)=>{s.jb("GatherND",M,{batch_dims:Number(z)})},840814:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt)=>{s.jb("Resize",M,{antialias:z,axes:V?Array.from(B().subarray(Number(V)>>>0,Number(Y)>>>0)):[],coordinateTransformMode:Fn(re),cubicCoeffA:be,excludeOutside:We,extrapolationValue:rt,keepAspectRatioPolicy:Fn(yt),mode:Fn(Ct),nearestMode:Fn(Kt)})},841176:(M,z,V,Y,re,be,We)=>{s.jb("Slice",M,{starts:z?Array.from(B().subarray(Number(z)>>>0,Number(V)>>>0)):[],ends:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[],axes:be?Array.from(B().subarray(Number(be)>>>0,Number(We)>>>0)):[]})},841440:M=>{s.jb("Tile",M,void 0)},841492:(M,z,V)=>{s.jb("InstanceNormalization",M,{epsilon:z,format:V?"NHWC":"NCHW"})},841606:(M,z,V)=>{s.jb("InstanceNormalization",M,{epsilon:z,format:V?"NHWC":"NCHW"})},841720:M=>{s.jb("Range",M,void 0)},841773:(M,z)=>{s.jb("Einsum",M,{equation:Fn(z)})},841854:(M,z,V,Y,re)=>{s.jb("Pad",M,{mode:z,value:V,pads:Y?Array.from(B().subarray(Number(Y)>>>0,Number(re)>>>0)):[]})},841997:(M,z,V,Y,re,be)=>{s.jb("BatchNormalization",M,{epsilon:z,momentum:V,spatial:!!re,trainingMode:!!Y,format:be?"NHWC":"NCHW"})},842166:(M,z,V,Y,re,be)=>{s.jb("BatchNormalization",M,{epsilon:z,momentum:V,spatial:!!re,trainingMode:!!Y,format:be?"NHWC":"NCHW"})},842335:(M,z,V)=>{s.jb("CumSum",M,{exclusive:Number(z),reverse:Number(V)})},842432:(M,z,V)=>{s.jb("DequantizeLinear",M,{axis:z,blockSize:V})},842522:(M,z,V,Y,re)=>{s.jb("GridSample",M,{align_corners:z,mode:Fn(V),padding_mode:Fn(Y),format:re?"NHWC":"NCHW"})},842692:(M,z,V,Y,re)=>{s.jb("GridSample",M,{align_corners:z,mode:Fn(V),padding_mode:Fn(Y),format:re?"NHWC":"NCHW"})},842862:(M,z)=>{s.jb("ScatterND",M,{reduction:Fn(z)})},842947:(M,z,V,Y,re,be,We,rt,yt)=>{s.jb("Attention",M,{numHeads:z,isUnidirectional:V,maskFilterValue:Y,scale:re,doRotary:be,qkvHiddenSizes:We?Array.from(B().subarray(Number(rt)>>>0,Number(rt)+We>>>0)):[],pastPresentShareBuffer:!!yt})},843219:M=>{s.jb("BiasAdd",M,void 0)},843274:M=>{s.jb("BiasSplitGelu",M,void 0)},843335:M=>{s.jb("FastGelu",M,void 0)},843391:(M,z,V,Y,re,be,We,rt,yt,Ct,Kt,dn,vn,Pn,Ws,hs)=>{s.jb("Conv",M,{format:dn?"NHWC":"NCHW",auto_pad:z,dilations:V?Array.from(B().subarray(Number(V)>>>0,Number(Y)>>>0)):[],group:re,kernel_shape:be?Array.from(B().subarray(Number(be)>>>0,Number(We)>>>0)):[],pads:rt?Array.from(B().subarray(Number(rt)>>>0,Number(yt)>>>0)):[],strides:Ct?Array.from(B().subarray(Number(Ct)>>>0,Number(Kt)>>>0)):[],w_is_const:()=>!!_e()[Number(vn)>>>0],activation:Fn(Pn),activation_params:Ws?Array.from(ve().subarray(Number(Ws)>>>0,Number(hs)>>>0)):[]})},843975:M=>{s.jb("Gelu",M,void 0)},844027:(M,z,V,Y,re,be,We,rt,yt)=>{s.jb("GroupQueryAttention",M,{numHeads:z,kvNumHeads:V,scale:Y,softcap:re,doRotary:be,rotaryInterleaved:We,smoothSoftmax:rt,localWindowSize:yt})},844244:(M,z,V,Y)=>{s.jb("LayerNormalization",M,{axis:z,epsilon:V,simplified:!!Y})},844355:(M,z,V,Y)=>{s.jb("LayerNormalization",M,{axis:z,epsilon:V,simplified:!!Y})},844466:(M,z,V,Y,re,be)=>{s.jb("MatMulNBits",M,{k:z,n:V,accuracyLevel:Y,bits:re,blockSize:be})},844593:(M,z,V,Y,re,be)=>{s.jb("MultiHeadAttention",M,{numHeads:z,isUnidirectional:V,maskFilterValue:Y,scale:re,doRotary:be})},844752:(M,z)=>{s.jb("QuickGelu",M,{alpha:z})},844816:(M,z,V,Y,re)=>{s.jb("RotaryEmbedding",M,{interleaved:!!z,numHeads:V,rotaryEmbeddingDim:Y,scale:re})},844955:(M,z,V)=>{s.jb("SkipLayerNormalization",M,{epsilon:z,simplified:!!V})},845057:(M,z,V)=>{s.jb("SkipLayerNormalization",M,{epsilon:z,simplified:!!V})},845159:(M,z,V,Y)=>{s.jb("GatherBlockQuantized",M,{gatherAxis:z,quantizeAxis:V,blockSize:Y})},845280:M=>{s.Zb(M)},845314:(M,z)=>s.ac(Number(M),Number(z),s.Fb.dc,s.Fb.errors)};function nt(M,z,V){return ds(async()=>{await s.Xb(Number(M),Number(z),Number(V))})}function ke(){return typeof wasmOffsetConverter<"u"}class Ge{name="ExitStatus";constructor(z){this.message=`Program terminated with exit(${z})`,this.status=z}}var dt=M=>{M.terminate(),M.onmessage=()=>{}},Ye=[],mt=M=>{St.length==0&&(ss(),Jt(St[0]));var z=St.pop();if(!z)return 6;Lt.push(z),Ht[M.Ab]=z,z.Ab=M.Ab;var V={Bb:"run",fc:M.ec,Hb:M.Hb,Ab:M.Ab};return z.postMessage(V,M.Mb),0},it=0,Mt=(M,z,...V)=>{for(var Y=2*V.length,re=nr(),be=go(8*Y),We=be>>>3,rt=0;rt<V.length;rt++){var yt=V[rt];typeof yt=="bigint"?(Q[We+2*rt]=1n,Q[We+2*rt+1]=yt):(Q[We+2*rt]=0n,Pe()[We+2*rt+1>>>0]=yt)}return M=Za(M,0,Y,be,z),Qr(re),M};function wt(M){if(u)return Mt(0,1,M);if(P=M,!(0<it)){for(var z of Lt)dt(z);for(z of St)dt(z);St=[],Lt=[],Ht={},ie=!0}v(0,new Ge(M))}function ot(M){if(u)return Mt(1,0,M);Je(M)}var Je=M=>{if(P=M,u)throw ot(M),"unwind";wt(M)},St=[],Lt=[],wn=[],Ht={},Mn=M=>{var z=M.Ab;delete Ht[z],St.push(M),Lt.splice(Lt.indexOf(M),1),M.Ab=0,wr(z)};function fa(){wn.forEach(M=>M())}var Jt=M=>new Promise(z=>{M.onmessage=re=>{var be=(re=re.data).Bb;if(re.Gb&&re.Gb!=fo()){var We=Ht[re.Gb];We?We.postMessage(re,re.Mb):$(`Internal error! Worker sent a message "${be}" to target pthread ${re.Gb}, but that thread no longer exists!`)}else be==="checkMailbox"?me():be==="spawnThread"?mt(re):be==="cleanupThread"?Mn(Ht[re.hc]):be==="loaded"?(M.loaded=!0,z(M)):be==="alert"?alert(`Thread ${re.ic}: ${re.text}`):re.target==="setimmediate"?M.postMessage(re):be==="callHandler"?s[re.Qb](...re.args):be&&$(`worker sent an unknown command ${be}`)},M.onerror=re=>{throw $(`worker sent an error! ${re.filename}:${re.lineno}: ${re.message}`),re};var V,Y=[];for(V of[])s.propertyIsEnumerable(V)&&Y.push(V);M.postMessage({Bb:"load",Rb:Y,kc:w,lc:C})});function ss(){var M=new Worker((()=>{let z=URL;return import.meta.url>"file:"&&import.meta.url<"file;"?new z("ort.bundle.min.mjs",import.meta.url):new URL(import.meta.url)})(),{type:"module",workerData:"em-pthread",name:"em-pthread"});St.push(M)}var wi=M=>{Re();var z=ce()[M+52>>>2>>>0];M=ce()[M+56>>>2>>>0],_l(z,z-M),Qr(z)},Mi=(M,z)=>{it=0,M=yo(M,z),0<it?P=M:mo(M)};class Xs{constructor(z){this.Ib=z-24}}function Wn(M,z,V){var Y=new Xs(M>>>=0);throw z>>>=0,V>>>=0,ce()[Y.Ib+16>>>2>>>0]=0,ce()[Y.Ib+4>>>2>>>0]=z,ce()[Y.Ib+8>>>2>>>0]=V,M}function wa(M,z,V,Y){return u?Mt(2,1,M,z,V,Y):Ra(M,z,V,Y)}function Ra(M,z,V,Y){if(M>>>=0,V>>>=0,Y>>>=0,d===void 0)return 6;var re=[];return u&&re.length===0?wa(M,z>>>=0,V,Y):(M={ec:V,Ab:M,Hb:Y,Mb:re},u?(M.Bb="spawnThread",postMessage(M,re),0):mt(M))}var Bs=typeof TextDecoder<"u"?new TextDecoder:void 0,Ft=(M,z=0,V=NaN)=>{var Y=(z>>>=0)+V;for(V=z;M[V]&&!(V>=Y);)++V;if(16<V-z&&M.buffer&&Bs)return Bs.decode(M.buffer instanceof ArrayBuffer?M.subarray(z,V):M.slice(z,V));for(Y="";z<V;){var re=M[z++];if(128&re){var be=63&M[z++];if((224&re)==192)Y+=String.fromCharCode((31&re)<<6|be);else{var We=63&M[z++];65536>(re=(240&re)==224?(15&re)<<12|be<<6|We:(7&re)<<18|be<<12|We<<6|63&M[z++])?Y+=String.fromCharCode(re):(re-=65536,Y+=String.fromCharCode(55296|re>>10,56320|1023&re))}}else Y+=String.fromCharCode(re)}return Y},Fn=(M,z)=>(M>>>=0)?Ft(U(),M,z):"";function Ys(M,z,V){return u?Mt(3,1,M,z,V):0}function Us(M,z){if(u)return Mt(4,1,M,z)}var Ua=M=>{for(var z=0,V=0;V<M.length;++V){var Y=M.charCodeAt(V);127>=Y?z++:2047>=Y?z+=2:55296<=Y&&57343>=Y?(z+=4,++V):z+=3}return z},qt=(M,z,V)=>{var Y=U();if(z>>>=0,0<V){var re=z;V=z+V-1;for(var be=0;be<M.length;++be){var We=M.charCodeAt(be);if(55296<=We&&57343>=We&&(We=65536+((1023&We)<<10)|1023&M.charCodeAt(++be)),127>=We){if(z>=V)break;Y[z++>>>0]=We}else{if(2047>=We){if(z+1>=V)break;Y[z++>>>0]=192|We>>6}else{if(65535>=We){if(z+2>=V)break;Y[z++>>>0]=224|We>>12}else{if(z+3>=V)break;Y[z++>>>0]=240|We>>18,Y[z++>>>0]=128|We>>12&63}Y[z++>>>0]=128|We>>6&63}Y[z++>>>0]=128|63&We}}Y[z>>>0]=0,M=z-re}else M=0;return M};function Zs(M,z){if(u)return Mt(5,1,M,z)}function F(M,z,V){if(u)return Mt(6,1,M,z,V)}function ue(M,z,V){return u?Mt(7,1,M,z,V):0}function ne(M,z){if(u)return Mt(8,1,M,z)}function le(M,z,V){if(u)return Mt(9,1,M,z,V)}function fe(M,z,V,Y){if(u)return Mt(10,1,M,z,V,Y)}function xe(M,z,V,Y){if(u)return Mt(11,1,M,z,V,Y)}function Ne(M,z,V,Y){if(u)return Mt(12,1,M,z,V,Y)}function ut(M){if(u)return Mt(13,1,M)}function xt(M,z){if(u)return Mt(14,1,M,z)}function ht(M,z,V){if(u)return Mt(15,1,M,z,V)}var Rt,_t,Zt=()=>Ue(""),nn=M=>{for(var z="";U()[M>>>0];)z+=Rt[U()[M++>>>0]];return z},sa={},ra={};function Nn(M,z,V={}){return(function(Y,re,be={}){var We=re.name;if(!Y)throw new _t(`type "${We}" must have a positive integer typeid pointer`);if(ra.hasOwnProperty(Y)){if(be.Sb)return;throw new _t(`Cannot register type '${We}' twice`)}ra[Y]=re,sa.hasOwnProperty(Y)&&(re=sa[Y],delete sa[Y],re.forEach(rt=>rt()))})(M,z,V)}var ia=(M,z,V)=>{switch(z){case 1:return V?Y=>_e()[Y>>>0]:Y=>U()[Y>>>0];case 2:return V?Y=>K()[Y>>>1>>>0]:Y=>H()[Y>>>1>>>0];case 4:return V?Y=>B()[Y>>>2>>>0]:Y=>ce()[Y>>>2>>>0];case 8:return V?Y=>Q[Y>>>3]:Y=>te[Y>>>3];default:throw new TypeError(`invalid integer width (${z}): ${M}`)}};function gs(M,z,V){V>>>=0,Nn(M>>>=0,{name:z=nn(z>>>0),fromWireType:Y=>Y,toWireType:function(Y,re){if(typeof re!="bigint"&&typeof re!="number")throw re=re===null?"null":(Y=typeof re)=="object"||Y==="array"||Y==="function"?re.toString():""+re,new TypeError(`Cannot convert "${re}" to ${this.name}`);return typeof re=="number"&&(re=BigInt(re)),re},Cb:Ma,readValueFromPointer:ia(z,V,z.indexOf("u")==-1),Db:null})}var Ma=8;function Hn(M,z,V,Y){Nn(M>>>=0,{name:z=nn(z>>>0),fromWireType:function(re){return!!re},toWireType:function(re,be){return be?V:Y},Cb:Ma,readValueFromPointer:function(re){return this.fromWireType(U()[re>>>0])},Db:null})}var Va=[],Ga=[];function Wa(M){9<(M>>>=0)&&--Ga[M+1]==0&&(Ga[M]=void 0,Va.push(M))}var Zn=M=>{if(!M)throw new _t("Cannot use deleted val. handle = "+M);return Ga[M]},ha=M=>{switch(M){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:let z=Va.pop()||Ga.length;return Ga[z]=M,Ga[z+1]=1,z}};function us(M){return this.fromWireType(ce()[M>>>2>>>0])}var ks={name:"emscripten::val",fromWireType:M=>{var z=Zn(M);return Wa(M),z},toWireType:(M,z)=>ha(z),Cb:Ma,readValueFromPointer:us,Db:null};function Vr(M){return Nn(M>>>0,ks)}var $s=(M,z)=>{switch(z){case 4:return function(V){return this.fromWireType(ve()[V>>>2>>>0])};case 8:return function(V){return this.fromWireType(Pe()[V>>>3>>>0])};default:throw new TypeError(`invalid float width (${z}): ${M}`)}};function Ds(M,z,V){V>>>=0,Nn(M>>>=0,{name:z=nn(z>>>0),fromWireType:Y=>Y,toWireType:(Y,re)=>re,Cb:Ma,readValueFromPointer:$s(z,V),Db:null})}function Ha(M,z,V,Y,re){if(M>>>=0,V>>>=0,z=nn(z>>>0),re===-1&&(re=4294967295),re=rt=>rt,Y===0){var be=32-8*V;re=rt=>rt<<be>>>be}var We=z.includes("unsigned")?function(rt,yt){return yt>>>0}:function(rt,yt){return yt};Nn(M,{name:z,fromWireType:re,toWireType:We,Cb:Ma,readValueFromPointer:ia(z,V,Y!==0),Db:null})}function _a(M,z,V){function Y(be){var We=ce()[be>>>2>>>0];return be=ce()[be+4>>>2>>>0],new re(_e().buffer,be,We)}var re=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array][z];Nn(M>>>=0,{name:V=nn(V>>>0),fromWireType:Y,Cb:Ma,readValueFromPointer:Y},{Sb:!0})}function Ya(M,z){Nn(M>>>=0,{name:z=nn(z>>>0),fromWireType:function(V){for(var Y,re=ce()[V>>>2>>>0],be=V+4,We=be,rt=0;rt<=re;++rt){var yt=be+rt;rt!=re&&U()[yt>>>0]!=0||(We=Fn(We,yt-We),Y===void 0?Y=We:(Y+="\0",Y+=We),We=yt+1)}return Is(V),Y},toWireType:function(V,Y){Y instanceof ArrayBuffer&&(Y=new Uint8Array(Y));var re=typeof Y=="string";if(!(re||Y instanceof Uint8Array||Y instanceof Uint8ClampedArray||Y instanceof Int8Array))throw new _t("Cannot pass non-string to std::string");var be=re?Ua(Y):Y.length,We=ho(4+be+1),rt=We+4;if(ce()[We>>>2>>>0]=be,re)qt(Y,rt,be+1);else if(re)for(re=0;re<be;++re){var yt=Y.charCodeAt(re);if(255<yt)throw Is(We),new _t("String has UTF-16 code units that do not fit in 8 bits");U()[rt+re>>>0]=yt}else for(re=0;re<be;++re)U()[rt+re>>>0]=Y[re];return V!==null&&V.push(Is,We),We},Cb:Ma,readValueFromPointer:us,Db(V){Is(V)}})}var st=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,lt=(M,z)=>{for(var V=M>>1,Y=V+z/2;!(V>=Y)&&H()[V>>>0];)++V;if(32<(V<<=1)-M&&st)return st.decode(U().slice(M,V));for(V="",Y=0;!(Y>=z/2);++Y){var re=K()[M+2*Y>>>1>>>0];if(re==0)break;V+=String.fromCharCode(re)}return V},Et=(M,z,V)=>{if(V??=2147483647,2>V)return 0;var Y=z;V=(V-=2)<2*M.length?V/2:M.length;for(var re=0;re<V;++re){var be=M.charCodeAt(re);K()[z>>>1>>>0]=be,z+=2}return K()[z>>>1>>>0]=0,z-Y},xn=M=>2*M.length,Gr=(M,z)=>{for(var V=0,Y="";!(V>=z/4);){var re=B()[M+4*V>>>2>>>0];if(re==0)break;++V,65536<=re?(re-=65536,Y+=String.fromCharCode(55296|re>>10,56320|1023&re)):Y+=String.fromCharCode(re)}return Y},Ca=(M,z,V)=>{if(z>>>=0,V??=2147483647,4>V)return 0;var Y=z;V=Y+V-4;for(var re=0;re<M.length;++re){var be=M.charCodeAt(re);if(55296<=be&&57343>=be&&(be=65536+((1023&be)<<10)|1023&M.charCodeAt(++re)),B()[z>>>2>>>0]=be,(z+=4)+4>V)break}return B()[z>>>2>>>0]=0,z-Y},Js=M=>{for(var z=0,V=0;V<M.length;++V){var Y=M.charCodeAt(V);55296<=Y&&57343>=Y&&++V,z+=4}return z};function ao(M,z,V){if(M>>>=0,z>>>=0,V=nn(V>>>=0),z===2)var Y=lt,re=Et,be=xn,We=rt=>H()[rt>>>1>>>0];else z===4&&(Y=Gr,re=Ca,be=Js,We=rt=>ce()[rt>>>2>>>0]);Nn(M,{name:V,fromWireType:rt=>{for(var yt,Ct=ce()[rt>>>2>>>0],Kt=rt+4,dn=0;dn<=Ct;++dn){var vn=rt+4+dn*z;dn!=Ct&&We(vn)!=0||(Kt=Y(Kt,vn-Kt),yt===void 0?yt=Kt:(yt+="\0",yt+=Kt),Kt=vn+z)}return Is(rt),yt},toWireType:(rt,yt)=>{if(typeof yt!="string")throw new _t(`Cannot pass non-string to C++ string type ${V}`);var Ct=be(yt),Kt=ho(4+Ct+z);return ce()[Kt>>>2>>>0]=Ct/z,re(yt,Kt+4,Ct+z),rt!==null&&rt.push(Is,Kt),Kt},Cb:Ma,readValueFromPointer:us,Db(rt){Is(rt)}})}function Te(M,z){Nn(M>>>=0,{Tb:!0,name:z=nn(z>>>0),Cb:0,fromWireType:()=>{},toWireType:()=>{}})}function N(M){po(M>>>0,!c,1,!l,131072,!1),fa()}var oe=M=>{if(!ie)try{if(M(),!(0<it))try{u?mo(P):Je(P)}catch(z){z instanceof Ge||z=="unwind"||v(0,z)}}catch(z){z instanceof Ge||z=="unwind"||v(0,z)}};function pe(M){M>>>=0,typeof Atomics.jc=="function"&&(Atomics.jc(B(),M>>>2,M).value.then(me),M+=128,Atomics.store(B(),M>>>2,1))}var me=()=>{var M=fo();M&&(pe(M),oe(_o))};function Ie(M,z){(M>>>=0)==z>>>0?setTimeout(me):u?postMessage({Gb:M,Bb:"checkMailbox"}):(M=Ht[M])&&M.postMessage({Bb:"checkMailbox"})}var qe=[];function vt(M,z,V,Y,re){for(z>>>=0,Y/=2,qe.length=Y,V=re>>>0>>>3,re=0;re<Y;re++)qe[re]=Q[V+2*re]?Q[V+2*re+1]:Pe()[V+2*re+1>>>0];return(z?De[z]:bc[M])(...qe)}var gt=()=>{it=0};function bt(M){M>>>=0,u?postMessage({Bb:"cleanupThread",hc:M}):Mn(Ht[M])}function pt(M){}var Xt=(M,z)=>{var V=ra[M];if(V===void 0)throw M=pl(M),V=nn(M),Is(M),new _t(`${z} has unknown type ${V}`);return V},jt=(M,z,V)=>{var Y=[];return M=M.toWireType(Y,V),Y.length&&(ce()[z>>>2>>>0]=ha(Y)),M};function qn(M,z,V){return z>>>=0,V>>>=0,M=Zn(M>>>0),z=Xt(z,"emval::as"),jt(z,V,M)}function ga(M,z){return z>>>=0,M=Zn(M>>>0),(z=Xt(z,"emval::as")).toWireType(null,M)}var Tn=M=>{try{M()}catch(z){Ue(z)}},Dn=0,An=null,rs=0,Os=[],pa={},Ba={},Vn=0,Jn=null,ea=[];function ds(M){return(function(z){if(!ie){if(Dn===0){var V=!1,Y=!1;z((re=0)=>{if(!ie&&(rs=re,V=!0,Y)){Dn=2,Tn(()=>gl(An)),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.resume(),re=!1;try{var be=(function(){var yt=B()[An+8>>>2>>>0];return yt=Pt[Ba[yt]],--it,yt()})()}catch(yt){be=yt,re=!0}var We=!1;if(!An){var rt=Jn;rt&&(Jn=null,(re?rt.reject:rt.resolve)(be),We=!0)}if(re&&!We)throw be}}),Y=!0,V||(Dn=1,An=(function(){var re=ho(65548),be=re+12;ce()[re>>>2>>>0]=be,ce()[re+4>>>2>>>0]=be+65536,be=Os[0];var We=pa[be];return We===void 0&&(We=Vn++,pa[be]=We,Ba[We]=be),be=We,B()[re+8>>>2>>>0]=be,re})(),typeof MainLoop<"u"&&MainLoop.Pb&&MainLoop.pause(),Tn(()=>Mr(An)))}else Dn===2?(Dn=0,Tn(Gs),Is(An),An=null,ea.forEach(oe)):Ue(`invalid state: ${Dn}`);return rs}})(z=>{M().then(z)})}function ys(M){return M>>>=0,ds(async()=>{var z=await Zn(M);return ha(z)})}var xa=[];function fs(M,z,V,Y){return V>>>=0,Y>>>=0,(M=xa[M>>>0])(null,z=Zn(z>>>0),V,Y)}var ma={},Kn=M=>{var z=ma[M];return z===void 0?nn(M):z};function gn(M,z,V,Y,re){return V>>>=0,Y>>>=0,re>>>=0,(M=xa[M>>>0])(z=Zn(z>>>0),z[V=Kn(V)],Y,re)}var On=()=>typeof globalThis=="object"?globalThis:Function("return this")();function qa(M){return(M>>>=0)==0?ha(On()):(M=Kn(M),ha(On()[M]))}var Vs=M=>{var z=xa.length;return xa.push(M),z},br=(M,z)=>{for(var V=Array(M),Y=0;Y<M;++Y)V[Y]=Xt(ce()[z+4*Y>>>2>>>0],"parameter "+Y);return V},so=(M,z)=>Object.defineProperty(z,"name",{value:M});function tl(M,z,V){var Y=(z=br(M,z>>>0)).shift();M--;var re=`return function (obj, func, destructorsRef, args) {
`,be=0,We=[];V===0&&We.push("obj");for(var rt=["retType"],yt=[Y],Ct=0;Ct<M;++Ct)We.push("arg"+Ct),rt.push("argType"+Ct),yt.push(z[Ct]),re+=`  var arg${Ct} = argType${Ct}.readValueFromPointer(args${be?"+"+be:""});
`,be+=z[Ct].Cb;return re+=`  var rv = ${V===1?"new func":"func.call"}(${We.join(", ")});
`,Y.Tb||(rt.push("emval_returnValue"),yt.push(jt),re+=`  return emval_returnValue(retType, destructorsRef, rv);
`),rt.push(re+`};
`),M=(function(Kt){var dn=Function;if(!(dn instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof dn} which is not a function`);var vn=so(dn.name||"unknownFunctionName",function(){});return vn.prototype=dn.prototype,vn=new vn,(Kt=dn.apply(vn,Kt))instanceof Object?Kt:vn})(rt)(...yt),V=`methodCaller<(${z.map(Kt=>Kt.name).join(", ")}) => ${Y.name}>`,Vs(so(V,M))}function xi(M){return M=Kn(M>>>0),ha(s[M])}function ro(M,z){return z>>>=0,M=Zn(M>>>0),z=Zn(z),ha(M[z])}function dc(M){9<(M>>>=0)&&(Ga[M+1]+=1)}function Ti(){return ha([])}function Du(M){M=Zn(M>>>0);for(var z=Array(M.length),V=0;V<M.length;V++)z[V]=M[V];return ha(z)}function Ou(M){return ha(Kn(M>>>0))}function nl(){return ha({})}function Iu(M){for(var z=Zn(M>>>=0);z.length;){var V=z.pop();z.pop()(V)}Wa(M)}function zu(M,z,V){z>>>=0,V>>>=0,M=Zn(M>>>0),z=Zn(z),V=Zn(V),M[z]=V}function Ei(M,z){return z>>>=0,M=(M=Xt(M>>>0,"_emval_take_value")).readValueFromPointer(z),ha(M)}function Lu(M,z){M=-9007199254740992>M||9007199254740992<M?NaN:Number(M),z>>>=0,M=new Date(1e3*M),B()[z>>>2>>>0]=M.getUTCSeconds(),B()[z+4>>>2>>>0]=M.getUTCMinutes(),B()[z+8>>>2>>>0]=M.getUTCHours(),B()[z+12>>>2>>>0]=M.getUTCDate(),B()[z+16>>>2>>>0]=M.getUTCMonth(),B()[z+20>>>2>>>0]=M.getUTCFullYear()-1900,B()[z+24>>>2>>>0]=M.getUTCDay(),M=(M.getTime()-Date.UTC(M.getUTCFullYear(),0,1,0,0,0,0))/864e5|0,B()[z+28>>>2>>>0]=M}var fc=M=>M%4==0&&(M%100!=0||M%400==0),al=[0,31,60,91,121,152,182,213,244,274,305,335],hc=[0,31,59,90,120,151,181,212,243,273,304,334];function Fu(M,z){M=-9007199254740992>M||9007199254740992<M?NaN:Number(M),z>>>=0,M=new Date(1e3*M),B()[z>>>2>>>0]=M.getSeconds(),B()[z+4>>>2>>>0]=M.getMinutes(),B()[z+8>>>2>>>0]=M.getHours(),B()[z+12>>>2>>>0]=M.getDate(),B()[z+16>>>2>>>0]=M.getMonth(),B()[z+20>>>2>>>0]=M.getFullYear()-1900,B()[z+24>>>2>>>0]=M.getDay();var V=(fc(M.getFullYear())?al:hc)[M.getMonth()]+M.getDate()-1|0;B()[z+28>>>2>>>0]=V,B()[z+36>>>2>>>0]=-60*M.getTimezoneOffset(),V=new Date(M.getFullYear(),6,1).getTimezoneOffset();var Y=new Date(M.getFullYear(),0,1).getTimezoneOffset();M=0|(V!=Y&&M.getTimezoneOffset()==Math.min(Y,V)),B()[z+32>>>2>>>0]=M}function pc(M){M>>>=0;var z=new Date(B()[M+20>>>2>>>0]+1900,B()[M+16>>>2>>>0],B()[M+12>>>2>>>0],B()[M+8>>>2>>>0],B()[M+4>>>2>>>0],B()[M>>>2>>>0],0),V=B()[M+32>>>2>>>0],Y=z.getTimezoneOffset(),re=new Date(z.getFullYear(),6,1).getTimezoneOffset(),be=new Date(z.getFullYear(),0,1).getTimezoneOffset(),We=Math.min(be,re);return 0>V?B()[M+32>>>2>>>0]=+(re!=be&&We==Y):0<V!=(We==Y)&&(re=Math.max(be,re),z.setTime(z.getTime()+6e4*((0<V?We:re)-Y))),B()[M+24>>>2>>>0]=z.getDay(),V=(fc(z.getFullYear())?al:hc)[z.getMonth()]+z.getDate()-1|0,B()[M+28>>>2>>>0]=V,B()[M>>>2>>>0]=z.getSeconds(),B()[M+4>>>2>>>0]=z.getMinutes(),B()[M+8>>>2>>>0]=z.getHours(),B()[M+12>>>2>>>0]=z.getDate(),B()[M+16>>>2>>>0]=z.getMonth(),B()[M+20>>>2>>>0]=z.getYear(),M=z.getTime(),BigInt(isNaN(M)?-1:M/1e3)}function mc(M,z,V,Y,re,be,We){return u?Mt(16,1,M,z,V,Y,re,be,We):-52}function io(M,z,V,Y,re,be){if(u)return Mt(17,1,M,z,V,Y,re,be)}var Wr={},Nu=()=>performance.timeOrigin+performance.now();function sl(M,z){if(u)return Mt(18,1,M,z);if(Wr[M]&&(clearTimeout(Wr[M].id),delete Wr[M]),!z)return 0;var V=setTimeout(()=>{delete Wr[M],oe(()=>ml(M,performance.timeOrigin+performance.now()))},z);return Wr[M]={id:V,qc:z},0}function _c(M,z,V,Y){M>>>=0,z>>>=0,V>>>=0,Y>>>=0;var re=new Date().getFullYear(),be=new Date(re,0,1).getTimezoneOffset();re=new Date(re,6,1).getTimezoneOffset();var We=Math.max(be,re);ce()[M>>>2>>>0]=60*We,B()[z>>>2>>>0]=+(be!=re),M=(z=rt=>{var yt=Math.abs(rt);return`UTC${0<=rt?"-":"+"}${String(Math.floor(yt/60)).padStart(2,"0")}${String(yt%60).padStart(2,"0")}`})(be),z=z(re),re<be?(qt(M,V,17),qt(z,Y,17)):(qt(M,Y,17),qt(z,V,17))}var gc=()=>Date.now();function Sf(M,z,V){return 0<=M&&3>=M?(M===0?M=Date.now():M=performance.timeOrigin+performance.now(),Q[V>>>0>>>3]=BigInt(Math.round(1e6*M)),0):28}var rl=[],il=(M,z)=>{rl.length=0;for(var V;V=U()[M++>>>0];){var Y=V!=105;z+=(Y&=V!=112)&&z%8?4:0,rl.push(V==112?ce()[z>>>2>>>0]:V==106?Q[z>>>3]:V==105?B()[z>>>2>>>0]:Pe()[z>>>3>>>0]),z+=Y?8:4}return rl};function yc(M,z,V){return M>>>=0,z=il(z>>>0,V>>>0),De[M](...z)}function ol(M,z,V){return M>>>=0,z=il(z>>>0,V>>>0),De[M](...z)}var ju=()=>{};function Ru(M,z){return $(Fn(M>>>0,z>>>0))}var Bu=()=>{throw it+=1,"unwind"};function ll(){return 4294901760}var Si=()=>navigator.hardwareConcurrency;function Uu(){return Ue("Cannot use emscripten_pc_get_function without -sUSE_OFFSET_CONVERTER"),0}function cl(M){M>>>=0;var z=U().length;if(M<=z||4294901760<M)return!1;for(var V=1;4>=V;V*=2){var Y=z*(1+.2/V);Y=Math.min(Y,M+100663296);e:{Y=(Math.min(4294901760,65536*Math.ceil(Math.max(M,Y)/65536))-w.buffer.byteLength+65535)/65536|0;try{w.grow(Y),Re();var re=1;break e}catch{}re=void 0}if(re)return!0}return!1}var Ci=()=>(Ue("Cannot use convertFrameToPC (needed by __builtin_return_address) without -sUSE_OFFSET_CONVERTER"),0),Hr={},oo=M=>{M.forEach(z=>{Ci()})};function vc(){var M=Error().stack.toString().split(`
`);return M[0]=="Error"&&M.shift(),oo(M),Hr.Lb=Ci(),Hr.cc=M,Hr.Lb}function er(M,z,V){if(M>>>=0,z>>>=0,Hr.Lb==M)var Y=Hr.cc;else(Y=Error().stack.toString().split(`
`))[0]=="Error"&&Y.shift(),oo(Y);for(var re=3;Y[re]&&Ci()!=M;)++re;for(M=0;M<V&&Y[M+re];++M)B()[z+4*M>>>2>>>0]=Ci();return M}var lo,ul={},dl=()=>{if(!lo){var M,z={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"};for(M in ul)ul[M]===void 0?delete z[M]:z[M]=ul[M];var V=[];for(M in z)V.push(`${M}=${z[M]}`);lo=V}return lo};function tr(M,z){if(u)return Mt(19,1,M,z);M>>>=0,z>>>=0;var V=0;return dl().forEach((Y,re)=>{var be=z+V;for(re=ce()[M+4*re>>>2>>>0]=be,be=0;be<Y.length;++be)_e()[re++>>>0]=Y.charCodeAt(be);_e()[re>>>0]=0,V+=Y.length+1}),0}function fl(M,z){if(u)return Mt(20,1,M,z);M>>>=0,z>>>=0;var V=dl();ce()[M>>>2>>>0]=V.length;var Y=0;return V.forEach(re=>Y+=re.length+1),ce()[z>>>2>>>0]=Y,0}function Ai(M){return u?Mt(21,1,M):52}function qr(M,z,V,Y){return u?Mt(22,1,M,z,V,Y):52}function Vu(M,z,V,Y){return u?Mt(23,1,M,z,V,Y):70}var co=[null,[],[]];function uo(M,z,V,Y){if(u)return Mt(24,1,M,z,V,Y);z>>>=0,V>>>=0,Y>>>=0;for(var re=0,be=0;be<V;be++){var We=ce()[z>>>2>>>0],rt=ce()[z+4>>>2>>>0];z+=8;for(var yt=0;yt<rt;yt++){var Ct=U()[We+yt>>>0],Kt=co[M];Ct===0||Ct===10?((M===1?S:$)(Ft(Kt)),Kt.length=0):Kt.push(Ct)}re+=rt}return ce()[Y>>>2>>>0]=re,0}u||(function(){for(var M=s.numThreads-1;M--;)ss();Ye.unshift(()=>{Ce++,(function(z){u?z():Promise.all(St.map(Jt)).then(z)})(()=>Be())})})();for(var hl=Array(256),Kr=0;256>Kr;++Kr)hl[Kr]=String.fromCharCode(Kr);Rt=hl,_t=s.BindingError=class extends Error{constructor(M){super(M),this.name="BindingError"}},s.InternalError=class extends Error{constructor(M){super(M),this.name="InternalError"}},Ga.push(0,1,void 0,1,null,1,!0,1,!1,1),s.count_emval_handles=()=>Ga.length/2-5-Va.length;var Pt,bc=[wt,ot,wa,Ys,Us,Zs,F,ue,ne,le,fe,xe,Ne,ut,xt,ht,mc,io,sl,tr,fl,Ai,qr,Vu,uo];(async function(){function M(Y,re){return Pt=Y.exports,Pt=(function(){var be=Pt,We={};for(let[rt,yt]of Object.entries(be))We[rt]=typeof yt=="function"?(...Ct)=>{Os.push(rt);try{return yt(...Ct)}finally{ie||(Os.pop(),An&&Dn===1&&Os.length===0&&(Dn=0,it+=1,Tn(vo),typeof Fibers<"u"&&Fibers.rc()))}}:yt;return We})(),Pt=(function(){var be=Pt,We=yt=>Ct=>yt(Ct)>>>0,rt=yt=>()=>yt()>>>0;return(be=Object.assign({},be)).Da=We(be.Da),be.fb=rt(be.fb),be.hb=We(be.hb),be.tb=We(be.tb),be.ub=rt(be.ub),be.__cxa_get_exception_ptr=We(be.__cxa_get_exception_ptr),be})(),wn.push(Pt.ib),C=re,Be(),Pt}Ce++;var z=He();if(s.instantiateWasm)return new Promise(Y=>{s.instantiateWasm(z,(re,be)=>{M(re,be),Y(re.exports)})});if(u)return new Promise(Y=>{ze=re=>{var be=new WebAssembly.Instance(re,He());Y(M(be,re))}});J??=s.locateFile?s.locateFile?s.locateFile("ort-wasm-simd-threaded.jsep.wasm",T):T+"ort-wasm-simd-threaded.jsep.wasm":new URL("/QalqanAI/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href;try{var V=await(async function(Y){var re=J;if(!ee&&typeof WebAssembly.instantiateStreaming=="function"&&!he(re))try{var be=fetch(re,{credentials:"same-origin"});return await WebAssembly.instantiateStreaming(be,Y)}catch(We){$(`wasm streaming compile failed: ${We}`),$("falling back to ArrayBuffer instantiation")}return(async function(We,rt){try{var yt=await(async function(Ct){if(!ee)try{var Kt=await _(Ct);return new Uint8Array(Kt)}catch{}if(Ct==J&&ee)Ct=new Uint8Array(ee);else{if(!p)throw"both async and sync fetching of the wasm failed";Ct=p(Ct)}return Ct})(We);return await WebAssembly.instantiate(yt,rt)}catch(Ct){$(`failed to asynchronously prepare wasm: ${Ct}`),Ue(Ct)}})(re,Y)})(z);return M(V.instance,V.module)}catch(Y){return t(Y),Promise.reject(Y)}})();var pl=M=>(pl=Pt.Da)(M),Pi=()=>(Pi=Pt.Ea)();s._OrtInit=(M,z)=>(s._OrtInit=Pt.Fa)(M,z),s._OrtGetLastError=(M,z)=>(s._OrtGetLastError=Pt.Ga)(M,z),s._OrtCreateSessionOptions=(M,z,V,Y,re,be,We,rt,yt,Ct)=>(s._OrtCreateSessionOptions=Pt.Ha)(M,z,V,Y,re,be,We,rt,yt,Ct),s._OrtAppendExecutionProvider=(M,z,V,Y,re)=>(s._OrtAppendExecutionProvider=Pt.Ia)(M,z,V,Y,re),s._OrtAddFreeDimensionOverride=(M,z,V)=>(s._OrtAddFreeDimensionOverride=Pt.Ja)(M,z,V),s._OrtAddSessionConfigEntry=(M,z,V)=>(s._OrtAddSessionConfigEntry=Pt.Ka)(M,z,V),s._OrtReleaseSessionOptions=M=>(s._OrtReleaseSessionOptions=Pt.La)(M),s._OrtCreateSession=(M,z,V)=>(s._OrtCreateSession=Pt.Ma)(M,z,V),s._OrtReleaseSession=M=>(s._OrtReleaseSession=Pt.Na)(M),s._OrtGetInputOutputCount=(M,z,V)=>(s._OrtGetInputOutputCount=Pt.Oa)(M,z,V),s._OrtGetInputOutputMetadata=(M,z,V,Y)=>(s._OrtGetInputOutputMetadata=Pt.Pa)(M,z,V,Y),s._OrtFree=M=>(s._OrtFree=Pt.Qa)(M),s._OrtCreateTensor=(M,z,V,Y,re,be)=>(s._OrtCreateTensor=Pt.Ra)(M,z,V,Y,re,be),s._OrtGetTensorData=(M,z,V,Y,re)=>(s._OrtGetTensorData=Pt.Sa)(M,z,V,Y,re),s._OrtReleaseTensor=M=>(s._OrtReleaseTensor=Pt.Ta)(M),s._OrtCreateRunOptions=(M,z,V,Y)=>(s._OrtCreateRunOptions=Pt.Ua)(M,z,V,Y),s._OrtAddRunConfigEntry=(M,z,V)=>(s._OrtAddRunConfigEntry=Pt.Va)(M,z,V),s._OrtReleaseRunOptions=M=>(s._OrtReleaseRunOptions=Pt.Wa)(M),s._OrtCreateBinding=M=>(s._OrtCreateBinding=Pt.Xa)(M),s._OrtBindInput=(M,z,V)=>(s._OrtBindInput=Pt.Ya)(M,z,V),s._OrtBindOutput=(M,z,V,Y)=>(s._OrtBindOutput=Pt.Za)(M,z,V,Y),s._OrtClearBoundOutputs=M=>(s._OrtClearBoundOutputs=Pt._a)(M),s._OrtReleaseBinding=M=>(s._OrtReleaseBinding=Pt.$a)(M),s._OrtRunWithBinding=(M,z,V,Y,re)=>(s._OrtRunWithBinding=Pt.ab)(M,z,V,Y,re),s._OrtRun=(M,z,V,Y,re,be,We,rt)=>(s._OrtRun=Pt.bb)(M,z,V,Y,re,be,We,rt),s._OrtEndProfiling=M=>(s._OrtEndProfiling=Pt.cb)(M),s._JsepOutput=(M,z,V)=>(s._JsepOutput=Pt.db)(M,z,V),s._JsepGetNodeName=M=>(s._JsepGetNodeName=Pt.eb)(M);var fo=()=>(fo=Pt.fb)(),Is=s._free=M=>(Is=s._free=Pt.gb)(M),ho=s._malloc=M=>(ho=s._malloc=Pt.hb)(M),po=(M,z,V,Y,re,be)=>(po=Pt.kb)(M,z,V,Y,re,be),wc=()=>(wc=Pt.lb)(),Za=(M,z,V,Y,re)=>(Za=Pt.mb)(M,z,V,Y,re),wr=M=>(wr=Pt.nb)(M),mo=M=>(mo=Pt.ob)(M),ml=(M,z)=>(ml=Pt.pb)(M,z),_o=()=>(_o=Pt.qb)(),_l=(M,z)=>(_l=Pt.rb)(M,z),Qr=M=>(Qr=Pt.sb)(M),go=M=>(go=Pt.tb)(M),nr=()=>(nr=Pt.ub)(),yo=s.dynCall_ii=(M,z)=>(yo=s.dynCall_ii=Pt.vb)(M,z),Mr=M=>(Mr=Pt.wb)(M),vo=()=>(vo=Pt.xb)(),gl=M=>(gl=Pt.yb)(M),Gs=()=>(Gs=Pt.zb)();return s.stackSave=()=>nr(),s.stackRestore=M=>Qr(M),s.stackAlloc=M=>go(M),s.setValue=function(M,z,V="i8"){switch(V.endsWith("*")&&(V="*"),V){case"i1":case"i8":_e()[M>>>0]=z;break;case"i16":K()[M>>>1>>>0]=z;break;case"i32":B()[M>>>2>>>0]=z;break;case"i64":Q[M>>>3]=BigInt(z);break;case"float":ve()[M>>>2>>>0]=z;break;case"double":Pe()[M>>>3>>>0]=z;break;case"*":ce()[M>>>2>>>0]=z;break;default:Ue(`invalid type for setValue: ${V}`)}},s.getValue=function(M,z="i8"){switch(z.endsWith("*")&&(z="*"),z){case"i1":case"i8":return _e()[M>>>0];case"i16":return K()[M>>>1>>>0];case"i32":return B()[M>>>2>>>0];case"i64":return Q[M>>>3];case"float":return ve()[M>>>2>>>0];case"double":return Pe()[M>>>3>>>0];case"*":return ce()[M>>>2>>>0];default:Ue(`invalid type for getValue: ${z}`)}},s.UTF8ToString=Fn,s.stringToUTF8=qt,s.lengthBytesUTF8=Ua,(function M(){if(0<Ce)Fe=M;else if(u)n(s),de();else{for(;0<Ye.length;)Ye.shift()(s);0<Ce?Fe=M:(s.calledRun=!0,ie||(de(),n(s)))}})(),s.PTR_SIZE=4,i}),OT=ly,Eb=globalThis.self?.name?.startsWith("em-pthread"),Eb&&ly()}),cy,_0,Sb,_r,IT,b_,Cb,Ab,uy,Pb,dy,zT,fy,LT,J0=ct(()=>{Z0(),cy=typeof location>"u"?void 0:location.origin,_0=import.meta.url>"file:"&&import.meta.url<"file;",Sb=()=>{{if(_0){let e=URL;return new URL(new e("ort.bundle.min.mjs",import.meta.url).href,cy).href}return import.meta.url}},_r=Sb(),IT=()=>{if(_r&&!_r.startsWith("blob:"))return _r.substring(0,_r.lastIndexOf("/")+1)},b_=(e,n)=>{try{let t=n??_r;return(t?new URL(e,t):new URL(e)).origin===cy}catch{return!1}},Cb=(e,n)=>{let t=n??_r;try{return(t?new URL(e,t):new URL(e)).href}catch{return}},Ab=(e,n)=>`${n??"./"}${e}`,uy=async e=>{let n=await(await fetch(e,{credentials:"same-origin"})).blob();return URL.createObjectURL(n)},Pb=async e=>(await import(e)).default,dy=(j$(),hm(kT)).default,zT=async()=>{if(!_r)throw new Error("Failed to load proxy worker: cannot determine the script source URL.");if(b_(_r))return[void 0,dy()];let e=await uy(_r);return[e,dy(e)]},fy=(R$(),hm(DT)).default,LT=async(e,n,t)=>{if(!e&&!n&&fy&&_r&&b_(_r))return[void 0,fy];{let s="ort-wasm-simd-threaded.jsep.mjs",i=e??Cb(s,n),l=t&&i&&!b_(i,n),c=l?await uy(i):i??Ab(s,n);return[l?c:void 0,await Pb(c)]}}}),hy,w_,Gp,py,kb,$b,Db,ev,aa,ku=ct(()=>{J0(),w_=!1,Gp=!1,py=!1,kb=()=>{if(typeof SharedArrayBuffer>"u")return!1;try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]))}catch{return!1}},$b=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,30,1,28,0,65,0,253,15,253,12,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,253,186,1,26,11]))}catch{return!1}},Db=()=>{try{return WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,19,1,17,0,65,1,253,15,65,2,253,15,65,3,253,15,253,147,2,11]))}catch{return!1}},ev=async e=>{if(w_)return Promise.resolve();if(Gp)throw new Error("multiple calls to 'initializeWebAssembly()' detected.");if(py)throw new Error("previous call to 'initializeWebAssembly()' failed.");Gp=!0;let n=e.initTimeout,t=e.numThreads;if(e.simd!==!1){if(e.simd==="relaxed"){if(!Db())throw new Error("Relaxed WebAssembly SIMD is not supported in the current environment.")}else if(!$b())throw new Error("WebAssembly SIMD is not supported in the current environment.")}let s=kb();t>1&&!s&&(typeof self<"u"&&!self.crossOriginIsolated&&console.warn("env.wasm.numThreads is set to "+t+", but this will not work unless you enable crossOriginIsolated mode. See https://web.dev/cross-origin-isolation-guide/ for more info."),console.warn("WebAssembly multi-threading is not supported in the current environment. Falling back to single-threading."),e.numThreads=t=1);let i=e.wasmPaths,l=typeof i=="string"?i:void 0,c=i?.mjs,u=c?.href??c,d=i?.wasm,f=d?.href??d,m=e.wasmBinary,[_,p]=await LT(u,l,t>1),y=!1,v=[];if(n>0&&v.push(new Promise(T=>{setTimeout(()=>{y=!0,T()},n)})),v.push(new Promise((T,k)=>{let b={numThreads:t};if(m)b.wasmBinary=m;else if(f||l)b.locateFile=S=>f??l+S;else if(u&&u.indexOf("blob:")!==0)b.locateFile=S=>new URL(S,u).href;else if(_){let S=IT();S&&(b.locateFile=$=>S+$)}p(b).then(S=>{Gp=!1,w_=!0,hy=S,T(),_&&URL.revokeObjectURL(_)},S=>{Gp=!1,py=!0,k(S)})})),await Promise.race(v),y)throw new Error(`WebAssembly backend initializing failed due to timeout: ${n}ms`)},aa=()=>{if(w_&&hy)return hy;throw new Error("WebAssembly is not initialized yet.")}}),hi,tg,Un,tv=ct(()=>{ku(),hi=(e,n)=>{let t=aa(),s=t.lengthBytesUTF8(e)+1,i=t._malloc(s);return t.stringToUTF8(e,i,s),n.push(i),i},tg=(e,n,t,s)=>{if(typeof e=="object"&&e!==null){if(t.has(e))throw new Error("Circular reference in options");t.add(e)}Object.entries(e).forEach(([i,l])=>{let c=n?n+i:i;if(typeof l=="object")tg(l,c+".",t,s);else if(typeof l=="string"||typeof l=="number")s(c,l.toString());else if(typeof l=="boolean")s(c,l?"1":"0");else throw new Error(`Can't handle extra config type: ${typeof l}`)})},Un=e=>{let n=aa(),t=n.stackSave();try{let s=n.PTR_SIZE,i=n.stackAlloc(2*s);n._OrtGetLastError(i,i+s);let l=Number(n.getValue(i,s===4?"i32":"i64")),c=n.getValue(i+s,"*"),u=c?n.UTF8ToString(c):"";throw new Error(`${e} ERROR_CODE: ${l}, ERROR_MESSAGE: ${u}`)}finally{n.stackRestore(t)}}}),FT,B$=ct(()=>{ku(),tv(),FT=e=>{let n=aa(),t=0,s=[],i=e||{};try{if(e?.logSeverityLevel===void 0)i.logSeverityLevel=2;else if(typeof e.logSeverityLevel!="number"||!Number.isInteger(e.logSeverityLevel)||e.logSeverityLevel<0||e.logSeverityLevel>4)throw new Error(`log serverity level is not valid: ${e.logSeverityLevel}`);if(e?.logVerbosityLevel===void 0)i.logVerbosityLevel=0;else if(typeof e.logVerbosityLevel!="number"||!Number.isInteger(e.logVerbosityLevel))throw new Error(`log verbosity level is not valid: ${e.logVerbosityLevel}`);e?.terminate===void 0&&(i.terminate=!1);let l=0;return e?.tag!==void 0&&(l=hi(e.tag,s)),t=n._OrtCreateRunOptions(i.logSeverityLevel,i.logVerbosityLevel,!!i.terminate,l),t===0&&Un("Can't create run options."),e?.extra!==void 0&&tg(e.extra,"",new WeakSet,(c,u)=>{let d=hi(c,s),f=hi(u,s);n._OrtAddRunConfigEntry(t,d,f)!==0&&Un(`Can't set a run config entry: ${c} - ${u}.`)}),[t,s]}catch(l){throw t!==0&&n._OrtReleaseRunOptions(t),s.forEach(c=>n._free(c)),l}}}),Ob,Ib,zb,Wp,Lb,NT,U$=ct(()=>{ku(),tv(),Ob=e=>{switch(e){case"disabled":return 0;case"basic":return 1;case"extended":return 2;case"all":return 99;default:throw new Error(`unsupported graph optimization level: ${e}`)}},Ib=e=>{switch(e){case"sequential":return 0;case"parallel":return 1;default:throw new Error(`unsupported execution mode: ${e}`)}},zb=e=>{e.extra||(e.extra={}),e.extra.session||(e.extra.session={});let n=e.extra.session;n.use_ort_model_bytes_directly||(n.use_ort_model_bytes_directly="1"),e.executionProviders&&e.executionProviders.some(t=>(typeof t=="string"?t:t.name)==="webgpu")&&(e.enableMemPattern=!1)},Wp=(e,n,t,s)=>{let i=hi(n,s),l=hi(t,s);aa()._OrtAddSessionConfigEntry(e,i,l)!==0&&Un(`Can't set a session config entry: ${n} - ${t}.`)},Lb=async(e,n,t)=>{for(let s of n){let i=typeof s=="string"?s:s.name,l=[];switch(i){case"webnn":if(i="WEBNN",typeof s!="string"){let m=s?.deviceType;m&&Wp(e,"deviceType",m,t)}break;case"webgpu":if(i="JS",typeof s!="string"){let m=s;if(m?.preferredLayout){if(m.preferredLayout!=="NCHW"&&m.preferredLayout!=="NHWC")throw new Error(`preferredLayout must be either 'NCHW' or 'NHWC': ${m.preferredLayout}`);Wp(e,"preferredLayout",m.preferredLayout,t)}}break;case"wasm":case"cpu":continue;default:throw new Error(`not supported execution provider: ${i}`)}let c=hi(i,t),u=l.length,d=0,f=0;if(u>0){d=aa()._malloc(u*aa().PTR_SIZE),t.push(d),f=aa()._malloc(u*aa().PTR_SIZE),t.push(f);for(let m=0;m<u;m++)aa().setValue(d+m*aa().PTR_SIZE,l[m][0],"*"),aa().setValue(f+m*aa().PTR_SIZE,l[m][1],"*")}await aa()._OrtAppendExecutionProvider(e,c,d,f,u)!==0&&Un(`Can't append execution provider: ${i}.`)}},NT=async e=>{let n=aa(),t=0,s=[],i=e||{};zb(i);try{let l=Ob(i.graphOptimizationLevel??"all"),c=Ib(i.executionMode??"sequential"),u=typeof i.logId=="string"?hi(i.logId,s):0,d=i.logSeverityLevel??2;if(!Number.isInteger(d)||d<0||d>4)throw new Error(`log serverity level is not valid: ${d}`);let f=i.logVerbosityLevel??0;if(!Number.isInteger(f)||f<0||f>4)throw new Error(`log verbosity level is not valid: ${f}`);let m=typeof i.optimizedModelFilePath=="string"?hi(i.optimizedModelFilePath,s):0;if(t=n._OrtCreateSessionOptions(l,!!i.enableCpuMemArena,!!i.enableMemPattern,c,!!i.enableProfiling,0,u,d,f,m),t===0&&Un("Can't create session options."),i.executionProviders&&await Lb(t,i.executionProviders,s),i.enableGraphCapture!==void 0){if(typeof i.enableGraphCapture!="boolean")throw new Error(`enableGraphCapture must be a boolean value: ${i.enableGraphCapture}`);Wp(t,"enableGraphCapture",i.enableGraphCapture.toString(),s)}if(i.freeDimensionOverrides)for(let[_,p]of Object.entries(i.freeDimensionOverrides)){if(typeof _!="string")throw new Error(`free dimension override name must be a string: ${_}`);if(typeof p!="number"||!Number.isInteger(p)||p<0)throw new Error(`free dimension override value must be a non-negative integer: ${p}`);let y=hi(_,s);n._OrtAddFreeDimensionOverride(t,y,p)!==0&&Un(`Can't set a free dimension override: ${_} - ${p}.`)}return i.extra!==void 0&&tg(i.extra,"",new WeakSet,(_,p)=>{Wp(t,_,p,s)}),[t,s]}catch(l){throw t!==0&&n._OrtReleaseSessionOptions(t)!==0&&Un("Can't release session options."),s.forEach(c=>n._free(c)),l}}}),mf,qo,vu,nv,ng,av,sv,g0,Wt=ct(()=>{mf=e=>{switch(e){case"int8":return 3;case"uint8":return 2;case"bool":return 9;case"int16":return 5;case"uint16":return 4;case"int32":return 6;case"uint32":return 12;case"float16":return 10;case"float32":return 1;case"float64":return 11;case"string":return 8;case"int64":return 7;case"uint64":return 13;case"int4":return 22;case"uint4":return 21;default:throw new Error(`unsupported data type: ${e}`)}},qo=e=>{switch(e){case 3:return"int8";case 2:return"uint8";case 9:return"bool";case 5:return"int16";case 4:return"uint16";case 6:return"int32";case 12:return"uint32";case 10:return"float16";case 1:return"float32";case 11:return"float64";case 8:return"string";case 7:return"int64";case 13:return"uint64";case 22:return"int4";case 21:return"uint4";default:throw new Error(`unsupported data type: ${e}`)}},vu=(e,n)=>{let t=[-1,4,1,1,2,2,4,8,-1,1,2,8,4,8,-1,-1,-1,-1,-1,-1,-1,.5,.5][e],s=typeof n=="number"?n:n.reduce((i,l)=>i*l,1);return t>0?Math.ceil(s*t):void 0},nv=e=>{switch(e){case"float16":return typeof Float16Array<"u"&&Float16Array.from?Float16Array:Uint16Array;case"float32":return Float32Array;case"uint8":return Uint8Array;case"int8":return Int8Array;case"uint16":return Uint16Array;case"int16":return Int16Array;case"int32":return Int32Array;case"bool":return Uint8Array;case"float64":return Float64Array;case"uint32":return Uint32Array;case"int64":return BigInt64Array;case"uint64":return BigUint64Array;default:throw new Error(`unsupported type: ${e}`)}},ng=e=>{switch(e){case"verbose":return 0;case"info":return 1;case"warning":return 2;case"error":return 3;case"fatal":return 4;default:throw new Error(`unsupported logging level: ${e}`)}},av=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",sv=e=>e==="float32"||e==="float16"||e==="int32"||e==="int64"||e==="uint32"||e==="uint64"||e==="int8"||e==="uint8"||e==="bool"||e==="uint4"||e==="int4",g0=e=>{switch(e){case"none":return 0;case"cpu":return 1;case"cpu-pinned":return 2;case"texture":return 3;case"gpu-buffer":return 4;case"ml-tensor":return 5;default:throw new Error(`unsupported data location: ${e}`)}}}),rv,jT=ct(()=>{Z0(),rv=async e=>{if(typeof e=="string"){let n=await fetch(e);if(!n.ok)throw new Error(`failed to load external data file: ${e}`);let t=n.headers.get("Content-Length"),s=t?parseInt(t,10):0;if(s<1073741824)return new Uint8Array(await n.arrayBuffer());{if(!n.body)throw new Error(`failed to load external data file: ${e}, no response body.`);let i=n.body.getReader(),l;try{l=new ArrayBuffer(s)}catch(u){if(u instanceof RangeError){let d=Math.ceil(s/65536);l=new WebAssembly.Memory({initial:d,maximum:d}).buffer}else throw u}let c=0;for(;;){let{done:u,value:d}=await i.read();if(u)break;let f=d.byteLength;new Uint8Array(l,c,f).set(d),c+=f}return new Uint8Array(l,0,s)}}else return e instanceof Blob?new Uint8Array(await e.arrayBuffer()):e instanceof Uint8Array?e:new Uint8Array(e)}}),Fb,Nb,jb,Rb,iv,Bb,yn,el=ct(()=>{Wt(),Fb=["V","I","W","E","F"],Nb=(e,n)=>{console.log(`[${Fb[e]},${new Date().toISOString()}]${n}`)},iv=(e,n)=>{jb=e,Rb=n},Bb=(e,n)=>{let t=ng(e),s=ng(jb);t>=s&&Nb(t,typeof n=="function"?n():n)},yn=(...e)=>{Rb&&Bb(...e)}}),Ub,bf,je,ag,RT,BT,UT,en=ct(()=>{Ub=class{static calcMatMulShape(e,n){return e[1]!==n[0]?void 0:[e[0],n[1]]}},bf=class{static calcShape(e,n,t=!1){let s=e.length,i=n.length;if(s===0)return n;if(i===0)return e;let l=Math.max(e.length,n.length),c=new Array(l);if(t){if(s<2||i<2)return;let u=Ub.calcMatMulShape([e[s-2],e[s-1]],[n[i-2],n[i-1]]);if(u===void 0)return;[c[l-2],c[l-1]]=u}for(let u=t?3:1;u<=l;u++){let d=s-u<0?1:e[s-u],f=i-u<0?1:n[i-u];if(d!==f&&d>1&&f>1)return;let m=Math.max(d,f);if(d&&f)c[l-u]=Math.max(d,f);else{if(m>1)return;c[l-u]=0}}return c}static isValidBroadcast(e,n){let t=e.length,s=n.length;if(t>s)return!1;for(let i=1;i<=t;i++)if(e[t-i]!==1&&e[t-i]!==n[s-i])return!1;return!0}},je=class H_{static size(n){return H_.getSizeFromDimensionRange(n,0,n.length)}static convertShape(n,t=4){let s=n.length;if(s===0)return[];let i=new Array(s),l=s-1;for(;l>=0;){if(n[l]%t===0){i[l]=n[l]/t;break}if(t%n[l]!==0)throw new Error("cannot convert shape");i[l]=1,t/=n[l],l--}for(l--;l>=0;l--)i[l]=n[l];return i}static sizeFromDimension(n,t){if(t<0||t>n.length)throw new Error(`invalid dimension of ${t} for sizeFromDimension as Tensor has ${n.length} dimensions.`);return H_.getSizeFromDimensionRange(n,t,n.length)}static sizeToDimension(n,t){if(t<0||t>n.length)throw new Error(`invalid dimension of ${t} for sizeToDimension as Tensor has ${n.length} dimensions.`);return H_.getSizeFromDimensionRange(n,0,t)}static getSizeFromDimensionRange(n,t,s){let i=1;for(let l=t;l<s;l++){if(n[l]<0)throw new Error("cannot get valid size from specified dimension range. Most likely the range contains negative values in them.");i*=Number(n[l])}return i}static computeStrides(n){let t=n.length;if(t===0)return[];if(t===1)return[1];let s=new Array(t);s[t-1]=1,s[t-2]=n[t-1];for(let i=t-3;i>=0;--i)s[i]=s[i+1]*n[i+1];return s}static normalizeAxis(n,t){if(n<-t&&n>=t)throw new Error("unsupported axis for this operation.");return n<0?n+t:n}static normalizeAxes(n,t){return n.map(s=>this.normalizeAxis(s,t??n.length))}static sortBasedOnPerm(n,t){return t?t.map(s=>n[s]):n.slice().reverse()}static padShape(n,t){let s=n.length;return n.map((i,l)=>i+t[l]+t[l+s])}static areEqual(n,t){return n.length!==t.length?!1:n.every((s,i)=>s===t[i])}},ag=class sm{static adjustPoolAttributes(n,t,s,i,l,c){if(!n&&s.length!==t.length-2)throw new Error("length of specified kernel shapes should be 2 less than length of input dimensions");if(n)for(let u=0;u<t.length-2;u++)u>=s.length?s.push(t[u+2]):s[u]=t[u+2];for(let u=0;u<s.length;u++)if(u<i.length){if(i[u]<0)throw new Error("strides should be greater than or equal to 1")}else i.push(1);for(let u=0;u<s.length;u++)if(u<l.length){if(l[u]<0)throw new Error("dilations should be greater than or equal to 1")}else l.push(1);for(let u=0;u<s.length*2;u++)if(u<c.length){if(c[u]<0)throw new Error("pad should be greater than or equal to 1")}else c.push(0);for(let u=0;u<s.length;u++){if(s[u]<=0)throw new Error("kernel shapes need to be greater than 0");if(c[u]>=s[u]||c[u+s.length]>=s[u])throw new Error("pads should be smaller than kernel")}}static adjustPadsBasedOnAutoPad(n,t,s,i,l,c,u){if(u){if(l.length!==2*(n.length-2))throw new Error("length of pads should be twice the length of data dimensions");if(t.length!==n.length-2)throw new Error("length of strides should be the length of data dimensions");if(i.length!==n.length-2)throw new Error("length of kernel shapes should be the length of data dimensions");for(let d=0;d<n.length-2;d++)sm.adjustPadAndReturnShape(n[d+(c?1:2)],t[d],s[d],i[d],l,d,d+n.length-2,u)}}static computePoolOutputShape(n,t,s,i,l,c,u){if(t.length<=0)throw new Error("input shape must be of size greater than 0");let d=[t[0],t[1]];return sm.computeShapeHelper(n,t,d,s,i,l,c,u),d}static computeConvOutputShape(n,t,s,i,l,c,u){if(n.length<=0||t.length<=0)throw new Error("invalid input tensor dims or invalid filter tensor dims");let d=[n[0],t[0]];return sm.computeShapeHelper(!1,n,d,s,i,l,c,u),d}static computeShapeHelper(n,t,s,i,l,c,u,d){if(n)for(let f=0;f<t.length-2;f++)s.push(1);else for(let f=0;f<t.length-2;f++)s.push(sm.adjustPadAndReturnShape(t[f+2],i[f],l[f],c[f],u,f,f+t.length-2,d))}static adjustPadAndReturnShape(n,t,s,i,l,c,u,d){let f=s*(i-1)+1;if(d&&d!=="NOTSET")switch(d){case"VALID":return l[c]=0,l[u]=0,Math.floor((n-f)/t+1);case"SAME_LOWER":case"SAME_UPPER":if(s!==1)throw new Error("Dilation not supported for SAME_UPPER or SAME_LOWER");{let m=((n+t-1)/t-1)*t+i-n;return l[c]=Math.floor(d==="SAME_LOWER"?(m+1)/2:m/2),l[u]=m-l[c],Math.floor((n+m-i)/t+1)}default:throw new Error("Unsupported AutoPad type")}else return Math.floor((n+l[c]+l[u]-f)/t+1)}},RT=class{static getShapeOfGemmResult(e,n,t,s,i){if(e.length!==2||t.length!==2)throw new Error("shape need to be of size 2");let l,c,u;n?(l=e[1],c=e[0]):(l=e[0],c=e[1]);let d=-1;if(s?(u=t[0],d=1):(u=t[1],d=0),t[d]!==c)throw new Error("dimension mismatch");if(l<=0||u<=0||c<=0)throw new Error("invalid shape specified");if(i&&!bf.isValidBroadcast(i,[l,u]))throw new Error("gemm: invalid bias shape for broadcast");return[l,u,c]}},BT=-34028234663852886e22,UT=34028234663852886e22}),ov,VT=ct(()=>{Wt(),ov=(e,n)=>new(nv(n))(e)}),y0,my,Vb,_y,Gb,gy,yy,vy,Wb,GT,V$=ct(()=>{el(),y0=(e,n=!0)=>{if(e.byteLength%8!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 8 (BigInt).");let t=e.byteLength/8,s=new BigInt64Array(e.buffer,e.byteOffset,t),i=new Int32Array(t);for(let l=0;l<t;l++){let c=s[l];if(c>2147483647n||c<-2147483648n)throw new Error(`Overflow occurred when converting BigInt to Int32 at index ${l}: ${c}`);i[l]=Number(c)}return n?new Uint8Array(i.buffer):i},my=(e,n=!0)=>{if(e.byteLength%4!==0)throw new Error("Invalid Uint8Array length - must be a multiple of 4 (Int32).");let t=e.byteLength/4,s=new Int32Array(e.buffer,e.byteOffset,t),i=BigInt64Array.from(s,BigInt);return n?new Uint8Array(i.buffer):i},Vb=1,_y=()=>Vb++,Gb=new Map([["float32",32],["float16",16],["int32",32],["uint32",32],["int64",64],["uint64",64],["int8",8],["uint8",8],["int4",4],["uint4",4]]),gy=(e,n)=>{let t=Gb.get(e);if(!t)throw new Error("Unsupported data type.");return n.length>0?Math.ceil(n.reduce((s,i)=>s*i)*t/8):0},yy=class{constructor(e){this.shouldConvertInt64toInt32=!1,this.isInt64ToInt32Converted=!1;let{sessionId:n,context:t,tensor:s,dataType:i,shape:l,shouldConvertInt64toInt32:c=!1}=e;this.sessionId=n,this.mlContext=t,this.mlTensor=s,this.dataType=i,this.tensorShape=l,this.shouldConvertInt64toInt32=c}get tensor(){return this.mlTensor}get type(){return this.dataType}get shape(){return this.tensorShape}get byteLength(){return gy(this.dataType,this.tensorShape)}destroy(){yn("verbose",()=>"[WebNN] TensorWrapper.destroy"),this.mlTensor.destroy()}write(e){this.mlContext.writeTensor(this.mlTensor,e)}async read(e,n){if(e){let t=await this.mlContext.readTensor(this.mlTensor),s=my(new Uint8Array(t));if(n){(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)).set(s);return}else return s.buffer}else return n?this.mlContext.readTensor(this.mlTensor,n):this.mlContext.readTensor(this.mlTensor)}canReuseTensor(e,n,t){return this.mlContext===e&&this.dataType===n&&this.tensorShape.length===t.length&&this.tensorShape.every((s,i)=>s===t[i])}setIsInt64ToInt32Converted(e){this.isInt64ToInt32Converted=e}},vy=class{constructor(e,n){this.tensorManager=e,this.wrapper=n}get tensorWrapper(){return this.wrapper}releaseTensor(){this.tensorWrapper&&(this.tensorManager.releaseTensor(this.tensorWrapper),this.wrapper=void 0)}async ensureTensor(e,n,t,s){let i=n,l=this.tensorManager.getMLContext(e),c=i==="int64"&&!l.opSupportLimits().input.dataTypes.includes("int64");if(c&&(i="int32",yn("verbose",()=>"[WebNN] TensorIdTracker.ensureTensor: convert dataType from int64 to int32")),this.wrapper){if(this.wrapper.canReuseTensor(l,i,t))return this.wrapper.tensor;if(s){if(this.wrapper.byteLength!==gy(i,t))throw new Error("Unable to copy data to tensor with different size.");this.activeUpload=new Uint8Array(await this.wrapper.read())}this.tensorManager.releaseTensor(this.wrapper)}let u=typeof MLTensorUsage>"u"?void 0:MLTensorUsage.READ|MLTensorUsage.WRITE;return this.wrapper=await this.tensorManager.getCachedTensor(e,i,t,u,!0,!0,c),s&&this.activeUpload&&(this.wrapper.write(this.activeUpload),this.activeUpload=void 0),this.wrapper.tensor}upload(e){let n=e;if(this.wrapper)if(this.wrapper.shouldConvertInt64toInt32&&(n=y0(e,!0),this.wrapper.setIsInt64ToInt32Converted(!0)),n.byteLength===this.wrapper.byteLength){this.wrapper.write(n);return}else yn("verbose",()=>"Data size does not match tensor size. Releasing tensor."),this.releaseTensor();this.activeUpload?this.activeUpload.set(n):this.activeUpload=new Uint8Array(n)}async download(e){if(this.activeUpload){let n=this.wrapper?.isInt64ToInt32Converted?my(this.activeUpload):this.activeUpload;if(e){e instanceof ArrayBuffer?new Uint8Array(e).set(n):new Uint8Array(e.buffer,e.byteOffset,e.byteLength).set(n);return}else return n.buffer}if(!this.wrapper)throw new Error("Tensor has not been created.");return e?this.wrapper.read(this.wrapper?.shouldConvertInt64toInt32,e):this.wrapper.read(this.wrapper?.shouldConvertInt64toInt32)}},Wb=class{constructor(e){this.backend=e,this.tensorTrackersById=new Map,this.freeTensors=[],this.externalTensors=new Set}getMLContext(e){let n=this.backend.getMLContext(e);if(!n)throw new Error("MLContext not found for session.");return n}reserveTensorId(){let e=_y();return this.tensorTrackersById.set(e,new vy(this)),e}releaseTensorId(e){let n=this.tensorTrackersById.get(e);n&&(this.tensorTrackersById.delete(e),n.tensorWrapper&&this.releaseTensor(n.tensorWrapper))}async ensureTensor(e,n,t,s,i){yn("verbose",()=>`[WebNN] TensorManager.ensureTensor {tensorId: ${n}, dataType: ${t}, shape: ${s}, copyOld: ${i}}`);let l=this.tensorTrackersById.get(n);if(!l)throw new Error("Tensor not found.");return l.ensureTensor(e,t,s,i)}upload(e,n){let t=this.tensorTrackersById.get(e);if(!t)throw new Error("Tensor not found.");t.upload(n)}async download(e,n){yn("verbose",()=>`[WebNN] TensorManager.download {tensorId: ${e}, dstBuffer: ${n?.byteLength}}`);let t=this.tensorTrackersById.get(e);if(!t)throw new Error("Tensor not found.");return t.download(n)}releaseTensorsForSession(e){for(let n of this.freeTensors)n.sessionId===e&&n.destroy();this.freeTensors=this.freeTensors.filter(n=>n.sessionId!==e)}registerTensor(e,n,t,s){let i=this.getMLContext(e),l=_y(),c=new yy({sessionId:e,context:i,tensor:n,dataType:t,shape:s});return this.tensorTrackersById.set(l,new vy(this,c)),this.externalTensors.add(c),l}async getCachedTensor(e,n,t,s,i,l,c=!1){let u=this.getMLContext(e);for(let[f,m]of this.freeTensors.entries())if(m.canReuseTensor(u,n,t)){yn("verbose",()=>`[WebNN] Reusing tensor {dataType: ${n}, shape: ${t}}`);let _=this.freeTensors.splice(f,1)[0];return _.sessionId=e,_}yn("verbose",()=>`[WebNN] MLContext.createTensor {dataType: ${n}, shape: ${t}}`);let d=await u.createTensor({dataType:n,shape:t,dimensions:t,usage:s,writable:i,readable:l});return new yy({sessionId:e,context:u,tensor:d,dataType:n,shape:t,shouldConvertInt64toInt32:c})}releaseTensor(e){this.externalTensors.has(e)&&this.externalTensors.delete(e),this.freeTensors.push(e)}},GT=(...e)=>new Wb(...e)}),M_,Hb,WT,G$=ct(()=>{Wt(),ku(),VT(),V$(),el(),M_=new Map([[1,"float32"],[10,"float16"],[6,"int32"],[12,"uint32"],[7,"int64"],[13,"uint64"],[22,"int4"],[21,"uint4"],[3,"int8"],[2,"uint8"],[9,"uint8"]]),Hb=(e,n)=>{if(e===n)return!0;if(e===void 0||n===void 0)return!1;let t=Object.keys(e).sort(),s=Object.keys(n).sort();return t.length===s.length&&t.every((i,l)=>i===s[l]&&e[i]===n[i])},WT=class{constructor(e){this.tensorManager=GT(this),this.mlContextBySessionId=new Map,this.sessionIdsByMLContext=new Map,this.mlContextCache=[],this.sessionGraphInputs=new Map,this.temporaryGraphInputs=[],this.temporarySessionTensorIds=new Map,iv(e.logLevel,!!e.debug)}get currentSessionId(){if(this.activeSessionId===void 0)throw new Error("No active session");return this.activeSessionId}onRunStart(e){yn("verbose",()=>`[WebNN] onRunStart {sessionId: ${e}}`),this.activeSessionId=e}onRunEnd(e){yn("verbose",()=>`[WebNN] onRunEnd {sessionId: ${e}}`);let n=this.temporarySessionTensorIds.get(e);if(n){for(let t of n)yn("verbose",()=>`[WebNN] releasing temporary tensor {tensorId: ${t}}`),this.tensorManager.releaseTensorId(t);this.temporarySessionTensorIds.delete(e),this.activeSessionId=void 0}}async createMLContext(e){if(e instanceof GPUDevice){let t=this.mlContextCache.findIndex(s=>s.gpuDevice===e);if(t!==-1)return this.mlContextCache[t].mlContext;{let s=await navigator.ml.createContext(e);return this.mlContextCache.push({gpuDevice:e,mlContext:s}),s}}else if(e===void 0){let t=this.mlContextCache.findIndex(s=>s.options===void 0&&s.gpuDevice===void 0);if(t!==-1)return this.mlContextCache[t].mlContext;{let s=await navigator.ml.createContext();return this.mlContextCache.push({mlContext:s}),s}}let n=this.mlContextCache.findIndex(t=>Hb(t.options,e));if(n!==-1)return this.mlContextCache[n].mlContext;{let t=await navigator.ml.createContext(e);return this.mlContextCache.push({options:e,mlContext:t}),t}}registerMLContext(e,n){this.mlContextBySessionId.set(e,n);let t=this.sessionIdsByMLContext.get(n);t||(t=new Set,this.sessionIdsByMLContext.set(n,t)),t.add(e),this.temporaryGraphInputs.length>0&&(this.sessionGraphInputs.set(e,this.temporaryGraphInputs),this.temporaryGraphInputs=[])}onReleaseSession(e){this.sessionGraphInputs.delete(e);let n=this.mlContextBySessionId.get(e);if(!n)return;this.tensorManager.releaseTensorsForSession(e),this.mlContextBySessionId.delete(e);let t=this.sessionIdsByMLContext.get(n);if(t.delete(e),t.size===0){this.sessionIdsByMLContext.delete(n);let s=this.mlContextCache.findIndex(i=>i.mlContext===n);s!==-1&&this.mlContextCache.splice(s,1)}}getMLContext(e){return this.mlContextBySessionId.get(e)}reserveTensorId(){return this.tensorManager.reserveTensorId()}releaseTensorId(e){yn("verbose",()=>`[WebNN] releaseTensorId {tensorId: ${e}}`),this.tensorManager.releaseTensorId(e)}async ensureTensor(e,n,t,s,i){let l=M_.get(t);if(!l)throw new Error(`Unsupported ONNX data type: ${t}`);return this.tensorManager.ensureTensor(e??this.currentSessionId,n,l,s,i)}async createTemporaryTensor(e,n,t){yn("verbose",()=>`[WebNN] createTemporaryTensor {onnxDataType: ${n}, shape: ${t}}`);let s=M_.get(n);if(!s)throw new Error(`Unsupported ONNX data type: ${n}`);let i=this.tensorManager.reserveTensorId();await this.tensorManager.ensureTensor(e,i,s,t,!1);let l=this.temporarySessionTensorIds.get(e);return l?l.push(i):this.temporarySessionTensorIds.set(e,[i]),i}uploadTensor(e,n){if(!aa().shouldTransferToMLTensor)throw new Error("Trying to upload to a MLTensor while shouldTransferToMLTensor is false");yn("verbose",()=>`[WebNN] uploadTensor {tensorId: ${e}, data: ${n.byteLength}}`),this.tensorManager.upload(e,n)}async downloadTensor(e,n){return this.tensorManager.download(e,n)}createMLTensorDownloader(e,n){return async()=>{let t=await this.tensorManager.download(e);return ov(t,n)}}registerMLTensor(e,n,t,s){let i=M_.get(t);if(!i)throw new Error(`Unsupported ONNX data type: ${t}`);let l=this.tensorManager.registerTensor(e,n,i,s);return yn("verbose",()=>`[WebNN] registerMLTensor {tensor: ${n}, dataType: ${i}, dimensions: ${s}} -> {tensorId: ${l}}`),l}registerMLConstant(e,n,t,s,i,l,c=!1){if(!l)throw new Error("External mounted files are not available.");let u=e;e.startsWith("./")&&(u=e.substring(2));let d=l.get(u);if(!d)throw new Error(`File with name ${u} not found in preloaded files.`);if(n+t>d.byteLength)throw new Error("Out of bounds: data offset and length exceed the external file data size.");let f=d.slice(n,n+t).buffer,m;switch(i.dataType){case"float32":m=new Float32Array(f);break;case"float16":m=typeof Float16Array<"u"&&Float16Array.from?new Float16Array(f):new Uint16Array(f);break;case"int32":m=new Int32Array(f);break;case"uint32":m=new Uint32Array(f);break;case"int64":c?(m=y0(new Uint8Array(f),!1),i.dataType="int32"):m=new BigInt64Array(f);break;case"uint64":m=new BigUint64Array(f);break;case"int8":m=new Int8Array(f);break;case"int4":case"uint4":case"uint8":m=new Uint8Array(f);break;default:throw new Error(`Unsupported data type: ${i.dataType} in creating WebNN Constant from external data.`)}return yn("verbose",()=>`[WebNN] registerMLConstant {dataType: ${i.dataType}, shape: ${i.shape}}} ${c?"(Note: it was int64 data type and registered to int32 as workaround)":""}`),s.constant(i,m)}registerGraphInput(e){this.temporaryGraphInputs.push(e)}isGraphInput(e,n){let t=this.sessionGraphInputs.get(e);return t?t.includes(n):!1}isInt64Supported(e){return!!this.mlContextBySessionId.get(e)?.opSupportLimits().input.dataTypes.includes("int64")}flush(){}}}),lv=ct(()=>{}),by,x_,T_,qb,Kb,wy,v0,Qb,HT,W$=ct(()=>{el(),lv(),by=new Map([[64,250],[128,200],[256,200],[512,200],[2048,230],[4096,200],[8192,50],[16384,50],[32768,50],[65536,50],[131072,50],[262144,50],[524288,50],[1048576,50],[2097152,30],[4194304,20],[8388608,10],[12582912,10],[16777216,10],[26214400,15],[33554432,22],[44236800,2],[58982400,6],[67108864,6],[134217728,6],[167772160,6]]),x_=[],T_=e=>Math.ceil(Number(e)/16)*16,qb=e=>{for(let n=0;n<x_.length;n++){let t=x_[n];if(e<=t)return t}return Math.ceil(e/16)*16},Kb=1,wy=()=>Kb++,v0=async(e,n,t,s)=>{let i=T_(t),l=e.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});try{let c=e.getCommandEncoder();e.endComputePass(),c.copyBufferToBuffer(n,0,l,0,i),e.flush(),await l.mapAsync(GPUMapMode.READ);let u=l.getMappedRange();if(s){let d=s();return d.set(new Uint8Array(u,0,t)),d}else return new Uint8Array(u.slice(0,t))}finally{l.destroy()}},Qb=class{constructor(e){this.backend=e,this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.buffersPending=[],this.capturedPendingBuffers=new Map;for(let[n]of by)x_.push(n),this.freeBuffers.set(n,[]),this.freeUniformBuffers.set(n,[]);this.sessionCount=0}upload(e,n){let t=n.buffer,s=n.byteOffset,i=n.byteLength,l=T_(i),c=this.storageCache.get(e);if(!c)throw new Error("gpu data for uploading does not exist");if(Number(c.originalSize)!==i)throw new Error(`inconsistent data size. gpu data size=${c.originalSize}, data size=${i}`);let u=this.backend.device.createBuffer({mappedAtCreation:!0,size:l,usage:GPUBufferUsage.MAP_WRITE|GPUBufferUsage.COPY_SRC}),d=u.getMappedRange();new Uint8Array(d).set(new Uint8Array(t,s,i)),u.unmap();let f=this.backend.device.createCommandEncoder();f.copyBufferToBuffer(u,0,c.gpuData.buffer,0,l),this.backend.device.queue.submit([f.finish()]),u.destroy(),yn("verbose",()=>`[WebGPU] GpuDataManager.upload(id=${e})`)}memcpy(e,n){let t=this.storageCache.get(e);if(!t)throw new Error("source gpu data for memcpy does not exist");let s=this.storageCache.get(n);if(!s)throw new Error("destination gpu data for memcpy does not exist");if(t.originalSize!==s.originalSize)throw new Error("inconsistent source and destination gpu data size");let i=T_(t.originalSize),l=this.backend.getCommandEncoder();this.backend.endComputePass(),l.copyBufferToBuffer(t.gpuData.buffer,0,s.gpuData.buffer,0,i)}registerExternalBuffer(e,n,t){let s;if(t){if(s=t[0],e===t[1])return yn("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${n}) => id=${s}, buffer is the same, skip.`),s;if(this.backend.capturedCommandList.has(this.backend.currentSessionId))throw new Error(`Registering a different external buffer under graph capture mode is not supported yet.
             Please use the previous external buffer!`)}else s=wy();return this.storageCache.set(s,{gpuData:{id:s,type:0,buffer:e},originalSize:n}),yn("verbose",()=>`[WebGPU] GpuDataManager.registerExternalBuffer(size=${n}) => id=${s}, registered.`),s}unregisterExternalBuffer(e){e!==void 0&&(this.storageCache.delete(e),yn("verbose",()=>`[WebGPU] GpuDataManager.unregisterExternalBuffer() => id=${e}`))}create(e,n=GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST){let t=qb(e),s,i=(n&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE,l=(n&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM;if(i||l){let u=(i?this.freeBuffers:this.freeUniformBuffers).get(t);u?u.length>0?s=u.pop():s=this.backend.device.createBuffer({size:t,usage:n}):s=this.backend.device.createBuffer({size:t,usage:n})}else s=this.backend.device.createBuffer({size:t,usage:n});let c={id:wy(),type:0,buffer:s};return this.storageCache.set(c.id,{gpuData:c,originalSize:Number(e)}),yn("verbose",()=>`[WebGPU] GpuDataManager.create(size=${e}) => id=${c.id}`),c}get(e){return this.storageCache.get(e)?.gpuData}release(e){let n=typeof e=="bigint"?Number(e):e,t=this.storageCache.get(n);if(!t){if(this.storageCache.size===0)return 0;throw new Error("releasing data does not exist")}return yn("verbose",()=>`[WebGPU] GpuDataManager.release(id=${n}), gpuDataId=${t.gpuData.id}`),this.storageCache.delete(n),this.buffersPending.push(t.gpuData.buffer),t.originalSize}async download(e,n){let t=this.storageCache.get(Number(e));if(!t)throw new Error("data does not exist");await v0(this.backend,t.gpuData.buffer,t.originalSize,n)}refreshPendingBuffers(){if(this.buffersPending.length!==0)if(this.backend.sessionStatus==="default"){for(let e of this.buffersPending){let n=by.get(e.size);if((e.usage&GPUBufferUsage.STORAGE)===GPUBufferUsage.STORAGE){let t=this.freeBuffers.get(e.size)||[];n===void 0||t.length>=n?e.destroy():t.push(e)}else if((e.usage&GPUBufferUsage.UNIFORM)===GPUBufferUsage.UNIFORM){let t=this.freeUniformBuffers.get(e.size)||[];n===void 0||t.length>=n?e.destroy():t.push(e)}else e.destroy()}this.buffersPending=[]}else{let e=this.capturedPendingBuffers.get(this.backend.currentSessionId);e||(e=[],this.capturedPendingBuffers.set(this.backend.currentSessionId,e));for(let n of this.buffersPending)e.push(n);this.buffersPending=[]}}dispose(){this.freeBuffers.forEach(e=>{e.forEach(n=>{n.destroy()})}),this.freeUniformBuffers.forEach(e=>{e.forEach(n=>{n.destroy()})}),this.storageCache.forEach(e=>{e.gpuData.buffer.destroy()}),this.capturedPendingBuffers.forEach(e=>{e.forEach(n=>{n.destroy()})}),this.storageCache=new Map,this.freeBuffers=new Map,this.freeUniformBuffers=new Map,this.capturedPendingBuffers=new Map}onCreateSession(){this.sessionCount+=1}onReleaseSession(e){let n=this.capturedPendingBuffers.get(e);n&&(n.forEach(t=>{t.destroy()}),this.capturedPendingBuffers.delete(e)),this.sessionCount-=1,this.sessionCount===0&&(yn("warning",()=>"[WebGPU] Clearing webgpu buffer cache"),this.storageCache.forEach(t=>{t.gpuData.buffer.destroy()}),this.storageCache=new Map)}},HT=(...e)=>new Qb(...e)}),Xb,$n,Fa=ct(()=>{Xb=class{constructor(e){Object.assign(this,e)}get cacheKey(){return this.key||(this.key=Object.getOwnPropertyNames(this).sort().map(e=>`${this[e]}`).join(";")),this.key}},$n=e=>new Xb(e)}),wf,E_,as,As,zt,Sa,b0,gf,cc,$t,Hp,Qe,At,qT,cv,Yb,KT,tn=ct(()=>{Wt(),en(),wf=64,E_=(e,n)=>{if(n===3)throw new Error("vec3 has same alignment as vec4, use vec4 instead");switch(Number(e)){case 10:return n>1?`vec${n}<f16>`:"f16";case 1:return n>1?`vec${n}<f32>`:"f32";case 6:return n>1?`vec${n}<i32>`:"i32";case 12:return n>1?`vec${n}<u32>`:"u32";case 7:if(n>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","i32"];case 13:if(n>1)throw new Error("currently not supported vecX of uint64 yet");return["vec2<u32>","u32"];case 9:if(n!==4)throw new Error("bool must be vec4");return["u32","vec4<bool>"];case 22:return"i32";case 21:return"u32";default:throw new Error(`Unknown data type: ${e}`)}},as=(e,n=1)=>{let t=E_(e,n);return typeof t=="string"?t:t[0]},As=(e,n=1)=>{let t=E_(e,n);return typeof t=="string"?t:t[1]},zt=(...e)=>{let n=[];return e.forEach(t=>{t.length!==0&&n.push({type:12,data:t},{type:12,data:je.computeStrides(t)})}),n},Sa=e=>e%4===0?4:e%2===0?2:1,b0=(e="f32",n,t="0")=>!n||n===1?`${e}(${t})`:`vec${n}<${e}>(${t})`,gf=(e,n,t)=>e==="f32"?t:n===1?`f32(${t})`:`vec${n}<f32>(${t})`,cc=(e,n)=>n===4?`(${e}.x + ${e}.y + ${e}.z + ${e}.w)`:n===2?`(${e}.x + ${e}.y)`:n===3?`(${e}.x + ${e}.y + ${e}.z)`:e,$t=(e,n,t,s)=>e.startsWith("uniforms.")&&t>4?typeof n=="string"?s==="f16"?`${e}[(${n}) / 8][(${n}) % 8 / 4][(${n}) % 8 % 4]`:`${e}[(${n}) / 4][(${n}) % 4]`:s==="f16"?`${e}[${Math.floor(n/8)}][${Math.floor(n%8/4)}][${n%8%4}]`:`${e}[${Math.floor(n/4)}][${n%4}]`:t>1?`${e}[${n}]`:e,Hp=(e,n,t,s,i)=>{let l=typeof t=="number",c=l?t:t.length,u=[...new Array(c).keys()],d=c<2?"u32":c<=4?`vec${c}<u32>`:`array<u32, ${c}>`,f=E_(n,i),m=typeof f=="string"?f:f[1],_=typeof f=="string"?f:f[0],p={indices:d,value:m,storage:_,tensor:n},y=U=>typeof U=="string"?U:`${U}u`,v={offsetToIndices:!1,indicesToOffset:!1,broadcastedIndicesToOffset:!1,set:!1,setByIndices:!1,get:!1,getByIndices:!1},T=l?"uniforms.":"",k=`${T}${e}_shape`,b=`${T}${e}_strides`,S="";for(let U=0;U<c-1;U++)S+=`
    let dim${U} = current / ${$t(b,U,c)};
    let rest${U} = current % ${$t(b,U,c)};
    indices[${U}] = dim${U};
    current = rest${U};
    `;S+=`indices[${c-1}] = current;`;let $=c<2?"":`
  fn o2i_${e}(offset: u32) -> ${p.indices} {
    var indices: ${p.indices};
    var current = offset;
    ${S}
    return indices;
  }`,w=U=>(v.offsetToIndices=!0,c<2?U:`o2i_${e}(${U})`),C=[];if(c>=2)for(let U=c-1;U>=0;U--)C.push(`${$t(b,U,c)} * (indices[${U}])`);let P=c<2?"":`
  fn i2o_${e}(indices: ${p.indices}) -> u32 {
    return ${C.join("+")};
  }`,A=U=>(v.indicesToOffset=!0,c<2?U:`i2o_${e}(${U})`),I=(...U)=>c===0?"0u":`${p.indices}(${U.map(y).join(",")})`,W=(U,K)=>c<2?`${U}`:`${$t(U,K,c)}`,G=(U,K,H)=>c<2?`${U}=${H};`:`${$t(U,K,c)}=${H};`,q={},Z=(U,K)=>{v.broadcastedIndicesToOffset=!0;let H=`${K.name}broadcastedIndicesTo${e}Offset`;if(H in q)return`${H}(${U})`;let B=[];for(let ce=c-1;ce>=0;ce--){let ve=K.indicesGet("outputIndices",ce+K.rank-c);B.push(`${W(b,ce)} * (${ve} % ${W(k,ce)})`)}return q[H]=`fn ${H}(outputIndices: ${K.type.indices}) -> u32 {
             return ${B.length>0?B.join("+"):"0u"};
           }`,`${H}(${U})`},X=(U,K)=>(()=>{if(p.storage===p.value)return`${e}[${U}]=${K};`;if(p.storage==="vec2<u32>"&&p.value==="i32")return`${e}[${U}]=vec2<u32>(u32(${K}), select(0u, 0xFFFFFFFFu, ${K} < 0));`;if(p.storage==="vec2<u32>"&&p.value==="u32")return`${e}[${U}]=vec2<u32>(u32(${K}), 0u);`;if(p.storage==="u32"&&p.value==="vec4<bool>")return`${e}[${U}]=dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(${K}));`;throw new Error(`not supported combination of storage type ${p.storage} and value type ${p.value} yet`)})(),Q=U=>(()=>{if(p.storage===p.value)return`${e}[${U}]`;if(p.storage==="vec2<u32>"&&p.value==="i32")return`i32(${e}[${U}].x)`;if(p.storage==="vec2<u32>"&&p.value==="u32")return`u32(${e}[${U}].x)`;if(p.storage==="u32"&&p.value==="vec4<bool>")return`vec4<bool>(bool(${e}[${U}] & 0xFFu), bool(${e}[${U}] & 0xFF00u), bool(${e}[${U}] & 0xFF0000u), bool(${e}[${U}] & 0xFF000000u))`;throw new Error(`not supported combination of storage type ${p.storage} and value type ${p.value} yet`)})(),te=c<2?"":`
  fn get_${e}ByIndices(indices: ${p.indices}) -> ${m} {
    return ${Q(`i2o_${e}(indices)`)};
  }`,R=c<2?"":(()=>{let U=u.map(H=>`d${H}: u32`).join(", "),K=u.map(H=>`d${H}`).join(", ");return`
  fn get_${e}(${U}) -> ${m} {
    return get_${e}ByIndices(${I(K)});
  }`})(),ee=(...U)=>{if(U.length!==c)throw new Error(`indices length must be ${c}`);let K=U.map(y).join(",");return c===0?Q("0u"):c===1?Q(K[0]):(v.get=!0,v.getByIndices=!0,v.indicesToOffset=!0,`get_${e}(${K})`)},ie=U=>c<2?Q(U):(v.getByIndices=!0,v.indicesToOffset=!0,`get_${e}ByIndices(${U})`),he=c<2?"":`
  fn set_${e}ByIndices(indices: ${p.indices}, value: ${m}) {
    ${X(`i2o_${e}(indices)`,"value")}
  }`,_e=c<2?"":(()=>{let U=u.map(H=>`d${H}: u32`).join(", "),K=u.map(H=>`d${H}`).join(", ");return`
  fn set_${e}(${U}, value: ${m}) {
    set_${e}ByIndices(${I(K)}, value);
  }`})();return{impl:()=>{let U=[],K=!1;return v.offsetToIndices&&(U.push($),K=!0),v.indicesToOffset&&(U.push(P),K=!0),v.broadcastedIndicesToOffset&&(Object.values(q).forEach(H=>U.push(H)),K=!0),v.set&&(U.push(_e),K=!0),v.setByIndices&&(U.push(he),K=!0),v.get&&(U.push(R),K=!0),v.getByIndices&&(U.push(te),K=!0),!l&&K&&U.unshift(`const ${k} = ${p.indices}(${t.join(",")});`,`const ${b} = ${p.indices}(${je.computeStrides(t).join(",")});`),U.join(`
`)},type:p,offsetToIndices:w,indicesToOffset:A,broadcastedIndicesToOffset:Z,indices:I,indicesGet:W,indicesSet:G,set:(...U)=>{if(U.length!==c+1)throw new Error(`indices length must be ${c}`);let K=U[c];if(typeof K!="string")throw new Error("value must be string");let H=U.slice(0,c).map(y).join(",");return c===0?X("0u",K):c===1?X(H[0],K):(v.set=!0,v.setByIndices=!0,v.indicesToOffset=!0,`set_${e}(${H}, ${K})`)},setByOffset:X,setByIndices:(U,K)=>c<2?X(U,K):(v.setByIndices=!0,v.indicesToOffset=!0,`set_${e}ByIndices(${U}, ${K});`),get:ee,getByOffset:Q,getByIndices:ie,usage:s,name:e,strides:b,shape:k,rank:c}},Qe=(e,n,t,s=1)=>Hp(e,n,t,"input",s),At=(e,n,t,s=1)=>Hp(e,n,t,"output",s),qT=(e,n,t)=>Hp(e,n,t,"atomicOutput",1),cv=(e,n,t,s=1)=>Hp(e,n,t,"internal",s),Yb=class{constructor(e,n){this.normalizedDispatchGroup=e,this.limits=n,this.internalVariables=[],this.variables=[],this.uniforms=[],this.variableIndex=0}guardAgainstOutOfBoundsWorkgroupSizes(e){return`if (global_idx >= ${typeof e=="number"?`${e}u`:e}) { return; }`}mainStart(e=wf){let n=typeof e=="number"?e:e[0],t=typeof e=="number"?1:e[1],s=typeof e=="number"?1:e[2];if(n>this.limits.maxComputeWorkgroupSizeX||t>this.limits.maxComputeWorkgroupSizeY||s>this.limits.maxComputeWorkgroupSizeZ)throw new Error(`workgroup size [${n}, ${t}, ${s}] exceeds the maximum workgroup size [${this.limits.maxComputeWorkgroupSizeX}, ${this.limits.maxComputeWorkgroupSizeY}, ${this.limits.maxComputeWorkgroupSizeZ}].`);if(n*t*s>this.limits.maxComputeInvocationsPerWorkgroup)throw new Error(`workgroup size [${n}, ${t}, ${s}] exceeds the maximum workgroup invocations ${this.limits.maxComputeInvocationsPerWorkgroup}.`);let i=this.normalizedDispatchGroup[1]===1&&this.normalizedDispatchGroup[2]===1,l=i?`@builtin(global_invocation_id) global_id : vec3<u32>,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(local_invocation_id) local_id : vec3<u32>`:`@builtin(global_invocation_id) global_id : vec3<u32>,
                                             @builtin(local_invocation_id) local_id : vec3<u32>,
    @builtin(local_invocation_index) local_idx : u32,
    @builtin(workgroup_id) workgroup_id : vec3<u32>,
    @builtin(num_workgroups) num_workgroups : vec3<u32>`,c=i?`let global_idx = global_id.x;
         let workgroup_index = workgroup_id.x;`:`let workgroup_index = workgroup_id.z * num_workgroups[0] * num_workgroups[1] +
             workgroup_id.y * num_workgroups[0] + workgroup_id.x;
         let global_idx = workgroup_index * ${n*t*s}u + local_idx;`;return`@compute @workgroup_size(${n}, ${t}, ${s})
  fn main(${l}) {
    ${c}
  `}appendVariableUniforms(e){e.rank!==0&&(e.shape.startsWith("uniforms.")&&this.uniforms.push({name:e.shape.replace("uniforms.",""),type:"u32",length:e.rank}),e.strides.startsWith("uniforms.")&&this.uniforms.push({name:e.strides.replace("uniforms.",""),type:"u32",length:e.rank}))}declareVariable(e,n){if(e.usage==="internal")throw new Error("cannot use internal variable with declareVariable(). use registerInternalVariables() instead.");this.variables.push(e),this.appendVariableUniforms(e);let t=e.usage==="input"?"read":"read_write",s=e.usage==="atomicOutput"?"atomic<i32>":e.type.storage;return`@group(0) @binding(${n}) var<storage, ${t}> ${e.name}: array<${s}>;`}declareVariables(...e){return e.map(n=>this.declareVariable(n,this.variableIndex++)).join(`
`)}registerInternalVariable(e){if(e.usage!=="internal")throw new Error("cannot use input or output variable with registerInternalVariable(). use declareVariables() instead.");this.internalVariables.push(e),this.appendVariableUniforms(e)}registerInternalVariables(...e){return e.forEach(n=>this.registerInternalVariable(n)),this}registerUniform(e,n,t=1){return this.uniforms.push({name:e,type:n,length:t}),this}registerUniforms(e){return this.uniforms=this.uniforms.concat(e),this}uniformDeclaration(){if(this.uniforms.length===0)return"";let e=[];for(let{name:n,type:t,length:s}of this.uniforms)if(s&&s>4)t==="f16"?e.push(`@align(16) ${n}:array<mat2x4<${t}>, ${Math.ceil(s/8)}>`):e.push(`${n}:array<vec4<${t}>, ${Math.ceil(s/4)}>`);else{let i=s==null||s===1?t:`vec${s}<${t}>`;e.push(`${n}:${i}`)}return`
      struct Uniforms { ${e.join(", ")} };
      @group(0) @binding(${this.variableIndex}) var<uniform> uniforms: Uniforms;`}get additionalImplementations(){return this.uniformDeclaration()+this.variables.map(e=>e.impl()).join(`
`)+this.internalVariables.map(e=>e.impl()).join(`
`)}get variablesInfo(){if(this.uniforms.length===0)return;let e=n=>[12,10,1,6][["u32","f16","f32","i32"].indexOf(n)];return this.uniforms.map(n=>[e(n.type),n.length??1])}},KT=(e,n)=>new Yb(e,n)}),Zb,My,Jb,ew,tw,nw,yr,QT,XT,uc=ct(()=>{Wt(),en(),Fa(),tn(),Zb=(e,n)=>{if(!e||e.length!==1)throw new Error("Transpose requires 1 input.");if(n.length!==0&&n.length!==e[0].dims.length)throw new Error(`perm size ${n.length} does not match input rank ${e[0].dims.length}`)},My=(e,n)=>n.length!==0?n:[...new Array(e).keys()].reverse(),Jb=(e,n)=>je.sortBasedOnPerm(e,My(e.length,n)),ew=(e,n,t,s)=>{let i=`fn perm(i: ${s.type.indices}) -> ${t.type.indices} {
    var a: ${t.type.indices};`;for(let l=0;l<n;++l)i+=`a[${e[l]}]=i[${l}];`;return i+="return a;}"},tw=(e,n)=>{let t=[],s=[];for(let i=0;i<e.length;++i)e[i]!==1&&t.push(e[i]),e[n[i]]!==1&&s.push(n[i]);return{newShape:t,newPerm:s}},nw=(e,n)=>{let t=0;for(let s=0;s<e.length;++s)if(n[e[s]]!==1){if(e[s]<t)return!1;t=e[s]}return!0},yr=(e,n)=>{let t=e.dataType,s=e.dims.length,i=My(s,n),l=Jb(e.dims,i),c=e.dims,u=l,d=s<2||nw(i,e.dims),f;if(d)return f=v=>{let T=Qe("input",t,c,4),k=At("output",t,u,4);return`
  ${v.registerUniform("output_size","u32").declareVariables(T,k)}
  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    output[global_idx] = input[global_idx];
  }`},{name:"TransposeCopy",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let v=je.size(l);return{outputs:[{dims:l,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(v/64/4)},programUniforms:[{type:12,data:Math.ceil(v/4)}]}},getShaderSource:f};let{newShape:m,newPerm:_}=tw(e.dims,i),p=je.areEqual(_,[2,3,1]),y=je.areEqual(_,[3,1,2]);if(m.length===2||p||y){c=p?[m[0],m[1]*m[2]]:y?[m[0]*m[1],m[2]]:m,u=[c[1],c[0]];let v=16;return f=T=>{let k=Qe("a",t,c.length),b=At("output",t,u.length);return`
  ${T.registerUniform("output_size","u32").declareVariables(k,b)}
  var<workgroup> tile : array<array<${b.type.value}, ${v+1}>, ${v}>;
  ${T.mainStart([v,v,1])}
    let stride = (uniforms.output_shape[1] - 1) / ${v} + 1;
    let workgroup_id_x = workgroup_index % stride;
    let workgroup_id_y = workgroup_index / stride;
    let input_col = workgroup_id_y * ${v}u + local_id.x;
    let input_row = workgroup_id_x * ${v}u + local_id.y;
    if (input_row < uniforms.a_shape[0] && input_col < uniforms.a_shape[1]) {
      tile[local_id.y][local_id.x] = ${k.getByIndices(`${k.type.indices}(input_row, input_col)`)};
    }
    workgroupBarrier();

    let output_col = workgroup_id_x * ${v}u + local_id.x;
    let output_row = workgroup_id_y * ${v}u + local_id.y;
    if (output_row < uniforms.output_shape[0] && output_col < uniforms.output_shape[1]) {
      ${b.setByIndices(`${b.type.indices}(output_row, output_col)`,"tile[local_id.x][local_id.y]")}
    }
  }`},{name:"TransposeShared",shaderCache:{inputDependencies:["type"]},getRunData:()=>{let T=je.size(l);return{outputs:[{dims:l,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(u[1]/v),y:Math.ceil(u[0]/v)},programUniforms:[{type:12,data:T},...zt(c,u)]}},getShaderSource:f}}return f=v=>{let T=Qe("a",t,c.length),k=At("output",t,u.length);return`
  ${v.registerUniform("output_size","u32").declareVariables(T,k)}

  ${ew(i,s,T,k)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${k.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${k.setByOffset("global_idx",T.getByIndices("aIndices"))}
  }`},{name:"Transpose",shaderCache:{hint:`${n}`,inputDependencies:["rank"]},getRunData:()=>{let v=je.size(l);return{outputs:[{dims:l,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:[{type:12,data:v},...zt(c,u)]}},getShaderSource:f}},QT=(e,n)=>{Zb(e.inputs,n.perm),e.compute(yr(e.inputs[0],n.perm))},XT=e=>$n({perm:e.perm})}),aw,sw,rw,iw,ow,lw,cw,uw,dw,fw,li,YT,ZT,JT,e2,t2,n2,a2,s2,r2,i2,H$=ct(()=>{Wt(),en(),tn(),uv(),uc(),aw={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate * candidate",logSumExp:"bestValue + exp(candidate)",l1:"bestValue + abs(candidate)",l2:"bestValue + candidate * candidate",logSum:"bestValue + candidate"},sw={max:"select(bestValue, candidate, candidate > bestValue)",min:"select(bestValue, candidate, candidate < bestValue)",mean:"bestValue + candidate",sum:"bestValue + candidate",prod:"bestValue * candidate",sumSquare:"bestValue + candidate",logSumExp:"bestValue + candidate",l1:"bestValue + candidate",l2:"bestValue + candidate",logSum:"bestValue + candidate"},rw={max:"_A[offset]",min:"_A[offset]",mean:"0",sum:"0",prod:"1",sumSquare:"0",logSumExp:"0",l1:"0",l2:"0",logSum:"0"},iw={max:"bestValue",min:"bestValue",sum:"bestValue",prod:"bestValue",sumSquare:"bestValue",logSumExp:"log(bestValue)",l1:"bestValue",l2:"sqrt(bestValue)",logSum:"log(bestValue)"},ow=(e,n)=>{let t=[];for(let s=n-e;s<n;++s)t.push(s);return t},lw=(e,n)=>{let t=[],s=e.length;for(let l=0;l<s;l++)n.indexOf(l)===-1&&t.push(e[l]);let i=n.map(l=>e[l]);return[t,i]},cw=(e,n)=>{let t=e.length+n.length,s=[],i=0;for(let l=0;l<t;l++)n.indexOf(l)===-1?s.push(e[i++]):s.push(1);return s},uw=(e,n)=>{for(let t=0;t<e.length;++t)if(e[e.length-t-1]!==n-1-t)return!1;return!0},dw=(e,n)=>{let t=[];if(!uw(e,n)){for(let s=0;s<n;++s)e.indexOf(s)===-1&&t.push(s);e.forEach(s=>t.push(s))}return t},fw=(e,n,t,s,i,l,c)=>{let u=t[0].dims,d=je.size(l),f=je.size(c),m=Qe("_A",t[0].dataType,u),_=At("output",i,l),p=64;d===1&&(p=256);let y=`
          var<workgroup> aBestValues : array<f32, ${p}>;
       `,v=T=>`
        ${T.registerUniform("reduceSize","u32").declareVariables(m,_)}
        ${y}
        fn DIV_CEIL(a : u32, b : u32) -> u32 {
          return ((a - 1u) / b + 1u);
         }
         ${T.mainStart(p)}

          let outputIndex = global_idx / ${p};
          let offset = outputIndex * uniforms.reduceSize;

          var bestValue = f32(${rw[s]});
          let Length = uniforms.reduceSize;
          for (var k = local_idx; k < Length; k = k + ${p}) {
           let candidate = f32(${m.getByOffset("offset + k")});
           bestValue = ${aw[s]};
          }
          aBestValues[local_idx] = bestValue;
          workgroupBarrier();

         var reduceSize = min(Length, ${p}u);
         for (var currentSize = reduceSize / 2u; reduceSize > 1u;
             currentSize = reduceSize / 2u) {
           let interval = DIV_CEIL(reduceSize, 2u);
           if (local_idx < currentSize) {
            let candidate = aBestValues[local_idx + interval];
            bestValue = ${sw[s]};
            aBestValues[local_idx] = bestValue;
           }
           reduceSize = interval;
           workgroupBarrier();
         }

         if (local_idx == 0u) {
          ${_.setByOffset("outputIndex",`${s==="mean"?`${_.type.storage}(bestValue / f32(uniforms.reduceSize))`:`${_.type.storage}(${iw[s]})`}`)};
         }
        }`;return{name:e,shaderCache:{hint:`${n};${p}`,inputDependencies:["type"]},getShaderSource:v,getRunData:()=>({outputs:[{dims:l,dataType:i}],dispatchGroup:{x:d},programUniforms:[{type:12,data:f}]})}},li=(e,n,t,s)=>{let i=e.inputs.length===1?t:w0(e.inputs,t),l=i.axes;l.length===0&&!i.noopWithEmptyAxes&&(l=e.inputs[0].dims.map((y,v)=>v));let c=je.normalizeAxes(l,e.inputs[0].dims.length),u=c,d=e.inputs[0],f=dw(u,e.inputs[0].dims.length);f.length>0&&(d=e.compute(yr(e.inputs[0],f),{inputs:[0],outputs:[-1]})[0],u=ow(u.length,d.dims.length));let[m,_]=lw(d.dims,u),p=m;i.keepDims&&(p=cw(m,c)),e.compute(fw(n,i.cacheKey,[d],s,e.inputs[0].dataType,p,_),{inputs:[d]})},YT=(e,n)=>{li(e,"ReduceMeanShared",n,"mean")},ZT=(e,n)=>{li(e,"ReduceL1Shared",n,"l1")},JT=(e,n)=>{li(e,"ReduceL2Shared",n,"l2")},e2=(e,n)=>{li(e,"ReduceLogSumExpShared",n,"logSumExp")},t2=(e,n)=>{li(e,"ReduceMaxShared",n,"max")},n2=(e,n)=>{li(e,"ReduceMinShared",n,"min")},a2=(e,n)=>{li(e,"ReduceProdShared",n,"prod")},s2=(e,n)=>{li(e,"ReduceSumShared",n,"sum")},r2=(e,n)=>{li(e,"ReduceSumSquareShared",n,"sumSquare")},i2=(e,n)=>{li(e,"ReduceLogSumShared",n,"logSum")}}),ci,hw,sg,w0,ui,pw,mw,_w,gw,yw,vw,bw,ww,Mw,xw,di,o2,l2,c2,u2,d2,f2,h2,p2,m2,_2,uv=ct(()=>{Wt(),en(),Fa(),tn(),H$(),ci=e=>{if(!e||e.length===0||e.length>2)throw new Error("Reduce op requires 1 or 2 inputs.");if(e.length===2&&e[1].dims.length!==1)throw new Error("Invalid axes input dims.")},hw=e=>["","",`var value = ${e.getByIndices("input_indices")};`,""],sg=(e,n,t,s,i,l,c=!1,u=!1)=>{let d=[],f=t[0].dims,m=f.length,_=je.normalizeAxes(i,m),p=!u&&_.length===0;f.forEach((T,k)=>{p||_.indexOf(k)>=0?c&&d.push(1):d.push(T)});let y=d.length,v=je.size(d);return{name:e,shaderCache:n,getShaderSource:T=>{let k=[],b=Qe("_A",t[0].dataType,m),S=At("output",l,y),$=s(b,S,_),w=$[2];for(let C=0,P=0;C<m;C++)p||_.indexOf(C)>=0?(c&&P++,w=`for(var j${C}: u32 = 0; j${C} < ${f[C]}; j${C}++) {
                  ${$[2].includes("last_index")?`let last_index = j${C};`:""}
                  ${b.indicesSet("input_indices",C,`j${C}`)}
                  ${w}
                }`):(k.push(`${b.indicesSet("input_indices",C,S.indicesGet("output_indices",P))};`),P++);return`

        ${T.registerUniform("output_size","u32").declareVariables(b,S)}

        ${T.mainStart()}
          ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          var input_indices: ${b.type.indices};
          let output_indices = ${S.offsetToIndices("global_idx")};

          ${k.join(`
`)}
          ${$[0]}       // init ops for reduce max/min
          ${$[1]}
          ${w}
          ${$[3]}
          ${$.length===4?S.setByOffset("global_idx","value"):$.slice(4).join(`
`)}
        }`},getRunData:()=>({outputs:[{dims:d,dataType:l}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:[{type:12,data:v},...zt(f,d)]})}},w0=(e,n)=>{let t=[];return e[1].dims[0]>0&&e[1].getBigInt64Array().forEach(s=>t.push(Number(s))),$n({axes:t,keepDims:n.keepDims,noopWithEmptyAxes:n.noopWithEmptyAxes})},ui=(e,n,t,s)=>{let i=e.inputs,l=i.length===1?t:w0(i,t);e.compute(sg(n,{hint:l.cacheKey,inputDependencies:["rank"]},[i[0]],l.noopWithEmptyAxes&&l.axes.length===0?hw:s,l.axes,i[0].dataType,l.keepDims,l.noopWithEmptyAxes),{inputs:[0]})},pw=(e,n)=>{ci(e.inputs),ui(e,"ReduceLogSum",n,(t,s)=>[`var value = ${s.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,"value = log(value);"])},mw=(e,n)=>{ci(e.inputs),ui(e,"ReduceL1",n,(t,s)=>[`var value = ${s.type.storage}(0);`,"",`value += abs(${t.getByIndices("input_indices")});`,""])},_w=(e,n)=>{ci(e.inputs),ui(e,"ReduceL2",n,(t,s)=>[`var t = ${s.type.value}(0); var value = ${s.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += (t * t);`,"value = sqrt(value);"])},gw=(e,n)=>{ci(e.inputs),ui(e,"ReduceLogSumExp",n,(t,s)=>[`var value = ${s.type.storage}(0);`,"",`value += exp(${t.getByIndices("input_indices")});`,"value = log(value);"])},yw=(e,n)=>{ci(e.inputs),ui(e,"ReduceMax",n,(t,s,i)=>{let l=[];for(let c=0;c<t.rank;c++)(i.indexOf(c)>=0||i.length===0)&&l.push(t.indicesSet("input_indices",c,0));return[`${l.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = max(value, ${t.getByIndices("input_indices")});`,""]})},vw=(e,n)=>{ci(e.inputs),ui(e,"ReduceMean",n,(t,s,i)=>{let l=1;for(let c=0;c<t.rank;c++)(i.indexOf(c)>=0||i.length===0)&&(l*=e.inputs[0].dims[c]);return["var sum = f32(0);","",`sum += f32(${t.getByIndices("input_indices")});`,`let value = ${s.type.value}(sum / ${l});`]})},bw=(e,n)=>{ci(e.inputs),ui(e,"ReduceMin",n,(t,s,i)=>{let l=[];for(let c=0;c<t.rank;c++)(i.indexOf(c)>=0||i.length===0)&&l.push(`input_indices[${c}] = 0;`);return[`${l.join(`
`)}`,`var value = ${t.getByIndices("input_indices")};`,`value = min(value, ${t.getByIndices("input_indices")});`,""]})},ww=(e,n)=>{ci(e.inputs),ui(e,"ReduceProd",n,(t,s)=>[`var value = ${s.type.storage}(1);`,"",`value *= ${t.getByIndices("input_indices")};`,""])},Mw=(e,n)=>{ci(e.inputs),ui(e,"ReduceSum",n,(t,s)=>[`var value = ${s.type.storage}(0);`,"",`value += ${t.getByIndices("input_indices")};`,""])},xw=(e,n)=>{ci(e.inputs),ui(e,"ReduceSumSquare",n,(t,s)=>[`var t = ${s.type.value}(0); var value = ${s.type.value}(0);`,"",`t = ${t.getByIndices("input_indices")}; value += t * t;`,""])},di=(e,n,t)=>{if(n.length===0)return t;let s=1,i=1;for(let l=0;l<n.length;l++)n.indexOf(l)===-1?s*=e[l]:i*=e[l];return i<32&&s>1024},o2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?vw(e,n):YT(e,n)},l2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?mw(e,n):ZT(e,n)},c2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?_w(e,n):JT(e,n)},u2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?gw(e,n):e2(e,n)},d2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?yw(e,n):t2(e,n)},f2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?bw(e,n):n2(e,n)},h2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?ww(e,n):a2(e,n)},p2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?Mw(e,n):s2(e,n)},m2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?xw(e,n):r2(e,n)},_2=(e,n)=>{di(e.inputs[0].dims,n.axes,n.noopWithEmptyAxes)?pw(e,n):i2(e,n)}}),xy,g2,y2,M0,q$=ct(()=>{Wt(),Fa(),uv(),xy=e=>{if(!e||e.length===0||e.length>2)throw new Error("ArgMinMaxOp op requires 1 or 2 inputs.");if(e[0].dataType!==1)throw new Error("Invalid input type.")},g2=(e,n)=>{xy(e.inputs);let t=(s,i,l)=>{let c=[];for(let u=0;u<s.rank;u++)(l.indexOf(u)>=0||l.length===0)&&c.push(`input_indices[${u}] = 0;`);return[`${c.join(`
`)}`,`var value = ${s.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${s.getByIndices("input_indices")} ${n.selectLastIndex>0?"<=":"<"} value) {
         value = ${s.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};e.compute(sg("ArgMin",{hint:n.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],t,[n.axis],7,n.keepDims),{inputs:[0]})},y2=(e,n)=>{xy(e.inputs);let t=(s,i,l)=>{let c=[];for(let u=0;u<s.rank;u++)(l.indexOf(u)>=0||l.length===0)&&c.push(`input_indices[${u}] = 0;`);return[`${c.join(`
`)}`,`var value = ${s.getByIndices("input_indices")};
var best_index : i32 = 0;`,`if (${s.getByIndices("input_indices")} ${n.selectLastIndex>0?">=":">"} value) {
         value = ${s.getByIndices("input_indices")};
         best_index = i32(last_index);
       }`,"",i.setByOffset("global_idx","best_index")]};e.compute(sg("argMax",{hint:n.cacheKey,inputDependencies:["rank"]},[e.inputs[0]],t,[n.axis],7,n.keepDims),{inputs:[0]})},M0=e=>$n(e)}),Tw,S_,Ew,Sw,Cw,mm,Aw,v2,dv=ct(()=>{Wt(),en(),lv(),tn(),Tw=(e,n)=>{let t=e[0],s=e[1],i=e[2],l=e[3],c=e[4],u=e[5];if(c&&u)throw new Error("Attention cannot have both past and attention_bias");if(t.dims.length!==3)throw new Error('Input "input" must have 3 dimensions');let d=t.dims[0],f=t.dims[1],m=t.dims[2];if(i.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimensions');if(s.dims.length!==2)throw new Error('Input "weights" is expected to have 2 dimensions');if(s.dims[0]!==m)throw new Error("Input 1 dimension 0 should have same length as dimension 2 of input 0");if(i.dims[0]!==s.dims[1])throw new Error('Input "bias" dimension 0 should have same length as dimension 1 of input "weights"');let _=i.dims[0]/3,p=_,y=p;if(n.qkvHiddenSizes.length>0){if(n.qkvHiddenSizes.length!==3)throw new Error("qkv_hidden_sizes attribute should have 3 elements");for(let $ of n.qkvHiddenSizes)if($%n.numHeads!==0)throw new Error("qkv_hidden_sizes should be divisible by num_heads");_=n.qkvHiddenSizes[0],p=n.qkvHiddenSizes[1],y=n.qkvHiddenSizes[2]}let v=f;if(_!==p)throw new Error("qkv_hidden_sizes first element should be same as the second");if(i.dims[0]!==_+p+y)throw new Error('Input "bias" dimension 0 should have same length as sum of Q/K/V hidden sizes');let T=0;if(c){if(p!==y)throw new Error('Input "past" expect k_hidden_size == v_hidden_size');if(c.dims.length!==5)throw new Error('Input "past" must have 5 dimensions');if(c.dims[0]!==2)throw new Error('Input "past" first dimension must be 2');if(c.dims[1]!==d)throw new Error('Input "past" second dimension must be batch_size');if(c.dims[2]!==n.numHeads)throw new Error('Input "past" third dimension must be num_heads');if(c.dims[4]!==p/n.numHeads)throw new Error('Input "past" fifth dimension must be k_hidden_size / num_heads');n.pastPresentShareBuffer||(T=c.dims[3])}let k=v+T,b=-1,S=0;if(l)throw new Error("Mask not supported");if(c)throw new Error("past is not supported");if(u){if(u.dims.length!==4)throw new Error('Input "attention_bias" must have 4 dimensions');if(u.dims[0]!==d||u.dims[1]!==n.numHeads||u.dims[2]!==f||u.dims[3]!==k)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:d,sequenceLength:f,pastSequenceLength:T,kvSequenceLength:v,totalSequenceLength:k,maxSequenceLength:b,inputHiddenSize:m,hiddenSize:_,vHiddenSize:y,headSize:Math.floor(_/n.numHeads),vHeadSize:Math.floor(y/n.numHeads),numHeads:n.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:n.maskFilterValue,maskType:S,scale:n.scale,broadcastResPosBias:!1,passPastInKv:!1,qkvFormat:1}},S_=(e,n,t)=>n&&e?`
      let total_sequence_length_input = u32(${n.getByOffset("0")});
      let present_sequence_length = max(total_sequence_length_input, uniforms.past_sequence_length);
      let is_subsequent_prompt: bool = sequence_length > 1 && sequence_length != total_sequence_length_input;
      let is_first_prompt: bool = is_subsequent_prompt == false && sequence_length == total_sequence_length_input;
      total_sequence_length = u32(${e?.getByOffset("batchIdx")}) + 1;
      var past_sequence_length: u32 = 0;
      if (is_first_prompt == false) {
        past_sequence_length = total_sequence_length - sequence_length;
      }
       `:`
    ${t?"let past_sequence_length = uniforms.past_sequence_length":""};
    let present_sequence_length = total_sequence_length;
    `,Ew=(e,n,t,s,i,l,c,u)=>{let d=Sa(c?1:l),f=64,m=l/d;m<f&&(f=32);let _=Math.ceil(l/d/f),p=[{type:12,data:n},{type:12,data:t},{type:12,data:s},{type:12,data:i},{type:12,data:m},{type:12,data:_}],y=as(e.dataType,d),v=As(1,d),T=["type"];c&&T.push("type"),u&&T.push("type");let k=b=>{let S=At("x",e.dataType,e.dims,d),$=[S],w=c?Qe("seq_lens",c.dataType,c.dims):void 0;w&&$.push(w);let C=u?Qe("total_sequence_length_input",u.dataType,u.dims):void 0;C&&$.push(C);let P=As(e.dataType),A=[{name:"batch_size",type:"u32"},{name:"num_heads",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"sequence_length",type:"u32"},{name:"total_sequence_length",type:"u32"},{name:"elements_per_thread",type:"u32"}];return`
  var<workgroup> thread_max: array<f32, ${f}>;
  var<workgroup> thread_sum: array<f32, ${f}>;
  ${b.registerUniforms(A).declareVariables(...$)}
  ${b.mainStart([f,1,1])}
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let sequence_length = uniforms.sequence_length;
    var total_sequence_length = uniforms.total_sequence_length;
    ${S_(w,C,!1)}
    let local_offset = local_idx * uniforms.elements_per_thread;
    let offset = (global_idx / ${f}) * uniforms.total_sequence_length + local_offset;
    let seq_causal_length = ${c?"u32(past_sequence_length + workgroup_id.y + 1)":"total_sequence_length"};
    var thread_max_vector = ${v}(-3.402823e+38f);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      thread_max_vector = max(${v}(x[offset + i]), thread_max_vector);
    }
    thread_max[local_idx] = ${(()=>{switch(d){case 1:return"thread_max_vector";case 2:return"max(thread_max_vector.x, thread_max_vector.y)";case 4:return"max(max(thread_max_vector.x, thread_max_vector.y), max(thread_max_vector.z, thread_max_vector.w))";default:throw new Error(`Unsupported components: ${d}`)}})()};
    workgroupBarrier();

    var max_value =  f32(-3.402823e+38f);
    for (var i = 0u; i < ${f}; i++) {
      max_value = max(thread_max[i], max_value);
    }

    var sum_vector = ${v}(0);
    for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
      sum_vector += exp(${v}(x[offset + i]) - max_value);
    }
    thread_sum[local_idx] = ${(()=>{switch(d){case 1:return"sum_vector";case 2:return"sum_vector.x + sum_vector.y";case 4:return"sum_vector.x + sum_vector.y + sum_vector.z + sum_vector.w";default:throw new Error(`Unsupported components: ${d}`)}})()};
    workgroupBarrier();

    var sum: f32 = 0;
    for (var i = 0u; i < ${f}; i++) {
      sum += thread_sum[i];
    }

    if (sum == 0) {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        x[offset + i] = ${S.type.value}(${P}(1.0) / ${P}(seq_causal_length));
      }
    } else {
      for (var i: u32 = 0; i < uniforms.elements_per_thread && i + local_offset < seq_causal_length; i++) {
        var f32input = ${v}(x[offset + i]);
        x[offset + i] = ${S.type.value}(exp(f32input - max_value) / sum);
      }
    }
      ${c?`
        for (var total_seq_id: u32 = seq_causal_length; total_seq_id + local_offset < uniforms.total_sequence_length; total_seq_id++) {
          x[offset + total_seq_id] = ${S.type.value}(${P}(0));
        }`:""};
  }`};return{name:"AttentionProbsSoftmax",shaderCache:{hint:`${f};${y};${d}`,inputDependencies:T},getShaderSource:k,getRunData:()=>({outputs:[],dispatchGroup:{x:1,y:i,z:n*t},programUniforms:p})}},Sw=(e,n,t,s,i,l,c,u,d)=>{let f=c+l.kvSequenceLength,m=[l.batchSize,l.numHeads,l.sequenceLength,f],_=e>1&&s,p=l.kvNumHeads?l.kvNumHeads:l.numHeads,y=_?[l.batchSize,p,f,l.headSize]:void 0,v=l.nReps?l.nReps:1,T=l.scale===0?1/Math.sqrt(l.headSize):l.scale,k=Sa(l.headSize),b=l.headSize/k,S=12,$={x:Math.ceil(f/S),y:Math.ceil(l.sequenceLength/S),z:l.batchSize*l.numHeads},w=[{type:12,data:l.sequenceLength},{type:12,data:b},{type:12,data:f},{type:12,data:l.numHeads},{type:12,data:l.headSize},{type:1,data:T},{type:12,data:c},{type:12,data:l.kvSequenceLength},{type:12,data:v}],C=_&&s&&je.size(s.dims)>0,P=["type","type"];C&&P.push("type"),i&&P.push("type"),u&&P.push("type"),d&&P.push("type");let A=[{dims:m,dataType:n.dataType,gpuDataType:0}];_&&A.push({dims:y,dataType:n.dataType,gpuDataType:0});let I=W=>{let G=Qe("q",n.dataType,n.dims,k),q=Qe("key",t.dataType,t.dims,k),Z=[G,q];if(C){let he=Qe("past_key",s.dataType,s.dims,k);Z.push(he)}i&&Z.push(Qe("attention_bias",i.dataType,i.dims));let X=u?Qe("seq_lens",u.dataType,u.dims):void 0;X&&Z.push(X);let Q=d?Qe("total_sequence_length_input",d.dataType,d.dims):void 0;Q&&Z.push(Q);let te=At("output",n.dataType,m),R=[te];_&&R.push(At("present_key",n.dataType,y,k));let ee=As(1,k),ie=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"alpha",type:"f32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${S}u;

  var<workgroup> tileQ: array<${G.type.storage}, ${S*S}>;
  var<workgroup> tileK: array<${G.type.storage}, ${S*S}>;
  ${W.registerUniforms(ie).declareVariables(...Z,...R)}
  ${W.mainStart([S,S,1])}
    // x holds the N and y holds the M
    let headIdx = workgroup_id.z % uniforms.num_heads;
    let kvHeadIdx = ${v===1?"headIdx":"headIdx / uniforms.n_reps"};
    let kv_num_heads = ${v===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
    let batchIdx = workgroup_id.z / uniforms.num_heads;
    let m = workgroup_id.y * TILE_SIZE;
    let n = workgroup_id.x * TILE_SIZE;
    let sequence_length = uniforms.M;
    var total_sequence_length = uniforms.N;
    ${S_(X,Q,!0)}
    let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx;
    let qOffset = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
    ${C&&_?"let pastKeyOffset = absKvHeadIdx * uniforms.past_sequence_length * uniforms.K;":""};
    let kOffset = absKvHeadIdx * uniforms.kv_sequence_length * uniforms.K;
    ${_?"let presentKeyOffset = absKvHeadIdx * uniforms.N * uniforms.K;":""}
    var value = ${ee}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (global_id.y < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = q[qOffset + local_id.y * uniforms.K + w + local_id.x];
      }
      if (n + local_id.y < uniforms.N && w + local_id.x < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
      ${C&&_?`
              if (n + local_id.y < past_sequence_length) {
                tileK[idx] = past_key[pastKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
              } else if (n + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
                tileK[idx] = key[kOffset + (n + local_id.y - past_sequence_length) * uniforms.K + w + local_id.x];
              }`:`
          if (n + local_id.y < uniforms.kv_sequence_length) {
            tileK[idx] = key[kOffset + (n + local_id.y) * uniforms.K + w + local_id.x];
          }`}
      ${_?`if (n + local_id.y < present_sequence_length) {
        present_key[presentKeyOffset + (n + local_id.y) * uniforms.K + w + local_id.x] = tileK[idx];
      }`:""}
      }
      workgroupBarrier();

      for (var k: u32 = 0u; k < TILE_SIZE && w+k < uniforms.K; k++) {
          value += ${ee}(tileQ[TILE_SIZE * local_id.y + k] * tileK[TILE_SIZE * local_id.x + k]);
      }

      workgroupBarrier();
    }

    if (global_id.y < uniforms.M && global_id.x < total_sequence_length) {
      let headOffset = workgroup_id.z * uniforms.M * uniforms.N;
      let outputIdx = headOffset + global_id.y * uniforms.N + global_id.x;
      var sum: f32 = ${(()=>{switch(k){case 1:return"value";case 2:return"value.x + value.y";case 4:return"value.x + value.y + value.z + value.w";default:throw new Error(`Unsupported components: ${k}`)}})()};
        output[outputIdx] = ${te.type.value} (sum * uniforms.alpha) + ${i?"attention_bias[outputIdx]":"0.0"};
    }
  }`};return{name:"AttentionProbs",shaderCache:{hint:`${k};${i!==void 0};${s!==void 0};${e}`,inputDependencies:P},getRunData:()=>({outputs:A,dispatchGroup:$,programUniforms:w}),getShaderSource:I}},Cw=(e,n,t,s,i,l,c=void 0,u=void 0)=>{let d=l+i.kvSequenceLength,f=i.nReps?i.nReps:1,m=i.vHiddenSize*f,_=e>1&&s,p=i.kvNumHeads?i.kvNumHeads:i.numHeads,y=_?[i.batchSize,p,d,i.headSize]:void 0,v=[i.batchSize,i.sequenceLength,m],T=12,k={x:Math.ceil(i.vHeadSize/T),y:Math.ceil(i.sequenceLength/T),z:i.batchSize*i.numHeads},b=[{type:12,data:i.sequenceLength},{type:12,data:d},{type:12,data:i.vHeadSize},{type:12,data:i.numHeads},{type:12,data:i.headSize},{type:12,data:m},{type:12,data:l},{type:12,data:i.kvSequenceLength},{type:12,data:f}],S=_&&s&&je.size(s.dims)>0,$=["type","type"];S&&$.push("type"),c&&$.push("type"),u&&$.push("type");let w=[{dims:v,dataType:n.dataType,gpuDataType:0}];_&&w.push({dims:y,dataType:n.dataType,gpuDataType:0});let C=P=>{let A=Qe("probs",n.dataType,n.dims),I=Qe("v",t.dataType,t.dims),W=[A,I];S&&W.push(Qe("past_value",s.dataType,s.dims));let G=c?Qe("seq_lens",c.dataType,c.dims):void 0;c&&W.push(G);let q=u?Qe("total_sequence_length_input",u.dataType,u.dims):void 0;u&&W.push(q);let Z=[At("output",n.dataType,v)];_&&Z.push(At("present_value",n.dataType,y));let X=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"v_hidden_size",type:"u32"},{name:"past_sequence_length",type:"u32"},{name:"kv_sequence_length",type:"u32"},{name:"n_reps",type:"u32"}];return`
  const TILE_SIZE = ${T}u;
  var<workgroup> tileQ: array<${A.type.value}, ${T*T}>;
  var<workgroup> tileV: array<${A.type.value}, ${T*T}>;
  ${P.registerUniforms(X).declareVariables(...W,...Z)}
  ${P.mainStart([T,T,1])}
   let headIdx = workgroup_id.z % uniforms.num_heads;
   let batchIdx = workgroup_id.z / uniforms.num_heads;
   let kvHeadIdx = ${f===1?"headIdx":"headIdx / uniforms.n_reps"};
   let kv_num_heads = ${f===1?"uniforms.num_heads":"uniforms.num_heads / uniforms.n_reps"};
   let m = global_id.y;
   let n = global_id.x;
   let sequence_length = uniforms.M;
   var total_sequence_length = uniforms.K;
   ${S_(G,q,!0)}
   let offsetA = workgroup_id.z * uniforms.M * uniforms.K + m * uniforms.K;
   let absKvHeadIdx = batchIdx * kv_num_heads + kvHeadIdx; // kvHeadIdx is relative to the batch
   ${S&&_?"let pastValueOffset = absKvHeadIdx * uniforms.N * uniforms.past_sequence_length + n;":""};
   let vOffset = absKvHeadIdx * uniforms.N * uniforms.kv_sequence_length + n;
   ${_?"let presentValueOffset = absKvHeadIdx * uniforms.N * uniforms.K + n;":""}
   var value = ${A.type.storage}(0);
   for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileQ[TILE_SIZE * local_id.y + local_id.x] = probs[offsetA + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        var idx = TILE_SIZE * local_id.y + local_id.x;
        ${S&&_?`
        if (w + local_id.y < past_sequence_length) {
          tileV[idx] = past_value[pastValueOffset + (w + local_id.y) * uniforms.N];
        } else if (w + local_id.y - past_sequence_length < uniforms.kv_sequence_length) {
          tileV[idx] = v[vOffset + (w + local_id.y - past_sequence_length) * uniforms.N];
        }
      `:`
            if (w + local_id.y < uniforms.kv_sequence_length) {
              tileV[idx] = v[vOffset + (w + local_id.y) * uniforms.N];
            }`}
        ${_?`
            if (w + local_id.y < present_sequence_length) {
          present_value[presentValueOffset + (w + local_id.y) * uniforms.N] = tileV[idx];
        }`:""}
      }
     workgroupBarrier();
     for (var k: u32 = 0u; k < TILE_SIZE && w+k < total_sequence_length; k++) {
       value += tileQ[TILE_SIZE * local_id.y + k] * tileV[TILE_SIZE * k + local_id.x];
     }
     workgroupBarrier();
   }

   // we need to transpose output from BNSH_v to BSND_v
   if (m < uniforms.M && n < uniforms.N) {
     let outputIdx = batchIdx * uniforms.M * uniforms.v_hidden_size + m * uniforms.v_hidden_size
       + headIdx * uniforms.N + n;
     output[outputIdx] = value;
   }
  }`};return{name:"AttentionScore",shaderCache:{hint:`${s!==void 0};${e}`,inputDependencies:$},getRunData:()=>({outputs:w,dispatchGroup:k,programUniforms:b}),getShaderSource:C}},mm=(e,n,t,s,i,l,c,u,d,f,m=void 0,_=void 0)=>{let p=Math.min(e.outputCount,1+(c?1:0)+(u?1:0)),y=p>1?f.pastSequenceLength:0,v=y+f.kvSequenceLength,T=d&&je.size(d.dims)>0?d:void 0,k=[n,t];p>1&&c&&je.size(c.dims)>0&&k.push(c),T&&k.push(T),m&&k.push(m),_&&k.push(_);let b=e.compute(Sw(p,n,t,c,T,f,y,m,_),{inputs:k,outputs:p>1?[-1,1]:[-1]})[0];e.compute(Ew(b,f.batchSize,f.numHeads,y,f.sequenceLength,v,m,_),{inputs:m&&_?[b,m,_]:[b],outputs:[]});let S=[b,s];p>1&&u&&je.size(u.dims)>0&&S.push(u),m&&S.push(m),_&&S.push(_),e.compute(Cw(p,b,s,u,f,y,m,_),{inputs:S,outputs:p>1?[0,2]:[0]})},Aw=(e,n)=>{let t=[n.batchSize,n.numHeads,n.sequenceLength,n.headSize],s=n.sequenceLength,i=n.inputHiddenSize,l=n.headSize,c=12,u={x:Math.ceil(n.headSize/c),y:Math.ceil(n.sequenceLength/c),z:n.batchSize*n.numHeads},d=[e.inputs[0],e.inputs[1],e.inputs[2]],f=[{type:12,data:s},{type:12,data:i},{type:12,data:l},{type:12,data:n.numHeads},{type:12,data:n.headSize},{type:12,data:n.hiddenSize},{type:12,data:n.hiddenSize+n.hiddenSize+n.vHiddenSize}],m=_=>{let p=At("output_q",d[0].dataType,t),y=At("output_k",d[0].dataType,t),v=At("output_v",d[0].dataType,t),T=Qe("input",d[0].dataType,d[0].dims),k=Qe("weight",d[1].dataType,d[1].dims),b=Qe("bias",d[2].dataType,d[2].dims),S=T.type.storage,$=[{name:"M",type:"u32"},{name:"K",type:"u32"},{name:"N",type:"u32"},{name:"num_heads",type:"u32"},{name:"head_size",type:"u32"},{name:"hidden_size",type:"u32"},{name:"ldb",type:"u32"}];return`
  const TILE_SIZE = ${c}u;
  var<workgroup> tileInput: array<${S}, ${c*c}>;
  var<workgroup> tileWeightQ: array<${S}, ${c*c}>;
  var<workgroup> tileWeightK: array<${S}, ${c*c}>;
  var<workgroup> tileWeightV: array<${S}, ${c*c}>;
  ${_.registerUniforms($).declareVariables(T,k,b,p,y,v)}
  ${_.mainStart([c,c,1])}
    let batchIndex = workgroup_id.z / uniforms.num_heads;
    let headNumber = workgroup_id.z % uniforms.num_heads;
    let m = global_id.y;
    let n = global_id.x;

    let inputOffset = batchIndex * (uniforms.M * uniforms.K) + m * uniforms.K;
    let biasOffsetQ = headNumber * uniforms.head_size;
    let biasOffsetK = uniforms.hidden_size + biasOffsetQ;
    let biasOffsetV = uniforms.hidden_size + biasOffsetK;

    var valueQ = ${S}(0);
    var valueK = ${S}(0);
    var valueV = ${S}(0);
    for (var w: u32 = 0u; w < uniforms.K; w += TILE_SIZE) {
      if (m < uniforms.M && w + local_id.x < uniforms.K) {
        tileInput[TILE_SIZE * local_id.y + local_id.x] = input[inputOffset + w + local_id.x];
      }
      if (n < uniforms.N && w + local_id.y < uniforms.K) {
        let offset = n + (w + local_id.y) * uniforms.ldb;
        tileWeightQ[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetQ + offset];
        tileWeightK[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetK + offset];
        tileWeightV[TILE_SIZE * local_id.y + local_id.x] = weight[biasOffsetV + offset];
      }
      workgroupBarrier();
      for (var k: u32 = 0u; k<TILE_SIZE && w+k < uniforms.K; k++) {
        let inputTileOffset = TILE_SIZE * local_id.y + k;
        let weightTileOffset = TILE_SIZE * k + local_id.x;
        valueQ += tileInput[inputTileOffset] * tileWeightQ[weightTileOffset];
        valueK += tileInput[inputTileOffset] * tileWeightK[weightTileOffset];
        valueV += tileInput[inputTileOffset] * tileWeightV[weightTileOffset];
      }

      workgroupBarrier();
    }

    let headOffset = (m * uniforms.N + n) % uniforms.head_size;
    valueQ += bias[headOffset + biasOffsetQ];
    valueK += bias[headOffset + biasOffsetK];
    valueV += bias[headOffset + biasOffsetV];

    let offset = workgroup_id.z * uniforms.M * uniforms.N;
    if (m < uniforms.M && n < uniforms.N) {
      let outputIdx = offset + m * uniforms.N + n;
      output_q[outputIdx] = valueQ;
      output_k[outputIdx] = valueK;
      output_v[outputIdx] = valueV;
    }
  }`};return e.compute({name:"AttentionPrepare",shaderCache:{inputDependencies:["type","type","type"]},getRunData:()=>({outputs:[{dims:t,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:t,dataType:e.inputs[0].dataType,gpuDataType:0},{dims:t,dataType:e.inputs[0].dataType,gpuDataType:0}],dispatchGroup:u,programUniforms:f}),getShaderSource:m},{inputs:d,outputs:[-1,-1,-1]})},v2=(e,n)=>{let t=Tw(e.inputs,n),[s,i,l]=Aw(e,t);return mm(e,s,i,l,e.inputs[4],void 0,void 0,void 0,e.inputs[5],t)}}),Pw,kw,$w,b2,K$=ct(()=>{vi(),Wt(),en(),Fa(),tn(),Pw=(e,n)=>{if(!e||e.length!==5)throw new Error("BatchNormalization requires 5 inputs");let t=(s,i,l)=>{let c=i.length;if(c!==s.length)throw new Error(`${l}: num dimensions != ${c}`);i.forEach((u,d)=>{if(u!==s[d])throw new Error(`${l}: dim[${d}] do not match`)})};if(e[0].dims.length>1){let s=n.format==="NHWC"?n.spatial?e[0].dims.slice(-1):e[0].dims.slice(-1).concat(e[0].dims.slice(1,e[0].dims.length-1)):e[0].dims.slice(1,n.spatial?2:void 0);t(e[1].dims,s,"Invalid input scale"),t(e[2].dims,s,"Invalid input B"),t(e[3].dims,s,"Invalid input mean"),t(e[4].dims,s,"Invalid input var")}else t(e[1].dims,[1],"Invalid input scale"),t(e[2].dims,[1],"Invalid input B"),t(e[3].dims,[1],"Invalid input mean"),t(e[4].dims,[1],"Invalid input var")},kw=(e,n)=>{let{epsilon:t,spatial:s,format:i}=n,l=e[0].dims,c=s?Sa(l[l.length-1]):1,u=i==="NHWC"&&l.length>1?c:1,d=je.size(l)/c,f=s,m=f?l.length:l,_=Qe("x",e[0].dataType,e[0].dims,c),p=Qe("scale",e[1].dataType,e[1].dims,u),y=Qe("bias",e[2].dataType,e[2].dims,u),v=Qe("inputMean",e[3].dataType,e[3].dims,u),T=Qe("inputVar",e[4].dataType,e[4].dims,u),k=At("y",e[0].dataType,m,c),b=()=>{let $="";if(s)$=`let cOffset = ${l.length===1?"0u":i==="NHWC"?`outputIndices[${l.length-1}] / ${c}`:"outputIndices[1]"};`;else if(i==="NCHW")$=`
            ${k.indicesSet("outputIndices","0","0")}
            let cOffset = ${k.indicesToOffset("outputIndices")};`;else{$=`var cIndices = ${p.type.indices}(0);
                       cIndices[0] = outputIndices[${l.length-1}];`;for(let w=1;w<p.rank;w++)$+=`cIndices[${w}] = outputIndices[${w}];`;$+=`let cOffset = ${p.indicesToOffset("cIndices")};`}return $},S=$=>`
  const epsilon = ${t};
  ${$.registerUniform("outputSize","u32").declareVariables(_,p,y,v,T,k)}
  ${$.mainStart()}
  ${$.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
    var outputIndices = ${k.offsetToIndices(`global_idx * ${c}`)};
    ${b()}
    let scale = ${p.getByOffset("cOffset")};
    let bias = ${y.getByOffset("cOffset")};
    let inputMean = ${v.getByOffset("cOffset")};
    let inputVar = ${T.getByOffset("cOffset")};
    let x = ${_.getByOffset("global_idx")};
    let value = (x - inputMean) * inverseSqrt(inputVar + epsilon) * scale + bias;
    ${k.setByOffset("global_idx","value")}
  }`;return{name:"BatchNormalization",shaderCache:{hint:`${n.epsilon}_${n.format}_${s}_${c}`,inputDependencies:f?["rank","type","type","type","type"]:void 0},getShaderSource:S,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:f?[{type:12,data:d},...zt(l)]:[{type:12,data:d}]})}},$w=e=>$n(e),b2=(e,n)=>{let{inputs:t,outputCount:s}=e,i=$w({...n,outputCount:s});if(da.webgpu.validateInputContent&&Pw(t,i),n.trainingMode)throw new Error("BatchNormalization trainingMode is not supported yet.");e.compute(kw(t,i))}}),Dw,Ow,w2,Q$=ct(()=>{en(),tn(),Dw=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![320,640,1280].includes(e[0].dims[2]))throw new Error("number of channels should be 320, 640 or 1280");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},Ow=e=>{let n=e[0].dims,t=e[0].dims[2],s=je.size(n)/4,i=e[0].dataType,l=Qe("input",i,n,4),c=Qe("bias",i,[t],4),u=Qe("residual",i,n,4),d=At("output",i,n,4);return{name:"BiasAdd",getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(s/64)}}),getShaderSource:f=>`
  const channels = ${t}u / 4;
  ${f.declareVariables(l,c,u,d)}

  ${f.mainStart()}
    ${f.guardAgainstOutOfBoundsWorkgroupSizes(s)}
    let value = ${l.getByOffset("global_idx")}
      + ${c.getByOffset("global_idx % channels")} + ${u.getByOffset("global_idx")};
    ${d.setByOffset("global_idx","value")}
  }`}},w2=e=>{Dw(e.inputs),e.compute(Ow(e.inputs))}}),Iw,Cn,M2,x2,T2,E2,S2,C2,A2,P2,k2,zw,$2,D2,O2,I2,rm,z2,q_,L2,F2,N2,j2,R2,B2,U2,V2,G2,W2,H2,q2,K2,Q2,X2,Y2,Ty,Z2,x0,T0,J2,eE,tE,Lw,Fw,nE,fv=ct(()=>{Wt(),en(),Fa(),tn(),Iw=(e,n,t,s,i,l,c)=>{let u=Math.ceil(n/4),d="";typeof i=="string"?d=`${i}(a)`:d=i("a");let f=Qe("inputData",t,[u],4),m=At("outputData",s,[u],4),_=[{name:"vec_size",type:"u32"}];return c&&_.push(...c),`
      ${e.registerUniforms(_).declareVariables(f,m)}

  ${l??""}

  ${e.mainStart()}
    ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}

    let a = ${f.getByOffset("global_idx")};
    ${m.setByOffset("global_idx",d)}
  }`},Cn=(e,n,t,s,i,l=e.dataType,c,u)=>{let d=[{type:12,data:Math.ceil(je.size(e.dims)/4)}];return c&&d.push(...c),{name:n,shaderCache:{hint:i,inputDependencies:["type"]},getShaderSource:f=>Iw(f,je.size(e.dims),e.dataType,l,t,s,u),getRunData:f=>({outputs:[{dims:e.dims,dataType:l}],dispatchGroup:{x:Math.ceil(je.size(f[0].dims)/64/4)},programUniforms:d})}},M2=e=>{e.compute(Cn(e.inputs[0],"Abs","abs"))},x2=e=>{e.compute(Cn(e.inputs[0],"Acos","acos"))},T2=e=>{e.compute(Cn(e.inputs[0],"Acosh","acosh"))},E2=e=>{e.compute(Cn(e.inputs[0],"Asin","asin"))},S2=e=>{e.compute(Cn(e.inputs[0],"Asinh","asinh"))},C2=e=>{e.compute(Cn(e.inputs[0],"Atan","atan"))},A2=e=>{e.compute(Cn(e.inputs[0],"Atanh","atanh"))},P2=e=>$n(e),k2=(e,n)=>{let t;switch(n.to){case 10:t="vec4<f16>";break;case 1:t="vec4<f32>";break;case 12:t="vec4<u32>";break;case 6:t="vec4<i32>";break;case 9:t="vec4<bool>";break;default:throw new RangeError(`not supported type (specified in attribute 'to' from 'Cast' operator): ${n.to}`)}e.compute(Cn(e.inputs[0],"Cast",t,void 0,n.cacheKey,n.to))},zw=e=>{let n,t,s=e.length>=2&&e[1].data!==0,i=e.length>=3&&e[2].data!==0;switch(e[0].dataType){case 1:n=s?e[1].getFloat32Array()[0]:-34028234663852886e22,t=i?e[2].getFloat32Array()[0]:34028234663852886e22;break;case 10:n=s?e[1].getUint16Array()[0]:64511,t=i?e[2].getUint16Array()[0]:31743;break;default:throw new Error("Unsupport data type")}return $n({min:n,max:t})},$2=(e,n)=>{let t=n||zw(e.inputs),s=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"Clip",i=>`clamp(${i}, vec4<${s}>(uniforms.min), vec4<${s}>(uniforms.max))`,void 0,t.cacheKey,void 0,[{type:e.inputs[0].dataType,data:t.min},{type:e.inputs[0].dataType,data:t.max}],[{name:"min",type:s},{name:"max",type:s}]),{inputs:[0]})},D2=e=>{e.compute(Cn(e.inputs[0],"Ceil","ceil"))},O2=e=>{e.compute(Cn(e.inputs[0],"Cos","cos"))},I2=e=>{e.compute(Cn(e.inputs[0],"Cosh","cosh"))},rm=e=>$n(e),z2=(e,n)=>{let t=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"Elu",s=>`elu_vf32(${s})`,`
  const elu_alpha_ = ${t}(${n.alpha});

  fn elu_f32(a: ${t}) -> ${t} {
  return select((exp(a) - 1.0) * elu_alpha_, a, a >= 0.0);
  }

  fn elu_vf32(v: vec4<${t}>) -> vec4<${t}> {
  return vec4(elu_f32(v.x), elu_f32(v.y), elu_f32(v.z), elu_f32(v.w));
  }`,n.cacheKey))},q_=(e="f32")=>`
const r0: ${e} = 0.3275911;
const r1: ${e} = 0.254829592;
const r2: ${e} = -0.284496736;
const r3: ${e} = 1.421413741;
const r4: ${e} = -1.453152027;
const r5: ${e} = 1.061405429;

fn erf_vf32(v: vec4<${e}>) -> vec4<${e}> {
  let absv = abs(v);
  let x = 1.0 / (1.0 + r0 * absv);
  return sign(v) * (1.0 - ((((r5 * x + r4) * x + r3) * x + r2) * x + r1) * x * exp(-absv * absv));
}`,L2=e=>{let n=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"Erf",t=>`erf_vf32(${t})`,q_(n)))},F2=e=>{e.compute(Cn(e.inputs[0],"Exp","exp"))},N2=e=>{e.compute(Cn(e.inputs[0],"Floor","floor"))},j2=e=>{let n=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"Gelu",t=>`0.5 * ${t} * (1.0 + erf_vf32(${t} * 0.7071067811865475))`,q_(n)))},R2=(e,n)=>{let t=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"LeakyRelu",s=>`select(leaky_relu_alpha_ * ${s}, ${s}, ${s} >= vec4<${t}>(0.0))`,`const leaky_relu_alpha_ = ${t}(${n.alpha});`,n.cacheKey))},B2=e=>{e.compute(Cn(e.inputs[0],"Not",n=>`!${n}`))},U2=e=>{e.compute(Cn(e.inputs[0],"Neg",n=>`-${n}`))},V2=e=>{e.compute(Cn(e.inputs[0],"Reciprocal",n=>`1.0/${n}`))},G2=e=>{let n=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"Relu",t=>`select(vec4<${n}>(0.0), ${t}, ${t} > vec4<${n}>(0.0))`))},W2=e=>{e.compute(Cn(e.inputs[0],"Sigmoid",n=>`(1.0 / (1.0 + exp(-${n})))`))},H2=e=>$n(e),q2=(e,n)=>{let t=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"HardSigmoid",s=>`max(vec4<${t}>(0.0), min(vec4<${t}>(1.0), ${n.alpha} * ${s} + vec4<${t}>(${n.beta})))`,void 0,n.cacheKey))},K2=e=>{e.compute(Cn(e.inputs[0],"Sin","sin"))},Q2=e=>{e.compute(Cn(e.inputs[0],"Sinh","sinh"))},X2=e=>{e.compute(Cn(e.inputs[0],"Sqrt","sqrt"))},Y2=e=>{e.compute(Cn(e.inputs[0],"Tan","tan"))},Ty=e=>`sign(${e}) * (1 - exp(-2 * abs(${e}))) / (1 + exp(-2 * abs(${e})))`,Z2=e=>{e.compute(Cn(e.inputs[0],"Tanh",Ty))},x0=(e="f32")=>`
const fast_gelu_a: ${e} = 0.5;
const fast_gelu_b: ${e} = 0.7978845608028654;
const fast_gelu_c: ${e} = 0.035677408136300125;

fn tanh_v(v: vec4<${e}>) -> vec4<${e}> {
  return ${Ty("v")};
}
`,T0=e=>`(fast_gelu_a + fast_gelu_a * tanh_v(${e} * (fast_gelu_c * ${e} * ${e} + fast_gelu_b))) * ${e}`,J2=e=>{let n=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"FastGelu",T0,x0(n),void 0,e.inputs[0].dataType))},eE=(e,n)=>{let t=As(e.inputs[0].dataType);return e.compute(Cn(e.inputs[0],"ThresholdedRelu",s=>`select(vec4<${t}>(0.0), ${s}, ${s} > thresholded_relu_alpha_)`,`const thresholded_relu_alpha_ = vec4<${t}>(${n.alpha});`,n.cacheKey)),0},tE=e=>{e.compute(Cn(e.inputs[0],"Log","log"))},Lw=(e,n)=>`
const alpha = vec4<${e}>(${n});
const one = ${e}(1.0);
const zero = ${e}(0.0);

fn quick_gelu_impl(x: vec4<${e}>) -> vec4<${e}> {
  let v = x *alpha;
  var x1 : vec4<${e}>;
  for (var i = 0; i < 4; i = i + 1) {
    if (v[i] >= zero) {
      x1[i] = one / (one + exp(-v[i]));
    } else {
      x1[i] = one - one / (one + exp(v[i]));
    }
  }
  return x * x1;
}
`,Fw=e=>`quick_gelu_impl(${e})`,nE=(e,n)=>{let t=As(e.inputs[0].dataType);e.compute(Cn(e.inputs[0],"QuickGelu",Fw,Lw(t,n.alpha),n.cacheKey,e.inputs[0].dataType))}}),Nw,jw,aE,X$=ct(()=>{en(),tn(),fv(),Nw=e=>{if(e[0].dims.length!==3)throw new Error("input should have 3 dimensions");if(![2560,5120,10240].includes(e[0].dims[2]))throw new Error("hidden state should be 2560, 5120 or 10240");if(e[1].dims.length!==1)throw new Error("bias is expected to have 1 dimensions");if(e[0].dims[2]!==e[1].dims[0])throw new Error("last dimension of input and bias are not the same")},jw=e=>{let n=e[0].dims.slice();n[2]=n[2]/2;let t=Qe("input",e[0].dataType,e[0].dims,4),s=Qe("bias",e[0].dataType,[e[0].dims[2]],4),i=At("output",e[0].dataType,n,4),l=je.size(n)/4,c=as(e[0].dataType);return{name:"BiasSplitGelu",getRunData:()=>({outputs:[{dims:n,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)}}),getShaderSource:u=>`
  const M_SQRT2 = sqrt(2.0);
  const halfChannels = ${e[0].dims[2]/4/2}u;

  ${u.declareVariables(t,s,i)}

  ${q_(c)}

  ${u.mainStart()}
    ${u.guardAgainstOutOfBoundsWorkgroupSizes(l)}
    let biasIdx = global_idx % halfChannels;
    let batchIndex = global_idx / halfChannels;
    let inputOffset = biasIdx + batchIndex * halfChannels * 2;
    let valueLeft = input[inputOffset] + bias[biasIdx];
    let valueRight = input[inputOffset + halfChannels] + bias[biasIdx + halfChannels];
    let geluRight = valueRight * 0.5 * (erf_vf32(valueRight / M_SQRT2) + 1);

    ${i.setByOffset("global_idx","valueLeft * geluRight")}
  }`}},aE=e=>{Nw(e.inputs),e.compute(jw(e.inputs))}}),Rw,Bw,fi,sE,rE,iE,oE,lE,cE,uE,dE,fE,hE,Y$=ct(()=>{Wt(),en(),tn(),Rw=(e,n,t,s,i,l,c,u,d,f,m,_)=>{let p,y;typeof u=="string"?p=y=(S,$)=>`${u}((${S}),(${$}))`:typeof u=="function"?p=y=u:(p=u.scalar,y=u.vector);let v=At("outputData",m,s.length,4),T=Qe("aData",d,n.length,4),k=Qe("bData",f,t.length,4),b;if(i)if(l){let S=je.size(n)===1,$=je.size(t)===1,w=n.length>0&&n[n.length-1]%4===0,C=t.length>0&&t[t.length-1]%4===0;S||$?b=v.setByOffset("global_idx",y(S?`${T.type.value}(${T.getByOffset("0")}.x)`:T.getByOffset("global_idx"),$?`${k.type.value}(${k.getByOffset("0")}.x)`:k.getByOffset("global_idx"))):b=`
            let outputIndices = ${v.offsetToIndices("global_idx * 4u")};
            let offsetA = ${T.broadcastedIndicesToOffset("outputIndices",v)};
            let offsetB = ${k.broadcastedIndicesToOffset("outputIndices",v)};
            ${v.setByOffset("global_idx",y(c||w?T.getByOffset("offsetA / 4u"):`${T.type.value}(${T.getByOffset("offsetA / 4u")}[offsetA % 4u])`,c||C?k.getByOffset("offsetB / 4u"):`${k.type.value}(${k.getByOffset("offsetB / 4u")}[offsetB % 4u])`))}
          `}else b=v.setByOffset("global_idx",y(T.getByOffset("global_idx"),k.getByOffset("global_idx")));else{if(!l)throw new Error("no necessary to use scalar implementation for element-wise binary op implementation.");let S=($,w,C="")=>{let P=`aData[indexA${w}][componentA${w}]`,A=`bData[indexB${w}][componentB${w}]`;return`
            let outputIndices${w} = ${v.offsetToIndices(`global_idx * 4u + ${w}u`)};
            let offsetA${w} = ${T.broadcastedIndicesToOffset(`outputIndices${w}`,v)};
            let offsetB${w} = ${k.broadcastedIndicesToOffset(`outputIndices${w}`,v)};
            let indexA${w} = offsetA${w} / 4u;
            let indexB${w} = offsetB${w} / 4u;
            let componentA${w} = offsetA${w} % 4u;
            let componentB${w} = offsetB${w} % 4u;
            ${$}[${w}] = ${C}(${p(P,A)});
          `};m===9?b=`
            var data = vec4<u32>(0);
            ${S("data",0,"u32")}
            ${S("data",1,"u32")}
            ${S("data",2,"u32")}
            ${S("data",3,"u32")}
            outputData[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:b=`
            ${S("outputData[global_idx]",0)}
            ${S("outputData[global_idx]",1)}
            ${S("outputData[global_idx]",2)}
            ${S("outputData[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(T,k,v)}

        ${_??""}

        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${b}
      }`},Bw=(e,n,t,s,i,l,c=t.dataType)=>{let u=t.dims.map(T=>Number(T)??1),d=s.dims.map(T=>Number(T)??1),f=!je.areEqual(u,d),m=u,_=je.size(u),p=!1,y=!1,v=[f];if(f){let T=bf.calcShape(u,d,!1);if(!T)throw new Error("Can't perform binary op on the given tensors");m=T.slice(),_=je.size(m);let k=je.size(u)===1,b=je.size(d)===1,S=u.length>0&&u[u.length-1]%4===0,$=d.length>0&&d[d.length-1]%4===0;v.push(k),v.push(b),v.push(S),v.push($);let w=1;for(let C=1;C<m.length;C++){let P=u[u.length-C],A=d[d.length-C];if(P===A)w*=P;else break}w%4===0?(y=!0,p=!0):(k||b||S||$)&&(p=!0)}else p=!0;return v.push(p),{name:e,shaderCache:{hint:n+v.map(T=>T.toString()).join("_"),inputDependencies:["rank","rank"]},getShaderSource:T=>Rw(T,u,d,m,p,f,y,i,t.dataType,s.dataType,c,l),getRunData:()=>({outputs:[{dims:m,dataType:c}],dispatchGroup:{x:Math.ceil(_/64/4)},programUniforms:[{type:12,data:Math.ceil(je.size(m)/4)},...zt(u,d,m)]})}},fi=(e,n,t,s,i,l)=>{e.compute(Bw(n,i??"",e.inputs[0],e.inputs[1],t,s,l))},sE=e=>{fi(e,"Add",(n,t)=>`${n}+${t}`)},rE=e=>{fi(e,"Div",(n,t)=>`${n}/${t}`)},iE=e=>{fi(e,"Equal",{scalar:(n,t)=>`u32(${n}==${t})`,vector:(n,t)=>`vec4<u32>(${n}==${t})`},void 0,void 0,9)},oE=e=>{fi(e,"Mul",(n,t)=>`${n}*${t}`)},lE=e=>{let n=Qe("input",e.inputs[0].dataType,e.inputs[0].dims).type.value;fi(e,"Pow",{scalar:(t,s)=>`pow_custom(${t},${s})`,vector:(t,s)=>`pow_vector_custom(${t},${s})`},`
    fn pow_custom(a : ${n}, b : ${n}) -> ${n} {
      if (b == ${n}(0.0)) {
        return ${n}(1.0);
      } else if (a < ${n}(0.0) && f32(b) != floor(f32(b))) {
        return ${n}(pow(f32(a), f32(b))); // NaN
      }
      return select(sign(a), ${n}(1.0), round(f32(abs(b) % ${n}(2.0))) != 1.0) * ${n}(${n==="i32"?"round":""}(pow(f32(abs(a)), f32(b))));
    }
    fn pow_vector_custom(a : vec4<${n}>, b : vec4<${n}>) -> vec4<${n}> {
      // TODO: implement vectorized pow
      return vec4<${n}>(pow_custom(a.x, b.x), pow_custom(a.y, b.y), pow_custom(a.z, b.z), pow_custom(a.w, b.w));
    }
      `)},cE=e=>{fi(e,"Sub",(n,t)=>`${n}-${t}`)},uE=e=>{fi(e,"Greater",{scalar:(n,t)=>`u32(${n}>${t})`,vector:(n,t)=>`vec4<u32>(${n}>${t})`},void 0,void 0,9)},dE=e=>{fi(e,"Less",{scalar:(n,t)=>`u32(${n}<${t})`,vector:(n,t)=>`vec4<u32>(${n}<${t})`},void 0,void 0,9)},fE=e=>{fi(e,"GreaterOrEqual",{scalar:(n,t)=>`u32(${n}>=${t})`,vector:(n,t)=>`vec4<u32>(${n}>=${t})`},void 0,void 0,9)},hE=e=>{fi(e,"LessOrEqual",{scalar:(n,t)=>`u32(${n}<=${t})`,vector:(n,t)=>`vec4<u32>(${n}<=${t})`},void 0,void 0,9)}}),Uw,Vw,Gw,Ww,pE,mE,Z$=ct(()=>{Wt(),en(),Fa(),tn(),Uw=(e,n)=>{if(!e||e.length<1)throw new Error("too few inputs");let t=0,s=e[t],i=s.dataType,l=s.dims.length;e.forEach((c,u)=>{if(u!==t){if(c.dataType!==i)throw new Error("input tensors should be one type");if(c.dims.length!==l)throw new Error("input tensors should have the same shape");c.dims.forEach((d,f)=>{if(f!==n&&d!==s.dims[f])throw new Error("non concat dimensions must match")})}})},Vw=(e,n)=>`
  fn calculateInputIndex(index: u32) -> u32 {
    let sizeInConcatAxis = array<u32, ${e}u>(${n});
    for (var i: u32 = 0u; i < ${e}; i += 1u ) {
      if (index < sizeInConcatAxis[i]) {
        return i;
      }
    }
    return ${e}u;
  }`,Gw=(e,n)=>{let t=e.length,s=[];for(let i=0;i<t;++i){let l=n.setByOffset("global_idx",e[i].getByIndices("indices"));t===1?s.push(l):i===0?s.push(`if (inputIndex == ${i}u) { ${l} }`):i===t-1?s.push(`else { ${l} }`):s.push(`else if (inputIndex == ${i}) { ${l} }`)}return s.join(`
`)},Ww=(e,n,t,s)=>{let i=je.size(t),l=new Array(e.length),c=new Array(e.length),u=0,d=[],f=[],m=[{type:12,data:i}];for(let T=0;T<e.length;++T)u+=e[T].dims[n],l[T]=u,f.push(e[T].dims.length),c[T]=Qe(`input${T}`,s,f[T]),d.push("rank"),m.push({type:12,data:l[T]});for(let T=0;T<e.length;++T)m.push(...zt(e[T].dims));m.push(...zt(t));let _=At("output",s,t.length),p=_.indicesGet("indices",n),y=Array.from(Array(l.length).keys()).map(T=>`uniforms.sizeInConcatAxis${T}`).join(","),v=T=>`

  ${(()=>{T.registerUniform("outputSize","u32");for(let k=0;k<e.length;k++)T.registerUniform(`sizeInConcatAxis${k}`,"u32");return T.declareVariables(...c,_)})()}

  ${Vw(l.length,y)}

  ${T.mainStart()}
    ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

    var indices = ${_.offsetToIndices("global_idx")};

    let inputIndex = calculateInputIndex(${p});
    if (inputIndex != 0u) {
      let sizeInConcatAxis = array<u32, ${l.length}u>(${y});
      ${p} -= sizeInConcatAxis[inputIndex - 1u];
    }

    ${Gw(c,_)}
  }`;return{name:"Concat",shaderCache:{hint:`${n}`,inputDependencies:d},getRunData:()=>({outputs:[{dims:t,dataType:s}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:m}),getShaderSource:v}},pE=(e,n)=>{let t=e.inputs,s=t[0].dims,i=je.normalizeAxis(n.axis,s.length);Uw(t,i);let l=s.slice();l[i]=t.reduce((u,d)=>u+(d.dims.length>i?d.dims[i]:0),0);let c=t.filter(u=>je.size(u.dims)>0);e.compute(Ww(c,i,l,t[0].dataType),{inputs:c})},mE=e=>$n({axis:e.axis})}),Eu,Su,Cu,hv,$u=ct(()=>{Wt(),en(),Eu=(e,n,t="f32")=>{switch(e.activation){case"Relu":return`value = max(value, ${n}(0.0));`;case"Sigmoid":return`value = (${n}(1.0) / (${n}(1.0) + exp(-value)));`;case"Clip":return`value = clamp(value, ${n}(${t}(uniforms.clip_min)), ${n}(${t}(uniforms.clip_max)));`;case"HardSigmoid":return`value = max(${n}(0.0), min(${n}(1.0), ${t}(uniforms.alpha) * value + ${t}(uniforms.beta)));`;case"LeakyRelu":return`value = select(${t}(uniforms.alpha) * value, value, value >= ${n}(0.0));`;case"Tanh":return`let e2x = exp(-2.0 * abs(value));
              value = sign(value) * (1.0 - e2x) / (1.0 + e2x);
        `;case"":return"";default:throw new Error(`Unsupported activation ${e.activation}`)}},Su=(e,n)=>{e.activation==="Clip"?n.push({type:1,data:e.clipMax},{type:1,data:e.clipMin}):e.activation==="HardSigmoid"?n.push({type:1,data:e.alpha},{type:1,data:e.beta}):e.activation==="LeakyRelu"&&n.push({type:1,data:e.alpha})},Cu=(e,n)=>{e.activation==="Clip"?n.push({name:"clip_max",type:"f32"},{name:"clip_min",type:"f32"}):e.activation==="HardSigmoid"?n.push({name:"alpha",type:"f32"},{name:"beta",type:"f32"}):e.activation==="LeakyRelu"&&n.push({name:"alpha",type:"f32"})},hv=e=>{let n=e?.activation||"";if(n==="HardSigmoid"){let[t,s]=e?.activation_params||[.2,.5];return{activation:n,alpha:t,beta:s}}else if(n==="Clip"){let[t,s]=e?.activation_params||[BT,UT];return{activation:n,clipMax:s,clipMin:t}}else if(n==="LeakyRelu"){let[t]=e?.activation_params||[.01];return{activation:n,alpha:t}}return{activation:n}}}),cs,_E,pv=ct(()=>{cs=(e,n)=>{switch(e){case 1:return n;case 2:return`vec2<${n}>`;case 3:return`vec3<${n}>`;case 4:return`vec4<${n}>`;default:throw new Error(`${e}-component is not supported.`)}},_E=e=>`
      ${e?"value = value + getBiasByOutputCoords(coords);":""}
      `}),gE,J$=ct(()=>{gE=e=>`
fn getIndexFromCoords4D(coords : vec4<i32>, shape : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
      shape.y * shape.z * shape.w, shape.z * shape.w, shape.w, 1));
}
fn getOutputIndexFromCoords(coords : vec4<i32>) -> i32 {
  return dot(coords, vec4<i32>(
    i32(${e}.x), i32(${e}.y), i32(${e}.z), 1));
}
`}),dm,mv,_v=ct(()=>{Wt(),en(),tn(),$u(),dm=(e,n,t,s,i)=>{let l=s-t;return`
      ${Array.from({length:t}).map((c,u)=>`
      if (${$t(n.shape,u,n.rank)} != 1) {
        ${n.indicesSet(e,u,$t(i,u+l,s))}
      } else {
        ${n.indicesSet(e,u,0)}
      }`).join("")}
`},mv=(e,n,t,s,i=!1,l)=>{let c=e[0].dims,u=e[1].dims,d=c[c.length-2],f=u[u.length-1],m=c[c.length-1],_=Sa(f),p=Sa(m),y=Sa(d),v=je.size(t)/_/y,T=e.length>2,k=s?s.slice(0,-2):t.slice(0,-2),b=[je.size(k),d,f],S=[{type:12,data:v},{type:12,data:d},{type:12,data:f},{type:12,data:m}];Su(n,S),S.push(...zt(k,c,u)),T&&S.push(...zt(e[2].dims)),S.push(...zt(b));let $=w=>{let C=cv("batch_dims",e[0].dataType,k.length),P=Qe("a",e[0].dataType,c.length,p),A=Qe("b",e[1].dataType,u.length,_),I=At("output",e[0].dataType,b.length,_),W=as(I.type.tensor),G=Eu(n,I.type.value,W),q=[P,A],Z="";if(T){let te=i?_:1;q.push(Qe("bias",e[2].dataType,e[2].dims.length,te)),Z=`${i?`value += bias[col / ${te}];`:`value += ${I.type.value}(bias[row + i]);`}`}let X=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"}];Cu(n,X);let Q=()=>{let te=`var a_data: ${P.type.value};`;for(let R=0;R<p;R++)te+=`
              let b_data${R} = b[(b_offset + (k + ${R}) * uniforms.N + col) / ${_}];`;for(let R=0;R<y;R++){te+=`a_data = a[(a_offset + (row + ${R}) * uniforms.K + k) / ${p}];`;for(let ee=0;ee<p;ee++)te+=`
            values[${R}] = fma(${A.type.value}(a_data${p===1?"":`[${ee}]`}), b_data${ee}, values[${R}]);
`}return te};return`
  ${w.registerUniforms(X).registerInternalVariables(C).declareVariables(...q,I)}
  ${w.mainStart()}
    ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let col = (global_idx % (uniforms.N / ${_})) * ${_};
    var index1 = global_idx / (uniforms.N / ${_});
    let stride1 = uniforms.M / ${y};
    let row = (index1 % stride1) * ${y};
    let batch = index1 / stride1;

    ${t.length===2?"":`let batch_indices = ${C.offsetToIndices("batch")};`}

    var a_indices: ${P.type.indices};
    ${dm("a_indices",P,P.rank-2,C.rank,"batch_indices")}
    ${P.indicesSet("a_indices",P.rank-2,0)}
    ${P.indicesSet("a_indices",P.rank-1,0)}
    let a_offset = ${P.indicesToOffset("a_indices")};

    var b_indices: ${A.type.indices};
    ${dm("b_indices",A,A.rank-2,C.rank,"batch_indices")}
    ${A.indicesSet("b_indices",A.rank-2,0)}
    ${A.indicesSet("b_indices",A.rank-1,0)}
    let b_offset = ${A.indicesToOffset("b_indices")};
    var values: array<${I.type.value}, ${y}>;
    for (var k: u32 = 0u; k < uniforms.K; k = k + ${p}) {
      ${Q()}
    }
    for (var i = 0u; i < ${y}u; i++) {
      var value = values[i];
      ${Z}
      ${G}
      let cur_indices = ${I.type.indices}(batch, row + i, col);
      let offset = ${I.indicesToOffset("cur_indices")};
      ${I.setByOffset(`offset / ${_}`,"value")};
    }
  }
  `};return{name:"MatMulNaive",shaderCache:{hint:`${n.activation};${_};${p};${y};${i}`,inputDependencies:T?["rank","rank","rank"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:l?l(t):t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(v/64)},programUniforms:S}),getShaderSource:$}}}),Hw,qw,E0,Ey,Kw,S0,Qw,rg,gv=ct(()=>{Wt(),en(),tn(),$u(),_v(),pv(),Hw=(e,n)=>e?`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          kStart + inputRow,
          globalRowStart / innerElementSize + inputCol${n?", batchIndices":""});
        `:`
        mm_Asub[inputRow][inputCol] = mm_readA(batch,
          globalRow + innerRow,
          kStart / innerElementSize + inputCol${n?", batchIndices":""});
        `,qw=(e,n)=>e?`
        let ACached0 = mm_Asub[k * innerElementSize][localRow];
        let ACached1 = mm_Asub[k * innerElementSize + 1][localRow];
        let ACached2 = mm_Asub[k * innerElementSize + 2][localRow];
        ${n===3?"":"let ACached3 = mm_Asub[k * innerElementSize + 3][localRow];"}
        for (var i = 0; i < rowPerThread; i = i + 1) {
          acc[i] = BCached0 * ACached0[i] + acc[i];
          acc[i] = BCached1 * ACached1[i] + acc[i];
          acc[i] = BCached2 * ACached2[i] + acc[i];
          ${n===3?"":"acc[i] = BCached3 * ACached3[i] + acc[i];"}
        }`:`
        for (var i = 0; i < rowPerThread; i = i + 1) {
          let ACached = mm_Asub[tileRow + i][k];
          acc[i] = BCached0 * ACached.x + acc[i];
          acc[i] = BCached1 * ACached.y + acc[i];
          acc[i] = BCached2 * ACached.z + acc[i];
          ${n===3?"":"acc[i] = BCached3 * ACached.w + acc[i];"}
        }`,E0=(e,n,t="f32",s,i=!1,l=32,c=!1,u=32)=>{let d=n[1]*e[1],f=n[0]*e[0],m=i?d:l,_=i?l:d,p=m/n[0],y=l/n[1];if(!((i&&p===4&&e[1]===4||!i&&(p===3||p===4))&&m%n[0]===0&&l%n[1]===0&&e[0]===4))throw new Error(`If transposeA ${i} is true, innerElementSize ${p} and workPerThread[1] ${e[1]} must be 4.
      Otherwise, innerElementSize ${p} must be 3 or 4.
  tileAWidth ${m} must be divisible by workgroupSize[0]${n[0]}. tileInner ${l} must be divisible by workgroupSize[1] ${n[1]}. colPerThread ${e[0]} must be 4.`);return`
var<workgroup> mm_Asub: array<array<vec${p}<${t}>, ${m/p}>, ${_}>;
var<workgroup> mm_Bsub: array<array<vec4<${t}>, ${f/e[0]}>, ${l}>;

const rowPerThread = ${e[1]};
const colPerThread = ${e[0]};
const innerElementSize = ${p};
const tileInner = ${l};

@compute @workgroup_size(${n[0]}, ${n[1]}, ${n[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
  let localRow = i32(localId.y);
  let tileRow = localRow * rowPerThread;
  let tileCol = i32(localId.x);

  let globalRow =i32(globalId.y) * rowPerThread;
  let globalCol = i32(globalId.x);
  let batch = ${c?"0":"i32(globalId.z)"};
  ${s?`let batchIndices = ${s.offsetToIndices("u32(batch)")};`:""}
  let globalRowStart = i32(workgroupId.y) * ${d};

  let num_tiles = ${c?`${Math.ceil(u/l)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
  var kStart = ${c?`i32(globalId.z) * ${u}`:"0"};

  var acc: array<vec4<${t}>, rowPerThread>;

  // Loop over shared dimension.
  let tileRowB = localRow * ${y};
  for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let inputRow = tileRow + innerRow;
          let inputCol = tileCol;
          ${Hw(i,s)}
      }

      // Load one tile of B into local memory.
      for (var innerRow = 0; innerRow < ${y}; innerRow = innerRow + 1) {
          let inputRow = tileRowB + innerRow;
          let inputCol = tileCol;
          mm_Bsub[inputRow][inputCol] = mm_readB(batch, kStart + inputRow, globalCol${s?", batchIndices":""});
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      for (var k = 0; k < tileInner / innerElementSize; k = k + 1) {
          let BCached0 = mm_Bsub[k * innerElementSize][tileCol];
          let BCached1 = mm_Bsub[k * innerElementSize + 1][tileCol];
          let BCached2 = mm_Bsub[k * innerElementSize + 2][tileCol];
          ${p===3?"":"let BCached3 = mm_Bsub[k * innerElementSize + 3][tileCol];"}

          ${qw(i,p)}
      }

      workgroupBarrier();
  }

  for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      mm_write(batch, globalRow + innerRow, globalCol, acc[innerRow]);
  }
}`},Ey=(e,n)=>e?`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              kStart + inputRow,
              globalRowStart + inputCol${n?", batchIndices":""});
            `:`
            mm_Asub[inputRow][inputCol] = mm_readA(batch,
              globalRowStart + inputRow,
              kStart + inputCol${n?", batchIndices":""});
            `,Kw=e=>e?"let ACached = mm_Asub[k][tileRow + innerRow];":"let ACached = mm_Asub[tileRow + innerRow][k];",S0=(e,n,t="f32",s,i=!1,l=32,c=!1,u=32,d=!1)=>{let f=e[1]*n[1],m=e[0]*n[0],_=i?f:l,p=i?l:f;if(!(p%n[1]===0&&_%n[0]===0&&l%n[1]===0))throw new Error(`tileAHight ${p} must be divisible by workgroupSize[1]${n[1]}, tileAWidth ${_} must be divisible by workgroupSize[0]${n[0]}, tileInner ${l} must be divisible by workgroupSize[1]${n[1]}`);let y=p/n[1],v=_/n[0],T=l/n[1],k=d?`
    let localRow = i32(localId.y);
    let localCol = i32(localId.x);
    let globalRowStart = i32(workgroupId.y) * ${f};
    let globalColStart = i32(workgroupId.x) * ${m};

    // Loop over shared dimension.
    for (var t = 0; t < num_tiles; t = t + 1) {
      // Load one tile of A into local memory.
      for (var inputRow = localRow; inputRow < ${p}; inputRow = inputRow + ${n[1]}) {
        for (var inputCol = localCol; inputCol < ${_}; inputCol = inputCol + ${n[0]}) {
          ${Ey(i,s)}
        }
      }
      // Load one tile of B into local memory.
      for (var inputRow = localRow; inputRow < ${l}; inputRow = inputRow + ${n[1]}) {
            for (var inputCol = localCol; inputCol < ${m}; inputCol = inputCol + ${n[0]}) {
          mm_Bsub[inputRow][inputCol] = mm_readB(batch,
            kStart + inputRow,
            globalColStart + inputCol${s?", batchIndices":""});
        }
      }
      kStart = kStart + tileInner;
      workgroupBarrier();

      // Compute acc values for a single thread.
      var BCached : array<${t}, colPerThread>;
      for (var k = 0; k < tileInner; k = k + 1) {
        for (var inner = 0; inner < colPerThread; inner = inner + 1) {
          BCached[inner] = mm_Bsub[k][localCol + inner * ${n[0]}];
        }
        for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
          let ACached = ${i?`mm_Asub[k][localRow + innerRow * ${n[1]}];`:`mm_Asub[localRow + innerRow * ${n[1]}][k];`}
          for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
            acc[innerRow][innerCol] = acc[innerRow][innerCol] +
                ACached * BCached[innerCol];
          }
        }
      }
      workgroupBarrier();
    }
    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      let gRow = globalRowStart + localRow + innerRow * ${n[1]};
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        let gCol = globalColStart + localCol + innerCol * ${n[0]};
        mm_write(batch, gRow, gCol, acc[innerRow][innerCol]);
      }
    }
    `:`
let tileRow = i32(localId.y) * rowPerThread;
let tileCol = i32(localId.x) * colPerThread;

let globalRow = i32(globalId.y) * rowPerThread;
let globalCol = i32(globalId.x) * colPerThread;
let globalRowStart = i32(workgroupId.y) * ${f};

let tileRowA = i32(localId.y) * ${y};
let tileColA = i32(localId.x) * ${v};
let tileRowB = i32(localId.y) * ${T};
// Loop over shared dimension.
for (var t = 0; t < num_tiles; t = t + 1) {
  // Load one tile of A into local memory.
  for (var innerRow = 0; innerRow < ${y}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < ${v}; innerCol = innerCol + 1) {
      let inputRow = tileRowA + innerRow;
      let inputCol = tileColA + innerCol;
      ${Ey(i,s)}
    }
  }

  // Load one tile of B into local memory.
  for (var innerRow = 0; innerRow < ${T}; innerRow = innerRow + 1) {
    for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
      let inputRow = tileRowB + innerRow;
      let inputCol = tileCol + innerCol;
      mm_Bsub[inputRow][inputCol] = mm_readB(batch,
        kStart + inputRow,
        globalCol + innerCol${s?", batchIndices":""});
    }
  }
  kStart = kStart + tileInner;
  workgroupBarrier();

  // Compute acc values for a single thread.
  var BCached : array<${t}, colPerThread>;
  for (var k = 0; k < tileInner; k = k + 1) {
    for (var inner = 0; inner < colPerThread; inner = inner + 1) {
      BCached[inner] = mm_Bsub[k][tileCol + inner];
    }

    for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
      ${Kw(i)}
      for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
        acc[innerRow][innerCol] = acc[innerRow][innerCol] + ACached * BCached[innerCol];
      }
    }
  }

  workgroupBarrier();
}

for (var innerRow = 0; innerRow < rowPerThread; innerRow = innerRow + 1) {
  for (var innerCol = 0; innerCol < colPerThread; innerCol = innerCol + 1) {
    mm_write(batch, globalRow + innerRow, globalCol + innerCol,
        acc[innerRow][innerCol]);
  }
}
`;return`
  var<workgroup> mm_Asub : array<array<${t}, ${_}>, ${p}>;
  var<workgroup> mm_Bsub : array<array<${t}, ${m}>, ${l}>;
  const rowPerThread = ${e[1]};
  const colPerThread = ${e[0]};
  const tileInner = ${l};

@compute @workgroup_size(${n[0]}, ${n[1]}, ${n[2]})
fn main(@builtin(local_invocation_id) localId : vec3<u32>,
        @builtin(global_invocation_id) globalId : vec3<u32>,
        @builtin(workgroup_id) workgroupId : vec3<u32>) {
    let batch = ${c?"0":"i32(globalId.z)"};
    ${s?`let batchIndices = ${s.offsetToIndices("u32(batch)")};`:""}
    let num_tiles = ${c?`${Math.ceil(u/l)}`:"(uniforms.dim_inner - 1) / tileInner + 1"};
    var kStart = ${c?`i32(globalId.z) * ${u}`:"0"};

    var acc : array<array<${t}, colPerThread>, rowPerThread>;
    ${k}
  }
`},Qw=(e,n,t,s,i=!1)=>{let[l,c,u,d]=s,f=as(s[0].type.tensor);return`
    fn mm_readA(batch: i32, row: i32, colIn: i32, batchIndices: ${l.type.indices}) -> ${cs(e,f)} {
      var value = ${cs(e,f)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_a_outer && col < uniforms.dim_inner)
      {
        var aIndices: ${c.type.indices};
        ${dm("aIndices",c,c.rank-2,l.rank,"batchIndices")}
        ${c.indicesSet("aIndices",c.rank-2,"u32(row)")}
        ${c.indicesSet("aIndices",c.rank-1,"u32(colIn)")}
        value = ${c.getByIndices("aIndices")};
      }
      return value;
    }

    fn mm_readB(batch: i32, row: i32, colIn: i32, batchIndices: ${l.type.indices}) -> ${cs(e,f)} {
      var value = ${cs(e,f)}(0.0);
      let col = colIn * ${e};
      if(row < uniforms.dim_inner && col < uniforms.dim_b_outer)
      {
        var bIndices: ${u.type.indices};
        ${dm("bIndices",u,u.rank-2,l.rank,"batchIndices")}
        ${u.indicesSet("bIndices",u.rank-2,"u32(row)")}
        ${u.indicesSet("bIndices",u.rank-1,"u32(colIn)")}
        value = ${u.getByIndices("bIndices")};
      }
      return value;
    }

    fn mm_write(batch: i32, row: i32, colIn: i32, valueIn: ${cs(e,f)}) {
      let col = colIn * ${e};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer) {
        var value = valueIn;
        let coords = vec3<i32>(batch, row, colIn);
        ${n?`value = value + ${i?"bias[colIn]":`${cs(e,f)}(bias[row])`};`:""}
        ${t}
        ${d.setByIndices("vec3<u32>(coords)","value")}
      }
    }
    `},rg=(e,n,t,s,i=!1,l)=>{let c=e[0].dims,u=e[1].dims,d=c.slice(0,-2),f=u.slice(0,-2),m=s?s.slice(0,-2):t.slice(0,-2),_=je.size(m),p=c[c.length-2],y=c[c.length-1],v=u[u.length-1],T=y%4===0&&v%4===0,k=p<=8?[4,1,1]:[4,4,1],b=[8,8,1],S=[Math.ceil(v/b[0]/k[0]),Math.ceil(p/b[1]/k[1]),Math.ceil(_/b[2]/k[2])],$=T?4:1,w=[...d,p,y/$],C=w.length,P=[...f,y,v/$],A=P.length,I=[_,p,v/$],W=[{type:6,data:p},{type:6,data:v},{type:6,data:y}];Su(n,W),W.push(...zt(m,w,P));let G=["rank","rank"],q=e.length>2;q&&(W.push(...zt(e[2].dims)),G.push("rank")),W.push(...zt(I));let Z=X=>{let Q=m.length,te=cv("batchDims",e[0].dataType,Q,1),R=as(e[0].dataType),ee=Qe("a",e[0].dataType,C,$),ie=Qe("b",e[1].dataType,A,$),he=At("result",e[0].dataType,I.length,$),_e=[ee,ie];if(q){let ce=i?$:1;_e.push(Qe("bias",e[2].dataType,e[2].dims.length,ce))}let U=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"}];Cu(n,U);let K=as(he.type.tensor),H=Eu(n,he.type.value,K),B=Qw($,q,H,[te,ee,ie,he],i);return`
  ${X.registerUniforms(U).registerInternalVariables(te).declareVariables(..._e,he)}
  ${B}
  ${T?E0(k,b,R,te):S0(k,b,R,te)}
                   `};return{name:"MatMul",shaderCache:{hint:`${k};${n.activation};${T};${i}`,inputDependencies:G},getRunData:()=>({outputs:[{dims:l?l(t):t,dataType:e[0].dataType}],dispatchGroup:{x:S[0],y:S[1],z:S[2]},programUniforms:W}),getShaderSource:Z}}}),Xw,yE,e3=ct(()=>{Wt(),el(),tn(),$u(),pv(),J$(),gv(),Xw=(e,n,t,s,i=!1,l,c=4,u=4,d=4,f="f32")=>{let m=W=>{switch(W){case 1:return"resData = x[xIndex];";case 3:return`resData = vec3<${f}>(x[xIndex], x[xIndex + 1], x[xIndex + 2]);`;case 4:return"resData = x[xIndex / 4];";default:throw new Error(`innerElementSize ${W} is not supported.`)}},_=W=>{switch(W){case 1:return"return w[row * i32(uniforms.w_shape[3]) + colIn];";case 4:return"return w[row * i32(uniforms.w_shape[3]) / 4 + colIn];";default:throw new Error(`innerElementSize ${W} is not supported.`)}},p=e?`
    let coord = vec4<i32>(batch, xRow, xCol, xCh);
    `:`
    let coord = vec4<i32>(batch, xCh, xRow, xCol);
    `,y=e?`
    let coords = vec4<i32>(
      batch,
      row / outWidth,
      row % outWidth,
      col);
    `:`
    let coords = vec4<i32>(
      batch,
      row,
      col / outWidth,
      col % outWidth);
    `,v=e?"i32(uniforms.x_shape[1])":"i32(uniforms.x_shape[2])",T=e?"i32(uniforms.x_shape[2])":"i32(uniforms.x_shape[3])",k=e?"row":"col",b=e?"col":"row",S=`
    let inChannels = i32(uniforms.w_shape[2]);
    let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
    let outRow = ${k} / outWidth;
    let outCol = ${k} % outWidth;

    let WRow = ${b} / (i32(uniforms.w_shape[1]) * inChannels);
    let WCol = ${b} / inChannels % i32(uniforms.w_shape[1]);
    let xRow = outRow * uniforms.stride[0] + uniforms.dilation[0] * WRow - uniforms.pad[0];
    let xCol = outCol * uniforms.stride[1] + uniforms.dilation[1] * WCol - uniforms.pad[1];
    let xCh = ${b} % inChannels;
    var resData = ${cs(c,f)}(0.0);
    // The bounds checking is always needed since we use it to pad zero for
    // the 'same' padding type.
    if (xRow >= 0 && xRow < ${v} && xCol >= 0 && xCol < ${T}) {
      ${p}
      let xIndex = getIndexFromCoords4D(coord, vec4<i32>(uniforms.x_shape));
      ${m(c)}
    }
    return resData;`,$=e?n&&s?`
    let col = colIn * ${c};
    ${S}`:`
    let col = colIn * ${c};
    if (row < uniforms.dim_a_outer && col < uniforms.dim_inner) {
      ${S}
    }
    return ${cs(c,f)}(0.0);`:s&&t?`
    let col = colIn * ${c};
    ${S}`:`
    let col = colIn * ${c};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${S}
    }
    return ${cs(c,f)}(0.0);`,w=e?s&&t?_(u):`
    let col = colIn * ${u};
    if (row < uniforms.dim_inner && col < uniforms.dim_b_outer) {
      ${_(u)}
    }
    return ${cs(u,f)}(0.0);`:`
    let col = colIn * ${u};
    if (row < uniforms.dim_inner && col < uniforms.dim_a_outer) {
      ${_(u)}
    }
    return ${cs(u,f)}(0.0);`,C=cs(d,f),P=cs(e?c:u,f),A=cs(e?u:c,f),I=Eu(l,C,f);return`
    fn mm_readA(batch: i32, row : i32, colIn : i32) -> ${P} {
      ${e?$:w}
    }

    fn mm_readB(batch: i32, row : i32, colIn : i32) -> ${A} {
      ${e?w:$}
    }

    fn mm_write(batch: i32, row : i32, colIn : i32, valueIn : ${C}) {
      let col = colIn * ${d};
      if (row < uniforms.dim_a_outer && col < uniforms.dim_b_outer)
      {
      var value = valueIn;
      let outWidth = ${e?"i32(uniforms.result_shape[2])":"i32(uniforms.result_shape[3])"};
      ${y}
      ${_E(i)}
      ${I}
      setOutputAtCoords(coords[0], coords[1], coords[2], coords[3], value);
      }
    }`},yE=(e,n,t,s,i,l,c,u,d)=>{let f=n.format==="NHWC",m=f?e[0].dims[3]:e[0].dims[1],_=t[0],p=f?t[2]:t[3],y=f?t[1]:t[2],v=f?t[3]:t[1],T=f&&(m%4===0||m%3===0)&&v%4===0,k=f?v:p*y,b=f?p*y:v,S=[8,8,1],$=s<=8?[4,1,1]:[4,4,1],w=[Math.ceil(k/S[0]/$[0]),Math.ceil(b/S[1]/$[1]),Math.ceil(_/S[2]/$[2])];yn("verbose",()=>`[conv2d_mm_webgpu] dispatch = ${w}`);let C=T?f&&m%4!==0?3:4:1,P=S[1]*$[1],A=S[0]*$[0],I=Math.max(S[0]*C,S[1]),W=s%P===0,G=i%A===0,q=l%I===0,Z=T?[C,4,4]:[1,1,1],X=[{type:6,data:s},{type:6,data:i},{type:6,data:l},{type:6,data:[n.pads[0],n.pads[1]]},{type:6,data:n.strides},{type:6,data:n.dilations}];Su(n,X),X.push(...zt(e[0].dims,e[1].dims));let Q=["rank","rank"];c&&(X.push(...zt(e[2].dims)),Q.push("rank")),X.push(...zt(t));let te=R=>{let ee=[{name:"dim_a_outer",type:"i32"},{name:"dim_b_outer",type:"i32"},{name:"dim_inner",type:"i32"},{name:"pad",type:"i32",length:2},{name:"stride",type:"i32",length:2},{name:"dilation",type:"i32",length:2}];Cu(n,ee);let ie=T?4:1,he=as(e[0].dataType),_e=`
      fn setOutputAtIndex(flatIndex : i32, value : ${T?`vec4<${he}>`:he}) {
        result[flatIndex] = ${T?`vec4<${he}>`:he}(value);
      }
      fn setOutputAtCoords(d0 : i32, d1 : i32, d2 : i32, d3 : i32, value : ${T?`vec4<${he}>`:he}) {
        let flatIndex = getOutputIndexFromCoords(vec4<i32>(d0, d1, d2, d3));
        setOutputAtIndex(flatIndex ${T?"/ 4":""}, value);
      }`,U=Qe("x",e[0].dataType,e[0].dims.length,C===3?1:C),K=Qe("w",e[1].dataType,e[1].dims.length,ie),H=[U,K],B=At("result",e[0].dataType,t.length,ie);if(c){let ce=Qe("bias",e[2].dataType,e[2].dims.length,ie);H.push(ce),_e+=`
        fn getBiasByOutputCoords(coords : vec4<i32>) -> ${T?`vec4<${he}>`:he} {
          return bias[coords.${f?"w":"y"}${T?"/ 4":""}];
        }`}return`
        ${gE("uniforms.result_strides")}
        //struct Uniforms { xShape : vec4<i32>, wShape : vec4<i32>, outShape : vec4<i32>,
        //  outShapeStrides: vec3<i32>, filterDims : vec2<i32>, pad : vec2<i32>, stride : vec2<i32>,
        //  dilation : vec2<i32>, dimAOuter : i32, dimBOuter : i32, dimInner : i32 };
        ${R.registerUniforms(ee).declareVariables(...H,B)}
        ${_e}
        ${Xw(f,W,G,q,c,n,Z[0],Z[1],Z[2],he)}
        ${T?E0($,S,he,void 0,!f,I):S0($,S,he,void 0,!f,I,!1,void 0,u)}`};return{name:"Conv2DMatMul",shaderCache:{hint:`${n.cacheKey};${C};${T};${W};${G};${q};${P};${A};${I}`,inputDependencies:Q},getRunData:()=>({outputs:[{dims:d?d(t):t,dataType:e[0].dataType}],dispatchGroup:{x:w[0],y:w[1],z:w[2]},programUniforms:X}),getShaderSource:te}}}),Yw,Sy,qp,Zw,Cy,Jw,vE,bE,t3=ct(()=>{Wt(),el(),en(),tn(),$u(),pv(),Yw=e=>{let n=1;for(let t=0;t<e.length;t++)n*=e[t];return n},Sy=e=>typeof e=="number"?[e,e,e]:e,qp=(e,n)=>n<=1?e:e+(e-1)*(n-1),Zw=(e,n,t,s=1)=>{let i=qp(n,s);return Math.floor((e[0]*(t-1)-t+i)/2)},Cy=(e,n,t,s,i)=>{i==null&&(i=Zw(e,n[0],s[0]));let l=[0,0,0,t];for(let c=0;c<3;c++)e[c]+2*i>=n[c]&&(l[c]=Math.trunc((e[c]-n[c]+2*i)/s[c]+1));return l},Jw=(e,n,t,s,i,l,c,u,d,f)=>{let m,_,p,y;if(e==="VALID"&&(e=0),typeof e=="number"){m={top:e,bottom:e,left:e,right:e,front:e,back:e};let v=Cy([n,t,s,1],[u,d,f],1,[i,l,c],e);_=v[0],p=v[1],y=v[2]}else if(Array.isArray(e)){if(!e.every((T,k,b)=>T===b[0]))throw Error(`Unsupported padding parameter: ${e}`);m={top:e[0],bottom:e[1],left:e[2],right:e[3],front:e[4],back:e[5]};let v=Cy([n,t,s,1],[u,d,f],1,[i,l,c],e[0]);_=v[0],p=v[1],y=v[2]}else if(e==="SAME_UPPER"){_=Math.ceil(n/i),p=Math.ceil(t/l),y=Math.ceil(s/c);let v=(_-1)*i+u-n,T=(p-1)*l+d-t,k=(y-1)*c+f-s,b=Math.floor(v/2),S=v-b,$=Math.floor(T/2),w=T-$,C=Math.floor(k/2),P=k-C;m={top:$,bottom:w,left:C,right:P,front:b,back:S}}else throw Error(`Unknown padding parameter: ${e}`);return{padInfo:m,outDepth:_,outHeight:p,outWidth:y}},vE=(e,n,t,s,i,l=!1,c="channelsLast")=>{let u,d,f,m,_;if(c==="channelsLast")[u,d,f,m,_]=e;else if(c==="channelsFirst")[u,_,d,f,m]=e;else throw new Error(`Unknown dataFormat ${c}`);let[p,,y,v,T]=n,[k,b,S]=Sy(t),[$,w,C]=Sy(s),P=qp(y,$),A=qp(v,w),I=qp(T,C),{padInfo:W,outDepth:G,outHeight:q,outWidth:Z}=Jw(i,d,f,m,k,b,S,P,A,I),X=l?p*_:p,Q=[0,0,0,0,0];return c==="channelsFirst"?Q=[u,X,G,q,Z]:c==="channelsLast"&&(Q=[u,G,q,Z,X]),{batchSize:u,dataFormat:c,inDepth:d,inHeight:f,inWidth:m,inChannels:_,outDepth:G,outHeight:q,outWidth:Z,outChannels:X,padInfo:W,strideDepth:k,strideHeight:b,strideWidth:S,filterDepth:y,filterHeight:v,filterWidth:T,effectiveFilterDepth:P,effectiveFilterHeight:A,effectiveFilterWidth:I,dilationDepth:$,dilationHeight:w,dilationWidth:C,inShape:e,outShape:Q,filterShape:n}},bE=(e,n,t,s,i,l)=>{let c=l==="channelsLast";c?e[0].dims[3]:e[0].dims[1];let u=[64,1,1],d={x:t.map((k,b)=>b)},f=[Math.ceil(Yw(d.x.map(k=>t[k]))/u[0]),1,1];yn("verbose",()=>`[conv3d_naive_webgpu] dispatch = ${f}`);let m=1,_=je.size(t),p=[{type:12,data:_},{type:12,data:s},{type:12,data:i},{type:12,data:n.strides},{type:12,data:n.dilations}];Su(n,p),p.push(...zt(e[0].dims,e[1].dims));let y=["rank","rank"],v=e.length===3;v&&(p.push(...zt(e[2].dims)),y.push("rank")),p.push(...zt(t));let T=k=>{let b=[{name:"output_size",type:"u32"},{name:"filter_dims",type:"u32",length:s.length},{name:"pads",type:"u32",length:i.length},{name:"strides",type:"u32",length:n.strides.length},{name:"dilations",type:"u32",length:n.dilations.length}];Cu(n,b);let S=1,$=as(e[0].dataType),w=Qe("x",e[0].dataType,e[0].dims.length,m),C=Qe("W",e[1].dataType,e[1].dims.length,S),P=[w,C],A=At("result",e[0].dataType,t.length,S),I="";if(v){let q=Qe("bias",e[2].dataType,e[2].dims.length,S);P.push(q),I+=`
        fn getBiasByOutputCoords(coords : array<u32, 5>) -> ${$} {
          return bias[${c?$t("coords",4,5):$t("coords",1,5)}];
        }`}let W=cs(m,$),G=Eu(n,W,$);return`
            ${I}
            fn getX(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${w.getByIndices("aIndices")};
            }
            fn getW(d0 : u32, d1 : u32, d2 : u32, d3 : u32, d4 : u32) -> f32 {
              let aIndices = array<u32, 5>(d0, d1, d2, d3, d4);
              return ${C.getByIndices("aIndices")};
            }
          ${k.registerUniforms(b).declareVariables(...P,A)}
          ${k.mainStart()}
          ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
              let coords = ${A.offsetToIndices("global_idx")};
              let batch = ${$t("coords",0,w.rank)};
              let d2 = ${c?$t("coords",w.rank-1,w.rank):$t("coords",1,w.rank)};
              let xFRCCorner = vec3<u32>(${c?$t("coords",1,w.rank):$t("coords",2,w.rank)},
              ${c?$t("coords",2,w.rank):$t("coords",3,w.rank)},
              ${c?$t("coords",3,w.rank):$t("coords",4,w.rank)}) * uniforms.strides - uniforms.pads;
              let xFCorner = xFRCCorner.x;
              let xRCorner = xFRCCorner.y;
              let xCCorner = xFRCCorner.z;
              let xShapeY = ${c?$t("uniforms.x_shape",1,w.rank):$t("uniforms.x_shape",2,w.rank)};
              let xShapeZ = ${c?$t("uniforms.x_shape",2,w.rank):$t("uniforms.x_shape",3,w.rank)};
              let xShapeW = ${c?$t("uniforms.x_shape",3,w.rank):$t("uniforms.x_shape",4,w.rank)};
              let xShapeU = ${c?$t("uniforms.x_shape",4,w.rank):$t("uniforms.x_shape",1,w.rank)};
              let inputDepthNearestVec4 = (xShapeU / 4) * 4;
              let inputDepthVec4Remainder = xShapeU % 4;

              var value = 0.0;
              for (var wF = 0u; wF < uniforms.filter_dims[0]; wF++) {
                let xF = xFCorner + wF * uniforms.dilations[0];
                if (xF < 0 || xF >= xShapeY) {
                  continue;
                }

                for (var wR = 0u; wR < uniforms.filter_dims[1]; wR++) {
                  let xR = xRCorner + wR * uniforms.dilations[1];
                  if (xR < 0 || xR >= xShapeZ) {
                    continue;
                  }

                  for (var wC = 0u; wC < uniforms.filter_dims[2]; wC++) {
                    let xC = xCCorner + wC * uniforms.dilations[2];
                    if (xC < 0 || xC >= xShapeW) {
                      continue;
                    }

                    for (var d1 = 0u; d1 < inputDepthNearestVec4; d1 += 4) {
                      ${c?`let xValues = vec4<f32>(
                               getX(batch, xF, xR, xC, d1),
                               getX(batch, xF, xR, xC, d1 + 1),
                               getX(batch, xF, xR, xC, d1 + 2),
                               getX(batch, xF, xR, xC, d1 + 3));
                            `:`let xValues = vec4<f32>(
                               getX(batch, d1, xF, xR, xC),
                               getX(batch, d1 + 1, xF, xR, xC),
                               getX(batch, d1 + 2, xF, xR, xC),
                               getX(batch, d1 + 3, xF, xR, xC));
                            `}
                            let wValues = vec4<f32>(
                              getW(d2, d1, wF, wR, wC),
                              getW(d2, d1 + 1, wF, wR, wC),
                              getW(d2, d1 + 2, wF, wR, wC),
                              getW(d2, d1 + 3, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                    if (inputDepthVec4Remainder == 1) {
                        ${c?`value += getX(batch, xF, xR, xC, inputDepthNearestVec4)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`:`value += getX(batch, inputDepthNearestVec4, xF, xR, xC)
                          * getW(d2, inputDepthNearestVec4, wF, wR, wC);`}
                    } else if (inputDepthVec4Remainder == 2) {
                      ${c?`let xValues = vec2<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1));
                      `:`let xValues = vec2<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC));
                    `}
                    let wValues = vec2<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC));
                      value += dot(xValues, wValues);
                    } else if (inputDepthVec4Remainder == 3) {
                      ${c?`let xValues = vec3<f32>(
                        getX(batch, xF, xR, xC, inputDepthNearestVec4),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 1),
                        getX(batch, xF, xR, xC, inputDepthNearestVec4 + 2));
                      `:`let xValues = vec3<f32>(
                        getX(batch, inputDepthNearestVec4, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 1, xF, xR, xC),
                        getX(batch, inputDepthNearestVec4 + 2, xF, xR, xC));
                    `}
                    let wValues = vec3<f32>(
                      getW(d2, inputDepthNearestVec4, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 1, wF, wR, wC),
                      getW(d2, inputDepthNearestVec4 + 2, wF, wR, wC));
                      value += dot(xValues, wValues);
                    }
                  }
                }
              }
              ${v?"value = value + getBiasByOutputCoords(coords)":""};
              ${G}
              result[global_idx] = f32(value);
          }`};return{name:"Conv3DNaive",shaderCache:{hint:`${n.cacheKey};${c};${m};${v}`,inputDependencies:y},getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:f[0],y:f[1],z:f[2]},programUniforms:p}),getShaderSource:T}}}),wE,ME,n3=ct(()=>{Wt(),en(),tn(),$u(),wE=(e,n,t,s)=>{let i=e.length>2,l=i?"value += b[output_channel];":"",c=e[0].dims,u=e[1].dims,d=n.format==="NHWC",f=d?t[3]:t[1],m=f/n.group,_=d&&m>=4?Sa(f):1,p=je.size(t)/_,y=[{type:12,data:p},{type:12,data:n.dilations},{type:12,data:[n.strides[0],n.strides[1]]},{type:12,data:[n.pads[0],n.pads[1]]},{type:12,data:m}];Su(n,y),y.push(...zt(c,[u[0],u[1],u[2],u[3]/_]));let v=i?["rank","rank","rank"]:["rank","rank"];y.push(...zt([t[0],t[1],t[2],t[3]/_]));let T=k=>{let b=At("output",e[0].dataType,t.length,_),S=as(b.type.tensor),$=Eu(n,b.type.value,S),w=Qe("x",e[0].dataType,c.length),C=Qe("w",e[1].dataType,u.length,_),P=[w,C];i&&P.push(Qe("b",e[2].dataType,e[2].dims,_));let A=[{name:"output_size",type:"u32"},{name:"dilations",type:"u32",length:n.dilations.length},{name:"strides",type:"u32",length:2},{name:"pads",type:"u32",length:2},{name:"output_channels_per_group",type:"u32"}];Cu(n,A);let I=d?`
      for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[0]; wHeight++) {
        let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

        if (xHeight < 0u || xHeight >= uniforms.x_shape[1]) {
          continue;
        }

        for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[1]; wWidth++) {
          let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
          if (xWidth < 0u || xWidth >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[2]; wInChannel++) {
            let input_channel = in_channel_offset + wInChannel;
            let xVal = ${w.get("batch","xHeight","xWidth","input_channel")};
            let wVal = ${C.get("wHeight","wWidth","wInChannel","output_channel")};
            value += xVal * wVal;
          }
        }
      }
      `:`
      for (var wInChannel: u32 = 0u; wInChannel < uniforms.w_shape[1]; wInChannel++) {
        let input_channel = in_channel_offset + wInChannel;
        for (var wHeight: u32 = 0u; wHeight < uniforms.w_shape[2]; wHeight++) {
          let xHeight = xRCCorner.x + wHeight * uniforms.dilations[0];

          if (xHeight < 0u || xHeight >= uniforms.x_shape[2]) {
            continue;
          }

          for (var wWidth: u32 = 0u; wWidth < uniforms.w_shape[3]; wWidth++) {
            let xWidth = xRCCorner.y + wWidth * uniforms.dilations[1];
            if (xWidth < 0u || xWidth >= uniforms.x_shape[3]) {
              continue;
            }

            let xVal = ${w.get("batch","input_channel","xHeight","xWidth")};
            let wVal = ${C.get("output_channel","wInChannel","wHeight","wWidth")};
            value += xVal * wVal;
          }
        }
      }
      `;return`
  ${k.registerUniforms(A).declareVariables(...P,b)}

  ${k.mainStart()}
    ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let outputIndices = ${b.offsetToIndices("global_idx")};
    let batch: u32 = outputIndices[0];
    let output_channel: u32 = outputIndices[${d?3:1}];
    let xRCCorner: vec2<u32> = vec2<u32>(outputIndices[${d?1:2}], outputIndices[${d?2:3}]) * uniforms.strides - uniforms.pads;
    let group_id: u32 = output_channel * ${_} / uniforms.output_channels_per_group;
    var in_channel_offset = group_id * uniforms.w_shape[${d?2:1}];

    var value: ${b.type.value} = ${b.type.value}(0);
    ${I}
    ${l}
    ${$}
    ${b.setByOffset("global_idx","value")}
  }`};return{name:"GroupedConv",shaderCache:{hint:`${n.cacheKey}_${_}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:s?s(t):t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:y}),getShaderSource:T}},ME=(e,n,t,s)=>{let i=e.length>2,l=Sa(t[3]),c=Sa(t[2]),u=je.size(t)/l/c,d=[e[0].dims[0],e[0].dims[1],e[0].dims[2],e[0].dims[3]/l],f=[e[1].dims[0],e[1].dims[1],e[1].dims[2],e[1].dims[3]/l],m=[t[0],t[1],t[2],t[3]/l],_=[{type:12,data:u},{type:6,data:[n.strides[0],n.strides[1]]},{type:6,data:[n.pads[0],n.pads[1]]}];Su(n,_),_.push(...zt(d,f,m));let p=(c-1)*n.strides[1]+f[1],y=v=>{let T=At("output",e[0].dataType,m.length,l),k=as(T.type.tensor),b=Eu(n,T.type.value,k),S=Qe("x",e[0].dataType,d.length,l),$=Qe("w",e[1].dataType,f.length,l),w=[S,$];i&&w.push(Qe("b",e[2].dataType,e[2].dims,l));let C=i?"value += b[output_channel];":"",P=[{name:"output_size",type:"u32"},{name:"strides",type:"i32",length:2},{name:"pads",type:"i32",length:2}];return Cu(n,P),`
  ${v.registerUniforms(P).declareVariables(...w,T)}
  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let width0 = uniforms.output_shape[3];
    let output_channel = global_idx % width0;
    var index1 = global_idx / width0;
    let width1 = uniforms.output_shape[2] / ${c}u;
    let col = (index1 % width1) * ${c}u;
    index1 = index1 / width1;
    let row = index1 % uniforms.output_shape[1];
    let batch = index1 / uniforms.output_shape[1];

    let x_corner = vec2<i32>(i32(row), i32(col)) * uniforms.strides - uniforms.pads;

    var x_vals: array<${S.type.value}, ${p}>;
    var values: array<${T.type.value}, ${c}>;
    let input_channel = output_channel;
    // Use constant instead of uniform can give better performance for w's height/width.
    for (var w_height: u32 = 0u; w_height < ${f[0]}; w_height++) {
      let x_height = x_corner.x + i32(w_height);
      if (x_height >= 0 && u32(x_height) < uniforms.x_shape[1]) {
        for (var i = 0; i < ${p}; i++) {
          let x_width = x_corner.y + i;
          if (x_width >= 0 && u32(x_width) < uniforms.x_shape[2]) {
            x_vals[i] = ${S.get("batch","u32(x_height)","u32(x_width)","input_channel")};
          } else {
            x_vals[i] = ${S.type.value}(0);
          }
        }
        for (var w_width: u32 = 0u; w_width < ${f[1]}; w_width++) {
          let w_val = ${$.get("w_height","w_width","0","output_channel")};
          for (var i = 0u; i < ${c}u; i++) {
            values[i] = fma(x_vals[i * u32(uniforms.strides[1]) + w_width], w_val, values[i]);
          }
        }
      }
    }

    for (var i = 0u; i < ${c}u; i++) {
      var value = values[i];
      ${C}
      ${b}
      ${T.set("batch","row","col + i","output_channel","value")};
    }
  }`};return{name:"GroupedConv-Vectorize",shaderCache:{hint:`${n.cacheKey};${l};${c};${p};${f[0]};${f[1]}`,inputDependencies:i?["rank","rank","type"]:["rank","rank"]},getRunData:()=>({outputs:[{dims:s?s(t):t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:_}),getShaderSource:y}}}),eM,C_,tM,A_,C0,Ay,nM,aM,A0,a3=ct(()=>{en(),e3(),t3(),gv(),n3(),$u(),_v(),uc(),eM=(e,n,t,s,i,l)=>{let c=e[0],u=e.slice(l?1:2,l?3:4),d=u.length,f=n[0],m=n.slice(2).map((p,y)=>p+(p-1)*(t[y]-1)),_=u.map((p,y)=>p+s[y]+s[y+d]).map((p,y)=>Math.floor((p-m[y]+i[y])/i[y]));return _.splice(0,0,c),_.splice(l?3:1,0,f),_},C_=[2,3,1,0],tM=(e,n)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length>5)throw new Error("greater than 5D is not supported");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let t=e[0].dims[n.format==="NHWC"?e[0].dims.length-1:1],s=e[1].dims[1]*n.group;if(t!==s)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");if(e.length===3&&(e[2].dims.length!==1||e[1].dims[0]!==e[2].dims[0]))throw new Error("invalid bias");let i=e[0].dims.length-2;if(n.dilations.length!==i)throw new Error(`dilations should be ${i}D`);if(n.strides.length!==i)throw new Error(`strides should be ${i}D`);if(n.pads.length!==i*2)throw new Error(`pads should be ${i*2}D`);if(n.kernelShape.length!==0&&n.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape")},A_=(e,n)=>{let t=e.kernelShape.slice();t.length<n[1].dims.length-2&&t.push(...Array(n[1].dims.length-2-t.length).fill(0));for(let l=2;l<n[1].dims.length;++l)t[l-2]===0&&(t[l-2]=n[1].dims[l]);let s=e.pads.slice();ag.adjustPadsBasedOnAutoPad(n[0].dims,e.strides,e.dilations,t,s,e.format==="NHWC",e.autoPad);let i=Object.assign({},e);return Object.assign(i,{kernelShape:t,pads:s}),i},C0=e=>{let n=hv(e),t=e.format,s=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],i=e.dilations,l=e.group,c=e.kernel_shape,u=e.pads,d=e.strides,f=e.w_is_const();return{autoPad:s,format:t,dilations:i,group:l,kernelShape:c,pads:u,strides:d,wIsConst:f,...n,cacheKey:`${e.format};${n.activation};`}},Ay=(e,n,t,s)=>{let i=t.format==="NHWC",l=eM(n[0].dims,n[1].dims,t.dilations,t.pads,t.strides,i);if(t.group!==1){let P=[n[0]];if(i){let A=e.kernelCustomData.wT??e.compute(yr(n[1],C_),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=A),P.push(A)}else P.push(n[1]);n.length===3&&P.push(n[2]),!e.adapterInfo.isArchitecture("ampere")&&i&&n[1].dims[0]===t.group&&n[1].dims[1]===1&&t.dilations[0]===1&&t.dilations[1]===1?e.compute(ME(P,t,l,s),{inputs:P}):e.compute(wE(P,t,l,s),{inputs:P});return}let c=n.length===3,u=n[0].dims[i?1:2],d=n[0].dims[i?2:3],f=n[0].dims[i?3:1],m=n[1].dims[2],_=n[1].dims[3],p=l[i?1:2],y=l[i?2:3],v=l[i?3:1],T=i&&m===u&&_===d&&t.pads[0]===0&&t.pads[1]===0;if(T||m===1&&_===1&&t.dilations[0]===1&&t.dilations[1]===1&&t.strides[0]===1&&t.strides[1]===1&&t.pads[0]===0&&t.pads[1]===0){let P=l[0],A,I,W,G=[];if(i){let X=e.kernelCustomData.wT??e.compute(yr(n[1],C_),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];if(t.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=X),T){let Q=u*d*f;A=n[0].reshape([1,P,Q]),I=X.reshape([1,Q,v]),W=[1,P,v]}else A=n[0].reshape([P,u*d,f]),I=X.reshape([1,f,v]),W=[P,p*y,v];G.push(A),G.push(I)}else A=n[0].reshape([P,f,u*d]),I=n[1].reshape([1,v,f]),W=[P,v,p*y],G.push(I),G.push(A);c&&G.push(n[2]);let q=W[2],Z=G[0].dims[G[0].dims.length-1];q<8&&Z<8?e.compute(mv(G,t,l,W,i,s),{inputs:G}):e.compute(rg(G,t,l,W,i,s),{inputs:G});return}let k=!0,b=e.kernelCustomData.wT??e.compute(yr(n[1],C_),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=b);let S=[n[0],b];c&&S.push(n[2]);let $=i?p*y:v,w=i?v:p*y,C=m*_*f;e.compute(yE(S,t,l,$,w,C,c,k,s),{inputs:S})},nM=(e,n)=>{let t=n.format==="NHWC",s=[e.inputs[0].reshape(t?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&s.push(e.inputs[2]);let i=[0,n.pads[0],0,n.pads[1]],l=[1].concat(n.strides),c=[1].concat(n.dilations),u=[1].concat(n.kernelShape),d=A_({...n,pads:i,strides:l,dilations:c,kernelShape:u},s);Ay(e,s,d,f=>t?[f[0],f[2],f[3]]:[f[0],f[1],f[3]])},aM=(e,n,t)=>{let s=t.format==="NHWC"?"channelsLast":"channelsFirst",i=A_(t,n),l=t.autoPad==="NOTSET"?t.pads:t.autoPad,c=vE(n[0].dims,n[1].dims,t.strides,t.dilations,l,!1,s);e.compute(bE(n,i,c.outShape,[c.filterDepth,c.filterHeight,c.filterWidth],[c.padInfo.front,c.padInfo.top,c.padInfo.left],s))},A0=(e,n)=>{if(tM(e.inputs,n),e.inputs[0].dims.length===3)nM(e,n);else if(e.inputs[0].dims.length===5)aM(e,e.inputs,n);else{let t=A_(n,e.inputs);Ay(e,e.inputs,t)}}}),xE,s3=ct(()=>{Wt(),el(),en(),tn(),xE=(e,n,t)=>{let s=e.length>2,i=n.outputShape,l=n.format==="NHWC",c=n.group,u=e[1].dims,d=u[2]/c,f=u[3],m=l?Sa(d):1,_=l&&f===1&&d>=4,p=_?Math.floor(d/4)*4:Math.floor(d/m)*m,y=d-p,v=l?Sa(f):1,T=l?f===1?m:v:1,k=je.size(i)/v,b=[Math.ceil(k/64),1,1];yn("verbose",()=>`[conv2d_backprop_webgpu] dispatch = ${b}`);let S=["rank","rank"],$=[n.strides[0],n.strides[1]],w=[n.kernelShape[l?1:2],n.kernelShape[l?2:3]],C=[n.dilations[0],n.dilations[1]],P=[w[0]+(n.dilations[0]<=1?0:(n.kernelShape[l?1:2]-1)*(n.dilations[0]-1)),w[1]+(n.dilations[1]<=1?0:(n.kernelShape[l?2:3]-1)*(n.dilations[1]-1))],A=[P[0]-1-Math.floor((n.pads[0]+n.pads[2])/2),P[1]-1-Math.floor((n.pads[1]+n.pads[3])/2)],I=[{type:12,data:k},{type:12,data:$},{type:12,data:w},{type:12,data:C},{type:12,data:P},{type:6,data:A},{type:12,data:p},{type:12,data:d},{type:12,data:f},...zt(e[0].dims,e[1].dims)];s&&(I.push(...zt(e[2].dims)),S.push("rank")),I.push(...zt(i));let W=G=>{let q=[{name:"output_size",type:"u32"},{name:"strides",type:"u32",length:$.length},{name:"filter_dims",type:"u32",length:w.length},{name:"dilations",type:"u32",length:w.length},{name:"effective_filter_dims",type:"u32",length:P.length},{name:"pads",type:"i32",length:A.length},{name:"input_channels_per_group_int",type:"u32"},{name:"input_channels_per_group",type:"u32"},{name:"output_channels_per_group",type:"u32"}],Z=as(e[0].dataType),X=l?1:2,Q=l?2:3,te=l?3:1,R=Qe("W",e[1].dataType,e[1].dims.length,T),ee=Qe("Dy",e[0].dataType,e[0].dims.length,m),ie=[ee,R];s&&ie.push(Qe("bias",e[2].dataType,[i[te]].length,v));let he=At("result",e[0].dataType,i.length,v),_e=()=>{let H="";if(_)m===4?H+=`
        let xValue = ${ee.getByOffset("x_offset")};
        let wValue = ${R.getByOffset("w_offset")};
        dotProd = dotProd + dot(xValue, wValue);
        x_offset += 1u;
        w_offset += 1u;`:m===2?H+=`
          dotProd = dotProd + dot(vec4<${Z}>(${ee.getByOffset("x_offset")}, ${ee.getByOffset("x_offset + 1u")}), vec4<${Z}>(${R.getByOffset("w_offset")}, ${R.getByOffset("w_offset + 1u")}));
          x_offset += 2u;
          w_offset += 2u;`:m===1&&(H+=`
          dotProd = dotProd + dot(vec4<${Z}>(${ee.getByOffset("x_offset")}, ${ee.getByOffset("x_offset + 1u")}, ${ee.getByOffset("x_offset + 2u")}, ${ee.getByOffset("x_offset + 3u")}), vec4<${Z}>(${R.getByOffset("w_offset")}, ${R.getByOffset("w_offset + 1u")}, ${R.getByOffset("w_offset + 2u")}, ${R.getByOffset("w_offset + 3u")}));
          x_offset += 4u;
          w_offset += 4u;`);else if(H+=`
                  let xValue = ${l?ee.getByOffset(`${ee.indicesToOffset(`${ee.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${m}`):ee.get("batch","inputChannel","idyR","idyC")};
        `,m===1)H+=`
          let w_offset = ${R.indicesToOffset(`${R.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel, wOutChannel)`)};
          let wValue = ${R.getByOffset(`w_offset / ${T}`)};
          dotProd = dotProd + xValue * wValue;`;else for(let B=0;B<m;B++)H+=`
            let wValue${B} = ${R.getByOffset(`${R.indicesToOffset(`${R.type.indices}(u32(wRPerm), u32(wCPerm), inputChannel + ${B}, wOutChannel)`)} / ${T}`)};
            dotProd = dotProd + xValue[${B}] * wValue${B};`;return H},U=()=>{if(y===0)return"";if(!_)throw new Error(`packInputAs4 ${_} is not true.`);let H="";if(m===1){H+="dotProd = dotProd";for(let B=0;B<y;B++)H+=`
            + ${ee.getByOffset(`x_offset + ${B}`)} * ${R.getByOffset(`w_offset + ${B}`)}`;H+=";"}else if(m===2){if(y!==2)throw new Error(`Invalid inputChannelsRemainder ${y}.`);H+=`
          let xValue = ${ee.getByOffset("x_offset")};
          let wValue = ${R.getByOffset("w_offset")};
          dotProd = dotProd + dot(xValue, wValue);`}return H},K=`
            let outputIndices = ${he.offsetToIndices(`global_idx * ${v}`)};
            let batch = ${he.indicesGet("outputIndices",0)};
            let d1 = ${he.indicesGet("outputIndices",te)};
            let r = ${he.indicesGet("outputIndices",X)};
            let c = ${he.indicesGet("outputIndices",Q)};
            let dyCorner = vec2<i32>(i32(r), i32(c)) - uniforms.pads;
            let dyRCorner = dyCorner.x;
            let dyCCorner = dyCorner.y;
            let groupId = d1 / uniforms.output_channels_per_group;
            let wOutChannel = d1 - groupId * uniforms.output_channels_per_group;
            // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
            // ? = to be determined. : = across all values in that axis.
            var dotProd = ${he.type.value}(0.0);
            var wR: u32 = 0;
            if (uniforms.dilations.x == 1) {
              // Minimum wR >= 0 that satisfies (dyRCorner + wR) % (uniforms.strides.x) == 0
              wR = u32(((dyRCorner + i32(uniforms.strides.x) - 1) / i32(uniforms.strides.x)) * i32(uniforms.strides.x) - dyRCorner);
            }
            for (; wR < uniforms.effective_filter_dims.x; wR = wR + 1) {
              if (wR % uniforms.dilations.x != 0) {
                continue;
              }
              let dyR = (${Z}(dyRCorner) + ${Z}(wR)) / ${Z}(uniforms.strides[0]);
              let wRPerm = uniforms.filter_dims.x - 1 - wR / uniforms.dilations.x;
              if (dyR < 0.0 || dyR >= ${Z}(uniforms.Dy_shape[${X}]) || fract(dyR) > 0.0 ||
                  wRPerm < 0) {
                continue;
              }
              let idyR: u32 = u32(dyR);
              var wC: u32 = 0;
              if (uniforms.dilations.y == 1) {
                // Minimum wC >= 0 that satisfies (dyCCorner + wC) % (uniforms.strides.y) == 0
                wC = u32(((dyCCorner + i32(uniforms.strides.y) - 1) / i32(uniforms.strides.y)) * i32(uniforms.strides.y) - dyCCorner);
              }
              for (; wC < uniforms.effective_filter_dims.y; wC = wC + 1) {
                if (wC % uniforms.dilations.y != 0) {
                  continue;
                }
                let dyC = (${Z}(dyCCorner) + ${Z}(wC)) / ${Z}(uniforms.strides.y);
                let wCPerm = uniforms.filter_dims.y - 1 - wC / uniforms.dilations.y;
                if (dyC < 0.0 || dyC >= ${Z}(uniforms.Dy_shape[${Q}]) ||
                    fract(dyC) > 0.0 || wCPerm < 0) {
                  continue;
                }
                let idyC: u32 = u32(dyC);
                var inputChannel = groupId * uniforms.input_channels_per_group;
                ${_?`
                var x_offset = ${ee.indicesToOffset(`${ee.type.indices}(batch, idyR, idyC, inputChannel)`)} / ${m};
                var w_offset = ${R.indicesToOffset(`${R.type.indices}(wRPerm, wCPerm, inputChannel, wOutChannel)`)} / ${T};
                  `:""}
                for (var d2: u32 = 0; d2 < uniforms.input_channels_per_group_int; d2 = d2 + ${_?4:m}) {
                  ${_e()}
                  inputChannel = inputChannel + ${_?4:m};
                }
                ${U()}
                wC = wC + uniforms.strides.y - 1;
              }
              wR = wR + uniforms.strides[0] - 1;
            }
            let value = dotProd${s?` + bias[d1 / ${v}]`:""};
            ${he.setByOffset("global_idx","value")};
          `;return`
    ${G.registerUniforms(q).declareVariables(...ie,he)}
      ${G.mainStart()}
      ${G.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")};
    ${K}}`};return{name:"ConvTranspose2D",shaderCache:{hint:`${n.cacheKey};${m}${T}${v}${_}${y}`,inputDependencies:S},getRunData:()=>({dispatchGroup:{x:b[0],y:b[1],z:b[2]},outputs:[{dims:t?t(i):i,dataType:e[0].dataType}],programUniforms:I}),getShaderSource:W}}}),sM,rM,iM,Py,TE,oM,ky,lM,EE,r3=ct(()=>{s3(),$u(),uc(),sM=(e,n,t,s,i,l)=>(e-1)*n+t+(s-1)*i+1-l,rM=(e,n,t,s,i)=>{let l=Math.floor(e/2);n==="SAME_UPPER"?(t[s]=l,t[i]=e-l):n==="SAME_LOWER"&&(t[s]=e-l,t[i]=l)},iM=(e,n,t,s,i,l,c,u,d,f)=>{let m=e.length-2,_=f.length===0;d.length<m&&d.push(...Array(m-d.length).fill(0));let p=e[0],y=n[u?3:1]*i;for(let v=0,T=e.length-m-(u?1:0);v<m;++v,++T){let k=e[T],b=_?k*c[v]:f[v],S=sM(k,c[v],l[v],n[T],t[v],b);rM(S,s,l,v,v+m),_&&f.push(c[v]*(k-1)+d[v]+(n[T]-1)*t[v]+1-l[v]-l[v+m])}f.splice(0,0,p),f.splice(u?3:1,0,y)},Py=(e,n)=>{let t=e.kernelShape.slice();if(e.kernelShape.length===0||e.kernelShape.reduce((_,p)=>_*p,1)===0){t.length=0;for(let _=2;_<n[1].dims.length;++_)t.push(n[1].dims[_])}let s=e.format==="NHWC";t.splice(0,0,n[1].dims[0]),t.splice(s?3:1,0,n[1].dims[1]);let i=e.pads.slice(),l=e.outputShape.slice(),c=e.outputPadding.slice(),u=n[0].dims,d=e.dilations.slice();if(d.reduce((_,p)=>_+p,0)===0){let _=n[0].dims.length-2;d=new Array(_).fill(1)}let f=e.strides.slice();if(f.reduce((_,p)=>_+p,0)===0){let _=n[0].dims.length-2;f=new Array(_).fill(1)}iM(u,t,d,e.autoPad,e.group,i,f,s,c,l);let m=Object.assign({},e);return Object.assign(m,{kernelShape:t,pads:i,outputPadding:c,outputShape:l,dilations:d,strides:f}),m},TE=e=>{let n=hv(e),t=e.format,s=["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][typeof e.autoPad>"u"?0:e.autoPad],i=e.dilations,l=e.group,c=e.kernelShape,u=e.pads,d=e.strides,f=e.wIsConst(),m=e.outputPadding,_=e.outputShape;return{autoPad:s,format:t,dilations:i,group:l,kernelShape:c,outputPadding:m,outputShape:_,pads:u,strides:d,wIsConst:f,...n,cacheKey:`${e.format};${n.activation};`}},oM=(e,n)=>{if(!e||e.length!==2&&e.length!==3)throw new Error("Conv requires 2 or 3 inputs");if(e[0].dims.length!==4&&e[0].dims.length!==3)throw new Error("currently only support 2-dimensional conv");if(e[0].dims.length!==e[1].dims.length)throw new Error("filter does not have same dimension as input");let t=e[0].dims[n.format==="NHWC"?e[0].dims.length-1:1],s=e[1].dims[0];if(t!==s)throw new Error("FILTER_IN_CHANNEL should be equal to DATA_CHANNEL");let i=e[1].dims[1]*n.group;if(e.length===3&&(e[2].dims.length!==1||e[2].dims[0]!==i))throw new Error("invalid bias");let l=e[0].dims.length-2;if(n.dilations.reduce((c,u)=>c+u,0)>0&&n.dilations.length!==l)throw new Error(`dilations should be ${l}D`);if(n.strides.reduce((c,u)=>c+u,0)>0&&n.strides.length!==l)throw new Error(`strides should be ${l}D`);if(n.pads.reduce((c,u)=>c+u,0)>0&&n.pads.length!==l*2)throw new Error(`pads should be ${l*2}D`);if(n.outputPadding.length!==l&&n.outputPadding.length!==0)throw new Error(`output_padding should be ${l}D`);if(n.kernelShape.reduce((c,u)=>c+u,0)>0&&n.kernelShape.length!==0&&n.kernelShape.length!==e[1].dims.length-2)throw new Error("invalid kernel shape");if(n.outputShape.length!==0&&n.outputShape.length!==e[0].dims.length-2)throw new Error("invalid output shape")},ky=(e,n,t,s)=>{let i=e.kernelCustomData.wT??e.compute(yr(n[1],[2,3,0,1]),{inputs:[1],outputs:[t.wIsConst?-2:-1]})[0];t.wIsConst&&!e.kernelCustomData.wT&&(e.kernelCustomData.wT=i);let l=[n[0],i];n.length===3&&l.push(n[2]),e.compute(xE(l,t,s),{inputs:l})},lM=(e,n)=>{let t=n.format==="NHWC",s=[e.inputs[0].reshape(t?[e.inputs[0].dims[0],1,e.inputs[0].dims[1],e.inputs[0].dims[2]]:[e.inputs[0].dims[0],e.inputs[0].dims[1],1,e.inputs[0].dims[2]]),e.inputs[1].reshape([e.inputs[1].dims[0],e.inputs[1].dims[1],1,e.inputs[1].dims[2]])];e.inputs.length===3&&s.push(e.inputs[2]);let i=n.kernelShape;(i.length===0||i[0]===0)&&(i=[e.inputs[1].dims[2]]);let l=n.dilations;(l.length===0||l[0]===0)&&(l=[1]);let c=n.strides;(c.length===0||c[0]===0)&&(c=[1]);let u=n.pads;u.length===0&&(u=[0,0]),u=[0,u[0],0,u[1]],c=[1].concat(c),l=[1].concat(l),i=[1].concat(i);let d=n.outputPadding;d=[0].concat(d);let f=Py({...n,pads:u,strides:c,dilations:l,kernelShape:i,outputPadding:d},s);ky(e,s,f,m=>t?[m[0],m[2],m[3]]:[m[0],m[1],m[3]])},EE=(e,n)=>{if(oM(e.inputs,n),e.inputs[0].dims.length===3)lM(e,n);else{let t=Py(n,e.inputs);ky(e,e.inputs,t)}}}),cM,SE,CE,i3=ct(()=>{Wt(),en(),Fa(),tn(),cM=(e,n,t,s)=>{let i=je.size(n),l=n.length,c=Qe("input",e,l),u=At("output",e,l),d=t.dataType===6?t.getInt32Array()[0]:Number(t.getBigInt64Array()[0]),f=je.normalizeAxis(d,l),m=_=>{let p=` i32(${c.indicesGet("inputIndices","uniforms.axis")}) `,y=$t("uniforms.input_shape","uniforms.axis",l),v=s.reverse?p+(s.exclusive?" + 1":""):"0",T=s.reverse?y:p+(s.exclusive?"":" + 1");return`
                ${_.registerUniform("outputSize","u32").registerUniform("axis","u32").declareVariables(c,u)}
                ${_.mainStart()}
                  ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
                  var inputIndices = ${u.offsetToIndices("global_idx")};
                  var sum = ${u.type.value}(0);
                  let first : i32 = ${v};
                  let last : i32 = ${T};
                  for (var i : i32 = first; i < last; i++) {
                    ${c.indicesSet("inputIndices","uniforms.axis","u32(i)")};
                    sum = sum + ${c.getByIndices("inputIndices")};
                  }
                  ${u.setByOffset("global_idx","sum")};
                }`};return{name:"CumSum",shaderCache:{hint:s.cacheKey,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:n,dataType:e}],dispatchGroup:{x:Math.ceil(i/64)},programUniforms:[{type:12,data:i},{type:12,data:f},...zt(n,n)]}),getShaderSource:m}},SE=(e,n)=>{let t=e.inputs[0].dims,s=e.inputs[0].dataType,i=e.inputs[1];e.compute(cM(s,t,i,n),{inputs:[0]})},CE=e=>{let n=e.exclusive===1,t=e.reverse===1;return $n({exclusive:n,reverse:t})}}),uM,dM,fM,AE,PE,o3=ct(()=>{Wt(),en(),Fa(),tn(),uM=e=>{if(!e||e.length!==1)throw new Error("DepthToSpace requires 1 input.");if(e[0].dims.length!==4)throw new Error("DepthToSpace requires 4D input.")},dM=(e,n,t,s)=>{let i=[];i.push(`fn perm(i: ${s.type.indices}) -> ${t.type.indices} {
    var a: ${t.type.indices};`);for(let l=0;l<n;++l)i.push(t.indicesSet("a",e[l],`i[${l}]`));return i.push("return a;}"),i.join(`
`)},fM=(e,n)=>{let t,s,i,l,c,u,d=n.format==="NHWC",f=n.blocksize,m=n.mode==="DCR";d?([t,s,i,l]=e.dims,c=m?[t,s,i,f,f,l/f**2]:[t,s,i,l/f**2,f,f],u=m?[0,1,3,2,4,5]:[0,1,4,2,5,3]):([t,s,i,l]=[e.dims[0],e.dims[2],e.dims[3],e.dims[1]],c=m?[t,f,f,l/f**2,s,i]:[t,l/f**2,f,f,s,i],u=m?[0,3,4,1,5,2]:[0,1,4,2,5,3]);let _=e.reshape(c),p=_.dims.length,y=e.dataType,v=Qe("a",y,p),T=At("output",y,p),k=b=>`
  ${b.registerUniform("output_size","u32").declareVariables(v,T)}

  ${dM(u,p,v,T)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let indices = ${T.offsetToIndices("global_idx")};
    let aIndices = perm(indices);

    ${T.setByOffset("global_idx",v.getByIndices("aIndices"))}
  }`;return{name:"DepthToSpace",shaderCache:{hint:`${e.dims};${n.blocksize};${n.mode}`,inputDependencies:["rank"]},getRunData:b=>{let S=d?[t,s*f,i*f,l/f**2]:[t,l/f**2,s*f,i*f],$=je.size(S),w=_.dims,C=je.sortBasedOnPerm(w,u);return{outputs:[{dims:S,dataType:b[0].dataType}],dispatchGroup:{x:Math.ceil($/64)},programUniforms:[{type:12,data:$},...zt(w,C)]}},getShaderSource:k}},AE=(e,n)=>{uM(e.inputs),e.compute(fM(e.inputs[0],n))},PE=e=>$n({blocksize:e.blocksize,mode:e.mode,format:e.format})}),P_,Kp,$y,hM,pM,mM,_M,Dy,gM,kE,$E,l3=ct(()=>{Wt(),en(),Fa(),tn(),P_="[a-zA-Z]|\\.\\.\\.",Kp="("+P_+")+",$y="^"+Kp+"$",hM="("+Kp+",)*"+Kp,pM="^"+hM+"$",mM=class{constructor(e=-1){this.symbolToIndices=new Map,this.inputIndex=e}addSymbol(e,n){let t=this.symbolToIndices.get(e);t===void 0?t=[n]:t.push(n),this.symbolToIndices.set(e,t)}},_M=class{constructor(e,n){this.equation=n,this.hasEllipsis=!1,this.symbolToInfo=new Map,this.lhs=new Array,this.outputDims=[];let[t,s]=n.includes("->")?n.split("->",2):[n,""];if(!t.match(RegExp(pM)))throw new Error("Invalid LHS term");if(t.split(",").forEach((i,l)=>{let c=e[l].dims.slice();if(!i.match(RegExp($y)))throw new Error("Invalid LHS term");let u=this.processTerm(i,!0,c,l);this.lhs.push(u)}),s==="")s+=[...this.symbolToInfo.entries()].filter(([i,l])=>l.count===1||i==="...").map(([i])=>i).join("");else if(!s.match(RegExp(Kp)))throw new Error("Invalid RHS");s.match(RegExp(P_,"g"))?.forEach(i=>{if(i==="...")this.outputDims=this.outputDims.concat(this.ellipsisDims);else{let l=this.symbolToInfo.get(i);if(l===void 0)throw new Error("Invalid RHS symbol");this.outputDims.push(l.dimValue)}}),this.rhs=this.processTerm(s,!1,this.outputDims)}addSymbol(e,n,t){let s=this.symbolToInfo.get(e);if(s!==void 0){if(s.dimValue!==n&&s.count!==1)throw new Error("Dimension mismatch");s.count++,s.inputIndices.push(t)}else s={count:1,dimValue:n,inputIndices:[t]};this.symbolToInfo.set(e,s)}processTerm(e,n,t,s=-1){let i=t.length,l=!1,c=[],u=0;if(!e.match(RegExp($y))&&!n&&e!=="")throw new Error("Invalid LHS term");let d=e.match(RegExp(P_,"g")),f=new mM(s);return d?.forEach((m,_)=>{if(m==="..."){if(l)throw new Error("Only one ellipsis is allowed per input term");l=!0;let p=i-d.length+1;if(p<0)throw new Error("Ellipsis out of bounds");if(c=t.slice(u,u+p),this.hasEllipsis){if(this.ellipsisDims.length!==c.length||this.ellipsisDims.toString()!==c.toString())throw new Error("Ellipsis dimensions mismatch")}else if(n)this.hasEllipsis=!0,this.ellipsisDims=c;else throw new Error("Ellipsis must be specified in the LHS");for(let y=0;y<c.length;y++){let v=String.fromCharCode(48+y);f.addSymbol(v,_+y),this.addSymbol(v,t[u++],s)}}else f.addSymbol(m,_+(this.hasEllipsis?this.ellipsisDims.length-1:0)),this.addSymbol(m,t[u++],s)}),f}},Dy=e=>e+"_max",gM=(e,n,t,s)=>{let i=e.map(f=>f.length).map((f,m)=>Qe(`input${m}`,n,f)),l=je.size(s),c=At("output",n,s.length),u=[...t.symbolToInfo.keys()].filter(f=>!t.rhs.symbolToIndices.has(f)),d=f=>{let m=[],_="var prod = 1.0;",p="var sum = 0.0;",y="sum += prod;",v=[],T=[],k=[],b=[],S=t.symbolToInfo.size===t.rhs.symbolToIndices.size;t.symbolToInfo.forEach((w,C)=>{if(t.rhs.symbolToIndices.has(C)){let P=t.rhs.symbolToIndices.get(C)?.[0];P!==void 0&&t.lhs.forEach((A,I)=>{if(w.inputIndices.includes(I)){let W=A.symbolToIndices.get(C);if(W===void 0)throw new Error("Invalid symbol error");W.forEach(G=>{m.push(`${i[I].indicesSet(`input${I}Indices`,G,c.indicesGet("outputIndices",P))}`)})}})}else t.lhs.forEach((P,A)=>{if(w.inputIndices.includes(A)){let I=P.symbolToIndices.get(C);if(I===void 0)throw new Error("Invalid symbol error");I.forEach(W=>{v.push(`${i[A].indicesSet(`input${A}Indices`,W,`${C}`)}`)}),b.push(`prod *= ${i[A].getByIndices(`input${A}Indices`)};`)}}),T.push(`for(var ${C}: u32 = 0; ${C} < uniforms.${Dy(C)}; ${C}++) {`),k.push("}")});let $=S?[...m,`let sum = ${i.map((w,C)=>w.getByIndices(`input${C}Indices`)).join(" * ")};`]:[...m,p,...T,...v,_,...b,y,...k];return`
            ${f.registerUniforms(u.map(w=>({name:`${Dy(w)}`,type:"u32"}))).registerUniform("outputSize","u32").declareVariables(...i,c)}

            ${f.mainStart()}
            ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
            var outputIndices = ${c.offsetToIndices("global_idx")};
            ${i.map((w,C)=>`var input${C}Indices: ${i[C].type.indices};`).join(`
`)}
            ${$.join(`
`)};
            ${c.setByOffset("global_idx","sum")};
          }`};return{name:"Einsum",shaderCache:{hint:t.equation,inputDependencies:e.map(()=>"rank")},getRunData:()=>{let f=u.filter(_=>t.symbolToInfo.has(_)).map(_=>({type:12,data:t.symbolToInfo.get(_)?.dimValue||0}));f.push({type:12,data:l});let m=e.map((_,p)=>[...zt(_)]).reduce((_,p)=>_.concat(p),f);return m.push(...zt(s)),{outputs:[{dims:s,dataType:n}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:m}},getShaderSource:d}},kE=(e,n)=>{let t=new _M(e.inputs,n.equation),s=t.outputDims,i=e.inputs.map((l,c)=>l.dims);e.compute(gM(i,e.inputs[0].dataType,t,s))},$E=e=>{let n=e.equation.replace(/\s+/g,"");return $n({equation:n})}}),yM,Oy,vM,bM,DE,c3=ct(()=>{Wt(),en(),tn(),yM=e=>{if(!e||e.length!==2)throw new Error("Expand requires 2 input.");let n=e[0].dims,t=Array.from(e[1].getBigInt64Array(),Number),s=t.length<n.length?0:t.length-n.length,i=n.length<t.length?0:n.length-t.length;for(;s<t.length&&i<n.length;++s,++i)if(t[s]!==n[i]&&t[s]!==1&&n[i]!==1)throw new Error("Expand requires shape to be broadcastable to input")},Oy=(e,n)=>{let t=e.length-n.length,s=[];for(let i=0;i<t;++i)s.push(e[i]);for(let i=0;i<n.length;++i)s.push(n[i]===1?e[i+t]:n[i]);return s},vM=(e,n)=>e.length>n.length?Oy(e,n):Oy(n,e),bM=e=>{let n=e[0].dims,t=Array.from(e[1].getBigInt64Array(),Number),s=vM(n,t),i=e[0].dataType,l=i===9||je.size(n)===1,c=i===9||n.length>0&&n[n.length-1]%4===0?4:1,u=l||s.length>0&&s[s.length-1]%4===0?4:1,d=Math.ceil(je.size(s)/u),f=_=>{let p=Qe("input",i,n.length,c),y=At("output",i,s.length,u),v;if(i===9){let T=(k,b,S="")=>`
          let outputIndices${b} = ${y.offsetToIndices(`outputOffset + ${b}u`)};
          let offset${b} = ${p.broadcastedIndicesToOffset(`outputIndices${b}`,y)};
          let index${b} = offset${b} / 4u;
          let component${b} = offset${b} % 4u;
          ${k}[${b}] = ${S}(${p.getByOffset(`index${b}`)}[component${b}]);
        `;v=`
        let outputOffset = global_idx * ${u};
        var data = vec4<u32>(0);
        ${T("data",0,"u32")}
        ${T("data",1,"u32")}
        ${T("data",2,"u32")}
        ${T("data",3,"u32")}
        ${y.setByOffset("global_idx","data")}
      }`}else v=`
        let outputIndices = ${y.offsetToIndices(`global_idx * ${u}`)};
        let inputOffset = ${p.broadcastedIndicesToOffset("outputIndices",y)};
        let data = ${y.type.value}(${p.getByOffset(`inputOffset / ${c}`)});
        ${y.setByOffset("global_idx","data")}
      }`;return`
    ${_.registerUniform("vec_size","u32").declareVariables(p,y)}
    ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
    ${v}`},m=[{type:12,data:d},...zt(n,s)];return{name:"Expand",shaderCache:{hint:`${s.length};${c}${u}`,inputDependencies:["rank"]},getShaderSource:f,getRunData:()=>({outputs:[{dims:s,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:m})}},DE=e=>{yM(e.inputs),e.compute(bM(e.inputs),{inputs:[0]})}}),wM,OE,u3=ct(()=>{Wt(),en(),tn(),fv(),wM=e=>{let n=e[0].dataType,t=je.size(e[0].dims),s=je.size(e[1].dims),i=s%4===0,l=c=>{let u=Qe("x",n,[1],4),d=Qe("bias",n,[1],4),f=At("y",n,[1],4),m=[{name:"output_vec_size",type:"u32"},{name:"bias_size",type:"u32"}],_=y=>`
      let bias${y}_offset: u32 = (global_idx * 4 + ${y}) % uniforms.bias_size;
      let bias${y} = ${d.getByOffset(`bias${y}_offset / 4`)}[bias${y}_offset % 4];`,p=i?`
      let bias = ${d.getByOffset("global_idx % (uniforms.bias_size / 4)")};`:`${_(0)}${_(1)}${_(2)}${_(3)}
      let bias = ${u.type.value}(bias0, bias1, bias2, bias3);`;return`${c.registerUniforms(m).declareVariables(u,d,f)}

    ${x0(As(n))}

    ${c.mainStart(wf)}
      ${c.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_vec_size")}

      let x = ${u.getByOffset("global_idx")};
      ${p}
      let x_in = x + bias;
      ${f.setByOffset("global_idx",T0("x_in"))}
    }`};return{name:"FastGeluWithBias",shaderCache:{hint:`${i}`,inputDependencies:["type","type"]},getShaderSource:l,getRunData:c=>({outputs:[{dims:c[0].dims,dataType:c[0].dataType}],programUniforms:[{type:12,data:Math.ceil(t/4)},{type:12,data:s}],dispatchGroup:{x:Math.ceil(t/wf/4)}})}},OE=e=>{e.inputs.length<2||je.size(e.inputs[1].dims)===0?J2(e):e.compute(wM(e.inputs))}}),MM,xM,IE,zE,d3=ct(()=>{Wt(),en(),Fa(),tn(),MM=e=>{if(!e||e.length!==2)throw new Error("Gather requires 2 inputs.")},xM=(e,n)=>{let t=e[0].dims,s=e[1].dims,i=t.length,l=je.normalizeAxis(n.axis,i),c=t.slice(0);c.splice(l,1,...s);let u=t[l],d=e[0].dataType===9?4:1,f=Math.ceil(je.size(c)/d),m=[{type:12,data:f},{type:6,data:u},{type:12,data:l},...zt(e[0].dims,e[1].dims,c)],_=p=>{let y=Qe("data",e[0].dataType,e[0].dims.length,d),v=Qe("inputIndices",e[1].dataType,e[1].dims.length),T=At("output",e[0].dataType,c.length,d),k=S=>{let $=s.length,w=`var indicesIndices${S}  = ${v.type.indices}(0);`;for(let C=0;C<$;C++)w+=`${$>1?`indicesIndices${S}[${C}]`:`indicesIndices${S}`} = ${c.length>1?`outputIndices${S}[uniforms.axis + ${C}]`:`outputIndices${S}`};`;w+=`
          var idx${S} = ${v.getByIndices(`indicesIndices${S}`)};
          if (idx${S} < 0) {
            idx${S} = idx${S} + uniforms.axisDimLimit;
          }
          var dataIndices${S} : ${y.type.indices};
        `;for(let C=0,P=0;C<i;C++)C===l?(w+=`${i>1?`dataIndices${S}[${C}]`:`dataIndices${S}`} = u32(idx${S});`,P+=$):(w+=`${i>1?`dataIndices${S}[${C}]`:`dataIndices${S}`} = ${c.length>1?`outputIndices${S}[${P}]`:`outputIndices${S}`};`,P++);return w},b;if(e[0].dataType===9){let S=($,w,C="")=>`
          let outputIndices${w} = ${T.offsetToIndices(`outputOffset + ${w}u`)};
          ${k(w)};
          let offset${w} = ${y.indicesToOffset(`dataIndices${w}`)};
          let index${w} = offset${w} / 4u;
          let component${w} = offset${w} % 4u;
          ${$}[${w}] = ${C}(${y.getByOffset(`index${w}`)}[component${w}]);
        `;b=`
        let outputOffset = global_idx * ${d};
        var value = vec4<u32>(0);
        ${S("value",0,"u32")}
        ${S("value",1,"u32")}
        ${S("value",2,"u32")}
        ${S("value",3,"u32")}
        ${T.setByOffset("global_idx","value")}
      `}else b=`
      let outputIndices = ${T.offsetToIndices("global_idx")};
      ${k("")};
      let value = ${y.getByIndices("dataIndices")};
      ${T.setByOffset("global_idx","value")};
      `;return`
      ${p.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(y,v,T)}
      ${p.mainStart()}
        ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        ${b}
      }`};return{name:"Gather",shaderCache:{hint:n.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:c,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:_}},IE=e=>$n({axis:e.axis}),zE=(e,n)=>{let t=e.inputs;MM(t),e.compute(xM(e.inputs,n))}}),TM,LE,FE,f3=ct(()=>{Wt(),en(),tn(),TM=(e,n,t,s,i,l,c,u,d)=>{let f=[{type:12,data:l},{type:12,data:s},{type:12,data:i},{type:12,data:t},{type:12,data:c},{type:12,data:u},{type:12,data:d}],m=[l];f.push(...zt(n.dims,m));let _=p=>{let y=Qe("indices_data",n.dataType,n.dims.length),v=At("input_slice_offsets_data",12,1,1),T=[y,v],k=[{name:"output_size",type:"u32"},{name:"batch_dims",type:"u32"},{name:"input_dims",type:"u32",length:i.length},{name:"sizes_from_slice_dims_data",type:"u32",length:t.length},{name:"num_slices_per_batch",type:"u32"},{name:"input_batch_stride",type:"u32"},{name:"num_slice_dims",type:"u32"}];return`
  ${p.registerUniforms(k).declareVariables(...T)}
  ${p.mainStart()}
    ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let batch_idx = global_idx / uniforms.num_slices_per_batch;
    let base_offset = batch_idx * uniforms.input_batch_stride;

    let slice_indices_base_offset = global_idx * uniforms.num_slice_dims;
    var relative_slice_offset = 0;
    for (var dim_idx = 0u; dim_idx < uniforms.num_slice_dims; dim_idx ++) {
      var index = i32(indices_data[dim_idx + slice_indices_base_offset].x);
      let input_dim_idx = uniforms.batch_dims + dim_idx;
      if (index < 0) {
        ${i.length===1?"index += i32(uniforms.input_dims);":"index += i32(uniforms.input_dims[input_dim_idx]);"}
      }
      ${t.length===1?"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data);":"relative_slice_offset += index * i32(uniforms.sizes_from_slice_dims_data[dim_idx]);"}
    }

    input_slice_offsets_data[global_idx] =  base_offset + u32(relative_slice_offset);
  }`};return e.compute({name:"computeSliceOffsets",shaderCache:{hint:`${i.length}_${t.length}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:m,dataType:e.inputs[1].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:f}),getShaderSource:_},{inputs:[n],outputs:[-1]})[0]},LE=(e,n)=>{let t=e.inputs,s=t[0].dims,i=t[0].dataType,l=t[1].dims,c=l[l.length-1],u=je.sizeToDimension(l,l.length-1),d=je.sizeFromDimension(s,n.batchDims+c),f=je.sizeToDimension(s,n.batchDims),m=je.sizeFromDimension(s,n.batchDims),_=u/f,p=new Array(c),y=d;for(let w=0;w<c;++w)p[c-1-w]=y,y*=s[n.batchDims+c-1-w];let v=TM(e,t[1],p,n.batchDims,s,u,_,m,c),T=n.batchDims+c;if(T>s.length)throw new Error("last dimension of indices must not be larger than rank of input tensor");let k=l.slice(0,-1).concat(s.slice(T)),b=je.size(k),S=[{type:12,data:b},{type:12,data:d},...zt(t[0].dims,v.dims,k)],$=w=>{let C=Qe("data",t[0].dataType,t[0].dims.length),P=Qe("slice_offsets",12,v.dims.length),A=At("output",t[0].dataType,k.length);return`
          ${w.registerUniform("output_size","u32").registerUniform("slice_size","u32").declareVariables(C,P,A)}
            ${w.mainStart()}
            ${w.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let slice_offset = slice_offsets[global_idx / uniforms.slice_size];
          output[global_idx] = data[u32(slice_offset) + global_idx % uniforms.slice_size];
        }`};e.compute({name:"GatherND",shaderCache:{hint:n.cacheKey,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:k,dataType:i}],dispatchGroup:{x:Math.ceil(b/64)},programUniforms:S}),getShaderSource:$},{inputs:[t[0],v]})},FE=e=>({batchDims:e.batch_dims,cacheKey:""})}),EM,SM,NE,jE,h3=ct(()=>{Wt(),en(),Fa(),tn(),EM=(e,n)=>{if(e.length<3||e.length>4)throw new Error("GatherBlockQuantized requires 3 or 4 inputs.");let t=je.normalizeAxis(n.quantizeAxis,e[0].dims.length),s=n.blockSize,i=e[0],l=e[2],c=e.length===4?e[3]:void 0;if(l.dims.length!==i.dims.length||!i.dims.map((u,d)=>d===t?Math.ceil(u/s)===l.dims[d]:u===l.dims[d]).reduce((u,d)=>u&&d,!0))throw new Error("Scales must have the same rank as the input tensor and the dims should match except on gatherAxis.");if(c){if(c.dataType!==i.dataType)throw new Error("Zero point must have the same data type as the input tensor.");if(c.dims.length!==l.dims.length||!c.dims.map((u,d)=>u===l.dims[d]).reduce((u,d)=>u&&d,!0))throw new Error("Zero point must have the same rank as the input tensor and the dims should match except on quantizeAxis.")}},SM=(e,n)=>{let t=e[0].dims,s=e[1].dims,i=t.length,l=je.normalizeAxis(n.gatherAxis,i),c=je.normalizeAxis(n.quantizeAxis,i),u=t.slice(0);u.splice(l,1,...s);let d=je.size(u),f=e[2].dataType,m=e[0].dataType===22,_=[{type:12,data:d},{type:12,data:c},{type:12,data:l},{type:12,data:n.blockSize},...zt(...e.map((y,v)=>y.dims),u)],p=y=>{let v=Qe("data",e[0].dataType,e[0].dims.length),T=Qe("inputIndices",e[1].dataType,e[1].dims.length),k=Qe("scales",e[2].dataType,e[2].dims.length),b=e.length>3?Qe("zeroPoint",e[3].dataType,e[3].dims.length):void 0,S=At("output",f,u.length),$=[v,T,k];b&&$.push(b);let w=[{name:"output_size",type:"u32"},{name:"quantize_axis",type:"u32"},{name:"gather_axis",type:"u32"},{name:"block_size",type:"u32"}];return`
        ${y.registerUniforms(w).declareVariables(...$,S)}
        ${y.mainStart()}
        let output_indices = ${S.offsetToIndices("global_idx")};
        var indices_indices = ${T.type.indices}(0);
        ${s.length>1?`
          for (var i: u32 = 0; i < ${s.length}; i++) {
            let index = ${S.indicesGet("output_indices","uniforms.gather_axis + i")};
            ${T.indicesSet("indices_indices","i","index")};
          }`:`indices_indices = ${S.indicesGet("output_indices","uniforms.gather_axis")};`};
        var data_indices = ${v.type.indices}(0);
        for (var i: u32 = 0; i < uniforms.gather_axis; i++) {
          let index = ${S.indicesGet("output_indices","i")};
          ${v.indicesSet("data_indices","i","index")};
        }
        var index_from_indices = ${T.getByIndices("indices_indices")};
        if (index_from_indices < 0) {
          index_from_indices += ${t[l]};
        }
        ${v.indicesSet("data_indices","uniforms.gather_axis","u32(index_from_indices)")};
        for (var i = uniforms.gather_axis + 1; i < ${u.length}; i++) {
          let index = ${S.indicesGet("output_indices",`i + ${s.length} - 1`)};
          ${v.indicesSet("data_indices","i","index")};
        }
        let data_offset = ${v.indicesToOffset("data_indices")};
        let data_index = data_offset % 8;
        // Convert 4-bit packed data to 8-bit packed data.
        let packed_4bit_quantized_data = ${v.getByOffset("data_offset / 8")};
        let packed_8bit_quantized_data = (packed_4bit_quantized_data >> (4 * (data_index % 2))) & 0x0f0f0f0f;
        let quantized_data_vec = ${m?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_quantized_data));
        let quantized_data = quantized_data_vec[data_index / 2];
        var scale_indices = data_indices;
        let quantize_axis_index = ${k.indicesGet("data_indices","uniforms.quantize_axis")} / uniforms.block_size;
        ${k.indicesSet("scale_indices","uniforms.quantize_axis","quantize_axis_index")};
        var scale = ${k.getByIndices("scale_indices")};
        ${b?`
              let zero_point_indices = scale_indices;
              let zero_point_offset = ${b.indicesToOffset("zero_point_indices")};
              let zero_point_index = zero_point_offset % 8;
              let packed_4bit_zero_points = ${b.getByOffset("zero_point_offset / 8")};
              let packed_8bit_zero_points = (packed_4bit_zero_points >> (4 * (zero_point_index % 2))) & 0x0f0f0f0f;
              let zero_point_vec = ${m?"unpack4xI8":"unpack4xU8"}(u32(packed_8bit_zero_points));
              let zero_point = zero_point_vec[zero_point_index / 2];`:"var zero_point = 0"};
        let dequantized_data = ${As(f)}(quantized_data - zero_point) * scale;
        ${S.setByOffset("global_idx","dequantized_data")};
    }`};return{name:"GatherBlockQuantized",shaderCache:{hint:`${n.cacheKey};${e.filter((y,v)=>v!==1).map(y=>y.dims.join("_")).join(";")}`,inputDependencies:Array.from({length:e.length},(y,v)=>"rank")},getRunData:()=>({outputs:[{dims:u,dataType:f}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:_}),getShaderSource:p}},NE=(e,n)=>{let t=e.inputs;EM(t,n),e.compute(SM(e.inputs,n))},jE=e=>$n({blockSize:e.blockSize,gatherAxis:e.gatherAxis,quantizeAxis:e.quantizeAxis})}),CM,AM,RE,BE,p3=ct(()=>{Wt(),en(),Fa(),tn(),CM=e=>{if(!e||e.length!==2)throw new Error("GatherElements requires 2 inputs.");if(e[0].dims.length<1)throw new Error("GatherElements requires that the data input be rank >= 1.");if(e[0].dims.length!==e[1].dims.length)throw new Error(`GatherElements requires that the data input and
                     indices input tensors be of same rank.`)},AM=(e,n)=>{let t=e[0].dims,s=e[0].dataType,i=t.length,l=e[1].dims,c=e[1].dataType,u=je.normalizeAxis(n.axis,i),d=t[u],f=l.slice(0),m=je.size(f),_=Qe("input",s,i),p=Qe("indicesInput",c,l.length),y=At("output",s,f.length),v=[{type:12,data:m},{type:6,data:d},{type:12,data:u}];return v.push(...zt(t,l,f)),{name:"GatherElements",shaderCache:{inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:f,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:v}),getShaderSource:T=>`
      ${T.registerUniform("outputSize","u32").registerUniform("axisDimLimit","i32").registerUniform("axis","u32").declareVariables(_,p,y)}
      ${T.mainStart()}
      ${T.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

      let outputIndices = ${y.offsetToIndices("global_idx")};

      var idx = ${p.getByOffset("global_idx")};
      if (idx < 0) {
        idx = idx + uniforms.axisDimLimit;
      }
      var inputIndices = ${_.type.indices}(outputIndices);
      ${_.indicesSet("inputIndices","uniforms.axis","u32(idx)")};
      let value = ${_.getByIndices("inputIndices")};

      ${y.setByOffset("global_idx","value")};
  }`}},RE=e=>$n({axis:e.axis}),BE=(e,n)=>{let t=e.inputs;CM(t),e.compute(AM(e.inputs,n))}}),PM,kM,UE,VE,m3=ct(()=>{Wt(),en(),tn(),PM=e=>{if(!e)throw new Error("Input is missing");if(e.length<2||e.length>3)throw new Error("Invaid input number.");if(e.length===3&&e[2].dims.length>2)throw new Error("Invalid input shape of C");if(e[0].dataType!==e[1].dataType||e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("Input types are mismatched")},kM=(e,n)=>{let t=e[0].dims.slice(),s=e[1].dims.slice(),[i,l,c]=RT.getShapeOfGemmResult(t,n.transA,s,n.transB,e.length===3?e[2].dims:void 0),u=[i,l];if(!u)throw new Error("Can't use gemm on the given tensors");let d=16,f=Math.ceil(l/d),m=Math.ceil(i/d),_=!0,p=je.size(u),y=[{type:12,data:_?f:p},{type:12,data:i},{type:12,data:l},{type:12,data:c},{type:1,data:n.alpha},{type:1,data:n.beta}],v=["type","type"];e.length===3&&(y.push(...zt(e[2].dims)),v.push("rank")),y.push(...zt(u));let T=b=>{let S="";n.transA&&n.transB?S="value += a[k * uniforms.M + m] * b[n * uniforms.K + k];":n.transA&&!n.transB?S="value += a[k * uniforms.M + m] * b[k * uniforms.N + n];":!n.transA&&n.transB?S="value += a[m * uniforms.K + k] * b[n * uniforms.K + k];":!n.transA&&!n.transB&&(S="value += a[m * uniforms.K + k] * b[k * uniforms.N + n];");let $=n.alpha===1?"":"value *= uniforms.alpha;",w=Qe("a",e[0].dataType,e[0].dims),C=Qe("b",e[1].dataType,e[1].dims),P=w.type.value,A=null,I=[w,C];e.length===3&&(A=Qe("c",e[2].dataType,e[2].dims.length),I.push(A));let W=At("output",e[0].dataType,u.length);I.push(W);let G=[{name:"output_size",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}];return`
  ${b.registerUniforms(G).declareVariables(...I)}

  ${b.mainStart()}
    ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

    let m = global_idx / uniforms.N;
    let n = global_idx % uniforms.N;

    var value = ${P}(0);
    for (var k: u32 = 0u; k < uniforms.K; k++) {
      ${S}
    }

    ${$}
    ${A!=null?`let cOffset = ${A.broadcastedIndicesToOffset("vec2(m, n)",W)}; value += ${P}(uniforms.beta) * ${A.getByOffset("cOffset")};`:""}
    output[global_idx] = value;
  }`},k=b=>{let S=Qe("a",e[0].dataType,e[0].dims),$=Qe("b",e[1].dataType,e[1].dims),w=null,C=[S,$];e.length===3&&(w=Qe("c",e[2].dataType,e[2].dims.length),C.push(w));let P=At("output",e[0].dataType,u.length);C.push(P);let A=[{name:"num_tile_n",type:"u32"},{name:"M",type:"u32"},{name:"N",type:"u32"},{name:"K",type:"u32"},{name:"alpha",type:"f32"},{name:"beta",type:"f32"}],I="",W="";n.transA&&n.transB?(W=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${S.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${$.type.value}(0);
      }
      `,I="value += tile_a[k][local_id.y] * tile_b[local_id.x][k];"):n.transA&&!n.transB?(W=`
      var col = tile_row_start + local_id.x;
      var row = k_start + local_id.y;
      if (col < uniforms.M && row < uniforms.K) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.M + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${S.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${$.type.value}(0);
      }
      `,I="value += tile_a[k][local_id.y] * tile_b[k][local_id.x];"):!n.transA&&n.transB?(W=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${S.type.value}(0);
      }

      col = k_start + local_id.x;
      row = tile_col_start + local_id.y;
      if (col < uniforms.K && row < uniforms.N) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.K + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${$.type.value}(0);
      }
      `,I="value += tile_a[local_id.y][k] * tile_b[local_id.x][k];"):!n.transA&&!n.transB&&(W=`
      var col = k_start + local_id.x;
      var row = tile_row_start + local_id.y;
      if (col < uniforms.K && row < uniforms.M) {
        tile_a[local_id.y][local_id.x] = a[row * uniforms.K + col];
      } else {
        tile_a[local_id.y][local_id.x] = ${S.type.value}(0);
      }

      col = tile_col_start + local_id.x;
      row = k_start + local_id.y;
      if (col < uniforms.N && row < uniforms.K) {
        tile_b[local_id.y][local_id.x] = b[row * uniforms.N + col];
      } else {
        tile_b[local_id.y][local_id.x] = ${$.type.value}(0);
      }
      `,I="value += tile_a[local_id.y][k] * tile_b[k][local_id.x];");let G=n.alpha===1?"":"value *= uniforms.alpha;";return`
  ${b.registerUniforms(A).declareVariables(...C)}
  var<workgroup> tile_a: array<array<${S.type.storage}, ${d}>, ${d}>;
  var<workgroup> tile_b: array<array<${$.type.storage}, ${d}>, ${d}>;
  ${b.mainStart([d,d,1])}
    let tile_col_start = (workgroup_index % uniforms.num_tile_n) * ${d};
    let tile_row_start = (workgroup_index / uniforms.num_tile_n) * ${d};
    let num_tiles = (uniforms.K - 1) / ${d} + 1;
    var k_start = 0u;
    var value = ${P.type.value}(0);
    for (var t: u32 = 0u; t < num_tiles; t++) {
      ${W}
      k_start = k_start + ${d};
      workgroupBarrier();

      for (var k: u32 = 0u; k < ${d}; k++) {
        ${I}
      }
      workgroupBarrier();
    }

    ${G}
    let m = tile_row_start + local_id.y;
    let n = tile_col_start + local_id.x;
    ${w!=null?`let cOffset = ${w.broadcastedIndicesToOffset("vec2(m, n)",P)}; value += ${P.type.value}(uniforms.beta) * ${w.getByOffset("cOffset")};`:""}
    if (m < uniforms.M && n < uniforms.N) {
      output[m * uniforms.N + n] = value;
    }
  }`};return _?{name:"GemmShared",shaderCache:{hint:`${n.cacheKey}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:u,dataType:e[0].dataType}],dispatchGroup:{x:f*m},programUniforms:y}),getShaderSource:k}:{name:"Gemm",shaderCache:{hint:`${n.cacheKey}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:u,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:y}),getShaderSource:T}},UE=e=>{let n=e.transA,t=e.transB,s=e.alpha,i=e.beta;return{transA:n,transB:t,alpha:s,beta:i,cacheKey:`${e.transA};${e.transB};${e.alpha===1}`}},VE=(e,n)=>{PM(e.inputs),e.compute(kM(e.inputs,n))}}),Ji,Go,fu,hu,$M,DM,OM,IM,zM,LM,FM,NM,GE,WE,_3=ct(()=>{Wt(),en(),Fa(),tn(),[Ji,Go,fu,hu]=[0,1,2,3],$M=e=>{if(e[0].dims.length!==4)throw new Error("only 4-D tensor is supported.");if(e[0].dims.length!==e[1].dims.length)throw new Error("input dimensions must be equal to grid dimensions");if(e[0].dims.length-2!==e[1].dims[e[1].dims.length-1])throw new Error(`last dimension of grid must be equal to ${e[0].dims.length-2}`);if(e[0].dims[0]!==e[1].dims[0])throw new Error("grid batch size must match input batch size")},DM=`
  fn gs_get_cubic_coeffs(x: f32) -> vec4<f32> {
    let cubic_alpha = -0.75f;
    let x_abs = abs(x);
    var coeffs: vec4<f32>;
    coeffs[0] = (((cubic_alpha * (x_abs + 1) - 5 * cubic_alpha) * (x_abs + 1) + 8 * cubic_alpha) * (x_abs + 1) - 4 * cubic_alpha);
    coeffs[1] = (((cubic_alpha + 2) * x_abs - (cubic_alpha + 3)) * x_abs * x_abs + 1);
    coeffs[2] = (((cubic_alpha + 2) * (1 - x_abs) - (cubic_alpha + 3)) * (1 - x_abs) * (1 - x_abs) + 1);
    coeffs[3] = (((cubic_alpha * (2 - x_abs) - 5 * cubic_alpha) * (2 - x_abs) + 8 * cubic_alpha) * (2 - x_abs) - 4 * cubic_alpha);
    return coeffs;
  }
`,OM=e=>`
  fn gs_bicubic_interpolate(p: mat4x4<${e}>, x: f32, y: f32) -> ${e} {
    var v: vec4<f32>;
    var coeffs = gs_get_cubic_coeffs(x);
    for (var i = 0; i < 4; i++) {
      v[i] = coeffs[0] * p[i][0] + coeffs[1] * p[i][1] + coeffs[2] * p[i][2] + coeffs[3] * p[i][3];
    }
    coeffs = gs_get_cubic_coeffs(y);
    let pixel = ${e}(coeffs[0] * v[0] + coeffs[1] * v[1] + coeffs[2] * v[2] + coeffs[3] * v[3]);
    return pixel;
  }
`,IM=e=>`
  fn gs_denormalize(n: f32, length: i32) -> f32 {
    ${e.alignCorners===0?`
    // alignCorners: false => [-1, 1] to [-0.5, length - 0.5]
    return ((n + 1.0) * f32(length) - 1.0) / 2.0;
    `:`
    // alignCorners: true => [-1, 1] to [0, length - 1]
    return (n + 1.0) / 2.0 * (f32(length - 1));
    `}
  }
`,zM=e=>`
  ${e.paddingMode==="reflection"?`
      fn gs_reflect(x: i32, x_min: f32, x_max: f32) -> u32 {
        var dx = 0.0;
        var fx = f32(x);
        let range = x_max - x_min;
        if (fx < x_min) {
          dx = x_min - fx;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_min + r;
          } else {
            fx = x_max - r;
          }
        } else if (fx > x_max) {
          dx = fx - x_max;
          let n = u32(dx / range);
          let r = dx - f32(n) * range;
          if (n % 2 == 0) {
            fx = x_max - r;
          } else {
            fx = x_min + r;
          }
        }
        return u32(fx);
      }`:""}
`,LM=(e,n,t)=>`
  fn pixel_at_grid(r: i32, c: i32, H: i32, W: i32, batch: u32, channel: u32, border: vec4<f32>) -> ${n} {
     var pixel = ${n}(0);
     var indices = vec4<u32>(0);
     indices[${Ji}] = batch;
     indices[${Go}] = channel;`+(()=>{switch(t.paddingMode){case"zeros":return`
          if (r >= 0 && r < H && c >=0 && c < W) {
            indices[${fu}] = u32(r);
            indices[${hu}] = u32(c);
          } else {
            return ${n}(0);
          }
        `;case"border":return`
          indices[${fu}] = u32(clamp(r, 0, H - 1));
          indices[${hu}] = u32(clamp(c, 0, W - 1));
        `;case"reflection":return`
          indices[${fu}] = gs_reflect(r, border[1], border[3]);
          indices[${hu}] = gs_reflect(c, border[0], border[2]);
        `;default:throw new Error(`padding mode ${t.paddingMode} is not supported`)}})()+`
    return ${e.getByIndices("indices")};
  }
`,FM=(e,n,t)=>(()=>{switch(t.mode){case"nearest":return`
          let result = pixel_at_grid(i32(round(y)), i32(round(x)), H_in, W_in, indices[${Ji}], indices[${Go}], border);
        `;case"bilinear":return`
          let x1 = i32(floor(x));
          let y1 = i32(floor(y));
          let x2 = x1 + 1;
          let y2 = y1 + 1;

          let p11 = pixel_at_grid(y1, x1, H_in, W_in, indices[${Ji}], indices[${Go}], border);
          let p12 = pixel_at_grid(y1, x2, H_in, W_in, indices[${Ji}], indices[${Go}], border);
          let p21 = pixel_at_grid(y2, x1, H_in, W_in, indices[${Ji}], indices[${Go}], border);
          let p22 = pixel_at_grid(y2, x2, H_in, W_in, indices[${Ji}], indices[${Go}], border);

          let dx2 = ${n}(f32(x2) - x);
          let dx1 = ${n}(x - f32(x1));
          let dy2 = ${n}(f32(y2) - y);
          let dy1 = ${n}(y - f32(y1));
          let result = dy2 * (dx2 * p11 + dx1 * p12) + dy1 * (dx2 * p21 + dx1 * p22);
        `;case"bicubic":return`
          let x0 = i32(floor(x)) - 1;
          let y0 = i32(floor(y)) - 1;
          var p: mat4x4<${n}>;
          for (var h = 0; h < 4; h++) {
            for (var w = 0; w < 4; w++) {
              p[h][w] = pixel_at_grid(h + y0, w + x0, H_in, W_in, indices[${Ji}], indices[${Go}], border);
            }
          }

          let dx = x - f32(x0 + 1);
          let dy = y - f32(y0 + 1);
          let result = gs_bicubic_interpolate(p, dx, dy);
        `;default:throw new Error(`mode ${t.mode} is not supported`)}})()+`${e.setByOffset("global_idx","result")}`,NM=(e,n)=>{let t=Qe("x",e[0].dataType,e[0].dims.length),s=[e[1].dims[0],e[1].dims[1],e[1].dims[2]],i=Qe("grid",e[1].dataType,s.length,2),l=[e[0].dims[0],e[0].dims[1],e[1].dims[1],e[1].dims[2]];n.format==="NHWC"&&(l=[e[0].dims[0],e[1].dims[1],e[1].dims[2],e[0].dims[3]],[Ji,Go,fu,hu]=[0,3,1,2]);let c=At("output",e[0].dataType,l.length),u=t.type.value,d=je.size(l),f=[{type:12,data:d},...zt(e[0].dims,s,l)],m=_=>`
  ${_.registerUniform("output_size","u32").declareVariables(t,i,c)}
  ${DM}
  ${OM(u)}
  ${IM(n)}
  ${zM(n)}
  ${LM(t,u,n)}

  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let H_in = i32(uniforms.x_shape[${fu}]);
      let W_in = i32(uniforms.x_shape[${hu}]);

      ${n.alignCorners===0?`
      let x_min = -0.5;
      let x_max = f32(W_in) - 0.5;
      let y_min = -0.5;
      let y_max = f32(H_in) - 0.5;
      `:`
      let x_min = 0.0;
      let x_max = f32(W_in) - 1.0;
      let y_min = 0.0;
      let y_max = f32(H_in) - 1.0;
      `};
      let border = vec4<f32>(x_min, y_min, x_max, y_max);

      let indices = ${c.offsetToIndices("global_idx")};
      var grid_indices = vec3<u32>(indices[${Ji}], indices[${fu}], indices[${hu}]);
      let nxy = ${i.getByIndices("grid_indices")};
      var x = gs_denormalize(f32(nxy[0]), W_in);
      var y = gs_denormalize(f32(nxy[1]), H_in);

      ${FM(c,u,n)}
  }`;return{name:"GridSample",shaderCache:{hint:`${n.cacheKey}`,inputDependencies:["type","type"]},getRunData:_=>{let p=je.size(l);return{outputs:[{dims:l,dataType:_[0].dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:f}},getShaderSource:m}},GE=(e,n)=>{$M(e.inputs),e.compute(NM(e.inputs,n))},WE=e=>$n({alignCorners:e.align_corners,mode:e.mode,paddingMode:e.padding_mode,format:e.format})}),Ns,jM,HE,Iy,RM,im,qE,KE=ct(()=>{Wt(),en(),Fa(),lv(),dv(),tn(),uc(),Ns=(e,n)=>e.length>n&&e[n].dims.length>0?e[n]:void 0,jM=(e,n)=>{let t=e[0],s=Ns(e,1),i=Ns(e,2),l=Ns(e,3),c=Ns(e,4),u=Ns(e,5),d=Ns(e,6),f=Ns(e,7);if(t.dims.length!==3&&t.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let m=t.dims[0],_=t.dims[1],p=t.dims.length===3?t.dims[2]:n.numHeads*t.dims[4],y=_,v=0,T=0,k=Math.floor(p/n.numHeads);if(d&&f&&je.size(d.dims)&&je.size(f.dims)){if(d.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(d.dims[0]!==m||d.dims[1]!==n.numHeads||d.dims[3]!==k)throw new Error('Input "past_key" shape (batch_size, num_heads, past_sequence_length, head_size)');if(f.dims[0]!==m||f.dims[1]!==n.numHeads||f.dims[3]!==k)throw new Error('Input "past_value" shape (batch_size, num_heads, past_sequence_length, head_size)');if(d.dims[2]!==f.dims[2])throw new Error('Input "past_key" and "past_value" shall have same dim 2 (past_sequence_length)');if(f.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');v=d.dims[2],T=d.dims[2]}else if(d&&je.size(d.dims)||f&&je.size(f.dims))throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let b;if(s&&je.size(s.dims)>0){if(t.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(s.dims.length<3||s.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(t.dims[0]!==s.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(s.dims.length===3){if(s.dims[2]!==t.dims[2])throw new Error('Input "query" and "key" shall have same dim 2 (hidden_size)');b=2,y=s.dims[1]}else if(s.dims.length===5){if(s.dims[2]!==n.numHeads||s.dims[3]!==2||s.dims[4]!==k)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');b=5,y=s.dims[1]}else{if(s.dims[1]!==n.numHeads||s.dims[3]!==k)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');b=0,y=s.dims[2]}}else{if(t.dims.length!==5)throw new Error('Input "query" is expected to have 5 dimensions when key is empty');if(t.dims[2]!==n.numHeads||t.dims[3]!==3)throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');b=3}if(l&&je.size(l.dims)>0){if(l.dims.length!==1)throw new Error('Input "bias" is expected to have 1 dimension');if(s&&s.dims.length===5&&s.dims[3]===2)throw new Error("bias is not allowed for packed kv.")}let S=v+y,$=0;if(c&&je.size(c.dims)>0){$=8;let A=c.dims;throw A.length===1?A[0]===m?$=1:A[0]===3*m+2&&($=3):A.length===2&&A[0]===m&&A[1]===S&&($=5),$===8?new Error('Input "key_padding_mask" shape shall be (batch_size) or (batch_size, total_sequence_length)'):new Error("Mask not supported")}let w=!1,C=p;if(i&&je.size(i.dims)>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(t.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(y!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');C=i.dims[2]}else{if(y!==i.dims[2])throw new Error('Input "key" and "value" shall have the same dim 2 (kv_sequence_length)');C=i.dims[1]*i.dims[3],w=!0}}let P=!1;if(c&&je.size(c.dims)>0)throw new Error("Key padding mask is not supported");if(u&&je.size(u.dims)>0){if(u.dims.length!==4)throw new Error('Input "attention_bias" is expected to have 4 dimensions');if(u.dims[0]!==m||u.dims[1]!==n.numHeads||u.dims[2]!==_||u.dims[3]!==S)throw new Error('Expect "attention_bias" shape (batch_size, num_heads, sequence_length, total_sequence_length)')}return{batchSize:m,sequenceLength:_,pastSequenceLength:v,kvSequenceLength:y,totalSequenceLength:S,maxSequenceLength:T,inputHiddenSize:0,hiddenSize:p,vHiddenSize:C,headSize:k,vHeadSize:Math.floor(C/n.numHeads),numHeads:n.numHeads,isUnidirectional:!1,pastPresentShareBuffer:!1,maskFilterValue:n.maskFilterValue,maskType:$,scale:n.scale,broadcastResPosBias:P,passPastInKv:w,qkvFormat:b}},HE=e=>$n({...e}),Iy=$n({perm:[0,2,1,3]}),RM=(e,n,t,s,i,l,c)=>{let u=[s,i,l],d=je.size(u),f=[{type:12,data:d},{type:12,data:c},{type:12,data:l}],m=_=>{let p=At("qkv_with_bias",n.dataType,u),y=Qe("qkv",n.dataType,u),v=Qe("bias",t.dataType,u),T=[{name:"output_size",type:"u32"},{name:"bias_offset",type:"u32"},{name:"hidden_size",type:"u32"}];return`
  ${_.registerUniforms(T).declareVariables(y,v,p)}
  ${_.mainStart()}
    ${_.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let bias_offset_idx = (global_idx % uniforms.hidden_size) + uniforms.bias_offset;

    qkv_with_bias[global_idx] = qkv[global_idx] + bias[bias_offset_idx];
  }`};return e.compute({name:"MultiHeadAttentionAddBias",shaderCache:{inputDependencies:["type","type"]},getRunData:()=>({outputs:[{dims:u,dataType:n.dataType,gpuDataType:0}],dispatchGroup:{x:Math.ceil(d/64)},programUniforms:f}),getShaderSource:m},{inputs:[n,t],outputs:[-1]})[0]},im=(e,n,t,s,i,l,c,u)=>{let d=l;if(c&&je.size(c.dims)>0){if(s===1)throw new Error("AddBiasReshape is not implemented. Please export your model with packed QKV or KV");return d=RM(e,l,c,n,s,t*i,u),d=d.reshape([n,s,t,i]),t===1||s===1?d:e.compute(yr(d,Iy.perm),{inputs:[d],outputs:[-1]})[0]}else return l.dims.length===3&&(d=l.reshape([n,s,t,i])),t===1||s===1?d:e.compute(yr(d,Iy.perm),{inputs:[d],outputs:[-1]})[0]},qE=(e,n)=>{let t=jM(e.inputs,n),s=e.inputs[0],i=Ns(e.inputs,1),l=Ns(e.inputs,2),c=Ns(e.inputs,3),u=Ns(e.inputs,4),d=Ns(e.inputs,5),f=Ns(e.inputs,6),m=Ns(e.inputs,7);if(s.dims.length===5)throw new Error("Packed QKV is not implemented");if(i?.dims.length===5)throw new Error("Packed KV is not implemented");let _=i&&l&&i.dims.length===4&&l.dims.length===4,p=im(e,t.batchSize,t.numHeads,t.sequenceLength,t.headSize,s,c,0);if(_)return mm(e,p,i,l,u,void 0,f,m,d,t);if(!i||!l)throw new Error("key and value must be provided");let y=im(e,t.batchSize,t.numHeads,t.kvSequenceLength,t.headSize,i,c,t.hiddenSize),v=im(e,t.batchSize,t.numHeads,t.kvSequenceLength,t.vHeadSize,l,c,2*t.hiddenSize);mm(e,p,y,v,u,void 0,f,m,d,t)}}),BM,UM,VM,GM,P0,QE,XE,YE=ct(()=>{Wt(),en(),Fa(),tn(),BM=e=>{if(!e||e.length<1)throw new Error("too few inputs")},UM=(e,n)=>{let t=[],s=n.numOutputs;return e[1].dims[0]>0&&(e[1].getBigInt64Array().forEach(i=>t.push(Number(i))),s=t.length),$n({numOutputs:s,axis:n.axis,splitSizes:t})},VM=e=>`
fn calculateOutputIndex(index: u32) -> u32 {
    for (var i: u32 = 0u; i < ${e}u; i += 1u ) {
    if (index < ${$t("uniforms.size_in_split_axis","i",e)}) {
        return i;
    }
    }
    return ${e}u;
}`,GM=e=>{let n=e.length,t=[];for(let s=0;s<n;++s){let i=e[s].setByIndices("indices","input[global_idx]");n===1?t.push(i):s===0?t.push(`if (output_number == ${s}u) { ${i} }`):s===n-1?t.push(`else { ${i} }`):t.push(`else if (output_number == ${s}) { ${i} }`)}return`
      fn writeBufferData(output_number: u32, indices: ${e[0].type.indices}, global_idx: u32) {
        ${t.join(`
`)}
      }`},P0=(e,n)=>{let t=e[0].dims,s=je.size(t),i=e[0].dataType,l=je.normalizeAxis(n.axis,t.length),c=new Array(n.numOutputs),u=Qe("input",i,t.length),d=new Array(n.numOutputs),f=[],m=[],_=0,p=[{type:12,data:s}];for(let v=0;v<n.numOutputs;v++){_+=n.splitSizes[v],d[v]=_;let T=t.slice();T[l]=n.splitSizes[v],m.push(T),c[v]=At(`output${v}`,i,T.length),f.push({dims:m[v],dataType:e[0].dataType})}p.push({type:12,data:d},...zt(t,...m));let y=v=>`
  ${v.registerUniform("input_size","u32").registerUniform("size_in_split_axis","u32",d.length).declareVariables(u,...c)}
  ${VM(d.length)}
  ${GM(c)}

  ${v.mainStart()}
    ${v.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.input_size")}

    var indices = ${u.offsetToIndices("global_idx")};
    var index = ${u.indicesGet("indices",l)};
    let output_number = calculateOutputIndex(index);
    if (output_number != 0) {
      index -= ${$t("uniforms.size_in_split_axis","output_number - 1u",d.length)};
      ${u.indicesSet("indices",l,"index")};
    }
    writeBufferData(output_number, indices, global_idx);
  }`;return{name:"Split",shaderCache:{hint:n.cacheKey,inputDependencies:["rank"]},getShaderSource:y,getRunData:()=>({outputs:f,dispatchGroup:{x:Math.ceil(s/64)},programUniforms:p})}},QE=(e,n)=>{BM(e.inputs);let t=e.inputs.length===1?n:UM(e.inputs,n);e.compute(P0(e.inputs,t),{inputs:[0]})},XE=e=>{let n=e.axis,t=e.splitSizes,s=e.numOutputs<0?t.length:e.numOutputs;if(s!==t.length)throw new Error("numOutputs and splitSizes lengh must be equal");return $n({axis:n,numOutputs:s,splitSizes:t})}}),WM,ig,ZE,JE=ct(()=>{Wt(),en(),Fa(),tn(),WM=(e,n)=>{let[t,s,i,l]=e,{numHeads:c,rotaryEmbeddingDim:u}=n;if(t.dims.length!==3&&t.dims.length!==4)throw new Error(`Input 'x' is expected to have 3 or 4 dimensions, got ${t.dims.length}`);if(!je.areEqual(s.dims,[])&&!je.areEqual(s.dims,[1])&&s.dims.length!==2)throw new Error(`Input 'position_ids' is expected to have 0, 1, or 2 dimensions, got ${s.dims.length}`);if(i.dims.length!==2)throw new Error(`Input 'cos_cache' is expected to have 2 dimensions, got ${i.dims.length}`);if(l.dims.length!==2)throw new Error(`Input 'sin_cache' is expected to have 2 dimensions, got ${l.dims.length}`);if(!je.areEqual(i.dims,l.dims))throw new Error("Inputs 'cos_cache' and 'sin_cache' are expected to have the same shape");if(u>0&&c===0)throw new Error("num_heads must be provided if rotary_embedding_dim is specified");let d=t.dims[0],f=t.dims[t.dims.length-2],m=i.dims[0],_=je.sizeFromDimension(t.dims,1)/f,p=u===0?i.dims[1]*2:_/c;if(u>p)throw new Error("rotary_embedding_dim must be less than or equal to head_size");if(s.dims.length===2){if(d!==s.dims[0])throw new Error(`Input 'position_ids' dimension 0 should be of size batch_size, got ${s.dims[0]}`);if(f!==s.dims[1])throw new Error(`Input 'position_ids' dimension 1 should be of size sequence_length, got ${s.dims[1]}`)}if(p/2!==i.dims[1]&&u/2!==i.dims[1])throw new Error(`Input 'cos_cache' dimension 1 should be same as head_size / 2 or rotary_embedding_dim / 2, got ${i.dims[1]}`);if(f>m)throw new Error("Updating cos_cache and sin_cache in RotaryEmbedding is not currently supported")},ig=(e,n)=>{let{interleaved:t,numHeads:s,rotaryEmbeddingDim:i,scale:l}=n,c=e[0].dims[0],u=je.sizeFromDimension(e[0].dims,1),d=e[0].dims[e[0].dims.length-2],f=u/d,m=e[2].dims[1],_=i===0?m*2:f/s,p=new Array(c,d,f/_,_-m),y=je.computeStrides(p),v=[{type:1,data:l},{type:12,data:p},{type:12,data:y},...e[0].dims.length===3?new Array({type:12,data:[u,f,_,1]}):[],...e[0].dims.length===4?new Array({type:12,data:[u,_,d*_,1]}):[],...zt(e[0].dims,e[1].dims,e[2].dims,e[3].dims,e[0].dims)],T=k=>{let b=Qe("input",e[0].dataType,e[0].dims.length),S=Qe("position_ids",e[1].dataType,e[1].dims.length),$=Qe("cos_cache",e[2].dataType,e[2].dims.length),w=Qe("sin_cache",e[3].dataType,e[3].dims.length),C=At("output",e[0].dataType,e[0].dims.length);return k.registerUniforms([{name:"scale",type:"f32"},{name:"global_shape",type:"u32",length:p.length},{name:"global_strides",type:"u32",length:y.length},{name:"input_output_strides",type:"u32",length:y.length}]),`
        ${k.declareVariables(b,S,$,w,C)}

        ${k.mainStart(wf)}
          let half_rotary_emb_dim = uniforms.${$.name}_shape[1];
          let bsnh = global_idx / uniforms.global_strides % uniforms.global_shape;
          let size = uniforms.global_shape[0] * uniforms.global_strides[0];
          ${k.guardAgainstOutOfBoundsWorkgroupSizes("size")}

          if (bsnh[3] < half_rotary_emb_dim) {
            let position_ids_idx =
                ${S.broadcastedIndicesToOffset("bsnh.xy",At("",S.type.tensor,2))};
            let position_id =
                u32(${S.getByOffset("position_ids_idx")}) + select(0, bsnh[1], position_ids_idx == 0);
            let i = dot(bsnh, uniforms.input_output_strides) + select(0, bsnh[3], ${t});
            let j = i + select(half_rotary_emb_dim, 1, ${t});
            let re = ${b.getByOffset("i")} * ${$.get("position_id","bsnh[3]")} -
                ${b.getByOffset("j")} * ${w.get("position_id","bsnh[3]")};
            ${C.setByOffset("i","re")}
            let im = ${b.getByOffset("i")} * ${w.get("position_id","bsnh[3]")} +
                ${b.getByOffset("j")} * ${$.get("position_id","bsnh[3]")};
            ${C.setByOffset("j","im")}
          } else {
            let k = dot(bsnh, uniforms.input_output_strides) + half_rotary_emb_dim;
            ${C.setByOffset("k",b.getByOffset("k"))}
          }
        }`};return{name:"RotaryEmbedding",shaderCache:{hint:$n({interleaved:t}).cacheKey,inputDependencies:["rank","rank","rank","rank"]},getShaderSource:T,getRunData:()=>({outputs:[{dims:e[0].dims,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(je.size(p)/wf)},programUniforms:v})}},ZE=(e,n)=>{WM(e.inputs,n),e.compute(ig(e.inputs,n))}}),HM,qM,zy,KM,eS,g3=ct(()=>{Fa(),Wt(),dv(),KE(),YE(),uc(),JE(),tn(),HM=(e,n)=>{if(n.doRotary&&e.length<=7)throw new Error("cos_cache and sin_cache inputs are required if do_rotary is specified");let t=e[0],s=e[1],i=e[2],l=e[3],c=e[4];if(n.doRotary!==0&&e.length<=7)throw new Error("cos_cast and sin_cache are expected if do_rotary attribute is non-zero");if(n.localWindowSize!==-1)throw new Error("Local attention is not supported");if(n.softcap!==0)throw new Error("Softcap is not supported");if(n.rotaryInterleaved!==0)throw new Error("Rotary interleaved is not supported");if(n.smoothSoftmax)throw new Error("Smooth softmax is not supported");if(t.dims.length!==3&&t.dims.length!==5)throw new Error("Input query is expected to have 3 or 5 dimensions");let u=!1,d=t.dims[0],f=t.dims[1],m=t.dims.length===3?u?t.dims[2]/3:t.dims[2]:n.numHeads*t.dims[4],_=f,p=0,y=!s||s.dims.length===0,v=Math.floor(y?m/(n.numHeads+2*n.kvNumHeads):m/n.numHeads);y&&(m=v*n.numHeads);let T=l&&l.dims.length!==0,k=c&&c.dims.length!==0;if(T&&l.dims.length===4&&l.dims[0]===d&&l.dims[1]!==n.kvNumHeads&&l.dims[2]===n.kvNumHeads&&l.dims[3]===v)throw new Error("BSNH pastKey/pastValue is not supported");if(T&&k){if(l.dims.length!==4)throw new Error('Input "past_key" is expected to have 4 dimensions');if(c.dims.length!==4)throw new Error('Input "past_value" is expected to have 4 dimensions');p=l.dims[2]}else if(T||k)throw new Error('Input "past_key" and "past_value" shall be both present or both absent');let b=1;if(s&&s.dims.length>0){if(t.dims.length!==3)throw new Error('Input "query" is expected to have 3 dimensions when key is given');if(s.dims.length<3||s.dims.length>5)throw new Error('Input "key" is expected to have 3, 4, or 5 dimensions');if(t.dims[0]!==s.dims[0])throw new Error('Input "query" and "key" shall have same dim 0 (batch size)');if(s.dims.length===3){if(t.dims[2]%s.dims[2]!==0)throw new Error('Dimension 2 of "query" should be a multiple of "key"');_=s.dims[1]}else if(s.dims.length===5){if(s.dims[2]!==n.numHeads||s.dims[3]!==2||s.dims[4]!==v)throw new Error('Expect "key" shape (batch_size, kv_sequence_length, num_heads, 2, head_size) for packed kv');if(i)throw new Error('Expect "value" be none when "key" has packed kv format.');_=s.dims[1]}else{if(s.dims[1]!==n.numHeads||s.dims[3]!==v)throw new Error('Expect "key" shape (batch_size, num_heads, kv_sequence_length, head_size) for past_key');_=s.dims[2]}}else{if(t.dims.length!==3&&t.dims.length!==5)throw new Error('Input "query" is expected to have 3 or 5 dimensions when key is empty');if(t.dims.length===5&&(t.dims[2]!==n.numHeads||t.dims[3]!==3))throw new Error('Expect "query" shape (batch_size, kv_sequence_length, num_heads, 3, head_size) for packed kv');b=3}let S=0,$=!1,w=n.kvNumHeads?v*n.kvNumHeads:m;if(i&&i.dims.length>0){if(i.dims.length!==3&&i.dims.length!==4)throw new Error('Input "value" is expected to have 3 or 4 dimensions');if(t.dims[0]!==i.dims[0])throw new Error('Input "query" and "value" shall have same dim 0 (batch_size)');if(i.dims.length===3){if(_!==i.dims[1])throw new Error('Input "key" and "value" shall have the same dim 1 (kv_sequence_length)');w=i.dims[2]}else{if(_!==i.dims[2])throw new Error('Input "past_key" and "past_value" shall have the same dim 2 (kv_sequence_length)');w=i.dims[1]*i.dims[3],$=!0}}let C=e.length>4?e[5]:void 0;if(C&&C.dims.length!==1&&C.dims[0]!==d)throw new Error('Input "seqlens" is expected to have 1 dimension and the same dim 0 as batch_size');return{batchSize:d,sequenceLength:f,pastSequenceLength:p,kvSequenceLength:_,totalSequenceLength:-1,maxSequenceLength:-1,inputHiddenSize:0,hiddenSize:m,vHiddenSize:w,headSize:v,vHeadSize:Math.floor(w/n.kvNumHeads),numHeads:n.numHeads,kvNumHeads:n.kvNumHeads,nReps:n.numHeads/n.kvNumHeads,pastPresentShareBuffer:!1,maskType:S,scale:n.scale,broadcastResPosBias:!1,passPastInKv:$,qkvFormat:b}},qM=$n({perm:[0,2,1,3]}),zy=(e,n,t)=>{let s=n,i=t.kvNumHeads;return n.dims.length===3&&t.kvSequenceLength!==0&&(s=n.reshape([t.batchSize,t.kvSequenceLength,i,t.headSize]),s=e.compute(yr(s,qM.perm),{inputs:[s],outputs:[-1]})[0]),s},KM=(e,n,t,s)=>{let i=7,l=["type","type"],c=[e*n],u=e*n,d=[{type:12,data:u},{type:12,data:n},{type:12,data:e}],f=m=>{let _=Qe("seq_lens",t.dataType,t.dims),p=Qe("total_seq_lens",s.dataType,s.dims),y=At("pos_ids",i,c),v=[{name:"output_size",type:"u32"},{name:"sequence_length",type:"u32"},{name:"batch_size",type:"u32"}];return`
  ${m.registerUniforms(v).declareVariables(_,p,y)}
  ${m.mainStart()}
    ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
    let total_sequence_length = u32(${p.getByOffset("0")});
    let is_subsequent_prompt = uniforms.sequence_length > 1 && uniforms.sequence_length != total_sequence_length;
    let is_first_prompt = !is_subsequent_prompt && uniforms.sequence_length == total_sequence_length;
    let batch_idx = global_idx / uniforms.sequence_length;
    let sequence_idx = i32(global_idx % uniforms.sequence_length);
    var pos_id: i32 = 0;
    let seqlen = ${_.getByOffset("batch_idx")};
    let total_seqlen = seqlen + 1;
    if (is_first_prompt) {
      if (sequence_idx < total_seqlen) {
        pos_id = sequence_idx;
      } else {
        pos_id = 1;
      }
      ${y.setByOffset("global_idx","pos_id")}
    } else if (is_subsequent_prompt) {
      let past_seqlen = total_seqlen - i32(uniforms.sequence_length);
      if (past_seqlen + sequence_idx < total_seqlen) {
        pos_id = past_seqlen + sequence_idx;
      } else {
        pos_id = 1;
      }
      ${y.setByOffset("global_idx","pos_id")}
    } else if (global_idx < uniforms.batch_size) {
      ${y.setByOffset("global_idx","seqlen")}
    };
  }
  `};return{name:"GeneratePositionIds",shaderCache:{hint:`${e};${n}`,inputDependencies:l},getRunData:()=>({outputs:[{dims:c,dataType:i}],dispatchGroup:{x:Math.ceil(u/64)},programUniforms:d}),getShaderSource:f}},eS=(e,n)=>{let t=HM(e.inputs,n);if(e.inputs[0].dims.length===5)throw new Error("Packed QKV is not implemented");if(e.inputs[1]?.dims.length===5)throw new Error("Packed KV is not implemented");let s=e.inputs[0],i=e.inputs[1]&&e.inputs[1].dims.length>0?e.inputs[1]:void 0,l=e.inputs[2]&&e.inputs[2].dims.length>0?e.inputs[2]:void 0,c=e.inputs[3]&&e.inputs[3].dims.length!==0?e.inputs[3]:void 0,u=e.inputs[4]&&e.inputs[4].dims.length!==0?e.inputs[4]:void 0,d=e.inputs.length>4?e.inputs[5]:void 0,f=e.inputs.length>5?e.inputs[6]:void 0,m=t.kvNumHeads?t.kvNumHeads:t.numHeads,_=$n({axis:2,numOutputs:3,splitSizes:[t.numHeads*t.headSize,m*t.headSize,m*t.headSize]}),[p,y,v]=!i&&!l?e.compute(P0([s],_),{inputs:[s],outputs:[-1,-1,-1]}):[s,i,l],T,k;if(n.doRotary){let w=e.compute(KM(t.batchSize,t.sequenceLength,d,f),{inputs:[d,f],outputs:[-1]})[0],C=e.inputs[7],P=e.inputs[8],A=$n({interleaved:n.rotaryInterleaved!==0,numHeads:t.numHeads,rotaryEmbeddingDim:0,scale:n.scale}),I=[p,w,C,P],W=[-1];T=e.compute(ig(I,A),{inputs:I,outputs:W})[0],I.splice(0,1,y);let G=$n({interleaved:n.rotaryInterleaved!==0,numHeads:t.kvNumHeads,rotaryEmbeddingDim:0,scale:n.scale});k=e.compute(ig(I,G),{inputs:I,outputs:W})[0]}let b=im(e,t.batchSize,t.numHeads,t.sequenceLength,t.headSize,n.doRotary?T:p,void 0,0),S=zy(e,n.doRotary?k:y,t),$=zy(e,v,t);mm(e,b,S,$,void 0,void 0,c,u,void 0,t,d,f)}}),Ly,QM,XM,tS,y3=ct(()=>{Wt(),en(),uc(),tn(),Ly=(e,n,t,s,i,l,c,u)=>{let d=Sa(l),f=d===1?"f32":`vec${d}f`,m=d===1?"vec2f":`mat2x${d}f`,_=i*c,p=64;_===1&&(p=256);let y=[i,c,l/d],v=[i,c,2],T=["rank","type","type"],k=[];k.push(...zt(y,v));let b=S=>{let $=Qe("x",n.dataType,3,d),w=Qe("scale",t.dataType,t.dims),C=Qe("bias",s.dataType,s.dims),P=At("output",1,3,2),A=[$,w,C,P];return`
  var<workgroup> workgroup_shared : array<${m}, ${p}>;
  const workgroup_size = ${p}u;
  ${S.declareVariables(...A)}
  ${S.mainStart(p)}
    let batch = workgroup_index / uniforms.x_shape[1];
    let channel = workgroup_index % uniforms.x_shape[1];
    let hight = uniforms.x_shape[2];
    // initialize workgroup memory
    var sum = ${f}(0);
    var squared_sum = ${f}(0);
    for (var h = local_idx; h < hight; h += workgroup_size) {
      let value = ${f}(${$.get("batch","channel","h")});
      sum += value;
      squared_sum += value * value;
    }
    workgroup_shared[local_idx] = ${m}(sum, squared_sum);
    workgroupBarrier();

    for (var currSize = workgroup_size >> 1;  currSize > 0; currSize = currSize >> 1) {
      if (local_idx < currSize) {
        workgroup_shared[local_idx] = workgroup_shared[local_idx] + workgroup_shared[local_idx + currSize];
      }
      workgroupBarrier();
    }
    if (local_idx == 0) {
      let sum_final = ${cc("workgroup_shared[0][0]",d)} / f32(hight * ${d});
      let squared_sum_final = ${cc("workgroup_shared[0][1]",d)} / f32(hight * ${d});

      let inv_std_dev = inverseSqrt(squared_sum_final - sum_final * sum_final + f32(${u}));
      let channel_scale = inv_std_dev * f32(scale[channel]);
      let channel_shift = f32(bias[channel]) - sum_final * channel_scale;
      output[workgroup_index] = vec2f(channel_scale, channel_shift);
    }
  }`};return e.compute({name:"InstanceNormComputeChannelScaleShift",shaderCache:{hint:`${d};${u};${p}`,inputDependencies:T},getRunData:()=>({outputs:[{dims:v,dataType:1}],dispatchGroup:{x:_},programUniforms:k}),getShaderSource:b},{inputs:[n,t,s],outputs:[-1]})[0]},QM=(e,n,t)=>{let s=n[0].dims,i=s,l=2,c=s[0],u=s[1],d=je.sizeFromDimension(s,l),f=Sa(d),m=je.size(i)/f,_=Ly(e,n[0],n[1],n[2],c,d,u,t.epsilon),p=[c,u,d/f],y=[c,u],v=["type","none"],T=k=>{let b=Qe("x",n[0].dataType,p.length,f),S=Qe("scale_shift",1,y.length,2),$=At("output",n[0].dataType,p.length,f),w=[b,S,$];return`
  ${k.registerUniform("output_size","u32").declareVariables(...w)}
  ${k.mainStart()}
  ${k.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let outputIndices = ${$.offsetToIndices("global_idx")};
      let batch = outputIndices[0];
      let channel = outputIndices[1];
      let scale_shift = ${S.getByIndices("vec2<u32>(batch, channel)")};
      let value = ${b.getByOffset("global_idx")} * ${$.type.value}(scale_shift.x) + ${$.type.value}(scale_shift.y);
      ${$.setByOffset("global_idx","value")};
  }`};e.compute({name:"InstanceNormalization",shaderCache:{hint:`${f}`,inputDependencies:v},getRunData:()=>({outputs:[{dims:i,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(m/64)},programUniforms:[{type:12,data:m},...zt(p,y,p)]}),getShaderSource:T},{inputs:[n[0],_]})},XM=(e,n,t)=>{let s=n[0].dims,i=s,l=s[0],c=s[s.length-1],u=je.sizeFromDimension(s,1)/c,d=Sa(c),f=je.size(i)/d,m=[{type:12,data:u},{type:12,data:Math.floor(c/d)}],_=["type","type"],p=!1,y=[0,s.length-1];for(let b=0;b<s.length-2;b++)p=p||s[b+1]!==1,y.push(b+1);p=p&&s[s.length-1]!==1;let v=p?e.compute(yr(e.inputs[0],y),{inputs:[e.inputs[0]],outputs:[-1]})[0]:e.inputs[0].reshape(Array.from({length:s.length},(b,S)=>s[y[S]])),T=Ly(e,v,n[1],n[2],l,u,c,t.epsilon),k=b=>{let S=as(n[0].dataType),$=d===1?"vec2f":`mat${d}x2f`,w=A=>{let I=A===0?"x":"y",W=d===1?"f32":`vec${d}f`;switch(d){case 1:return`${S}(${W}(scale.${I}))`;case 2:return`vec2<${S}>(${W}(scale[0].${I}, scale[1].${I}))`;case 4:return`vec4<${S}>(${W}(scale[0].${I}, scale[1].${I}, scale[2].${I}, scale[3].${I}))`;default:throw new Error(`Not supported compoents ${d}`)}},C=Qe("input",n[0].dataType,n[0].dims,d),P=At("output",n[0].dataType,i,d);return`
  @group(0) @binding(0) var<storage, read> input : array<${C.type.storage}>;
  @group(0) @binding(1) var<storage, read> scale_input : array<${$}>;
  @group(0) @binding(2) var<storage, read_write> output : array<${P.type.storage}>;
  struct Uniforms {H: u32, C : u32};
  @group(0) @binding(3) var<uniform> uniforms: Uniforms;

  ${b.mainStart()}
    let current_image_number = global_idx / (uniforms.C * uniforms.H);
    let current_channel_number = global_idx % uniforms.C;

    let scale_offset = current_image_number * uniforms.C + current_channel_number;
    let scale = scale_input[scale_offset];
    output[global_idx] = fma(input[global_idx], ${w(0)}, ${w(1)});
  }`};e.compute({name:"InstanceNormalizationNHWC",shaderCache:{hint:`${d}`,inputDependencies:_},getRunData:()=>({outputs:[{dims:i,dataType:n[0].dataType}],dispatchGroup:{x:Math.ceil(f/64)},programUniforms:m}),getShaderSource:k},{inputs:[n[0],T]})},tS=(e,n)=>{n.format==="NHWC"?XM(e,e.inputs,n):QM(e,e.inputs,n)}}),YM,ZM,nS,v3=ct(()=>{Wt(),en(),tn(),YM=e=>{if(!e||e.length<2)throw new Error("layerNorm requires at least 2 inputs.")},ZM=(e,n,t)=>{let s=n.simplified,i=e[0].dims,l=e[1],c=!s&&e[2],u=i,d=je.normalizeAxis(n.axis,i.length),f=je.sizeToDimension(i,d),m=je.sizeFromDimension(i,d),_=je.size(l.dims),p=c?je.size(c.dims):0;if(_!==m||c&&p!==m)throw new Error(`Size of X.shape()[axis:] == ${m}.
       Size of scale and bias (if provided) must match this.
       Got scale size of ${_} and bias size of ${p}`);let y=[];for(let C=0;C<i.length;++C)C<d?y.push(i[C]):y.push(1);let v=Sa(m),T=["type","type"],k=[{type:12,data:f},{type:1,data:m},{type:12,data:Math.floor(m/v)},{type:1,data:n.epsilon}];c&&T.push("type");let b=t>1,S=t>2,$=C=>{let P=as(e[0].dataType),A=[Qe("x",e[0].dataType,e[0].dims,v),Qe("scale",l.dataType,l.dims,v)];c&&A.push(Qe("bias",c.dataType,c.dims,v)),A.push(At("output",e[0].dataType,u,v)),b&&A.push(At("mean_data_output",1,y)),S&&A.push(At("inv_std_output",1,y));let I=[{name:"norm_count",type:"u32"},{name:"norm_size",type:"f32"},{name:"norm_size_vectorized",type:"u32"},{name:"epsilon",type:"f32"}];return`
  ${C.registerUniforms(I).declareVariables(...A)}
  ${C.mainStart()}
    ${C.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.norm_count")}
    let offset = global_idx * uniforms.norm_size_vectorized;
    var mean_vector = ${b0("f32",v)};
    var mean_square_vector = ${b0("f32",v)};

    for (var h: u32 = 0u; h < uniforms.norm_size_vectorized; h++) {
      let value = ${gf(P,v,"x[h + offset]")};
      mean_vector += value;
      mean_square_vector += value * value;
    }
    let mean = ${cc("mean_vector",v)} / uniforms.norm_size;
    let inv_std_dev = inverseSqrt(${cc("mean_square_vector",v)} / uniforms.norm_size ${s?"":"- mean * mean"} + uniforms.epsilon);

    for (var j: u32 = 0; j < uniforms.norm_size_vectorized; j++) {
      let f32input = ${gf(P,v,"x[j + offset]")};
      let f32scale = ${gf(P,v,"scale[j]")};
      output[j + offset] = ${A[0].type.value}((f32input ${s?"":"- mean"}) * inv_std_dev * f32scale
        ${c?`+ ${gf(P,v,"bias[j]")}`:""}
      );
    }

    ${b?"mean_data_output[global_idx] = mean":""};
    ${S?"inv_std_output[global_idx] = inv_std_dev":""};
  }`},w=[{dims:u,dataType:e[0].dataType}];return b&&w.push({dims:y,dataType:1}),S&&w.push({dims:y,dataType:1}),{name:"LayerNormalization",shaderCache:{hint:`${v};${t};${s}`,inputDependencies:T},getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(f/64)},programUniforms:k}),getShaderSource:$}},nS=(e,n)=>{YM(e.inputs),e.compute(ZM(e.inputs,n,e.outputCount))}}),JM,aS,b3=ct(()=>{en(),_v(),gv(),JM=e=>{if(!e||e.length!==2)throw new Error("MatMul requires 2 inputs.");if(e[0].dims[e[0].dims.length-1]!==e[1].dims[e[1].dims.length-2])throw new Error("shared dimension does not match.")},aS=e=>{JM(e.inputs);let n=bf.calcShape(e.inputs[0].dims,e.inputs[1].dims,!0);if(!n)throw new Error("Can't use matmul on the given tensors");let t=n[n.length-1],s=e.inputs[0].dims[e.inputs[0].dims.length-1];if(t<8&&s<8)e.compute(mv(e.inputs,{activation:""},n));else{let i=n[n.length-2],l=je.size(e.inputs[0].dims.slice(0,-2)),c=je.size(e.inputs[1].dims.slice(0,-2));if(l!==1&&i===1&&c===1){let u=e.inputs[0].reshape([1,l,s]),d=e.inputs[1].reshape([1,s,t]),f=[1,l,t],m=[u,d];e.compute(rg(m,{activation:""},n,f),{inputs:m})}else e.compute(rg(e.inputs,{activation:""},n))}}}),e1,t1,n1,sS,rS,w3=ct(()=>{Wt(),en(),Fa(),tn(),e1=(e,n)=>{if(e.length<3||e.length>4)throw new Error("MatMulNBits requires 3 or 4 inputs");let t=e[0],s=t.dims.length;if(t.dims[s-1]!==n.k)throw new Error("The last dim of input shape does not match the k value");let i=Math.floor((n.k+n.blockSize-1)/n.blockSize),l=n.blockSize/8*n.bits,c=e[1];if(!je.areEqual(c.dims,[n.n,i,l]))throw new Error("The second inputs must be 3D tensor with shape N X nBlocksPerCol X blobSize");let u=e[2].dims;if(je.size(u)!==n.n*i)throw new Error("scales input size error.");if(e.length===4){let d=e[3].dims,f=n.bits>4?n.n*i:n.n*Math.floor((i+1)/2);if(je.size(d)!==f)throw new Error("zeroPoints input size error.")}},t1=(e,n)=>{let t=e[0].dims,s=t.length,i=t[s-2],l=n.k,c=n.n,u=t.slice(0,s-2),d=je.size(u),f=e[1].dims[2]/4,m=e[0].dataType,_=Sa(n.k),p=Sa(f),y=Sa(c),v=u.concat([i,c]),T=i>1&&c/y%2===0?2:1,k=je.size(v)/y/T,b=64,S=[],$=[d,i,l/_],w=je.convertShape(e[1].dims).slice();w.splice(-1,1,f/p),S.push(...zt($)),S.push(...zt(w)),S.push(...zt(e[2].dims)),e.length===4&&S.push(...zt(je.convertShape(e[3].dims)));let C=[d,i,c/y];S.push(...zt(C));let P=A=>{let I=$.length,W=Qe("a",e[0].dataType,I,_),G=Qe("b",12,w.length,p),q=Qe("scales",e[2].dataType,e[2].dims.length),Z=[W,G,q],X=e.length===4?Qe("zero_points",12,e[3].dims.length):void 0;X&&Z.push(X);let Q=C.length,te=At("output",e[0].dataType,Q,y),R=as(e[0].dataType),ee=(()=>{switch(_){case 1:return`array<${R}, 8>`;case 2:return`mat4x2<${R}>`;case 4:return`mat2x4<${R}>`;default:throw new Error(`${_}-component is not supported.`)}})(),ie=()=>{let U=`
          // reuse a data
            var input_offset = ${W.indicesToOffset(`${W.type.indices}(batch, row, word_offset)`)};
            var a_data: ${ee};
            for (var j: u32 = 0; j < ${8/_}; j++) {
              a_data[j] = ${W.getByOffset("input_offset")};
              input_offset++;
            }
          `;for(let K=0;K<y*T;K++)U+=`
            b_value = ${p===1?`b${K}_data`:`b${K}_data[i]`};
            b_value_lower = unpack4xU8(b_value & b_mask);
            b_value_upper = unpack4xU8((b_value >> 4) & b_mask);
            b_quantized_values = ${ee}(${Array.from({length:4},(H,B)=>`${R}(b_value_lower[${B}]), ${R}(b_value_upper[${B}])`).join(", ")});
            b_dequantized_values = ${_===1?`${ee}(${Array.from({length:8},(H,B)=>`(b_quantized_values[${B}] - ${X?`zero_point${K}`:"zero_point"}) * scale${K}`).join(", ")});`:`(b_quantized_values - ${ee}(${Array(8).fill(`${X?`zero_point${K}`:"zero_point"}`).join(",")})) * scale${K};`};
            workgroup_shared[local_id.x * ${T} + ${Math.floor(K/y)}]${y>1?`[${K%y}]`:""} += ${Array.from({length:8/_},(H,B)=>`${_===1?`a_data[${B}] * b_dequantized_values[${B}]`:`dot(a_data[${B}], b_dequantized_values[${B}])`}`).join(" + ")};
          `;return U},he=()=>{let U=`
            var col_index = col * ${y};
            ${X?`
            let zero_point_bytes_per_col = (nBlocksPerCol + 1) / 2;
            var zero_point_byte_count: u32;
            var zero_point_word_index: u32;
            var zero_point_byte_offset: u32;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            var zero_point_bits_offset: u32;
            var zero_point_word: u32;`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${R}(8);`}
            `;for(let K=0;K<y*T;K++)U+=`
            let scale${K} = ${q.getByOffset("col_index * nBlocksPerCol + block")};
            ${X?`
            zero_point_byte_count = col_index * zero_point_bytes_per_col + (block >> 0x1u);
            zero_point_word_index = zero_point_byte_count >> 0x2u;
            zero_point_byte_offset = zero_point_byte_count & 0x3u;
            zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            zero_point_word = ${X.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point${K} = ${R}((zero_point_word) & 0xFu);`:""}
            col_index += 1;`;return U},_e=()=>{let U=`col_index = col * ${y};`;for(let K=0;K<y*T;K++)U+=`
            let b${K}_data = ${G.getByIndices(`${G.type.indices}(col_index, block, word)`)};
            col_index += 1;`;return U+=`
            var b_value: u32;
            let b_mask: u32 = 0x0F0F0F0Fu;
            var b_value_lower: vec4<u32>;
            var b_value_upper: vec4<u32>;
            var b_quantized_values: ${ee};
            var b_dequantized_values: ${ee};`,U};return`
        var<workgroup> workgroup_shared: array<${te.type.value}, ${T*b}>;
        ${A.declareVariables(...Z,te)}
        ${A.mainStart([b,1,1])}
          let output_indices = ${te.offsetToIndices(`(global_idx / ${b}) * ${T}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let nBlocksPerCol = uniforms.b_shape[1];

          for (var block = local_id.x; block < nBlocksPerCol; block += ${b}) {
            //process one block
            var word_offset: u32 = block * ${n.blockSize/_};
            ${he()}
            for (var word: u32 = 0; word < ${f}; word += ${p}) {
              ${_e()}
              for (var i: u32 = 0; i < ${p}; i++) {
                ${ie()}
                word_offset += ${8/_};
              }
            }
          }
          workgroupBarrier();

          if (local_id.x < ${T}) {
            var output_value: ${te.type.value} = ${te.type.value}(0);
            var workgroup_shared_offset: u32 = local_id.x;
            for (var b: u32 = 0u; b < ${b}u; b++) {
              output_value += workgroup_shared[workgroup_shared_offset];
              workgroup_shared_offset += ${T};
            }
            ${te.setByIndices(`${te.type.indices}(batch, row, col + local_id.x)`,"output_value")};
          }
        }`};return{name:"MatMulNBits",shaderCache:{hint:`${n.blockSize};${n.bits};${_};${p};${y};${T};${b}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:v,dataType:m}],dispatchGroup:{x:k},programUniforms:S}),getShaderSource:P}},n1=(e,n)=>{let t=e[0].dims,s=t.length,i=t[s-2],l=n.k,c=n.n,u=t.slice(0,s-2),d=je.size(u),f=e[1].dims[2]/4,m=e[0].dataType,_=Sa(n.k),p=Sa(f),y=u.concat([i,c]),v=128,T=c%8===0?8:c%4===0?4:1,k=v/T,b=k*p*8,S=b/_,$=b/n.blockSize,w=je.size(y)/T,C=[],P=[d,i,l/_],A=je.convertShape(e[1].dims).slice();A.splice(-1,1,f/p),C.push(...zt(P)),C.push(...zt(A)),C.push(...zt(e[2].dims)),e.length===4&&C.push(...zt(je.convertShape(e[3].dims)));let I=[d,i,c];C.push(...zt(I));let W=G=>{let q=P.length,Z=Qe("a",e[0].dataType,q,_),X=Qe("b",12,A.length,p),Q=Qe("scales",e[2].dataType,e[2].dims.length),te=[Z,X,Q],R=e.length===4?Qe("zero_points",12,e[3].dims.length):void 0;R&&te.push(R);let ee=I.length,ie=At("output",e[0].dataType,ee),he=as(e[0].dataType),_e=()=>{switch(_){case 1:return`
          let a_data0 = vec4<${he}>(sub_a[word_offset], sub_a[word_offset + 1], sub_a[word_offset + 2], sub_a[word_offset + 3]);
          let a_data1 = vec4<${he}>(sub_a[word_offset + 4], sub_a[word_offset + 5], sub_a[word_offset + 6], sub_a[word_offset + 7]);`;case 2:return`
          let a_data0 = vec4<${he}>(sub_a[word_offset], sub_a[word_offset + 1]);
          let a_data1 = vec4<${he}>(sub_a[word_offset + 2], sub_a[word_offset + 3]);`;case 4:return`
          let a_data0 = sub_a[word_offset];
          let a_data1 = sub_a[word_offset + 1];`;default:throw new Error(`${_}-component is not supported.`)}};return`
        var<workgroup> sub_a: array<${Z.type.value}, ${S}>;
        var<workgroup> inter_results: array<array<${ie.type.value}, ${k}>, ${T}>;
        ${G.declareVariables(...te,ie)}
        ${G.mainStart([k,T,1])}
          let output_indices = ${ie.offsetToIndices(`workgroup_index * ${T}`)};
          let col = output_indices[2];
          let row = output_indices[1];
          let batch = output_indices[0];
          let n_blocks_per_col = uniforms.b_shape[1];
          let num_tiles =  (n_blocks_per_col - 1) / ${$} + 1;

          // Loop over shared dimension.
          for (var tile: u32 = 0; tile < num_tiles; tile += 1) {
            let a_col_start = tile * ${S};
            // load one tile A data into shared memory.
            for (var a_offset = local_idx; a_offset < ${S}; a_offset += ${v})
            {
              let a_col = a_col_start + a_offset;
              if (a_col < uniforms.a_shape[2])
              {
                sub_a[a_offset] = ${Z.getByIndices(`${Z.type.indices}(batch, row, a_col)`)};
              } else {
                sub_a[a_offset] = ${Z.type.value}(0);
              }
            }
            workgroupBarrier();

            // each thread process one block
            let b_row = col + local_id.y;
            let block = tile * ${$} + local_id.x;
            ${R?`
            let zero_point_bytes_per_col = (n_blocks_per_col + 1) / 2;
            let zero_point_byte_count = b_row * zero_point_bytes_per_col + (block >> 0x1u);
            let zero_point_word_index = zero_point_byte_count >> 0x2u;
            let zero_point_byte_offset = zero_point_byte_count & 0x3u;
            let zero_point_nibble_offset: u32 = block & 0x1u;
            let zero_point_bits_offset = (zero_point_byte_offset << 3) + (zero_point_nibble_offset << 2);
            let zero_point_word = ${R.getByOffset("zero_point_word_index")} >> zero_point_bits_offset;
            let zero_point = ${he}((zero_point_word) & 0xFu);`:`
            // The default zero point is 8 for unsigned 4-bit quantization.
            let zero_point = ${he}(8);`}
            let scale = ${Q.getByOffset("b_row * n_blocks_per_col + block")};
            let b_data = ${X.getByIndices(`${X.type.indices}(b_row, block, 0)`)};
            var word_offset = local_id.x * ${n.blockSize/_};
            for (var i: u32 = 0; i < ${p}; i++) {
              ${_e()}
              let b_value = ${p===1?"b_data":"b_data[i]"};
              let b_value_lower = unpack4xU8(b_value & 0x0F0F0F0Fu);
              let b_value_upper = unpack4xU8((b_value >> 4) & 0x0F0F0F0Fu);
              let b_quantized_values = mat2x4<${he}>(${Array.from({length:4},(U,K)=>`${he}(b_value_lower[${K}]), ${he}(b_value_upper[${K}])`).join(", ")});
              let b_dequantized_values = (b_quantized_values - mat2x4<${he}>(${Array(8).fill("zero_point").join(",")})) * scale;
              inter_results[local_id.y][local_id.x] += ${Array.from({length:2},(U,K)=>`${`dot(a_data${K}, b_dequantized_values[${K}])`}`).join(" + ")};
              word_offset += ${8/_};
            }
            workgroupBarrier();
          }

          if (local_idx < ${T}) {
            var output_value: ${ie.type.value} = ${ie.type.value}(0);
            for (var b = 0u; b < ${k}; b++) {
              output_value += inter_results[local_idx][b];
            }
            if (col + local_idx < uniforms.output_shape[2])
            {
              ${ie.setByIndices(`${ie.type.indices}(batch, row, col + local_idx)`,"output_value")}
            }
          }
        }`};return{name:"BlockwiseMatMulNBits32",shaderCache:{hint:`${n.blockSize};${_};${p};${k};${T}`,inputDependencies:Array(e.length).fill("rank")},getRunData:()=>({outputs:[{dims:y,dataType:m}],dispatchGroup:{x:w},programUniforms:C}),getShaderSource:W}},sS=(e,n)=>{e1(e.inputs,n),n.blockSize===32&&e.adapterInfo.isVendor("intel")&&e.adapterInfo.isArchitecture("gen-12lp")?e.compute(n1(e.inputs,n)):e.compute(t1(e.inputs,n))},rS=e=>$n(e)}),a1,s1,r1,i1,o1,l1,c1,u1,iS,M3=ct(()=>{Wt(),en(),tn(),a1=e=>{if(!e||e.length<1)throw new Error("Too few inputs");if(e[0].dataType!==1&&e[0].dataType!==10)throw new Error("Input type must be float or float16.");if(e.length>=2){let n=e[0].dims.length*2===e[1].dims[0];if(e.length===4&&(n=e[3].dims[0]*2===e[1].dims[0]),!n)throw new Error("The pads should be a 1D tensor of shape [2 * input_rank] or [2 * num_axes].")}},s1=(e,n,t)=>{let s="";for(let i=n-1;i>=0;--i)s+=`
            k = i32(${e.indicesGet("indices",i)}) - ${$t("uniforms.pads",i,t)};
            if (k < 0) {
              break;
            }
            if (k >= i32(${$t("uniforms.x_shape",i,n)})) {
              break;
            }
            offset += k * i32(${$t("uniforms.x_strides",i,n)});
        `;return`
          value = ${e.type.value}(uniforms.constant_value);
          for (var i = 0; i < 1; i++) {
            var offset = 0;
            var k = 0;
            ${s}
            value = x[offset];
          }
      `},r1=(e,n,t)=>{let s="";for(let i=n-1;i>=0;--i)s+=`
                k = i32(${e.indicesGet("indices",i)}) - ${$t("uniforms.pads",i,t)};
                if (k < 0) {
                  k = -k;
                }
                {
                  let _2n_1 = 2 * (i32(${$t("uniforms.x_shape",i,n)}) - 1);
                  k = k % _2n_1;
                  if(k >= i32(${$t("uniforms.x_shape",i,n)})) {
                    k = _2n_1 - k;
                  }
                }
                offset += k * i32(${$t("uniforms.x_strides",i,n)});
            `;return`
              var offset = 0;
              var k = 0;
              ${s}
              value = x[offset];
          `},i1=(e,n,t)=>{let s="";for(let i=n-1;i>=0;--i)s+=`
                k = i32(${e.indicesGet("indices",i)}) - ${$t("uniforms.pads",i,t)};
                if (k < 0) {
                  k = 0;
                }
                if (k >= i32(${$t("uniforms.x_shape",i,n)})) {
                  k = i32(${$t("uniforms.x_shape",i,n)}) - 1;
                }
                offset += k * i32(${$t("uniforms.x_strides",i,n)});
            `;return`
              var offset = 0;
              var k = 0;
              ${s}
              value = x[offset];
          `},o1=(e,n,t)=>{let s="";for(let i=n-1;i>=0;--i)s+=`
                k = i32(${e.indicesGet("indices",i)}) - ${$t("uniforms.pads",i,t)};
                if (k < 0)  {
                  k += i32(${$t("uniforms.x_shape",i,n)}]);
                }
                if (k >= i32(${$t("uniforms.x_shape",i,n)})) {
                  k -= i32(${$t("uniforms.x_shape",i,n)});
                }
                offset += k * i32(${$t("uniforms.x_strides",i,n)});
            `;return`
              var offset = 0;
              var k = 0;
              ${s}
              value = x[offset];
          `},l1=(e,n,t)=>{switch(t.mode){case 0:return s1(e,n,t.pads.length);case 1:return r1(e,n,t.pads.length);case 2:return i1(e,n,t.pads.length);case 3:return o1(e,n,t.pads.length);default:throw new Error("Invalid mode")}},c1=(e,n)=>{let t=je.padShape(e[0].dims.slice(),n.pads),s=e[0].dims,i=je.size(t),l=[{type:12,data:i},{type:6,data:n.pads}],c=e.length>=3&&e[2].data;n.mode===0&&l.push({type:c?e[2].dataType:1,data:n.value}),l.push(...zt(e[0].dims,t));let u=["rank"],d=f=>{let m=At("output",e[0].dataType,t.length),_=Qe("x",e[0].dataType,s.length),p=_.type.value,y=l1(m,s.length,n),v=[{name:"output_size",type:"u32"},{name:"pads",type:"i32",length:n.pads.length}];return n.mode===0&&v.push({name:"constant_value",type:c?p:"f32"}),`
            ${f.registerUniforms(v).declareVariables(_,m)}
            ${f.mainStart()}
            ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}

            let indices = ${m.offsetToIndices("global_idx")};

            var value = ${p}(0);
            ${y}
            output[global_idx] = value;
        }`};return{name:"Pad",shaderCache:{hint:`${n.mode}${c}`,inputDependencies:u},getRunData:()=>({outputs:[{dims:t,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(je.size(t)/64)},programUniforms:l}),getShaderSource:d}},u1=(e,n)=>{if(e.length>1){let t=e[1].getBigInt64Array(),s=e.length>=3&&e[2].data?e[2].dataType===10?e[2].getUint16Array()[0]:e[2].getFloat32Array()[0]:0,i=e[0].dims.length,l=new Int32Array(2*i).fill(0);if(e.length>=4){let u=e[3].getBigInt64Array();for(let d=0;d<u.length;d++)l[Number(u[d])]=Number(t[d]),l[Number(u[d])+i]=Number(t[d+u.length])}else t.forEach((u,d)=>l[Number(d)]=Number(u));let c=[];return l.forEach(u=>c.push(u)),{mode:n.mode,value:s,pads:c}}else return n},iS=(e,n)=>{a1(e.inputs);let t=u1(e.inputs,n);e.compute(c1(e.inputs,t),{inputs:[0]})}}),Qp,Fy,Ny,jy,Ry,d1,f1,By,Uy,oS,lS,Vy,cS,uS,Gy,dS,fS,hS,pS,x3=ct(()=>{vi(),Wt(),en(),tn(),Qp=e=>{if(da.webgpu.validateInputContent&&(!e||e.length!==1))throw new Error("Pool ops requires 1 input.")},Fy=(e,n,t)=>{let s=n.format==="NHWC",i=e.dims.slice();s&&i.splice(1,0,i.pop());let l=Object.hasOwnProperty.call(n,"dilations"),c=n.kernelShape.slice(),u=n.strides.slice(),d=l?n.dilations.slice():[],f=n.pads.slice();ag.adjustPoolAttributes(t,i,c,u,d,f);let m=ag.computePoolOutputShape(t,i,u,d,c,f,n.autoPad),_=Object.assign({},n);l?Object.assign(_,{kernelShape:c,strides:u,pads:f,dilations:d,cacheKey:n.cacheKey}):Object.assign(_,{kernelShape:c,strides:u,pads:f,cacheKey:n.cacheKey});let p=m.slice();return p.push(p.splice(1,1)[0]),[_,s?p:m]},Ny=(e,n)=>{let t=n.format==="NHWC",s=je.size(e),i=je.size(n.kernelShape),l=[{type:12,data:s},{type:12,data:i}],c=[{name:"outputSize",type:"u32"},{name:"kernelSize",type:"u32"}];if(n.kernelShape.length<=2){let u=n.kernelShape[n.kernelShape.length-1],d=n.strides[n.strides.length-1],f=n.pads[n.pads.length/2-1],m=n.pads[n.pads.length-1],_=!!(f+m);l.push({type:12,data:u},{type:12,data:d},{type:12,data:f},{type:12,data:m}),c.push({name:"kw",type:"u32"},{name:"sw",type:"u32"},{name:"pwStart",type:"u32"},{name:"pwEnd",type:"u32"});let p=!1;if(n.kernelShape.length===2){let y=n.kernelShape[n.kernelShape.length-2],v=n.strides[n.strides.length-2],T=n.pads[n.pads.length/2-2],k=n.pads[n.pads.length-2];p=!!(T+k),l.push({type:12,data:y},{type:12,data:v},{type:12,data:T},{type:12,data:k}),c.push({name:"kh",type:"u32"},{name:"sh",type:"u32"},{name:"phStart",type:"u32"},{name:"phEnd",type:"u32"})}return[l,c,!0,_,p]}else{if(t)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let u=je.computeStrides(n.kernelShape);l.push({type:12,data:u},{type:12,data:n.pads},{type:12,data:n.strides}),c.push({name:"kernelStrides",type:"u32",length:u.length},{name:"pads",type:"u32",length:n.pads.length},{name:"strides",type:"u32",length:n.strides.length});let d=n.pads.reduce((f,m)=>f+m);return[l,c,!!d,!1,!1]}},jy=(e,n,t,s,i,l,c,u,d,f,m,_)=>{let p=i.format==="NHWC",y=n.type.value,v=At("output",n.type.tensor,s);if(i.kernelShape.length<=2){let T="",k="",b="",S=t-(p?2:1);if(m?T=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${S}] = indices[${S}] * uniforms.sw - uniforms.pwStart + i;
                  if (xIndices[${S}] < 0 || xIndices[${S}]
                      >= uniforms.x_shape[${S}]) {
                    pad++;
                    continue;
                  }
                  let x_val = x[${n.indicesToOffset("xIndices")}];
                  ${l}
                }`:T=`
                for (var i: u32 = 0u; i < uniforms.kw; i++) {
                  xIndices[${S}] = indices[${S}] * uniforms.sw - uniforms.pwStart + i;
                  let x_val = x[${n.indicesToOffset("xIndices")}];
                  ${l}
                }`,i.kernelShape.length===2){let $=t-(p?3:2);_?k=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${$}] = indices[${$}] * uniforms.sh - uniforms.phStart + j;
                  if (xIndices[${$}] < 0 || xIndices[${$}] >= uniforms.x_shape[${$}]) {
                    pad += i32(uniforms.kw);
                    continue;
                  }
              `:k=`
                for (var j: u32 = 0u; j < uniforms.kh; j++) {
                  xIndices[${$}] = indices[${$}] * uniforms.sh - uniforms.phStart + j;
                `,b=`
              }
            `}return`
            ${e.registerUniforms(d).declareVariables(n,v)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}

              let indices = ${v.offsetToIndices("global_idx")};
              var xIndices = ${v.offsetToIndices("global_idx")};

              var value = ${y}(${u});
              var pad = 0;
              ${k}
              ${T}
              ${b}
              ${c}

              output[global_idx] = value;
            }`}else{if(p)throw new Error("Pooling with kernelShape.length > 2 is not supported for NHWC format.");let T=i.kernelShape.length,k=i.pads.length,b="";return f?b=`
                if (xIndices[j] >= uniforms.x_shape[j]) {
                  pad++;
                  isPad = true;
                  break;
                }
              }
              if (!isPad) {
                let x_val = x[${n.indicesToOffset("xIndices")}];
                ${l}
              }`:b=`
              }
              let x_val = x[${n.indicesToOffset("xIndices")}];
              ${l}
            `,`
            ${e.registerUniforms(d).declareVariables(n,v)}

            ${e.mainStart()}
              ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
              let indices = ${v.offsetToIndices("global_idx")};
              var xIndices = ${v.offsetToIndices("global_idx")};

              var offsets: array<u32, ${T}>;

              var value = ${y}(${u});
              var pad = 0;
              var isPad = false;

              for (var i: u32 = 0u; i < uniforms.kernelSize; i++) {
                var offset = i;
                for (var j = 0u; j < ${T-1}u; j++) {
                  offsets[j] = offset / ${$t("uniforms.kernelStrides","j",T)};
                  offset -= offsets[j] * ${$t("uniforms.kernelStrides","j",T)};
                }
                offsets[${T-1}] = offset;

                isPad = false;
                for (var j = ${t-T}u; j < ${t}u; j++) {
                  xIndices[j] = indices[j] * ${$t("uniforms.strides",`j - ${t-T}u`,T)}
                    + offsets[j - ${t-T}u] - ${$t("uniforms.pads","j - 2u",k)};
                  ${b}
              }
              ${c}

              output[global_idx] = value;
            }`}},Ry=e=>`${e.format};${e.ceilMode};${e.autoPad};${e.kernelShape.length}`,d1=e=>`${Ry(e)};${e.countIncludePad}`,f1=e=>`${Ry(e)};${e.storageOrder};${e.dilations}`,By=e=>({format:e.format,autoPad:["NOTSET","VALID","SAME_UPPER","SAME_LOWER"][e.auto_pad],ceilMode:e.ceil_mode,kernelShape:e.kernel_shape,strides:e.strides,pads:e.pads}),Uy=(e,n,t,s)=>{let[i,l]=Fy(n,s,t),c=Qe("x",n.dataType,n.dims.length),u=c.type.value,d="value += x_val;",f="";i.countIncludePad?f+=`value /= ${u}(uniforms.kernelSize);`:f+=`value /= ${u}(i32(uniforms.kernelSize) - pad);`;let[m,_,p,y,v]=Ny(l,i);m.push(...zt(n.dims,l));let T=["rank"];return{name:e,shaderCache:{hint:`${s.cacheKey};${p};${y};${v}`,inputDependencies:T},getRunData:()=>({outputs:[{dims:l,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(je.size(l)/64)},programUniforms:m}),getShaderSource:k=>jy(k,c,n.dims.length,l.length,i,d,f,0,_,p,y,v)}},oS=e=>{let n=e.count_include_pad!==0,t=By(e);if(t.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for AveragePool");let s={countIncludePad:n,...t,cacheKey:""};return{...s,cacheKey:d1(s)}},lS=(e,n)=>{Qp(e.inputs),e.compute(Uy("AveragePool",e.inputs[0],!1,n))},Vy={autoPad:"",ceilMode:0,countIncludePad:!1,kernelShape:[],strides:[],pads:[],storageOrder:0,dilations:[]},cS=e=>{let n=e.format;return{format:n,...Vy,cacheKey:n}},uS=(e,n)=>{Qp(e.inputs),e.compute(Uy("GlobalAveragePool",e.inputs[0],!0,n))},Gy=(e,n,t,s)=>{let[i,l]=Fy(n,s,t),c=`
      value = max(x_val, value);
    `,u="",d=Qe("x",n.dataType,n.dims.length),f=["rank"],[m,_,p,y,v]=Ny(l,i);return m.push(...zt(n.dims,l)),{name:e,shaderCache:{hint:`${s.cacheKey};${p};${y};${v}`,inputDependencies:f},getRunData:()=>({outputs:[{dims:l,dataType:n.dataType}],dispatchGroup:{x:Math.ceil(je.size(l)/64)},programUniforms:m}),getShaderSource:T=>jy(T,d,n.dims.length,l.length,i,c,u,n.dataType===10?-65504:-1e5,_,p,y,v)}},dS=(e,n)=>{Qp(e.inputs),e.compute(Gy("MaxPool",e.inputs[0],!1,n))},fS=e=>{let n=e.storage_order,t=e.dilations,s=By(e);if(n!==0)throw new Error("column major storage order is not yet supported for MaxPool");if(s.ceilMode!==0)throw new Error("using ceil() in shape computation is not yet supported for MaxPool");let i={storageOrder:n,dilations:t,...s,cacheKey:""};return{...i,cacheKey:f1(i)}},hS=e=>{let n=e.format;return{format:n,...Vy,cacheKey:n}},pS=(e,n)=>{Qp(e.inputs),e.compute(Gy("GlobalMaxPool",e.inputs[0],!0,n))}}),h1,p1,mS,_S,T3=ct(()=>{Wt(),en(),Fa(),tn(),h1=(e,n)=>{if(e.length<2||e.length>3)throw new Error("DequantizeLinear requires 2 or 3 inputs.");if(e.length===3&&e[1].dims===e[2].dims)throw new Error("x-scale and x-zero-point must have the same shape.");if(e.length===3&&e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[0].dataType===6&&e.length>2)throw new Error("In the case of dequantizing int32 there is no zero point.");if(e[1].dims.length!==0&&e[1].dims.length!==1&&e[1].dims.length!==e[0].dims.length)throw new Error("scale input must be a scalar, a 1D tensor, or have the same rank as the input tensor.");if(e.length>2){if(e[0].dataType!==e[2].dataType)throw new Error("x and x-zero-point must have the same data type.");if(e[1].dims.length!==e[2].dims.length)throw new Error("scale and zero-point inputs must have the same rank.");if(!e[1].dims.map((t,s)=>t===e[2].dims[s]).reduce((t,s)=>t&&s,!0))throw new Error("scale and zero-point inputs must have the same shape.")}if(n.blockSize>0){if(e[1].dims.length===0||e[1].dims.length===1&&e[1].dims[0]===1)throw new Error("blockSize must be set only for block quantization.");if(!e[1].dims.map((i,l)=>l===n.axis||i===e[0].dims[l]).reduce((i,l)=>i&&l,!0))throw new Error("For block qunatization, scale input shape to match the input shape except for the axis");if(e[1].dims.length!==e[0].dims.length)throw new Error("For block qunatization the scale input rank must be the same as the x rank.");let t=e[0].dims[n.axis],s=e[1].dims[n.axis];if(n.blockSize<Math.ceil(t/s)||n.blockSize>Math.ceil(t/(s-1)-1))throw new Error("blockSize must be with in the range [ceil(dI / Si), ceil(dI / (Si - 1) - 1)].")}},p1=(e,n)=>{let t=je.normalizeAxis(n.axis,e[0].dims.length),s=e[0].dataType,i=s===3,l=e[0].dims,c=e[1].dataType,u=je.size(l),d=s===3||s===2,f=d?[Math.ceil(je.size(e[0].dims)/4)]:e[0].dims,m=e[1].dims,_=e.length>2?e[2]:void 0,p=_?d?[Math.ceil(je.size(_.dims)/4)]:_.dims:void 0,y=m.length===0||m.length===1&&m[0]===1,v=y===!1&&m.length===1,T=Sa(u),k=y&&(!d||T===4),b=k?T:1,S=k&&!d?T:1,$=Qe("input",d?12:s,f.length,S),w=Qe("scale",c,m.length),C=_?Qe("zero_point",d?12:s,p.length):void 0,P=At("output",c,l.length,b),A=[$,w];C&&A.push(C);let I=[f,m];_&&I.push(p);let W=[{type:12,data:u/b},{type:12,data:t},{type:12,data:n.blockSize},...zt(...I,l)],G=q=>{let Z=[{name:"output_size",type:"u32"},{name:"axis",type:"u32"},{name:"block_size",type:"u32"}];return`
      ${q.registerUniforms(Z).declareVariables(...A,P)}
      ${q.mainStart()}
          ${q.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
          let output_indices = ${P.offsetToIndices("global_idx")};

          // Set input x
          ${d?`
            let input = ${$.getByOffset("global_idx / 4")};
            let x_vec = ${i?"unpack4xI8(input)":"unpack4xU8(input)"};
            let x_value = ${b===1?"x_vec[global_idx % 4]":"x_vec"};`:`let x_value = ${$.getByOffset("global_idx")};`};

          // Set scale input
          ${y?`let scale_value= ${w.getByOffset("0")}`:v?`
            let scale_index = ${P.indicesGet("output_indices","uniforms.axis")};
            let scale_value= ${w.getByOffset("scale_index")};`:`
            var scale_indices: ${w.type.indices} = output_indices;
            let index = ${w.indicesGet("scale_indices","uniforms.axis")} / uniforms.block_size;
            ${w.indicesSet("scale_indices","uniforms.axis","index")};
            let scale_value= ${w.getByIndices("scale_indices")};`};

          // Set zero-point input
          ${C?y?d?`
                let zero_point_input = ${C.getByOffset("0")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value= zero_point_vec[0]`:`let zero_point_value = ${C.getByOffset("0")}`:v?d?`
                let zero_point_index = ${P.indicesGet("output_indices","uniforms.axis")};
                let zero_point_input = ${C.getByOffset("zero_point_index / 4")};
                let zero_point_vec =  ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_index % 4]`:`
                let zero_point_index = ${P.indicesGet("output_indices","uniforms.axis")};
                let zero_point_value = ${C.getByOffset("zero_point_index")};`:d?`
                let zero_point_offset = ${w.indicesToOffset("scale_indices")};
                let zero_point_input = ${C.getByOffset("zero_point_offset / 4")};
                let zero_point_vec = ${i?"unpack4xI8(zero_point_input)":"unpack4xU8(zero_point_input)"};
                let zero_point_value = zero_point_vec[zero_point_offset % 4];`:`let zero_point_value = ${C.getByIndices("scale_indices")};`:`let zero_point_value = ${d?i?"i32":"u32":$.type.value}(0);`};
      // Compute and write output
      ${P.setByOffset("global_idx",`${P.type.value}(x_value - zero_point_value) * scale_value`)};
      }`};return{name:"DequantizeLinear",shaderCache:{hint:n.cacheKey,inputDependencies:C?["rank","rank","rank"]:["rank","rank"]},getShaderSource:G,getRunData:()=>({outputs:[{dims:l,dataType:c}],dispatchGroup:{x:Math.ceil(u/b/64),y:1,z:1},programUniforms:W})}},mS=(e,n)=>{h1(e.inputs,n),e.compute(p1(e.inputs,n))},_S=e=>$n({axis:e.axis,blockSize:e.blockSize})}),m1,_1,gS,E3=ct(()=>{vi(),Wt(),tn(),m1=(e,n,t)=>{let s=e===n,i=e<n&&t<0,l=e>n&&t>0;if(s||i||l)throw new Error("Range these inputs' contents are invalid.")},_1=(e,n,t,s)=>{let i=Math.abs(Math.ceil((n-e)/t)),l=[i],c=i,u=[{type:12,data:c},{type:s,data:e},{type:s,data:t},...zt(l)],d=f=>{let m=At("output",s,l.length),_=m.type.value,p=[{name:"outputSize",type:"u32"},{name:"start",type:_},{name:"delta",type:_}];return`
        ${f.registerUniforms(p).declareVariables(m)}
        ${f.mainStart()}
        ${f.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
        output[global_idx] = uniforms.start + ${_}(global_idx) * uniforms.delta;
      }`};return{name:"Range",shaderCache:{hint:`${s}`},getShaderSource:d,getRunData:()=>({outputs:[{dims:l,dataType:s}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:u})}},gS=e=>{let n=0,t=0,s=0;e.inputs[0].dataType===6?(n=e.inputs[0].getInt32Array()[0],t=e.inputs[1].getInt32Array()[0],s=e.inputs[2].getInt32Array()[0]):e.inputs[0].dataType===1&&(n=e.inputs[0].getFloat32Array()[0],t=e.inputs[1].getFloat32Array()[0],s=e.inputs[2].getFloat32Array()[0]),da.webgpu.validateInputContent&&m1(n,t,s),e.compute(_1(n,t,s,e.inputs[0].dataType),{inputs:[]})}}),g1,Wy,Hy,y1,yS,vS,S3=ct(()=>{Wt(),en(),Fa(),tn(),g1=(e,n,t,s)=>{if(e!=="none"&&s!=="i32"&&s!=="u32"&&s!=="f32")throw new Error(`Input ${s} is not supported with reduction ${e}.`);let i=`{
                var oldValue = 0;
                loop {
                  let newValueF32 =`,l=`;
                  let newValue = bitcast<i32>(newValueF32);
                  let res = atomicCompareExchangeWeak(&${n}, oldValue, newValue);
                  if res.exchanged {
                    break;
                  }
                  oldValue = res.old_value;
                }
              }`;switch(e){case"none":return`${n}=${t};`;case"add":return s==="i32"||s==="u32"?`atomicAdd(&${n}, bitcast<${s}>(${t}));`:`
              ${i}bitcast<${s}>(oldValue) + (${t})${l}`;case"max":return s==="i32"||s==="u32"?`atomicMax(&${n}, bitcast<${s}>(${t}));`:`
                ${i}max(bitcast<f32>(oldValue), (${t}))${l}`;case"min":return s==="i32"||s==="u32"?`atomicMin(&${n}, bitcast<${s}>(${t}));`:`${i}min(bitcast<${s}>(oldValue), (${t}))${l}`;case"mul":return`${i}(bitcast<${s}>(oldValue) * (${t}))${l}`;default:throw new Error(`Reduction ${e} is not supported.`)}},Wy=(e,n)=>`${e===1?`
    let element_count_dim = uniforms.output_strides;
    let dim_value = uniforms.output_shape;`:`
    let element_count_dim = uniforms.output_strides[${n?"i - indices_start":"i"}];
    let dim_value = uniforms.output_shape[${n?"i - indices_start":"i"} + uniforms.last_index_dimension];`}
    
    if (index >= 0) {
      if (index >= i32(dim_value)) {
        index = i32(dim_value - 1);
      }
    } else {
      if (index < -i32(dim_value)) {
        index = 0;
      } else {
        index += i32(dim_value);
      }
    }
    data_offset += u32((u32(index) * element_count_dim));`,Hy=(e,n,t)=>`for (var i = 0u; i < uniforms.num_updates_elements; i++) {
        let value = updates[uniforms.num_updates_elements * ${t?"global_idx":"idx"} + i];
        ${g1(e.reduction,"output[data_offset + i]","value",n)}
      }`,y1=(e,n)=>{let t=e[0].dims,s=e[1].dims,i=t,l=1,c=Math.ceil(je.size(s)/l),u=s[s.length-1],d=je.sizeFromDimension(t,u),f=je.sizeFromDimension(s,0)/u,m=[{type:12,data:c},{type:12,data:u},{type:12,data:d},...zt(e[1].dims,e[2].dims,i)],_=p=>{let y=Qe("indices",e[1].dataType,e[1].dims.length),v=Qe("updates",e[2].dataType,e[2].dims.length,l),T=n.reduction!=="none"&&n.reduction!==""?qT("output",e[0].dataType,i.length):At("output",e[0].dataType,i.length,l);return`
      ${p.registerUniform("output_size","u32").registerUniform("last_index_dimension","u32").registerUniform("num_updates_elements","u32").declareVariables(y,v,T)}
      ${p.mainStart()}
        ${p.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
  var hasDuplicates = false;
  if (${n.reduction==="none"}) {
    for (var i = 0; i < ${f}; i = i + 1) {
      for (var j = i + 1; j < ${f}; j = j + 1) {
        var index_i = i32(indices[i].x);
        var index_j = i32(indices[j].x);
        if (index_i == index_j) {
          hasDuplicates = true;
          break;
        }
      }
      if (hasDuplicates) {
        break;
      }
    }
  }

  if (${n.reduction==="none"} && hasDuplicates) {
    if (global_idx != 0u) {
      return;
    }
    // Process each index-update pair individually when duplicates exist
    for (var idx = 0u; idx < ${f}u; idx++) {
      var data_offset = 0u;
      for (var i = 0u; i < uniforms.last_index_dimension; i++) {
        var index = i32(indices[idx * uniforms.last_index_dimension + i].x);
        ${Wy(t.length,!1)}
      }
      ${Hy(n,T.type.value,!1)}
    }
    return;
  }

  var data_offset = 0u;
  var indices_start = uniforms.last_index_dimension * global_idx;
  var indices_end = indices_start + uniforms.last_index_dimension;
  for (var i = indices_start; i < indices_end; i++) {
    var index = i32(indices[i].x);
    ${Wy(t.length,!0)}
  }
  ${Hy(n,T.type.value,!0)}
  }`};return{name:"ScatterND",shaderCache:{hint:`${n.cacheKey}_${n.reduction}`,inputDependencies:["rank","rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(c/64)},programUniforms:m}),getShaderSource:_}},yS=e=>$n({reduction:e.reduction}),vS=(e,n)=>{e.compute(y1(e.inputs,n),{inputs:[e.inputs[1],e.inputs[2]],outputs:[]})}}),v1,b1,w1,qy,M1,x1,T1,E1,S1,C1,A1,P1,Ky,k1,$1,D1,O1,I1,bS,wS,C3=ct(()=>{Wt(),en(),Fa(),tn(),v1=(e,n)=>{if(e.every(t=>t>0||(()=>{throw new Error("Resize requires scales input values to be positive")})),e.length>0){if(n.mode==="linear"){if(!(e.length===2||e.length===3||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1||e.length===5&&e[0]===1&&e[1]===1))throw new Error(`For linear mode, Resize requires scales to be 2D, 3D, 4D with either two outermost or one innermost and
            one outermost scale values equal to 1, or 5D with two outermost scale values equal to 1`)}else if(n.mode==="cubic"&&!(e.length===2||e.length===4&&e[0]===1&&e[1]===1||e.length===4&&e[0]===1&&e[3]===1))throw new Error("Resize requires scales input size to be 2 or 4 for cubic mode")}},b1=(e,n,t)=>{n.every(i=>i>=0&&i<t||(()=>{throw new Error("Resize requires axes input values to be positive and less than rank")}));let s=new Array(t).fill(1);return n.forEach((i,l)=>s[i]=e[l]),s},w1=(e,n,t,s,i,l)=>{let[c,u,d]=t>10?[1,2,3]:[-1,e.length>1?1:-1,-1],f=e[0].dims.length;if(c>0&&e.length>c&&e[c].dims.length>0)e[c].getFloat32Array().forEach(m=>l.push(m));else if(n.coordinateTransformMode==="tf_crop_and_resize")throw new Error("Resize requires RoI input to be specified when coordinateTransformMode is tfCropAndResize");if(u>0&&e.length>u&&e[u].dims.length===1&&e[u].dims[0]>0){if(e[u].getFloat32Array().forEach(m=>s.push(m)),s.length!==0&&s.length!==f&&t>=18&&s.length!==n.axes.length)throw new Error("Resize requires scales input size to be same as input rank or axes size for opset 18 and up");v1(s,n),n.axes.length>0&&b1(s,n.axes,f).forEach((m,_)=>s[_]=m)}if(d>0&&e.length>d&&e[d].dims.length===1&&e[d].dims[0]>0&&(e[d].getBigInt64Array().forEach(m=>i.push(Number(m))),i.length!==0&&i.length!==f&&t>=18&&i.length!==n.axes.length))throw new Error("Resize requires sizes input size to be same as input rank or axes size for opset 18 and up");if(n.axes.length>0){if(s.length!==0&&s.length!==n.axes.length)throw new Error('Resize requires "scales" input size to be of axes rank when axes attributes is specified');if(i.length!==0&&i.length!==n.axes.length)throw new Error('Resize requires "sizes" input size to be of rank axes rank when axes attributes is specified')}if(typeof s<"u"&&typeof i<"u"&&s.length>0&&i.length>f)throw new Error("Resize requires only of scales or sizes to be specified")},qy=(e,n,t,s)=>`
  // The whole part and the fractional part are calculated separately due to inaccuracy of floating
  // point division. As an example, f32(21) / f32(7) may evaluate to 2.99... instead of 3, causing an
  // offset-by-one error later in floor().
  let big = (${e}) * (${n});
  let whole = ${s}(big / (${t}));
  let fract = ${s}(big % (${t})) / ${s}(${t});
  return whole + fract;
`,M1=(e,n)=>`fn getOriginalCoordinateFromResizedCoordinate(xResized: u32, xScale: f32, lengthResized: u32,
     lengthOriginal: u32, roiStart: f32, roiEnd: f32) -> ${n} { `+(()=>{switch(e){case"asymmetric":return`
          if (xScale < 1.0 || floor(xScale) != xScale) {
            return ${n}(xResized) / ${n}(xScale);
          } else {
            ${qy("xResized","lengthOriginal","lengthResized",n)}
          }
        `;case"pytorch_half_pixel":return`if (lengthResized > 1) {
                    return (${n}(xResized) + 0.5) / ${n}(xScale) - 0.5;
                  } else {
                    return 0.0;
                  }`;case"tf_half_pixel_for_nn":return`return (${n}(xResized) + 0.5) / ${n}(xScale);`;case"align_corners":return`if (lengthResized == 1) {
                    return 0.0;
                  } else {
                    ${qy("xResized","lengthOriginal - 1","lengthResized - 1",n)}
                  }`;case"tf_crop_and_resize":return`if (lengthResized > 1) {
                    return ${n}(roiStart) * ${n}(lengthOriginal - 1) +
                        (${n}(xResized) * ${n}(roiEnd - roiStart) * ${n}(lengthOriginal - 1)) /
                        ${n}(lengthResized - 1);
                  } else {
                    return 0.5 * ${n}(roiStart + roiEnd) * ${n}(lengthOriginal - 1);
                  }`;case"half_pixel_symmetric":return`const outputWidth = ${n}xScale * ${n}(lengthResized);
                  const adjustment = ${n}(lengthResized) / outputWidth;
                  const center = ${n}(lengthOriginal) / 2;
                  const offset = center * (1 - adjustment);
                  return offset + ((${n}(xResized) + 0.5) / ${n}(xScale)) - 0.5;`;case"half_pixel":return`return ((${n}(xResized) + 0.5) / ${n}(xScale)) - 0.5;`;default:throw new Error(`Coordinate transform mode ${e} is not supported`)}})()+"}",x1=(e,n,t)=>`fn getNearestPixelFromOriginal(xOriginal: ${t}, isDownSample: bool) -> ${t} {`+(()=>{switch(e){case"round_prefer_ceil":return"if (fract(xOriginal) == 0.5) {             return ceil(xOriginal);           } else {             return round(xOriginal);           }";case"floor":return"return floor(xOriginal);";case"ceil":return"return ceil(xOriginal);";case"round_prefer_floor":return"if (fract(xOriginal) == 0.5) {                     return floor(xOriginal);                   } else {                     return round(xOriginal);                   }";default:if(n<11)return"if (isDownSample)                     {                       return ceil(xOriginal);                     } else {                       return xOriginal;                     }";throw new Error(`Nearest mode ${e} is not supported`)}})()+"}",T1=(e,n,t)=>{let s=new Array(t).fill(0).concat(new Array(t).fill(1)),i=e.length===0?s:e.slice();return n.length>0?(n.forEach((l,c)=>{s[l]=i[c],s[c+t]=i[n.length+c]}),s):i},E1=(e,n,t,s)=>{let i=[];if(t.length>0)if(s.length>0){if(e.forEach(l=>i.push(l)),Math.max(...s)>e.length)throw new Error("axes is out of bound");s.forEach((l,c)=>i[l]=t[c])}else t.forEach(l=>i.push(l));else{if(n.length===0)throw new Error("Resize requires either scales or sizes.");i=e.map((l,c)=>Math.round(l*n[c]))}return i},S1=(e,n,t)=>{let s=(()=>{switch(t.keepAspectRatioPolicy){case"not_larger":return t.axes.length>0?Math.min(...t.axes.map(l=>n[l]),Number.MAX_VALUE):Math.min(...n,Number.MAX_VALUE);case"not_smaller":return t.axes.length>0?Math.max(...t.axes.map(l=>n[l]),Number.MIN_VALUE):Math.max(...n,Number.MIN_VALUE);default:throw new Error(`Keep aspect ratio policy ${t.keepAspectRatioPolicy} is not supported`)}})();n.fill(1,0,n.length);let i=e.slice();return t.axes.length>0?(t.axes.forEach(l=>n[l]=s),t.axes.forEach(l=>i[l]=Math.round(e[l]*n[l]))):(n.fill(s,0,n.length),i.forEach((l,c)=>i[c]=Math.round(l*n[c]))),i},C1=(e,n,t,s,i)=>`
    fn calculateOriginalIndicesFromOutputIndices(output_indices: ${e.type.indices}) -> array<${e.type.value}, ${t.length}> {
      var original_indices: array<${e.type.value}, ${t.length}>;
      for (var i:u32 = 0; i < ${t.length}; i++) {
        var output_index = ${e.indicesGet("output_indices","i")};
        var scale = ${$t("uniforms.scales","i",s)};
        var roi_low = ${$t("uniforms.roi","i",i)};
        var roi_hi = ${$t("uniforms.roi",`i + ${n.length}`,i)};
        if (scale == 1.0) {
          original_indices[i] = ${e.type.value}(output_index);
        } else {
          var input_shape_i = ${$t("uniforms.input_shape","i",n.length)};
          var output_shape_i = ${$t("uniforms.output_shape","i",t.length)};
          original_indices[i] = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                           input_shape_i, roi_low, roi_hi);
        }
      }
      return original_indices;
    }`,A1=(e,n,t,s,i,l,c)=>`
    fn calculateInputIndicesFromOutputIndices(output_indices: ${n.type.indices}) -> ${e.type.indices} {
      var input_indices: ${e.type.indices};
      for (var i:u32 = 0; i < ${s.length}; i++) {
        var output_index = ${n.indicesGet("output_indices","i")};
        var input_index: u32;
        var scale = ${$t("uniforms.scales","i",i)};
        if (scale == 1.0) {
          input_index = output_index;
        } else {
          var roi_low = ${$t("uniforms.roi","i",l)};
          var roi_hi = ${$t("uniforms.roi",`i + ${t.length}`,l)};
          var input_shape_i = ${$t("uniforms.input_shape","i",t.length)};
          var output_shape_i = ${$t("uniforms.output_shape","i",s.length)};
          var original_idx = getOriginalCoordinateFromResizedCoordinate(output_index, scale, output_shape_i,
                                                                        input_shape_i, roi_low, roi_hi);
          if (!${c} || (original_idx >= 0 && original_idx < ${n.type.value}(input_shape_i))) {
            if (original_idx < 0) {
              input_index = 0;
            } else if (original_idx > ${n.type.value}(input_shape_i - 1)) {
              input_index = input_shape_i - 1;
            } else {
              input_index = u32(getNearestPixelFromOriginal(original_idx, scale < 1));
            }
          } else {
            input_index = u32(original_idx);
          }
        }
        ${e.indicesSet("input_indices","i","input_index")}
      }
      return input_indices;
    }`,P1=(e,n)=>`
    fn checkInputIndices(input_indices: ${e.type.indices}) -> bool {
      for (var i:u32 = 0; i < ${n.length}; i++) {
        var input_index = ${e.indicesGet("input_indices","i")};
        if (input_index < 0 || input_index >= ${$t("uniforms.input_shape","i",n.length)}) {
          return false;
        }
      }
      return true;
    }`,Ky=(e,n,t,s)=>e.rank>s?`
    ${e.indicesSet("input_indices",n,"channel")};
    ${e.indicesSet("input_indices",t,"batch")};
`:"",k1=(e,n,t,s,i)=>{let[l,c,u,d]=t.length===2?[-1,0,1,-1]:[0,2,3,1],f=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, row: u32, col: u32) -> ${f} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",c,`max(0, min(row, ${t[c]} - 1))`)};
      ${e.indicesSet("input_indices",u,`max(0, min(col, ${t[u]} - 1))`)};
      ${Ky(e,d,l,2)}
      return ${e.getByIndices("input_indices")};
    }

    fn bilinearInterpolation(output_indices: ${n.type.indices}) -> ${f} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var row:${f} = originalIndices[${c}];
      var col:${f} = originalIndices[${u}];
      ${s?`if (row < 0 || row > (${t[c]} - 1) || col < 0 || col > (${t[u]} - 1)) {
        return ${i};
      }`:""};
      row = max(0, min(row, ${t[c]} - 1));
      col = max(0, min(col, ${t[u]} - 1));
      var row1: u32 = u32(row);
      var col1: u32 = u32(col);
      var row2: u32 = u32(row + 1);
      var col2: u32 = u32(col + 1);
      var channel: u32 = ${t.length>2?`u32(originalIndices[${d}])`:"0"};
      var batch: u32 =  ${t.length>2?`u32(originalIndices[${l}])`:"0"};
      var x11: ${f} = getInputValue(batch, channel, row1, col1);
      var x12: ${f} = getInputValue(batch, channel, row1, col2);
      var x21: ${f} = getInputValue(batch, channel, row2, col1);
      var x22: ${f} = getInputValue(batch, channel, row2, col2);
      var dx1: ${f} = abs(row - ${f}(row1));
      var dx2: ${f} = abs(${f}(row2) - row);
      var dy1: ${f} = abs(col - ${f}(col1));
      var dy2: ${f} = abs(${f}(col2) - col);
      if (row1 == row2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (col1 == col2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      return (x11 * dx2 * dy2 + x12 * dx2 * dy1 + x21 * dx1 * dy2 + x22 * dx1 * dy1);
    }`},$1=(e,n,t,s,i,l,c,u,d,f)=>{let m=t.length===2,[_,p]=m?[0,1]:[2,3],y=e.type.value,v=T=>{let k=T===_?"row":"col";return`
      fn ${k}CubicInterpolation(input_indices: ${e.type.indices}, output_indices: ${n.type.indices}) -> ${y} {
        var output_index = ${n.indicesGet("output_indices",T)};
        var originalIdx: ${y} = getOriginalCoordinateFromResizedCoordinate(output_index, ${i[T]},
        ${s[T]}, ${t[T]}, ${l[T]}, ${l[T]} + ${t.length});
        var fractOriginalIdx: ${y} = originalIdx - floor(originalIdx);
        var coefs = getCubicInterpolationCoefs(fractOriginalIdx);

        if (${u} && (originalIdx < 0 || originalIdx > (${t[T]} - 1))) {
          return ${d};
        }
        var data: array<${y}, 4> = array<${y}, 4>(0.0, 0.0, 0.0, 0.0);
        for (var i: i32 = -1; i < 3; i++) {
          var ${k}: ${y} = originalIdx + ${y}(i);
          if (${k} < 0 || ${k} >= ${t[T]}) {
            ${f?`coefs[i + 1] = 0.0;
                        continue;`:u?`return ${d};`:`${k} = max(0, min(${k}, ${t[T]} - 1));`};
          }
        var input_indices_copy: ${e.type.indices} = input_indices;
          ${e.indicesSet("input_indices_copy",T,`u32(${k})`)};
          data[i + 1] = ${T===_?e.getByIndices("input_indices_copy"):"rowCubicInterpolation(input_indices_copy, output_indices)"};
        }
        return cubicInterpolation1D(data, coefs);
      }`};return`
    ${v(_)};
    ${v(p)};
  fn getCubicInterpolationCoefs(s: ${y}) -> array<${y}, 4> {
    var absS = abs(s);
    var coeffs: array<${y}, 4> = array<${y}, 4>(0.0, 0.0, 0.0, 0.0);
    var oneMinusAbsS: ${y} = 1.0 - absS;
    var twoMinusAbsS: ${y} = 2.0 - absS;
    var onePlusAbsS: ${y} = 1.0 + absS;
    coeffs[0] = ((${c} * onePlusAbsS - 5 * ${c}) * onePlusAbsS + 8 * ${c}) * onePlusAbsS - 4 * ${c};
    coeffs[1] = ((${c} + 2) * absS - (${c} + 3)) * absS * absS + 1;
    coeffs[2] = ((${c} + 2) * oneMinusAbsS - (${c} + 3)) * oneMinusAbsS * oneMinusAbsS + 1;
    coeffs[3] = ((${c} * twoMinusAbsS - 5 * ${c}) * twoMinusAbsS + 8 * ${c}) * twoMinusAbsS - 4 * ${c};
    return coeffs;
  }

  fn cubicInterpolation1D(x: array<${y}, 4>, coefs: array<${y}, 4>) -> ${y} {
    var coefsSum: ${y} = coefs[0] + coefs[1] + coefs[2] + coefs[3];
    return (x[0] * coefs[0] + x[1] * coefs[1]+ x[2] * coefs[2]+ x[3] * coefs[3]) / coefsSum;
  }

  fn bicubicInterpolation(output_indices: ${n.type.indices}) -> ${y} {
    var input_indices: ${e.type.indices} = output_indices;
    return colCubicInterpolation(input_indices, output_indices);
  }
    `},D1=(e,n,t,s,i)=>{let[l,c,u,d,f]=t.length===3?[-1,0,1,2,-1]:[0,2,3,4,1],m=e.type.value;return`
    fn getInputValue(batch: u32, channel: u32, depth:u32, height: u32, width: u32) -> ${m} {
      var input_indices: ${e.type.indices};
      ${e.indicesSet("input_indices",c,`max(0, min(depth, ${t[c]} - 1))`)};
      ${e.indicesSet("input_indices",u,`max(0, min(height, ${t[u]} - 1))`)};
      ${e.indicesSet("input_indices",d,`max(0, min(width, ${t[d]} - 1))`)};
      ${Ky(e,f,l,3)}
      return ${e.getByIndices("input_indices")};
    }

    fn trilinearInterpolation(output_indices: ${n.type.indices}) -> ${m} {
      var originalIndices = calculateOriginalIndicesFromOutputIndices(output_indices);
      var depth:${m} = originalIndices[${c}];
      var height:${m} = originalIndices[${u}];
      var width:${m} = originalIndices[${d}];
      ${s?`if (depth < 0 || depth > (${t[c]} - 1) || height < 0 || height > (${t[u]} - 1) || width < 0 || (width > ${t[d]} - 1)) {
      return ${i};
        }`:""};

    depth = max(0, min(depth, ${t[c]} - 1));
      height = max(0, min(height, ${t[u]} - 1));
      width = max(0, min(width, ${t[d]} - 1));
      var depth1: u32 = u32(depth);
      var height1: u32 = u32(height);
      var width1: u32 = u32(width);
      var depth2: u32 = u32(depth + 1);
      var height2: u32 = u32(height + 1);
      var width2: u32 = u32(width + 1);
      var channel: u32 = ${t.length>3?`u32(originalIndices[${f}])`:"0"};
      var batch: u32 =  ${t.length>3?`u32(originalIndices[${l}])`:"0"};

      var x111: ${m} = getInputValue(batch, channel, depth1, height1, width1);
      var x112: ${m} = getInputValue(batch, channel, depth1, height1, width2);
      var x121: ${m} = getInputValue(batch, channel, depth1, height2, width1);
      var x122: ${m} = getInputValue(batch, channel, depth1, height2, width2);
      var x211: ${m} = getInputValue(batch, channel, depth2, height1, width1);
      var x212: ${m} = getInputValue(batch, channel, depth2, height1, width2);
      var x221: ${m} = getInputValue(batch, channel, depth2, height2, width1);
      var x222: ${m} = getInputValue(batch, channel, depth2, height2, width2);
      var dx1: ${m} = abs(depth - ${m}(depth1));
      var dx2: ${m} = abs(${m}(depth2) - depth);
      var dy1: ${m} = abs(height - ${m}(height1));
      var dy2: ${m} = abs(${m}(height2) - height);
      var dz1: ${m} = abs(width - ${m}(width1));
      var dz2: ${m} = abs(${m}(width2) - width);
      if (depth1 == depth2) {
        dx1 = 0.5;
        dx2 = 0.5;
      }
      if (height1 == height2) {
        dy1 = 0.5;
        dy2 = 0.5;
      }
      if (width1 == width2) {
        dz1 = 0.5;
        dz2 = 0.5;
      }
      return (x111 * dx2 * dy2 * dz2 + x112 * dx2 * dy2 * dz1 + x121 * dx2 * dy1 *dz2 + x122 * dx2 * dy1 * dz1 +
              x211 * dx1 * dy2 * dz2 + x212 * dx1 * dy2 * dz1 + x221 * dx1 * dy1 *dz2 + x222 * dx1 * dy1 * dz1);
    }`},O1=(e,n,t,s,i,l)=>{let c=e.dims,u=T1(l,n.axes,c.length),d=E1(c,s,i,n.axes),f=s.slice();s.length===0&&(f=c.map((S,$)=>S===0?1:d[$]/S),n.keepAspectRatioPolicy!=="stretch"&&(d=S1(c,f,n)));let m=At("output",e.dataType,d.length),_=Qe("input",e.dataType,c.length),p=je.size(d),y=c.length===d.length&&c.every((S,$)=>S===d[$]),v=n.coordinateTransformMode==="tf_crop_and_resize",T=n.extrapolationValue,k=_.type.value,b=S=>`
      ${y?"":`
      ${M1(n.coordinateTransformMode,k)};
      ${(()=>{switch(n.mode){case"nearest":return`
              ${P1(_,c)};
              ${x1(n.nearestMode,t,k)};
              ${A1(_,m,c,d,f.length,u.length,v)};
              `;case"linear":return`
              ${C1(m,c,d,f.length,u.length)};
              ${(()=>{if(c.length===2||c.length===4)return`${k1(_,m,c,v,T)}`;if(c.length===3||c.length===5)return`${D1(_,m,c,v,T)}`;throw Error("Linear mode only supports input dims 2, 3, 4 and 5 are supported in linear mode.")})()};
            `;case"cubic":return`
            ${(()=>{if(c.length===2||c.length===4)return`${$1(_,m,c,d,f,u,n.cubicCoeffA,v,n.extrapolationValue,n.excludeOutside)}`;throw Error("Cubic mode only supports input dims 2 and 4 are supported in linear mode.")})()};
            `;default:throw Error("Invalid resize mode")}})()};
      `}
      ${S.registerUniform("output_size","u32").registerUniform("scales","f32",f.length).registerUniform("roi","f32",u.length).declareVariables(_,m)}
      ${S.mainStart()}
        ${S.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
        ${y?"output[global_idx] = input[global_idx];":`
        let output_indices = ${m.offsetToIndices("global_idx")};
        var input_indices: ${_.type.indices};
        ${(()=>{switch(n.mode){case"nearest":return`input_indices = calculateInputIndicesFromOutputIndices(output_indices);
                if (checkInputIndices(input_indices)) {
                  output[global_idx] = ${_.getByIndices("input_indices")};
                } else {
                  output[global_idx] = ${n.extrapolationValue};
                }`;case"linear":return`output[global_idx] = ${c.length===2||c.length===4?"bilinearInterpolation":"trilinearInterpolation"}(output_indices);`;case"cubic":return"output[global_idx] = bicubicInterpolation(output_indices);";default:throw Error(`Unsupported resize mode: ${n.mode}`)}})()};
`}
      }`;return{name:"Resize",shaderCache:{hint:`${n.cacheKey}|${t}|${f.length>0?n.mode==="cubic"?f:f.length:""}|${i.length>0?i:""}|${u.length>0?u:""}|${y}|${n.mode==="nearest"?c.length:c}`,inputDependencies:["rank"]},getShaderSource:b,getRunData:()=>({outputs:[{dims:d,dataType:e.dataType}],dispatchGroup:{x:Math.ceil(p/64)},programUniforms:[{type:12,data:p},{type:1,data:f},{type:1,data:u},...zt(c,d)]})}},I1=e=>{let n=e.customDataBuffer;return new Uint32Array(n,n.byteOffset,1)[0]},bS=(e,n)=>{let t=[],s=[],i=[],l=I1(e);if(n.antialias!==0)throw Error("Only default value (0) for Antialias attribute is supported");w1(e.inputs,n,l,t,s,i),e.compute(O1(e.inputs[0],n,l,t,s,i),{inputs:[0]})},wS=e=>{let n=e.antialias,t=e.axes,s=e.coordinateTransformMode,i=e.cubicCoeffA,l=e.excludeOutside!==0,c=e.extrapolationValue,u=e.keepAspectRatioPolicy,d=e.mode,f=e.nearestMode===""?"simple":e.nearestMode;return $n({antialias:n,axes:t,coordinateTransformMode:s,cubicCoeffA:i,excludeOutside:l,extrapolationValue:c,keepAspectRatioPolicy:u,mode:d,nearestMode:f})}}),z1,L1,MS,A3=ct(()=>{Wt(),en(),tn(),z1=e=>{if(!e||e.length<3)throw new Error("layerNorm requires at least 3 inputs.");let n=e[0],t=e[1],s=e[2];if(n.dataType!==t.dataType||n.dataType!==s.dataType)throw new Error("All inputs must have the same data type");if(n.dims.length!==3&&n.dims.length!==2)throw new Error("Input must be 2D or 3D");if(t.dims.length!==3&&t.dims.length!==2)throw new Error("Skip must be 2D or 3D");let i=n.dims[n.dims.length-1],l=n.dims[n.dims.length-2];if(t.dims[t.dims.length-1]!==i)throw new Error("Skip must have the same hidden size as input");if(t.dims[t.dims.length-2]!==l)throw new Error("Skip must have the same sequence length as input");if(s.dims.length!==1)throw new Error("Gamma must be 1D");if(s.dims[s.dims.length-1]!==i)throw new Error("Gamma must have the same hidden size as input");if(e.length>3){let c=e[3];if(c.dims.length!==1)throw new Error("Beta must be 1D");if(c.dims[c.dims.length-1]!==i)throw new Error("Beta must have the same hidden size as input")}if(e.length>4){let c=e[4];if(c.dims.length!==1)throw new Error("Bias must be 1D");if(c.dims[c.dims.length-1]!==i)throw new Error("Bias must have the same hidden size as input")}},L1=(e,n,t,s)=>{let i=n.simplified,l=e[0].dims,c=je.size(l),u=l,d=c,f=l.slice(-1)[0],m=s?l.slice(0,-1).concat(1):[],_=!i&&e.length>3,p=e.length>4,y=s&&t>1,v=s&&t>2,T=t>3,k=64,b=Sa(f),S=[{type:12,data:d},{type:12,data:b},{type:12,data:f},{type:1,data:n.epsilon}],$=C=>{let P=[{name:"output_size",type:"u32"},{name:"components",type:"u32"},{name:"hidden_size",type:"u32"},{name:"epsilon",type:"f32"}],A=[Qe("x",e[0].dataType,e[0].dims,b),Qe("skip",e[1].dataType,e[1].dims,b),Qe("gamma",e[2].dataType,e[2].dims,b)];_&&A.push(Qe("beta",e[3].dataType,e[3].dims,b)),p&&A.push(Qe("bias",e[4].dataType,e[4].dims,b)),A.push(At("output",e[0].dataType,u,b)),y&&A.push(At("mean_output",1,m)),v&&A.push(At("inv_std_output",1,m)),T&&A.push(At("input_skip_bias_sum",e[0].dataType,u,b));let I=as(e[0].dataType),W=as(1,b);return`

      ${C.registerUniforms(P).declareVariables(...A)}
      var<workgroup> sum_shared : array<${W}, ${k}>;
      var<workgroup> sum_squared_shared : array<${W}, ${k}>;

      ${C.mainStart([k,1,1])}
        let ix = local_id.x;
        let iy = global_id.x / ${k};

        let hidden_size_vectorized: u32 = uniforms.hidden_size / uniforms.components;
        var stride = hidden_size_vectorized / ${k};
        let offset = ix * stride + iy * hidden_size_vectorized;
        let offset1d = stride * ix;
        if (ix == ${k-1}) {
          stride = hidden_size_vectorized - stride * ix;
        }
        for (var i: u32 = 0; i < stride; i++) {
          let skip_value = skip[offset + i];
          let bias_value = ${p?"bias[offset1d + i]":I+"(0.0)"};
          let input_value = x[offset + i];
          let value = input_value + skip_value + bias_value;
          ${T?"input_skip_bias_sum[offset + i] = value;":""}
          output[offset + i] = value;
          let f32_value = ${gf(I,b,"value")};
          sum_shared[ix] += f32_value;
          sum_squared_shared[ix] += f32_value * f32_value;
        }
        workgroupBarrier();

        var reduce_size : u32 = ${k};
        for (var curr_size = reduce_size >> 1;  curr_size > 0; curr_size = reduce_size >> 1) {
          reduce_size = curr_size + (reduce_size & 1);
          if (ix < curr_size) {
            sum_shared[ix] += sum_shared[ix + reduce_size];
            sum_squared_shared[ix] += sum_squared_shared[ix + reduce_size];
          }
          workgroupBarrier();
        }

        let sum = sum_shared[0];
        let square_sum = sum_squared_shared[0];
        let mean = ${cc("sum",b)} / f32(uniforms.hidden_size);
        let inv_std_dev = inverseSqrt(${cc("square_sum",b)} / f32(uniforms.hidden_size) ${i?"":"- mean * mean"} + uniforms.epsilon);
        ${y?"mean_output[global_idx] = mean;":""}
        ${v?"inv_std_output[global_idx] = inv_std_dev;":""}

        for (var i: u32 = 0; i < stride; i++) {
          output[offset + i] = (output[offset + i] ${i?"":`- ${I}(mean)`}) *
            ${I}(inv_std_dev) * gamma[offset1d + i]
            ${_?"+ beta[offset1d + i]":""};
        }
      }`},w=[{dims:u,dataType:e[0].dataType}];return t>1&&w.push({dims:m,dataType:1}),t>2&&w.push({dims:m,dataType:1}),t>3&&w.push({dims:l,dataType:e[0].dataType}),{name:"SkipLayerNormalization",shaderCache:{hint:`${b};${y};${v};${T}`,inputDependencies:e.map((C,P)=>"type")},getShaderSource:$,getRunData:()=>({outputs:w,dispatchGroup:{x:Math.ceil(d/f)},programUniforms:S})}},MS=(e,n)=>{z1(e.inputs);let t=[0];e.outputCount>1&&t.push(-3),e.outputCount>2&&t.push(-3),e.outputCount>3&&t.push(3),e.compute(L1(e.inputs,n,e.outputCount,!1),{outputs:t})}}),F1,Xp,N1,Qy,j1,R1,xS,TS,P3=ct(()=>{Wt(),en(),Fa(),tn(),F1=(e,n)=>{if(!e||e.length<1)throw new Error("too few inputs");if(n.axes.length!==0){if(n.axes.length!==n.starts.length||n.axes.length!==n.ends.length)throw new Error("axes, starts and ends must have the same length")}else if(n.starts.length!==n.ends.length)throw new Error("starts and ends must have the same length");e.slice(1).forEach((t,s)=>{if(e[s+1].dataType!==6&&e[s+1].dataType!==7)throw new Error(`Input ${s} must be an array of int32 or int64`)})},Xp=(e,n)=>{let t=[];if(e.length>n)if(e[n].dataType===7)e[n].getBigInt64Array().forEach(s=>t.push(Number(s)));else if(e[n].dataType===6)e[n].getInt32Array().forEach(s=>t.push(Number(s)));else throw new Error(`Input ${n} must be an array of int32 or int64`);return t},N1=(e,n)=>{if(e.length>1){let t=Xp(e,1),s=Xp(e,2),i=Xp(e,3);return i.length===0&&(i=[...Array(e[0].dims.length).keys()]),$n({starts:t,ends:s,axes:i})}else return n},Qy=(e,n,t,s,i)=>{let l=e;return e<0&&(l+=t[s[n]]),i[n]<0?Math.max(0,Math.min(l,t[s[n]]-1)):Math.max(0,Math.min(l,t[s[n]]))},j1=(e,n,t)=>`fn calculateInputIndices(output_indices: ${n.type.indices}) -> ${e.type.indices} {
          var input_indices: ${e.type.indices};
          var carry = 0u;
          for (var i = ${t.length}; i >= 0; i--) {
            let input_shape_i = ${$t("uniforms.input_shape","i",t.length)};
            let steps_i = ${$t("uniforms.steps","i",t.length)};
            let signs_i = ${$t("uniforms.signs","i",t.length)};
            let starts_i = ${$t("uniforms.starts","i",t.length)};
            var output_index = ${n.indicesGet("output_indices","i")};
            var input_index = output_index * steps_i + starts_i + carry;
            carry = input_index / input_shape_i;
            input_index = input_index % input_shape_i;
            if (signs_i < 0) {
              input_index = input_shape_i - input_index - 1u + starts_i;
            }
            ${e.indicesSet("input_indices","i","input_index")};
          }
          return input_indices;
      }`,R1=(e,n)=>{let t=e[0].dims,s=je.size(t),i=n.axes.length>0?je.normalizeAxes(n.axes,t.length):[...Array(t.length).keys()],l=Xp(e,4);l.forEach(b=>b!==0||(()=>{throw new Error("step cannot be 0")})),l.length===0&&(l=Array(i.length).fill(1));let c=n.starts.map((b,S)=>Qy(b,S,t,i,l)),u=n.ends.map((b,S)=>Qy(b,S,t,i,l));if(i.length!==c.length||i.length!==u.length)throw new Error("start, ends and axes should have the same number of elements");if(i.length!==t.length)for(let b=0;b<t.length;++b)i.includes(b)||(c.splice(b,0,0),u.splice(b,0,t[b]),l.splice(b,0,1));let d=l.map(b=>Math.sign(b));l.forEach((b,S,$)=>{if(b<0){let w=(u[S]-c[S])/b,C=c[S],P=C+w*l[S];c[S]=P,u[S]=C,$[S]=-b}});let f=t.slice(0);i.forEach((b,S)=>{f[b]=Math.ceil((u[b]-c[b])/l[b])});let m={dims:f,dataType:e[0].dataType},_=At("output",e[0].dataType,f.length),p=Qe("input",e[0].dataType,e[0].dims.length),y=je.size(f),v=[{name:"outputSize",type:"u32"},{name:"starts",type:"u32",length:c.length},{name:"signs",type:"i32",length:d.length},{name:"steps",type:"u32",length:l.length}],T=[{type:12,data:y},{type:12,data:c},{type:6,data:d},{type:12,data:l},...zt(e[0].dims,f)],k=b=>`
      ${b.registerUniforms(v).declareVariables(p,_)}
        ${j1(p,_,t)}
        ${b.mainStart()}
          ${b.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.outputSize")}
          let output_indices = ${_.offsetToIndices("global_idx")};
          let input_indices = calculateInputIndices(output_indices);
          ${_.setByOffset("global_idx",p.getByIndices("input_indices"))}
      }`;return{name:"Slice",shaderCache:{hint:`${d.length}_${c.length}_${l.length}`,inputDependencies:["rank"]},getShaderSource:k,getRunData:()=>({outputs:[m],dispatchGroup:{x:Math.ceil(s/64)},programUniforms:T})}},xS=(e,n)=>{F1(e.inputs,n);let t=N1(e.inputs,n);e.compute(R1(e.inputs,t),{inputs:[0]})},TS=e=>{let n=e.starts,t=e.ends,s=e.axes;return $n({starts:n,ends:t,axes:s})}}),B1,U1,ES,SS,k3=ct(()=>{Wt(),en(),Fa(),uc(),tn(),B1=e=>{if(!e||e.length!==1)throw new Error("Softmax op requires 1 input.")},U1=(e,n)=>{let t=e.inputs[0],s=t.dims,i=je.size(s),l=s.length,c=je.normalizeAxis(n.axis,l),u=c<s.length-1,d,f=[];u?(f=Array.from({length:l},(A,I)=>I),f[c]=l-1,f[l-1]=c,d=e.compute(yr(t,f),{inputs:[t],outputs:[-1]})[0]):d=t;let m=d.dims,_=m[l-1],p=i/_,y=Sa(_),v=_/y,T=64;p===1&&(T=256);let k=(A,I)=>I===4?`max(max(${A}.x, ${A}.y), max(${A}.z, ${A}.w))`:I===2?`max(${A}.x, ${A}.y)`:I===3?`max(max(${A}.x, ${A}.y), ${A}.z)`:A,b=Qe("x",d.dataType,d.dims,y),S=At("result",d.dataType,d.dims,y),$=b.type.value,w=as(d.dataType)==="f32"?`var threadMax = ${$}(-3.402823e+38f);`:`var threadMax = ${$}(-65504.0h);`,C=A=>`
      var<workgroup> rowMaxShared : ${$};
      var<workgroup> rowSumShared : ${$};
      var<workgroup> threadShared : array<${$}, ${T}>;

      fn getValue(row: i32, col: i32, row_stride: i32) -> ${$} {
        let index = row * row_stride + col;
        return x[index];
      }

      fn setValue(row: i32, col: i32, row_stride: i32, value: ${$}) {
        let index = row * row_stride + col;
        result[index] = value;
      }
      ${A.registerUniform("packedCols","i32").declareVariables(b,S)}
      ${A.mainStart(T)}
        let gindex = i32(global_idx);
        let lindex = i32(local_idx);
        const wg = ${T};
        let row = gindex / wg;
        let cols = uniforms.packedCols;
        let row_stride : i32 = uniforms.packedCols;

        // find the rows max
        ${w}
        for (var col = lindex; col < cols; col += wg) {
          let value = getValue(row, col, row_stride);
          threadMax = max(threadMax, value);
        }
        if (lindex < cols) {
          threadShared[lindex] = threadMax;
        }
        workgroupBarrier();

        var reduceSize = min(cols, wg);
        for (var currSize = reduceSize >> 1;  currSize > 0; currSize = reduceSize >> 1) {
          reduceSize = currSize + (reduceSize & 1);
          if (lindex < currSize) {
            threadShared[lindex] = max(threadShared[lindex], threadShared[lindex + reduceSize]);
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowMaxShared = ${$}(${k("threadShared[0]",y)});
        }
        workgroupBarrier();

        // find the rows sum
        var threadSum = ${$}(0.0);
        for (var col = lindex; col < cols; col += wg) {
          let subExp = exp(getValue(row, col, row_stride) - rowMaxShared);
          threadSum += subExp;
        }
        threadShared[lindex] = threadSum;
        workgroupBarrier();

        for (var currSize = wg >> 1;  currSize > 0; currSize = currSize >> 1) {
          if (lindex < currSize) {
            threadShared[lindex] = threadShared[lindex] + threadShared[lindex + currSize];
          }
          workgroupBarrier();
        }
        if (lindex == 0) {
          rowSumShared = ${$}(${cc("threadShared[0]",y)});
        }
        workgroupBarrier();

        // calculate final value for each element in the row
        for (var col = lindex; col < cols; col += wg) {
          let value = exp(getValue(row, col, row_stride) - rowMaxShared) / rowSumShared;
          setValue(row, col, row_stride, value);
        }
      }`,P=e.compute({name:"Softmax",shaderCache:{hint:`${y};${T}`,inputDependencies:["type"]},getRunData:()=>({outputs:[{dims:m,dataType:d.dataType}],dispatchGroup:{x:p},programUniforms:[{type:6,data:v}]}),getShaderSource:C},{inputs:[d],outputs:[u?-1:0]})[0];u&&e.compute(yr(P,f),{inputs:[P]})},ES=(e,n)=>{B1(e.inputs),U1(e,n)},SS=e=>$n({axis:e.axis})}),Xy,V1,G1,W1,CS,$3=ct(()=>{Wt(),en(),tn(),Xy=e=>Array.from(e.getBigInt64Array(),Number),V1=e=>{if(!e||e.length!==2)throw new Error("Tile requires 2 inputs.");if(e[0].dataType!==1&&e[0].dataType!==10&&e[0].dataType!==6&&e[0].dataType!==12)throw new Error("Tile only support float, float16, int32, and uint32 data types");if(e[1].dataType!==7)throw new Error("Tile `repeats` input should be of int64 data type");if(e[1].dims.length!==1)throw new Error("Tile `repeats` input should be 1-D");if(Xy(e[1]).length!==e[0].dims.length)throw new Error("Tile `repeats` input should have same number of elements as rank of input data tensor")},G1=(e,n)=>{let t=[];for(let s=0;s<e.length;++s)t.push(e[s]*n[s]);return t},W1=(e,n)=>{let t=e[0].dims,s=n??Xy(e[1]),i=G1(t,s),l=je.size(i),c=e[0].dataType,u=Qe("input",c,t.length),d=At("output",c,i.length),f=m=>`
      const inputShape = ${u.indices(...t)};
      ${m.registerUniform("output_size","u32").declareVariables(u,d)}
      ${m.mainStart()}
      ${m.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.output_size")}
      let output_indices = ${d.offsetToIndices("global_idx")};
      var input_indices: ${u.type.indices};
      for (var i = 0; i < ${t.length}; i++) {
        let input_dim_i = ${u.indicesGet("uniforms.input_shape","i")};
        let input_dim_value = ${d.indicesGet("output_indices","i")}  % input_dim_i;

        ${u.indicesSet("input_indices","i","input_dim_value")}
      }
      ${d.setByOffset("global_idx",u.getByIndices("input_indices"))}
    }`;return{name:"Tile",shaderCache:{hint:`${s}`,inputDependencies:["rank"]},getRunData:()=>({outputs:[{dims:i,dataType:e[0].dataType}],dispatchGroup:{x:Math.ceil(l/64)},programUniforms:[{type:12,data:l},...zt(e[0].dims,i)]}),getShaderSource:f}},CS=e=>{V1(e.inputs),e.compute(W1(e.inputs),{inputs:[0]})}}),H1,q1,AS,D3=ct(()=>{Wt(),en(),tn(),H1=(e,n,t,s,i)=>{let l=At("output_data",i,t.length,4),c=Qe("a_data",n[1].dataType,n[1].dims.length,4),u=Qe("b_data",n[2].dataType,n[2].dims.length,4),d=Qe("c_data",n[0].dataType,n[0].dims.length,4),f,m=(_,p,y)=>`select(${p}, ${_}, ${y})`;if(!s)f=l.setByOffset("global_idx",m(c.getByOffset("global_idx"),u.getByOffset("global_idx"),d.getByOffset("global_idx")));else{let _=(p,y,v="")=>{let T=`a_data[index_a${y}][component_a${y}]`,k=`b_data[index_b${y}][component_b${y}]`,b=`bool(c_data[index_c${y}] & (0xffu << (component_c${y} * 8)))`;return`
            let output_indices${y} = ${l.offsetToIndices(`global_idx * 4u + ${y}u`)};
            let offset_a${y} = ${c.broadcastedIndicesToOffset(`output_indices${y}`,l)};
            let offset_b${y} = ${u.broadcastedIndicesToOffset(`output_indices${y}`,l)};
            let offset_c${y} = ${d.broadcastedIndicesToOffset(`output_indices${y}`,l)};
            let index_a${y} = offset_a${y} / 4u;
            let index_b${y} = offset_b${y} / 4u;
            let index_c${y} = offset_c${y} / 4u;
            let component_a${y} = offset_a${y} % 4u;
            let component_b${y} = offset_b${y} % 4u;
            let component_c${y} = offset_c${y} % 4u;
            ${p}[${y}] = ${v}(${m(T,k,b)});
          `};i===9?f=`
            var data = vec4<u32>(0);
            ${_("data",0,"u32")}
            ${_("data",1,"u32")}
            ${_("data",2,"u32")}
            ${_("data",3,"u32")}
            output_data[global_idx] = dot(vec4<u32>(0x1, 0x100, 0x10000, 0x1000000), vec4<u32>(data));`:f=`
            ${_("output_data[global_idx]",0)}
            ${_("output_data[global_idx]",1)}
            ${_("output_data[global_idx]",2)}
            ${_("output_data[global_idx]",3)}
          `}return`
        ${e.registerUniform("vec_size","u32").declareVariables(d,c,u,l)}
        ${e.mainStart()}
        ${e.guardAgainstOutOfBoundsWorkgroupSizes("uniforms.vec_size")}
        ${f}
      }`},q1=e=>{let n=e[1].dims,t=e[2].dims,s=e[0].dims,i=e[1].dataType,l=!(je.areEqual(n,t)&&je.areEqual(t,s)),c=n,u=je.size(n);if(l){let f=bf.calcShape(bf.calcShape(n,t,!1),s,!1);if(!f)throw new Error("Can't perform where op on the given tensors");c=f,u=je.size(c)}let d=Math.ceil(u/4);return{name:"Where",shaderCache:{inputDependencies:["rank","rank","rank"]},getShaderSource:f=>H1(f,e,c,l,i),getRunData:()=>({outputs:[{dims:c,dataType:i}],dispatchGroup:{x:Math.ceil(u/64/4)},programUniforms:[{type:12,data:d},...zt(s,n,t,c)]})}},AS=e=>{e.compute(q1(e.inputs))}}),PS,O3=ct(()=>{q$(),dv(),K$(),Q$(),X$(),Y$(),Z$(),a3(),r3(),i3(),o3(),l3(),c3(),u3(),d3(),f3(),h3(),p3(),m3(),_3(),g3(),y3(),v3(),b3(),w3(),KE(),M3(),x3(),T3(),E3(),S3(),uv(),C3(),JE(),A3(),P3(),k3(),YE(),$3(),uc(),fv(),D3(),PS=new Map([["Abs",[M2]],["Acos",[x2]],["Acosh",[T2]],["Add",[sE]],["ArgMax",[y2,M0]],["ArgMin",[g2,M0]],["Asin",[E2]],["Asinh",[S2]],["Atan",[C2]],["Atanh",[A2]],["Attention",[v2]],["AveragePool",[lS,oS]],["BatchNormalization",[b2]],["BiasAdd",[w2]],["BiasSplitGelu",[aE]],["Cast",[k2,P2]],["Ceil",[D2]],["Clip",[$2]],["Concat",[pE,mE]],["Conv",[A0,C0]],["ConvTranspose",[EE,TE]],["Cos",[O2]],["Cosh",[I2]],["CumSum",[SE,CE]],["DepthToSpace",[AE,PE]],["DequantizeLinear",[mS,_S]],["Div",[rE]],["Einsum",[kE,$E]],["Elu",[z2,rm]],["Equal",[iE]],["Erf",[L2]],["Exp",[F2]],["Expand",[DE]],["FastGelu",[OE]],["Floor",[N2]],["FusedConv",[A0,C0]],["Gather",[zE,IE]],["GatherElements",[BE,RE]],["GatherBlockQuantized",[NE,jE]],["GatherND",[LE,FE]],["Gelu",[j2]],["Gemm",[VE,UE]],["GlobalAveragePool",[uS,cS]],["GlobalMaxPool",[pS,hS]],["Greater",[uE]],["GreaterOrEqual",[fE]],["GridSample",[GE,WE]],["GroupQueryAttention",[eS]],["HardSigmoid",[q2,H2]],["InstanceNormalization",[tS]],["LayerNormalization",[nS]],["LeakyRelu",[R2,rm]],["Less",[dE]],["LessOrEqual",[hE]],["Log",[tE]],["MatMul",[aS]],["MatMulNBits",[sS,rS]],["MaxPool",[dS,fS]],["Mul",[oE]],["MultiHeadAttention",[qE,HE]],["Neg",[U2]],["Not",[B2]],["Pad",[iS]],["Pow",[lE]],["QuickGelu",[nE,rm]],["Range",[gS]],["Reciprocal",[V2]],["ReduceMin",[f2]],["ReduceMean",[o2]],["ReduceMax",[d2]],["ReduceSum",[p2]],["ReduceProd",[h2]],["ReduceL1",[l2]],["ReduceL2",[c2]],["ReduceLogSum",[_2]],["ReduceLogSumExp",[u2]],["ReduceSumSquare",[m2]],["Relu",[G2]],["Resize",[bS,wS]],["RotaryEmbedding",[ZE]],["ScatterND",[vS,yS]],["Sigmoid",[W2]],["Sin",[K2]],["Sinh",[Q2]],["Slice",[xS,TS]],["SkipLayerNormalization",[MS]],["Split",[QE,XE]],["Sqrt",[X2]],["Softmax",[ES,SS]],["Sub",[cE]],["Tan",[Y2]],["Tanh",[Z2]],["ThresholdedRelu",[eE,rm]],["Tile",[CS]],["Transpose",[QT,XT]],["Where",[AS]]])}),kS,I3=ct(()=>{vi(),el(),tn(),kS=class{constructor(e){this.backend=e,this.repo=new Map,this.attributesBound=!1}getArtifact(e){return this.repo.get(e)}setArtifact(e,n){this.repo.set(e,n)}run(e,n,t,s,i){yi(e.programInfo.name);let l=this.backend.device,c=this.backend.getComputePassEncoder();this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2);let u=[];for(let f of n)u.push({binding:u.length,resource:{buffer:f.buffer}});for(let f of t)u.push({binding:u.length,resource:{buffer:f.buffer}});i&&u.push({binding:u.length,resource:i});let d=l.createBindGroup({layout:e.computePipeline.getBindGroupLayout(0),entries:u,label:e.programInfo.name});if(this.backend.sessionStatus==="capturing"){let f={kernelId:this.backend.currentKernelId,computePipeline:e.computePipeline,bindGroup:d,dispatchGroup:s};this.backend.capturedCommandList.get(this.backend.currentSessionId).push(f)}c.setPipeline(e.computePipeline),c.setBindGroup(0,d),c.dispatchWorkgroups(...s),this.backend.writeTimestamp(this.backend.pendingDispatchNumber*2+1),this.backend.pendingDispatchNumber++,(this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber||this.backend.queryType==="at-passes")&&this.backend.endComputePass(),this.backend.pendingDispatchNumber>=this.backend.maxDispatchNumber&&this.backend.flush(),Rr(e.programInfo.name)}dispose(){}build(e,n){yi(e.name);let t=this.backend.device,s=[];[{feature:"shader-f16",extension:"f16"},{feature:"subgroups",extension:"subgroups"}].forEach(f=>{t.features.has(f.feature)&&s.push(`enable ${f.extension};`)});let i=KT(n,this.backend.device.limits),l=e.getShaderSource(i),c=`${s.join(`
`)}
${i.additionalImplementations}
${l}`,u=t.createShaderModule({code:c,label:e.name});yn("verbose",()=>`[WebGPU] ${e.name} shader code: ${c}`);let d=t.createComputePipeline({compute:{module:u,entryPoint:"main"},layout:"auto",label:e.name});return Rr(e.name),{programInfo:e,computePipeline:d,uniformVariablesInfo:i.variablesInfo}}normalizeDispatchGroupSize(e){let n=typeof e=="number"?e:e.x,t=typeof e=="number"?1:e.y||1,s=typeof e=="number"?1:e.z||1,i=this.backend.device.limits.maxComputeWorkgroupsPerDimension;if(n<=i&&t<=i&&s<=i)return[n,t,s];let l=n*t*s,c=Math.ceil(Math.sqrt(l));if(c>i){if(c=Math.ceil(Math.cbrt(l)),c>i)throw new Error("Total dispatch size exceeds WebGPU maximum.");return[c,c,c]}else return[c,c,1]}}}),$S={};Ef($S,{WebGpuBackend:()=>DS});var K1,Q1,X1,DS,z3=ct(()=>{vi(),Wt(),el(),VT(),W$(),O3(),I3(),K1=(e,n)=>{if(n.length!==e.length)throw new Error(`inputDependencies length ${n.length} is not equal to inputTensors length ${e.length}.`);let t=[];for(let s=0;s<e.length;++s){let i=e[s].dataType;switch(n[s]){case"none":{t.push("");break}case"type":{t.push(`${i}`);break}case"rank":{let l=e[s].dims.length;t.push(`${i};${l}`);break}case"dims":{let l=e[s].dims.join(",");t.push(`${i};${l}`);break}default:throw new Error(`unsupported input dependency: ${n[s]}`)}}return t.join("|")},Q1=(e,n,t)=>{let s=e.name;return e.shaderCache?.hint&&(s+="["+e.shaderCache.hint+"]"),s+=":"+t+`:${K1(n,e.shaderCache?.inputDependencies??new Array(n.length).fill("dims"))}`,s},X1=class{constructor(e){e&&(this.architecture=e.architecture,this.vendor=e.vendor)}isArchitecture(e){return this.architecture===e}isVendor(e){return this.vendor===e}},DS=class{constructor(){this.currentSessionId=null,this.currentKernelId=null,this.commandEncoder=null,this.computePassEncoder=null,this.maxDispatchNumber=16,this.pendingDispatchNumber=0,this.pendingKernels=[],this.pendingQueries=new Map,this.sessionStatus="default",this.capturedCommandList=new Map,this.capturedPendingKernels=new Map,this.sessionExternalDataMapping=new Map}get currentKernelCustomData(){if(this.currentKernelId===null)throw new Error("currentKernelCustomData(): currentKernelId is null. (should not happen)");let e=this.kernelCustomData.get(this.currentKernelId);return e||(e={},this.kernelCustomData.set(this.currentKernelId,e)),e}async initialize(e,n){this.env=e;let t=[],s={requiredLimits:{maxComputeWorkgroupStorageSize:n.limits.maxComputeWorkgroupStorageSize,maxComputeWorkgroupsPerDimension:n.limits.maxComputeWorkgroupsPerDimension,maxStorageBufferBindingSize:n.limits.maxStorageBufferBindingSize,maxBufferSize:n.limits.maxBufferSize,maxComputeInvocationsPerWorkgroup:n.limits.maxComputeInvocationsPerWorkgroup,maxComputeWorkgroupSizeX:n.limits.maxComputeWorkgroupSizeX,maxComputeWorkgroupSizeY:n.limits.maxComputeWorkgroupSizeY,maxComputeWorkgroupSizeZ:n.limits.maxComputeWorkgroupSizeZ},requiredFeatures:t},i=l=>n.features.has(l)&&t.push(l)&&!0;i("chromium-experimental-timestamp-query-inside-passes")||i("timestamp-query"),i("shader-f16"),i("subgroups"),this.device=await n.requestDevice(s),this.adapterInfo=new X1(n.info||await n.requestAdapterInfo()),this.gpuDataManager=HT(this),this.programManager=new kS(this),this.kernels=new Map,this.kernelPersistentData=new Map,this.kernelCustomData=new Map,iv(e.logLevel,!!e.debug),this.device.onuncapturederror=l=>{l.error instanceof GPUValidationError&&console.error(`An uncaught WebGPU validation error was raised: ${l.error.message}`)},Object.defineProperty(this.env.webgpu,"device",{value:this.device,writable:!1,enumerable:!0,configurable:!1}),Object.defineProperty(this.env.webgpu,"adapter",{value:n,writable:!1,enumerable:!0,configurable:!1}),this.setQueryType()}dispose(){typeof this.querySet<"u"&&this.querySet.destroy(),this.gpuDataManager.dispose()}getCommandEncoder(){return this.commandEncoder||(this.commandEncoder=this.device.createCommandEncoder()),this.commandEncoder}getComputePassEncoder(){if(!this.computePassEncoder){let e=this.getCommandEncoder(),n={};this.queryType==="at-passes"&&(n.timestampWrites={querySet:this.querySet,beginningOfPassWriteIndex:this.pendingDispatchNumber*2,endOfPassWriteIndex:this.pendingDispatchNumber*2+1}),this.computePassEncoder=e.beginComputePass(n)}return this.computePassEncoder}endComputePass(){this.computePassEncoder&&(this.computePassEncoder.end(),this.computePassEncoder=null)}flush(){if(!this.commandEncoder)return;yi(),this.endComputePass();let e;this.queryType!=="none"&&(this.commandEncoder.resolveQuerySet(this.querySet,0,this.pendingDispatchNumber*2,this.queryResolveBuffer,0),e=this.device.createBuffer({size:this.pendingDispatchNumber*2*8,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),this.pendingQueries.set(e,this.pendingKernels),this.pendingKernels=[],this.commandEncoder.copyBufferToBuffer(this.queryResolveBuffer,0,e,0,this.pendingDispatchNumber*2*8)),this.device.queue.submit([this.commandEncoder.finish()]),this.gpuDataManager.refreshPendingBuffers(),this.commandEncoder=null,this.pendingDispatchNumber=0,this.queryType!=="none"&&e.mapAsync(GPUMapMode.READ).then(()=>{let n=new BigUint64Array(e.getMappedRange()),t=this.pendingQueries.get(e);for(let s=0;s<n.length/2;s++){let i=t[s],l=i.kernelId,c=this.kernels.get(l),u=c.kernelType,d=c.kernelName,f=i.programName,m=i.inputTensorViews,_=i.outputTensorViews,p=n[s*2],y=n[s*2+1];typeof this.queryTimeBase>"u"&&(this.queryTimeBase=p);let v=Number(p-this.queryTimeBase),T=Number(y-this.queryTimeBase);if(!Number.isSafeInteger(v)||!Number.isSafeInteger(T))throw new RangeError("incorrect timestamp range");if(this.env.webgpu.profiling?.ondata)this.env.webgpu.profiling.ondata({version:1,inputsMetadata:m.map(k=>({dims:k.dims,dataType:qo(k.dataType)})),outputsMetadata:_.map(k=>({dims:k.dims,dataType:qo(k.dataType)})),kernelId:l,kernelType:u,kernelName:d,programName:f,startTime:v,endTime:T});else{let k="";m.forEach((S,$)=>{k+=`input[${$}]: [${S.dims}] | ${qo(S.dataType)}, `});let b="";_.forEach((S,$)=>{b+=`output[${$}]: [${S.dims}] | ${qo(S.dataType)}, `}),console.log(`[profiling] kernel "${l}|${u}|${d}|${f}" ${k}${b}execution time: ${T-v} ns`)}pm("GPU",`${f}::${p}::${y}`)}e.unmap(),this.pendingQueries.delete(e)}),Rr()}run(e,n,t,s,i,l){yi(e.name);let c=[];for(let S=0;S<n.length;++S){let $=n[S].data;if($===0)continue;let w=this.gpuDataManager.get($);if(!w)throw new Error(`no GPU data for input: ${$}`);c.push(w)}let{outputs:u,dispatchGroup:d,programUniforms:f}=e.getRunData(n),m=t.length===0?u.map((S,$)=>$):t;if(m.length!==u.length)throw new Error(`Output size ${m.length} must be equal to ${u.length}.`);let _=[],p=[];for(let S=0;S<u.length;++S){if(!Number.isInteger(m[S])||m[S]<-3||m[S]>=l)throw new Error(`Invalid output index: ${m[S]}`);if(m[S]===-3)continue;let $=m[S]===-1,w=m[S]===-2,C=$||w?i(u[S].dataType,u[S].dims):s(m[S],u[S].dataType,u[S].dims);if(_.push(C),C.data===0)continue;let P=this.gpuDataManager.get(C.data);if(!P)throw new Error(`no GPU data for output: ${C.data}`);if($&&this.temporaryData.push(P),w){let A=this.kernelPersistentData.get(this.currentKernelId);A||(A=[],this.kernelPersistentData.set(this.currentKernelId,A)),A.push(P)}p.push(P)}if(c.length!==n.length||p.length!==_.length){if(p.length===0)return Rr(e.name),_;throw new Error(`Program ${e.name} has zero-sized tensor(s) in inputs or outputs. This is not supported now.`)}let y;if(f){let S=0,$=[];f.forEach(A=>{let I=typeof A.data=="number"?[A.data]:A.data;if(I.length===0)return;let W=A.type===10?2:4,G,q;A.type===10?(q=I.length>4?16:I.length>2?8:I.length*W,G=I.length>4?16:W*I.length):(q=I.length<=2?I.length*W:16,G=16),S=Math.ceil(S/q)*q,$.push(S);let Z=A.type===10?8:4;S+=I.length>4?Math.ceil(I.length/Z)*G:I.length*W});let w=16;S=Math.ceil(S/w)*w;let C=new ArrayBuffer(S);f.forEach((A,I)=>{let W=$[I],G=typeof A.data=="number"?[A.data]:A.data;if(A.type===6)new Int32Array(C,W,G.length).set(G);else if(A.type===12)new Uint32Array(C,W,G.length).set(G);else if(A.type===10)new Uint16Array(C,W,G.length).set(G);else if(A.type===1)new Float32Array(C,W,G.length).set(G);else throw new Error(`Unsupported uniform type: ${qo(A.type)}`)});let P=this.gpuDataManager.create(S,GPUBufferUsage.COPY_DST|GPUBufferUsage.UNIFORM);this.device.queue.writeBuffer(P.buffer,0,C,0,S),this.gpuDataManager.release(P.id),y={offset:0,size:S,buffer:P.buffer}}let v=this.programManager.normalizeDispatchGroupSize(d),T=v[1]===1&&v[2]===1,k=Q1(e,n,T),b=this.programManager.getArtifact(k);if(b||(b=this.programManager.build(e,v),this.programManager.setArtifact(k,b),yn("info",()=>`[artifact] key: ${k}, programName: ${e.name}`)),f&&b.uniformVariablesInfo){if(f.length!==b.uniformVariablesInfo.length)throw new Error(`Uniform variables count mismatch: expect ${b.uniformVariablesInfo.length}, got ${f.length} in program "${b.programInfo.name}".`);for(let S=0;S<f.length;S++){let $=f[S],w=$.type,C=typeof $.data=="number"?1:$.data.length,[P,A]=b.uniformVariablesInfo[S];if(w!==P||C!==A)throw new Error(`Uniform variable ${S} mismatch: expect type ${P} with size ${A}, got type ${w} with size ${C} in program "${b.programInfo.name}".`)}}if(yn("info",()=>`[ProgramManager] run "${e.name}" (key=${k}) with ${v[0]}x${v[1]}x${v[2]}`),this.queryType!=="none"||this.sessionStatus==="capturing"){let S={kernelId:this.currentKernelId,programName:b.programInfo.name,inputTensorViews:n,outputTensorViews:_};this.pendingKernels.push(S),this.sessionStatus==="capturing"&&this.capturedPendingKernels.get(this.currentSessionId).push(S)}return this.programManager.run(b,c,p,v,y),Rr(e.name),_}upload(e,n){this.gpuDataManager.upload(e,n)}memcpy(e,n){this.gpuDataManager.memcpy(e,n)}async download(e,n){await this.gpuDataManager.download(e,n)}alloc(e){return this.gpuDataManager.create(e).id}free(e){return this.gpuDataManager.release(e)}createKernel(e,n,t,s){let i=PS.get(e);if(!i)throw new Error(`kernel not implemented: ${e}`);let l={kernelType:e,kernelName:s,kernelEntry:i[0],attributes:[i[1],t]};this.kernels.set(n,l)}releaseKernel(e){let n=this.kernelPersistentData.get(e);if(n){for(let t of n)this.gpuDataManager.release(t.id);this.kernelPersistentData.delete(e)}this.kernelCustomData.delete(e),this.kernels.delete(e)}computeKernel(e,n,t){let s=this.kernels.get(e);if(!s)throw new Error(`kernel not created: ${e}`);let i=s.kernelType,l=s.kernelName,c=s.kernelEntry,u=s.attributes;if(this.currentKernelId!==null)throw new Error(`kernel "[${i}] ${l}" is not allowed to be called recursively`);this.currentKernelId=e,u[0]&&(u[1]=u[0](u[1]),u[0]=void 0),yn("info",()=>`[WebGPU] Start to run kernel "[${i}] ${l}"...`);let d=this.env.debug;this.temporaryData=[];try{return d&&this.device.pushErrorScope("validation"),c(n,u[1]),0}catch(f){return t.push(Promise.resolve(`[WebGPU] Kernel "[${i}] ${l}" failed. ${f}`)),1}finally{d&&t.push(this.device.popErrorScope().then(f=>f?`GPU validation error for kernel "[${i}] ${l}": ${f.message}`:null));for(let f of this.temporaryData)this.gpuDataManager.release(f.id);this.temporaryData=[],this.currentKernelId=null}}registerBuffer(e,n,t,s){let i=this.sessionExternalDataMapping.get(e);i||(i=new Map,this.sessionExternalDataMapping.set(e,i));let l=i.get(n),c=this.gpuDataManager.registerExternalBuffer(t,s,l);return i.set(n,[c,t]),c}unregisterBuffers(e){let n=this.sessionExternalDataMapping.get(e);n&&(n.forEach(t=>this.gpuDataManager.unregisterExternalBuffer(t[0])),this.sessionExternalDataMapping.delete(e))}getBuffer(e){let n=this.gpuDataManager.get(e);if(!n)throw new Error(`no GPU data for buffer: ${e}`);return n.buffer}createDownloader(e,n,t){return async()=>{let s=await v0(this,e,n);return ov(s.buffer,t)}}writeTimestamp(e){this.queryType==="inside-passes"&&this.computePassEncoder.writeTimestamp(this.querySet,e)}setQueryType(){this.queryType="none",(this.env.webgpu.profiling?.mode==="default"||(typeof this.env.trace>"u"?this.env.wasm.trace:this.env.trace))&&(this.device.features.has("chromium-experimental-timestamp-query-inside-passes")?this.queryType="inside-passes":this.device.features.has("timestamp-query")&&(this.queryType="at-passes"),this.queryType!=="none"&&typeof this.querySet>"u"&&(this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxDispatchNumber*2}),this.queryResolveBuffer=this.device.createBuffer({size:this.maxDispatchNumber*2*8,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.QUERY_RESOLVE})))}captureBegin(){yn("info","captureBegin"),this.capturedCommandList.get(this.currentSessionId)||this.capturedCommandList.set(this.currentSessionId,[]),this.capturedPendingKernels.get(this.currentSessionId)||this.capturedPendingKernels.set(this.currentSessionId,[]),this.flush(),this.sessionStatus="capturing"}captureEnd(){yn("info","captureEnd"),this.flush(),this.sessionStatus="default"}replay(){yn("info","replay"),this.sessionStatus="replaying";let e=this.capturedCommandList.get(this.currentSessionId),n=this.capturedPendingKernels.get(this.currentSessionId),t=e.length;this.pendingKernels=[];for(let s=0;s<t;s++){let i=this.getComputePassEncoder(),l=e[s];this.writeTimestamp(this.pendingDispatchNumber*2),i.setPipeline(l.computePipeline),i.setBindGroup(0,l.bindGroup),i.dispatchWorkgroups(...l.dispatchGroup),this.writeTimestamp(this.pendingDispatchNumber*2+1),this.pendingDispatchNumber++,this.queryType!=="none"&&this.pendingKernels.push(n[s]),(this.pendingDispatchNumber>=this.maxDispatchNumber||this.queryType==="at-passes")&&this.endComputePass(),this.pendingDispatchNumber>=this.maxDispatchNumber&&this.flush()}this.flush(),this.sessionStatus="default"}onCreateSession(){this.gpuDataManager.onCreateSession()}onReleaseSession(e){this.unregisterBuffers(e),this.capturedCommandList.has(e)&&this.capturedCommandList.delete(e),this.capturedPendingKernels.has(e)&&this.capturedPendingKernels.delete(e),this.gpuDataManager.onReleaseSession(e)}onRunStart(e){this.currentSessionId=e,this.setQueryType()}}}),OS={};Ef(OS,{init:()=>IS});var k_,Y1,IS,L3=ct(()=>{Wt(),el(),en(),G$(),k_=class zS{constructor(n,t,s,i){this.module=n,this.dataType=t,this.data=s,this.dims=i}getFloat32Array(){if(this.dataType!==1)throw new Error("Invalid data type");let n=je.size(this.dims);return n===0?new Float32Array:new Float32Array(this.module.HEAP8.buffer,this.data,n)}getBigInt64Array(){if(this.dataType!==7)throw new Error("Invalid data type");let n=je.size(this.dims);return n===0?new BigInt64Array:new BigInt64Array(this.module.HEAP8.buffer,this.data,n)}getInt32Array(){if(this.dataType!==6)throw new Error("Invalid data type");let n=je.size(this.dims);return n===0?new Int32Array:new Int32Array(this.module.HEAP8.buffer,this.data,n)}getUint16Array(){if(this.dataType!==10&&this.dataType!==4)throw new Error("Invalid data type");let n=je.size(this.dims);return n===0?new Uint16Array:new Uint16Array(this.module.HEAP8.buffer,this.data,n)}reshape(n){if(je.size(n)!==je.size(this.dims))throw new Error("Invalid new shape");return new zS(this.module,this.dataType,this.data,n)}},Y1=class{constructor(e,n,t){this.module=e,this.backend=n,this.customDataOffset=0,this.customDataSize=0,this.adapterInfo=n.adapterInfo;let s=e.PTR_SIZE,i=t/e.PTR_SIZE,l=s===4?"i32":"i64";this.opKernelContext=Number(e.getValue(s*i++,l));let c=Number(e.getValue(s*i++,l));this.outputCount=Number(e.getValue(s*i++,l)),this.customDataOffset=Number(e.getValue(s*i++,"*")),this.customDataSize=Number(e.getValue(s*i++,l));let u=[];for(let d=0;d<c;d++){let f=Number(e.getValue(s*i++,l)),m=Number(e.getValue(s*i++,"*")),_=Number(e.getValue(s*i++,l)),p=[];for(let y=0;y<_;y++)p.push(Number(e.getValue(s*i++,l)));u.push(new k_(e,f,m,p))}this.inputs=u}get kernelCustomData(){return this.backend.currentKernelCustomData}get customDataBuffer(){return this.module.HEAPU8.subarray(this.customDataOffset,this.customDataOffset+this.customDataSize)}compute(e,n){let t=n?.inputs?.map(c=>typeof c=="number"?this.inputs[c]:c)??this.inputs,s=n?.outputs??[],i=(c,u,d)=>new k_(this.module,u,this.output(c,d),d),l=(c,u)=>{let d=vu(c,u);if(!d)throw new Error(`Unsupported data type: ${c}`);let f=d>0?this.backend.gpuDataManager.create(d).id:0;return new k_(this.module,c,f,u)};return this.backend.run(e,t,s,i,l,this.outputCount)}output(e,n){let t=this.module.stackSave();try{let s=this.module.PTR_SIZE,i=s===4?"i32":"i64",l=this.module.stackAlloc((1+n.length)*s);this.module.setValue(l,n.length,i);for(let c=0;c<n.length;c++)this.module.setValue(l+s*(c+1),n[c],i);return this.module._JsepOutput(this.opKernelContext,e,l)}catch(s){throw new Error(`Failed to generate kernel's output[${e}] with dims [${n}]. If you are running with pre-allocated output, please make sure the output type/dims are correct. Error: ${s}`)}finally{this.module.stackRestore(t)}}},IS=async(e,n,t,s)=>{let i=n.jsepInit;if(!i)throw new Error("Failed to initialize JSEP. The WebAssembly module is not built with JSEP support.");if(e==="webgpu"){let l=(z3(),hm($S)).WebGpuBackend,c=new l;await c.initialize(t,s),i("webgpu",[c,u=>c.alloc(Number(u)),u=>c.free(u),(u,d,f,m=!1)=>{if(m)yn("verbose",()=>`[WebGPU] jsepCopyGpuToGpu: src=${Number(u)}, dst=${Number(d)}, size=${Number(f)}`),c.memcpy(Number(u),Number(d));else{yn("verbose",()=>`[WebGPU] jsepCopyCpuToGpu: dataOffset=${Number(u)}, gpuDataId=${Number(d)}, size=${Number(f)}`);let _=n.HEAPU8.subarray(Number(u>>>0),Number(u>>>0)+Number(f));c.upload(Number(d),_)}},async(u,d,f)=>{yn("verbose",()=>`[WebGPU] jsepCopyGpuToCpu: gpuDataId=${u}, dataOffset=${d}, size=${f}`),await c.download(Number(u),()=>n.HEAPU8.subarray(Number(d)>>>0,Number(d+f)>>>0))},(u,d,f)=>c.createKernel(u,Number(d),f,n.UTF8ToString(n._JsepGetNodeName(Number(d)))),u=>c.releaseKernel(u),(u,d,f,m)=>{yn("verbose",()=>`[WebGPU] jsepRun: sessionHandle=${f}, kernel=${u}, contextDataOffset=${d}`);let _=new Y1(n,c,Number(d));return c.computeKernel(Number(u),_,m)},()=>c.captureBegin(),()=>c.captureEnd(),()=>c.replay()])}else{let l=new WT(t);i("webnn",[l,()=>l.reserveTensorId(),c=>l.releaseTensorId(c),async(c,u,d,f,m)=>l.ensureTensor(c,u,d,f,m),(c,u)=>{l.uploadTensor(c,u)},async(c,u)=>l.downloadTensor(c,u)])}}}),Z1,yv,vv,nc,J1,Yy,og,bv,wv,Zy,Mv,xv,Tv,LS=ct(()=>{B$(),U$(),Wt(),ku(),tv(),jT(),Z1=(e,n)=>{aa()._OrtInit(e,n)!==0&&Un("Can't initialize onnxruntime.")},yv=async e=>{Z1(e.wasm.numThreads,ng(e.logLevel))},vv=async(e,n)=>{aa().asyncInit?.();{let t=(L3(),hm(OS)).init;if(n==="webgpu"){if(typeof navigator>"u"||!navigator.gpu)throw new Error("WebGPU is not supported in current environment");let s=e.webgpu.adapter;if(s){if(typeof s.limits!="object"||typeof s.features!="object"||typeof s.requestDevice!="function")throw new Error("Invalid GPU adapter set in `env.webgpu.adapter`. It must be a GPUAdapter object.")}else{let i=e.webgpu.powerPreference;if(i!==void 0&&i!=="low-power"&&i!=="high-performance")throw new Error(`Invalid powerPreference setting: "${i}"`);let l=e.webgpu.forceFallbackAdapter;if(l!==void 0&&typeof l!="boolean")throw new Error(`Invalid forceFallbackAdapter setting: "${l}"`);if(s=await navigator.gpu.requestAdapter({powerPreference:i,forceFallbackAdapter:l}),!s)throw new Error('Failed to get GPU adapter. You may need to enable flag "--enable-unsafe-webgpu" if you are using Chrome.')}await t("webgpu",aa(),e,s)}if(n==="webnn"){if(typeof navigator>"u"||!navigator.ml)throw new Error("WebNN is not supported in current environment");await t("webnn",aa(),e)}}},nc=new Map,J1=e=>{let n=aa(),t=n.stackSave();try{let s=n.PTR_SIZE,i=n.stackAlloc(2*s);n._OrtGetInputOutputCount(e,i,i+s)!==0&&Un("Can't get session input/output count.");let l=s===4?"i32":"i64";return[Number(n.getValue(i,l)),Number(n.getValue(i+s,l))]}finally{n.stackRestore(t)}},Yy=(e,n)=>{let t=aa(),s=t.stackSave(),i=0;try{let l=t.PTR_SIZE,c=t.stackAlloc(2*l);t._OrtGetInputOutputMetadata(e,n,c,c+l)!==0&&Un("Can't get session input/output metadata.");let u=Number(t.getValue(c,"*"));i=Number(t.getValue(c+l,"*"));let d=t.HEAP32[i/4];if(d===0)return[u,0];let f=t.HEAPU32[i/4+1],m=[];for(let _=0;_<f;_++){let p=Number(t.getValue(i+8+_*l,"*"));m.push(p!==0?t.UTF8ToString(p):Number(t.getValue(i+8+(_+f)*l,"*")))}return[u,d,m]}finally{t.stackRestore(s),i!==0&&t._OrtFree(i)}},og=e=>{let n=aa(),t=n._malloc(e.byteLength);if(t===0)throw new Error(`Can't create a session. failed to allocate a buffer of size ${e.byteLength}.`);return n.HEAPU8.set(e,t),[t,e.byteLength]},bv=async(e,n)=>{let t,s,i=aa();Array.isArray(e)?[t,s]=e:e.buffer===i.HEAPU8.buffer?[t,s]=[e.byteOffset,e.byteLength]:[t,s]=og(e);let l=0,c=0,u=0,d=[],f=[],m=[];try{if([c,d]=await NT(n),n?.externalData&&i.mountExternalData){let w=[];for(let C of n.externalData){let P=typeof C=="string"?C:C.path;w.push(rv(typeof C=="string"?C:C.data).then(A=>{i.mountExternalData(P,A)}))}await Promise.all(w)}for(let w of n?.executionProviders??[])if((typeof w=="string"?w:w.name)==="webnn"){if(i.shouldTransferToMLTensor=!1,typeof w!="string"){let C=w,P=C?.context,A=C?.gpuDevice,I=C?.deviceType,W=C?.powerPreference;P?i.currentContext=P:A?i.currentContext=await i.webnnCreateMLContext(A):i.currentContext=await i.webnnCreateMLContext({deviceType:I,powerPreference:W})}else i.currentContext=await i.webnnCreateMLContext();break}l=await i._OrtCreateSession(t,s,c),i.webgpuOnCreateSession?.(l),l===0&&Un("Can't create a session."),i.jsepOnCreateSession?.(),i.currentContext&&(i.webnnRegisterMLContext(l,i.currentContext),i.currentContext=void 0,i.shouldTransferToMLTensor=!0);let[_,p]=J1(l),y=!!n?.enableGraphCapture,v=[],T=[],k=[],b=[],S=[];for(let w=0;w<_;w++){let[C,P,A]=Yy(l,w);C===0&&Un("Can't get an input name."),f.push(C);let I=i.UTF8ToString(C);v.push(I),k.push(P===0?{name:I,isTensor:!1}:{name:I,isTensor:!0,type:qo(P),shape:A})}for(let w=0;w<p;w++){let[C,P,A]=Yy(l,w+_);C===0&&Un("Can't get an output name."),m.push(C);let I=i.UTF8ToString(C);T.push(I),b.push(P===0?{name:I,isTensor:!1}:{name:I,isTensor:!0,type:qo(P),shape:A});{if(y&&n?.preferredOutputLocation===void 0){S.push("gpu-buffer");continue}let W=typeof n?.preferredOutputLocation=="string"?n.preferredOutputLocation:n?.preferredOutputLocation?.[I]??"cpu";if(W!=="cpu"&&W!=="cpu-pinned"&&W!=="gpu-buffer"&&W!=="ml-tensor")throw new Error(`Not supported preferred output location: ${W}.`);if(y&&W!=="gpu-buffer")throw new Error(`Not supported preferred output location: ${W}. Only 'gpu-buffer' location is supported when enableGraphCapture is true.`);S.push(W)}}let $=null;return S.some(w=>w==="gpu-buffer"||w==="ml-tensor")&&(u=i._OrtCreateBinding(l),u===0&&Un("Can't create IO binding."),$={handle:u,outputPreferredLocations:S,outputPreferredLocationsEncoded:S.map(w=>g0(w))}),nc.set(l,[l,f,m,$,y,!1]),[l,v,T,k,b]}catch(_){throw f.forEach(p=>i._OrtFree(p)),m.forEach(p=>i._OrtFree(p)),u!==0&&i._OrtReleaseBinding(u)!==0&&Un("Can't release IO binding."),l!==0&&i._OrtReleaseSession(l)!==0&&Un("Can't release session."),_}finally{i._free(t),c!==0&&i._OrtReleaseSessionOptions(c)!==0&&Un("Can't release session options."),d.forEach(_=>i._free(_)),i.unmountExternalData?.()}},wv=e=>{let n=aa(),t=nc.get(e);if(!t)throw new Error(`cannot release session. invalid session id: ${e}`);let[s,i,l,c,u]=t;c&&(u&&n._OrtClearBoundOutputs(c.handle)!==0&&Un("Can't clear bound outputs."),n._OrtReleaseBinding(c.handle)!==0&&Un("Can't release IO binding.")),n.jsepOnReleaseSession?.(e),n.webnnOnReleaseSession?.(e),n.webgpuOnReleaseSession?.(e),i.forEach(d=>n._OrtFree(d)),l.forEach(d=>n._OrtFree(d)),n._OrtReleaseSession(s)!==0&&Un("Can't release session."),nc.delete(e)},Zy=async(e,n,t,s,i,l,c=!1)=>{if(!e){n.push(0);return}let u=aa(),d=u.PTR_SIZE,f=e[0],m=e[1],_=e[3],p=_,y,v;if(f==="string"&&(_==="gpu-buffer"||_==="ml-tensor"))throw new Error("String tensor is not supported on GPU.");if(c&&_!=="gpu-buffer")throw new Error(`External buffer must be provided for input/output index ${l} when enableGraphCapture is true.`);if(_==="gpu-buffer"){let b=e[2].gpuBuffer;v=vu(mf(f),m);{let S=u.jsepRegisterBuffer;if(!S)throw new Error('Tensor location "gpu-buffer" is not supported without using WebGPU.');y=S(s,l,b,v)}}else if(_==="ml-tensor"){let b=e[2].mlTensor;v=vu(mf(f),m);let S=u.webnnRegisterMLTensor;if(!S)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');y=S(s,b,mf(f),m)}else{let b=e[2];if(Array.isArray(b)){v=d*b.length,y=u._malloc(v),t.push(y);for(let S=0;S<b.length;S++){if(typeof b[S]!="string")throw new TypeError(`tensor data at index ${S} is not a string`);u.setValue(y+S*d,hi(b[S],t),"*")}}else{let S=u.webnnIsGraphInput;if(f!=="string"&&S){let $=u.UTF8ToString(i);if(S(s,$)){let w=mf(f);v=vu(w,m),p="ml-tensor";let C=u.webnnCreateTemporaryTensor,P=u.webnnUploadTensor;if(!C||!P)throw new Error('Tensor location "ml-tensor" is not supported without using WebNN.');let A=await C(s,w,m);P(A,new Uint8Array(b.buffer,b.byteOffset,b.byteLength)),y=A}else v=b.byteLength,y=u._malloc(v),t.push(y),u.HEAPU8.set(new Uint8Array(b.buffer,b.byteOffset,v),y)}else v=b.byteLength,y=u._malloc(v),t.push(y),u.HEAPU8.set(new Uint8Array(b.buffer,b.byteOffset,v),y)}}let T=u.stackSave(),k=u.stackAlloc(4*m.length);try{m.forEach((S,$)=>u.setValue(k+$*d,S,d===4?"i32":"i64"));let b=u._OrtCreateTensor(mf(f),y,v,k,m.length,g0(p));b===0&&Un(`Can't create tensor for input/output. session=${s}, index=${l}.`),n.push(b)}finally{u.stackRestore(T)}},Mv=async(e,n,t,s,i,l)=>{let c=aa(),u=c.PTR_SIZE,d=nc.get(e);if(!d)throw new Error(`cannot run inference. invalid session id: ${e}`);let f=d[0],m=d[1],_=d[2],p=d[3],y=d[4],v=d[5],T=n.length,k=s.length,b=0,S=[],$=[],w=[],C=[],P=c.stackSave(),A=c.stackAlloc(T*u),I=c.stackAlloc(T*u),W=c.stackAlloc(k*u),G=c.stackAlloc(k*u);try{[b,S]=FT(l);for(let X=0;X<T;X++)await Zy(t[X],$,C,e,m[n[X]],n[X],y);for(let X=0;X<k;X++)await Zy(i[X],w,C,e,_[s[X]],T+s[X],y);for(let X=0;X<T;X++)c.setValue(A+X*u,$[X],"*"),c.setValue(I+X*u,m[n[X]],"*");for(let X=0;X<k;X++)c.setValue(W+X*u,w[X],"*"),c.setValue(G+X*u,_[s[X]],"*");if(p&&!v){let{handle:X,outputPreferredLocations:Q,outputPreferredLocationsEncoded:te}=p;if(m.length!==T)throw new Error(`input count from feeds (${T}) is expected to be always equal to model's input count (${m.length}).`);for(let R=0;R<T;R++){let ee=n[R];await c._OrtBindInput(X,m[ee],$[R])!==0&&Un(`Can't bind input[${R}] for session=${e}.`)}for(let R=0;R<k;R++){let ee=s[R];i[R]?.[3]?c._OrtBindOutput(X,_[ee],w[R],0)!==0&&Un(`Can't bind pre-allocated output[${R}] for session=${e}.`):c._OrtBindOutput(X,_[ee],0,te[ee])!==0&&Un(`Can't bind output[${R}] to ${Q[R]} for session=${e}.`)}nc.set(e,[f,m,_,p,y,!0])}c.jsepOnRunStart?.(f),c.webnnOnRunStart?.(f);let q;p?q=await c._OrtRunWithBinding(f,p.handle,k,W,b):q=await c._OrtRun(f,I,A,T,G,k,W,b),q!==0&&Un("failed to call OrtRun().");let Z=[];for(let X=0;X<k;X++){let Q=Number(c.getValue(W+X*u,"*"));if(Q===w[X]){Z.push(i[X]);continue}let te=c.stackSave(),R=c.stackAlloc(4*u),ee=!1,ie,he=0;try{c._OrtGetTensorData(Q,R,R+u,R+2*u,R+3*u)!==0&&Un(`Can't access output tensor data on index ${X}.`);let _e=u===4?"i32":"i64",U=Number(c.getValue(R,_e));he=c.getValue(R+u,"*");let K=c.getValue(R+u*2,"*"),H=Number(c.getValue(R+u*3,_e)),B=[];for(let Pe=0;Pe<H;Pe++)B.push(Number(c.getValue(K+Pe*u,_e)));c._OrtFree(K)!==0&&Un("Can't free memory for tensor dims.");let ce=B.reduce((Pe,ze)=>Pe*ze,1);ie=qo(U);let ve=p?.outputPreferredLocations[s[X]];if(ie==="string"){if(ve==="gpu-buffer"||ve==="ml-tensor")throw new Error("String tensor is not supported on GPU.");let Pe=[];for(let ze=0;ze<ce;ze++){let Ze=c.getValue(he+ze*u,"*"),Re=c.getValue(he+(ze+1)*u,"*"),de=ze===ce-1?void 0:Re-Ze;Pe.push(c.UTF8ToString(Ze,de))}Z.push([ie,B,Pe,"cpu"])}else if(ve==="gpu-buffer"&&ce>0){let Pe=c.jsepGetBuffer;if(!Pe)throw new Error('preferredLocation "gpu-buffer" is not supported without using WebGPU.');let ze=Pe(he),Ze=vu(U,ce);if(Ze===void 0||!av(ie))throw new Error(`Unsupported data type: ${ie}`);ee=!0,Z.push([ie,B,{gpuBuffer:ze,download:c.jsepCreateDownloader(ze,Ze,ie),dispose:()=>{c._OrtReleaseTensor(Q)!==0&&Un("Can't release tensor.")}},"gpu-buffer"])}else if(ve==="ml-tensor"&&ce>0){let Pe=c.webnnEnsureTensor,ze=c.webnnIsInt64Supported;if(!Pe||!ze)throw new Error('preferredLocation "ml-tensor" is not supported without using WebNN.');if(vu(U,ce)===void 0||!sv(ie))throw new Error(`Unsupported data type: ${ie}`);if(ie==="int64"&&!ze(e))throw new Error('preferredLocation "ml-tensor" for int64 output is not supported by current WebNN Context.');let Ze=await Pe(e,he,U,B,!1);ee=!0,Z.push([ie,B,{mlTensor:Ze,download:c.webnnCreateMLTensorDownloader(he,ie),dispose:()=>{c.webnnReleaseTensorId(he),c._OrtReleaseTensor(Q)}},"ml-tensor"])}else{let Pe=nv(ie),ze=new Pe(ce);new Uint8Array(ze.buffer,ze.byteOffset,ze.byteLength).set(c.HEAPU8.subarray(he,he+ze.byteLength)),Z.push([ie,B,ze,"cpu"])}}finally{c.stackRestore(te),ie==="string"&&he&&c._free(he),ee||c._OrtReleaseTensor(Q),c.webnnOnRunEnd?.(f)}}return p&&!y&&(c._OrtClearBoundOutputs(p.handle)!==0&&Un("Can't clear bound outputs."),nc.set(e,[f,m,_,p,y,!1])),Z}finally{c.stackRestore(P),$.forEach(q=>c._OrtReleaseTensor(q)),w.forEach(q=>c._OrtReleaseTensor(q)),C.forEach(q=>c._free(q)),b!==0&&c._OrtReleaseRunOptions(b),S.forEach(q=>c._free(q))}},xv=e=>{let n=aa(),t=nc.get(e);if(!t)throw new Error("invalid session id");let s=t[0],i=n._OrtEndProfiling(s);i===0&&Un("Can't get an profile file name."),n._OrtFree(i)},Tv=e=>{let n=[];for(let t of e){let s=t[2];!Array.isArray(s)&&"buffer"in s&&n.push(s.buffer)}return n}}),ac,Fr,ff,Yp,Zp,$_,Jy,D_,pu,mu,ex,FS,NS,jS,RS,BS,US,VS,GS=ct(()=>{vi(),LS(),ku(),J0(),ac=()=>!!da.wasm.proxy&&typeof document<"u",ff=!1,Yp=!1,Zp=!1,D_=new Map,pu=(e,n)=>{let t=D_.get(e);t?t.push(n):D_.set(e,[n])},mu=()=>{if(ff||!Yp||Zp||!Fr)throw new Error("worker not ready")},ex=e=>{switch(e.data.type){case"init-wasm":ff=!1,e.data.err?(Zp=!0,Jy[1](e.data.err)):(Yp=!0,Jy[0]()),$_&&(URL.revokeObjectURL($_),$_=void 0);break;case"init-ep":case"copy-from":case"create":case"release":case"run":case"end-profiling":{let n=D_.get(e.data.type);e.data.err?n.shift()[1](e.data.err):n.shift()[0](e.data.out);break}}},FS=async()=>{if(!Yp){if(ff)throw new Error("multiple calls to 'initWasm()' detected.");if(Zp)throw new Error("previous call to 'initWasm()' failed.");if(ff=!0,ac())return new Promise((e,n)=>{Fr?.terminate(),zT().then(([t,s])=>{try{Fr=s,Fr.onerror=l=>n(l),Fr.onmessage=ex,Jy=[e,n];let i={type:"init-wasm",in:da};!i.in.wasm.wasmPaths&&(t||_0)&&(i.in.wasm.wasmPaths={wasm:new URL("/QalqanAI/assets/ort-wasm-simd-threaded.jsep-B0T3yYHD.wasm",import.meta.url).href}),Fr.postMessage(i),$_=t}catch(i){n(i)}},n)});try{await ev(da.wasm),await yv(da),Yp=!0}catch(e){throw Zp=!0,e}finally{ff=!1}}},NS=async e=>{if(ac())return mu(),new Promise((n,t)=>{pu("init-ep",[n,t]);let s={type:"init-ep",in:{epName:e,env:da}};Fr.postMessage(s)});await vv(da,e)},jS=async e=>ac()?(mu(),new Promise((n,t)=>{pu("copy-from",[n,t]);let s={type:"copy-from",in:{buffer:e}};Fr.postMessage(s,[e.buffer])})):og(e),RS=async(e,n)=>{if(ac()){if(n?.preferredOutputLocation)throw new Error('session option "preferredOutputLocation" is not supported for proxy.');return mu(),new Promise((t,s)=>{pu("create",[t,s]);let i={type:"create",in:{model:e,options:{...n}}},l=[];e instanceof Uint8Array&&l.push(e.buffer),Fr.postMessage(i,l)})}else return bv(e,n)},BS=async e=>{if(ac())return mu(),new Promise((n,t)=>{pu("release",[n,t]);let s={type:"release",in:e};Fr.postMessage(s)});wv(e)},US=async(e,n,t,s,i,l)=>{if(ac()){if(t.some(c=>c[3]!=="cpu"))throw new Error("input tensor on GPU is not supported for proxy.");if(i.some(c=>c))throw new Error("pre-allocated output tensor is not supported for proxy.");return mu(),new Promise((c,u)=>{pu("run",[c,u]);let d=t,f={type:"run",in:{sessionId:e,inputIndices:n,inputs:d,outputIndices:s,options:l}};Fr.postMessage(f,Tv(d))})}else return Mv(e,n,t,s,i,l)},VS=async e=>{if(ac())return mu(),new Promise((n,t)=>{pu("end-profiling",[n,t]);let s={type:"end-profiling",in:e};Fr.postMessage(s)});xv(e)}}),e0,tx,WS,F3=ct(()=>{vi(),GS(),Wt(),Z0(),jT(),e0=(e,n)=>{switch(e.location){case"cpu":return[e.type,e.dims,e.data,"cpu"];case"gpu-buffer":return[e.type,e.dims,{gpuBuffer:e.gpuBuffer},"gpu-buffer"];case"ml-tensor":return[e.type,e.dims,{mlTensor:e.mlTensor},"ml-tensor"];default:throw new Error(`invalid data location: ${e.location} for ${n()}`)}},tx=e=>{switch(e[3]){case"cpu":return new pi(e[0],e[2],e[1]);case"gpu-buffer":{let n=e[0];if(!av(n))throw new Error(`not supported data type: ${n} for deserializing GPU tensor`);let{gpuBuffer:t,download:s,dispose:i}=e[2];return pi.fromGpuBuffer(t,{dataType:n,dims:e[1],download:s,dispose:i})}case"ml-tensor":{let n=e[0];if(!sv(n))throw new Error(`not supported data type: ${n} for deserializing MLTensor tensor`);let{mlTensor:t,download:s,dispose:i}=e[2];return pi.fromMLTensor(t,{dataType:n,dims:e[1],download:s,dispose:i})}default:throw new Error(`invalid data location: ${e[3]}`)}},WS=class{async fetchModelAndCopyToWasmMemory(e){return jS(await rv(e))}async loadModel(e,n){yi();let t;typeof e=="string"?t=await this.fetchModelAndCopyToWasmMemory(e):t=e,[this.sessionId,this.inputNames,this.outputNames,this.inputMetadata,this.outputMetadata]=await RS(t,n),Rr()}async dispose(){return BS(this.sessionId)}async run(e,n,t){yi();let s=[],i=[];Object.entries(e).forEach(_=>{let p=_[0],y=_[1],v=this.inputNames.indexOf(p);if(v===-1)throw new Error(`invalid input '${p}'`);s.push(y),i.push(v)});let l=[],c=[];Object.entries(n).forEach(_=>{let p=_[0],y=_[1],v=this.outputNames.indexOf(p);if(v===-1)throw new Error(`invalid output '${p}'`);l.push(y),c.push(v)});let u=s.map((_,p)=>e0(_,()=>`input "${this.inputNames[i[p]]}"`)),d=l.map((_,p)=>_?e0(_,()=>`output "${this.outputNames[c[p]]}"`):null),f=await US(this.sessionId,i,u,c,d,t),m={};for(let _=0;_<f.length;_++)m[this.outputNames[c[_]]]=l[_]??tx(f[_]);return Rr(),m}startProfiling(){}endProfiling(){VS(this.sessionId)}}}),HS={};Ef(HS,{OnnxruntimeWebAssemblyBackend:()=>$0,initializeFlags:()=>k0,wasmBackend:()=>qS});var k0,$0,qS,N3=ct(()=>{vi(),GS(),F3(),k0=()=>{(typeof da.wasm.initTimeout!="number"||da.wasm.initTimeout<0)&&(da.wasm.initTimeout=0);let e=da.wasm.simd;if(typeof e!="boolean"&&e!==void 0&&e!=="fixed"&&e!=="relaxed"&&(console.warn(`Property "env.wasm.simd" is set to unknown value "${e}". Reset it to \`false\` and ignore SIMD feature checking.`),da.wasm.simd=!1),typeof da.wasm.proxy!="boolean"&&(da.wasm.proxy=!1),typeof da.wasm.trace!="boolean"&&(da.wasm.trace=!1),typeof da.wasm.numThreads!="number"||!Number.isInteger(da.wasm.numThreads)||da.wasm.numThreads<=0)if(typeof self<"u"&&!self.crossOriginIsolated)da.wasm.numThreads=1;else{let n=typeof navigator>"u"?T$("node:os").cpus().length:navigator.hardwareConcurrency;da.wasm.numThreads=Math.min(4,Math.ceil((n||1)/2))}},$0=class{async init(e){k0(),await FS(),await NS(e)}async createInferenceSessionHandler(e,n){let t=new WS;return await t.loadModel(e,n),t}},qS=new $0});vi();vi();vi();var j3="1.22.0-dev.20250409-89f8206ba4",R3=PT;{let e=(N3(),hm(HS)).wasmBackend;bu("webgpu",e,5),bu("webnn",e,5),bu("cpu",e,10),bu("wasm",e,10)}Object.defineProperty(da.versions,"web",{value:j3,enumerable:!0});const B3=Object.freeze(Object.defineProperty({__proto__:null,get InferenceSession(){return Y0},get TRACE(){return pm},get TRACE_FUNC_BEGIN(){return yi},get TRACE_FUNC_END(){return Rr},get Tensor(){return pi},default:R3,get env(){return da},get registerBackend(){return bu}},Symbol.toStringTag,{value:"Module"}));var t0={},U3={"onnxruntime-common":(e=>{e.exports=b$}),"onnxruntime-web":(e=>{e.exports=B3}),"?2ce3":(()=>{}),"?7992":(()=>{}),"?5af5":(()=>{}),"?2b25":(()=>{}),"?db59":(()=>{}),"?383f":(()=>{}),"?fa4b":(()=>{}),"./node_modules/@huggingface/jinja/dist/index.js":((e,n,t)=>{t.r(n),t.d(n,{Environment:()=>St,Interpreter:()=>Mn,Template:()=>Zs,parse:()=>Pe,tokenize:()=>_});var s=Object.freeze({Text:"Text",NumericLiteral:"NumericLiteral",StringLiteral:"StringLiteral",Identifier:"Identifier",Equals:"Equals",OpenParen:"OpenParen",CloseParen:"CloseParen",OpenStatement:"OpenStatement",CloseStatement:"CloseStatement",OpenExpression:"OpenExpression",CloseExpression:"CloseExpression",OpenSquareBracket:"OpenSquareBracket",CloseSquareBracket:"CloseSquareBracket",OpenCurlyBracket:"OpenCurlyBracket",CloseCurlyBracket:"CloseCurlyBracket",Comma:"Comma",Dot:"Dot",Colon:"Colon",Pipe:"Pipe",CallOperator:"CallOperator",AdditiveBinaryOperator:"AdditiveBinaryOperator",MultiplicativeBinaryOperator:"MultiplicativeBinaryOperator",ComparisonBinaryOperator:"ComparisonBinaryOperator",UnaryOperator:"UnaryOperator",Comment:"Comment"}),i=class{constructor(F,ue){this.value=F,this.type=ue}};function l(F){return/\w/.test(F)}function c(F){return/[0-9]/.test(F)}function u(F){return/\s/.test(F)}var d=[["{%",s.OpenStatement],["%}",s.CloseStatement],["{{",s.OpenExpression],["}}",s.CloseExpression],["(",s.OpenParen],[")",s.CloseParen],["{",s.OpenCurlyBracket],["}",s.CloseCurlyBracket],["[",s.OpenSquareBracket],["]",s.CloseSquareBracket],[",",s.Comma],[".",s.Dot],[":",s.Colon],["|",s.Pipe],["<=",s.ComparisonBinaryOperator],[">=",s.ComparisonBinaryOperator],["==",s.ComparisonBinaryOperator],["!=",s.ComparisonBinaryOperator],["<",s.ComparisonBinaryOperator],[">",s.ComparisonBinaryOperator],["+",s.AdditiveBinaryOperator],["-",s.AdditiveBinaryOperator],["~",s.AdditiveBinaryOperator],["*",s.MultiplicativeBinaryOperator],["/",s.MultiplicativeBinaryOperator],["%",s.MultiplicativeBinaryOperator],["=",s.Equals]],f=new Map([["n",`
`],["t","	"],["r","\r"],["b","\b"],["f","\f"],["v","\v"],["'","'"],['"','"'],["\\","\\"]]);function m(F,ue={}){return F.endsWith(`
`)&&(F=F.slice(0,-1)),ue.lstrip_blocks&&(F=F.replace(/^[ \t]*({[#%-])/gm,"$1")),ue.trim_blocks&&(F=F.replace(/([#%-]})\n/g,"$1")),F.replace(/{%\s*(end)?generation\s*%}/gs,"")}function _(F,ue={}){const ne=[],le=m(F,ue);let fe=0,xe=0;const Ne=ht=>{let Rt="";for(;ht(le[fe]);){if(le[fe]==="\\"){if(++fe,fe>=le.length)throw new SyntaxError("Unexpected end of input");const _t=le[fe++],Zt=f.get(_t);if(Zt===void 0)throw new SyntaxError(`Unexpected escaped character: ${_t}`);Rt+=Zt;continue}if(Rt+=le[fe++],fe>=le.length)throw new SyntaxError("Unexpected end of input")}return Rt},ut=()=>{const ht=ne.at(-1);ht&&ht.type===s.Text&&(ht.value=ht.value.trimEnd(),ht.value===""&&ne.pop())},xt=()=>{for(;fe<le.length&&u(le[fe]);)++fe};e:for(;fe<le.length;){const ht=ne.at(-1)?.type;if(ht===void 0||ht===s.CloseStatement||ht===s.CloseExpression||ht===s.Comment){let _t="";for(;fe<le.length&&!(le[fe]==="{"&&(le[fe+1]==="%"||le[fe+1]==="{"||le[fe+1]==="#"));)_t+=le[fe++];if(_t.length>0){ne.push(new i(_t,s.Text));continue}}if(le[fe]==="{"&&le[fe+1]==="#"){fe+=2;const _t=le[fe]==="-";_t&&++fe;let Zt="";for(;le[fe]!=="#"||le[fe+1]!=="}";){if(fe+2>=le.length)throw new SyntaxError("Missing end of comment tag");Zt+=le[fe++]}const nn=Zt.endsWith("-");nn&&(Zt=Zt.slice(0,-1)),_t&&ut(),ne.push(new i(Zt,s.Comment)),fe+=2,nn&&xt();continue}if(le.slice(fe,fe+3)==="{%-"){ut(),ne.push(new i("{%",s.OpenStatement)),fe+=3;continue}if(le.slice(fe,fe+3)==="{{-"){ut(),ne.push(new i("{{",s.OpenExpression)),xe=0,fe+=3;continue}if(Ne(u),le.slice(fe,fe+3)==="-%}"){ne.push(new i("%}",s.CloseStatement)),fe+=3,xt();continue}if(le.slice(fe,fe+3)==="-}}"){ne.push(new i("}}",s.CloseExpression)),fe+=3,xt();continue}const Rt=le[fe];if(Rt==="-"||Rt==="+"){const _t=ne.at(-1)?.type;if(_t===s.Text||_t===void 0)throw new SyntaxError(`Unexpected character: ${Rt}`);switch(_t){case s.Identifier:case s.NumericLiteral:case s.StringLiteral:case s.CloseParen:case s.CloseSquareBracket:break;default:{++fe;const Zt=Ne(c);ne.push(new i(`${Rt}${Zt}`,Zt.length>0?s.NumericLiteral:s.UnaryOperator));continue}}}for(const[_t,Zt]of d){if(_t==="}}"&&xe>0)continue;if(le.slice(fe,fe+_t.length)===_t){ne.push(new i(_t,Zt)),Zt===s.OpenExpression?xe=0:Zt===s.OpenCurlyBracket?++xe:Zt===s.CloseCurlyBracket&&--xe,fe+=_t.length;continue e}}if(Rt==="'"||Rt==='"'){++fe;const _t=Ne(Zt=>Zt!==Rt);ne.push(new i(_t,s.StringLiteral)),++fe;continue}if(c(Rt)){let _t=Ne(c);if(le[fe]==="."&&c(le[fe+1])){++fe;const Zt=Ne(c);_t=`${_t}.${Zt}`}ne.push(new i(_t,s.NumericLiteral));continue}if(l(Rt)){const _t=Ne(l);ne.push(new i(_t,s.Identifier));continue}throw new SyntaxError(`Unexpected character: ${Rt}`)}return ne}var p=class{type="Statement"},y=class extends p{constructor(F){super(),this.body=F}type="Program"},v=class extends p{constructor(F,ue,ne){super(),this.test=F,this.body=ue,this.alternate=ne}type="If"},T=class extends p{constructor(F,ue,ne,le){super(),this.loopvar=F,this.iterable=ue,this.body=ne,this.defaultBlock=le}type="For"},k=class extends p{type="Break"},b=class extends p{type="Continue"},S=class extends p{constructor(F,ue,ne){super(),this.assignee=F,this.value=ue,this.body=ne}type="Set"},$=class extends p{constructor(F,ue,ne){super(),this.name=F,this.args=ue,this.body=ne}type="Macro"},w=class extends p{constructor(F){super(),this.value=F}type="Comment"},C=class extends p{type="Expression"},P=class extends C{constructor(F,ue,ne){super(),this.object=F,this.property=ue,this.computed=ne}type="MemberExpression"},A=class extends C{constructor(F,ue){super(),this.callee=F,this.args=ue}type="CallExpression"},I=class extends C{constructor(F){super(),this.value=F}type="Identifier"},W=class extends C{constructor(F){super(),this.value=F}type="Literal"},G=class extends W{type="IntegerLiteral"},q=class extends W{type="FloatLiteral"},Z=class extends W{type="StringLiteral"},X=class extends W{type="ArrayLiteral"},Q=class extends W{type="TupleLiteral"},te=class extends W{type="ObjectLiteral"},R=class extends C{constructor(F,ue,ne){super(),this.operator=F,this.left=ue,this.right=ne}type="BinaryExpression"},ee=class extends C{constructor(F,ue){super(),this.operand=F,this.filter=ue}type="FilterExpression"},ie=class extends p{constructor(F,ue){super(),this.filter=F,this.body=ue}type="FilterStatement"},he=class extends C{constructor(F,ue){super(),this.lhs=F,this.test=ue}type="SelectExpression"},_e=class extends C{constructor(F,ue,ne){super(),this.operand=F,this.negate=ue,this.test=ne}type="TestExpression"},U=class extends C{constructor(F,ue){super(),this.operator=F,this.argument=ue}type="UnaryExpression"},K=class extends C{constructor(F=void 0,ue=void 0,ne=void 0){super(),this.start=F,this.stop=ue,this.step=ne}type="SliceExpression"},H=class extends C{constructor(F,ue){super(),this.key=F,this.value=ue}type="KeywordArgumentExpression"},B=class extends C{constructor(F){super(),this.argument=F}type="SpreadExpression"},ce=class extends p{constructor(F,ue,ne){super(),this.call=F,this.callerArgs=ue,this.body=ne}type="CallStatement"},ve=class extends C{constructor(F,ue,ne){super(),this.condition=F,this.trueExpr=ue,this.falseExpr=ne}type="Ternary"};function Pe(F){const ue=new y([]);let ne=0;function le(st,lt){const Et=F[ne++];if(!Et||Et.type!==st)throw new Error(`Parser Error: ${lt}. ${Et.type} !== ${st}.`);return Et}function fe(st){if(!xt(st))throw new SyntaxError(`Expected ${st}`);++ne}function xe(){switch(F[ne].type){case s.Comment:return new w(F[ne++].value);case s.Text:return ht();case s.OpenStatement:return Rt();case s.OpenExpression:return _t();default:throw new SyntaxError(`Unexpected token type: ${F[ne].type}`)}}function Ne(...st){return ne+st.length<=F.length&&st.every((lt,Et)=>lt===F[ne+Et].type)}function ut(...st){return F[ne]?.type===s.OpenStatement&&F[ne+1]?.type===s.Identifier&&st.includes(F[ne+1]?.value)}function xt(...st){return ne+st.length<=F.length&&st.every((lt,Et)=>F[ne+Et].type==="Identifier"&&lt===F[ne+Et].value)}function ht(){return new Z(le(s.Text,"Expected text token").value)}function Rt(){if(le(s.OpenStatement,"Expected opening statement token"),F[ne].type!==s.Identifier)throw new SyntaxError(`Unknown statement, got ${F[ne].type}`);const st=F[ne].value;let lt;switch(st){case"set":++ne,lt=Zt();break;case"if":++ne,lt=nn(),le(s.OpenStatement,"Expected {% token"),fe("endif"),le(s.CloseStatement,"Expected %} token");break;case"macro":++ne,lt=sa(),le(s.OpenStatement,"Expected {% token"),fe("endmacro"),le(s.CloseStatement,"Expected %} token");break;case"for":++ne,lt=Nn(),le(s.OpenStatement,"Expected {% token"),fe("endfor"),le(s.CloseStatement,"Expected %} token");break;case"call":{++ne;let Et=null;Ne(s.OpenParen)&&(Et=us());const xn=Ya();if(xn.type!=="Identifier")throw new SyntaxError("Expected identifier following call statement");const Gr=us();le(s.CloseStatement,"Expected closing statement token");const Ca=[];for(;!ut("endcall");)Ca.push(xe());le(s.OpenStatement,"Expected '{%'"),fe("endcall"),le(s.CloseStatement,"Expected closing statement token");const Js=new A(xn,Gr);lt=new ce(Js,Et,Ca);break}case"break":++ne,le(s.CloseStatement,"Expected closing statement token"),lt=new k;break;case"continue":++ne,le(s.CloseStatement,"Expected closing statement token"),lt=new b;break;case"filter":{++ne;let Et=Ya();Et instanceof I&&Ne(s.OpenParen)&&(Et=ha(Et)),le(s.CloseStatement,"Expected closing statement token");const xn=[];for(;!ut("endfilter");)xn.push(xe());le(s.OpenStatement,"Expected '{%'"),fe("endfilter"),le(s.CloseStatement,"Expected '%}'"),lt=new ie(Et,xn);break}default:throw new SyntaxError(`Unknown statement type: ${st}`)}return lt}function _t(){le(s.OpenExpression,"Expected opening expression token");const st=ia();return le(s.CloseExpression,"Expected closing expression token"),st}function Zt(){const st=ra();let lt=null;const Et=[];if(Ne(s.Equals))++ne,lt=ra();else{for(le(s.CloseStatement,"Expected %} token");!ut("endset");)Et.push(xe());le(s.OpenStatement,"Expected {% token"),fe("endset")}return le(s.CloseStatement,"Expected closing statement token"),new S(st,lt,Et)}function nn(){const st=ia();le(s.CloseStatement,"Expected closing statement token");const lt=[],Et=[];for(;!ut("elif","else","endif");)lt.push(xe());if(ut("elif")){++ne,++ne;const xn=nn();Et.push(xn)}else if(ut("else"))for(++ne,++ne,le(s.CloseStatement,"Expected closing statement token");!ut("endif");)Et.push(xe());return new v(st,lt,Et)}function sa(){const st=Ya();if(st.type!=="Identifier")throw new SyntaxError("Expected identifier following macro statement");const lt=us();le(s.CloseStatement,"Expected closing statement token");const Et=[];for(;!ut("endmacro");)Et.push(xe());return new $(st,lt,Et)}function ra(st=!1){const lt=st?Ya:ia,Et=[lt()],xn=Ne(s.Comma);for(;xn&&(++ne,Et.push(lt()),!!Ne(s.Comma)););return xn?new Q(Et):Et[0]}function Nn(){const st=ra(!0);if(!(st instanceof I||st instanceof Q))throw new SyntaxError(`Expected identifier/tuple for the loop variable, got ${st.type} instead`);if(!xt("in"))throw new SyntaxError("Expected `in` keyword following loop variable");++ne;const lt=ia();le(s.CloseStatement,"Expected closing statement token");const Et=[];for(;!ut("endfor","else");)Et.push(xe());const xn=[];if(ut("else"))for(++ne,++ne,le(s.CloseStatement,"Expected closing statement token");!ut("endfor");)xn.push(xe());return new T(st,lt,Et,xn)}function ia(){return gs()}function gs(){const st=Ma();if(xt("if")){++ne;const lt=Ma();if(xt("else")){++ne;const Et=gs();return new ve(lt,st,Et)}else return new he(st,lt)}return st}function Ma(){let st=Hn();for(;xt("or");){const lt=F[ne];++ne;const Et=Hn();st=new R(lt,st,Et)}return st}function Hn(){let st=Va();for(;xt("and");){const lt=F[ne];++ne;const Et=Va();st=new R(lt,st,Et)}return st}function Va(){let st;for(;xt("not");){const lt=F[ne];++ne;const Et=Va();st=new U(lt,Et)}return st??Ga()}function Ga(){let st=Wa();for(;;){let lt;if(xt("not","in"))lt=new i("not in",s.Identifier),ne+=2;else if(xt("in"))lt=F[ne++];else if(Ne(s.ComparisonBinaryOperator))lt=F[ne++];else break;const Et=Wa();st=new R(lt,st,Et)}return st}function Wa(){let st=Ds();for(;Ne(s.AdditiveBinaryOperator);){const lt=F[ne];++ne;const Et=Ds();st=new R(lt,st,Et)}return st}function Zn(){const st=$s(Ya());return Ne(s.OpenParen)?ha(st):st}function ha(st){let lt=new A(st,us());return lt=$s(lt),Ne(s.OpenParen)&&(lt=ha(lt)),lt}function us(){le(s.OpenParen,"Expected opening parenthesis for arguments list");const st=ks();return le(s.CloseParen,"Expected closing parenthesis for arguments list"),st}function ks(){const st=[];for(;!Ne(s.CloseParen);){let lt;if(F[ne].type===s.MultiplicativeBinaryOperator&&F[ne].value==="*"){++ne;const Et=ia();lt=new B(Et)}else if(lt=ia(),Ne(s.Equals)){if(++ne,!(lt instanceof I))throw new SyntaxError("Expected identifier for keyword argument");const Et=ia();lt=new H(lt,Et)}st.push(lt),Ne(s.Comma)&&++ne}return st}function Vr(){const st=[];let lt=!1;for(;!Ne(s.CloseSquareBracket);)Ne(s.Colon)?(st.push(void 0),++ne,lt=!0):(st.push(ia()),Ne(s.Colon)&&(++ne,lt=!0));if(st.length===0)throw new SyntaxError("Expected at least one argument for member/slice expression");if(lt){if(st.length>3)throw new SyntaxError("Expected 0-3 arguments for slice expression");return new K(...st)}return st[0]}function $s(st){for(;Ne(s.Dot)||Ne(s.OpenSquareBracket);){const lt=F[ne];++ne;let Et;const xn=lt.type===s.OpenSquareBracket;if(xn)Et=Vr(),le(s.CloseSquareBracket,"Expected closing square bracket");else if(Et=Ya(),Et.type!=="Identifier")throw new SyntaxError("Expected identifier following dot operator");st=new P(st,Et,xn)}return st}function Ds(){let st=Ha();for(;Ne(s.MultiplicativeBinaryOperator);){const lt=F[ne++],Et=Ha();st=new R(lt,st,Et)}return st}function Ha(){let st=_a();for(;xt("is");){++ne;const lt=xt("not");lt&&++ne;const Et=Ya();if(!(Et instanceof I))throw new SyntaxError("Expected identifier for the test");st=new _e(st,lt,Et)}return st}function _a(){let st=Zn();for(;Ne(s.Pipe);){++ne;let lt=Ya();if(!(lt instanceof I))throw new SyntaxError("Expected identifier for the filter");Ne(s.OpenParen)&&(lt=ha(lt)),st=new ee(st,lt)}return st}function Ya(){const st=F[ne++];switch(st.type){case s.NumericLiteral:{const lt=st.value;return lt.includes(".")?new q(Number(lt)):new G(Number(lt))}case s.StringLiteral:{let lt=st.value;for(;Ne(s.StringLiteral);)lt+=F[ne++].value;return new Z(lt)}case s.Identifier:return new I(st.value);case s.OpenParen:{const lt=ra();return le(s.CloseParen,"Expected closing parenthesis, got ${tokens[current].type} instead."),lt}case s.OpenSquareBracket:{const lt=[];for(;!Ne(s.CloseSquareBracket);)lt.push(ia()),Ne(s.Comma)&&++ne;return++ne,new X(lt)}case s.OpenCurlyBracket:{const lt=new Map;for(;!Ne(s.CloseCurlyBracket);){const Et=ia();le(s.Colon,"Expected colon between key and value in object literal");const xn=ia();lt.set(Et,xn),Ne(s.Comma)&&++ne}return++ne,new te(lt)}default:throw new SyntaxError(`Unexpected token: ${st.type}`)}}for(;ne<F.length;)ue.body.push(xe());return ue}function ze(F,ue,ne=1){ue===void 0&&(ue=F,F=0);const le=[];for(let fe=F;fe<ue;fe+=ne)le.push(fe);return le}function Ze(F,ue,ne,le=1){const fe=Math.sign(le);fe>=0?(ue=(ue??=0)<0?Math.max(F.length+ue,0):Math.min(ue,F.length),ne=(ne??=F.length)<0?Math.max(F.length+ne,0):Math.min(ne,F.length)):(ue=(ue??=F.length-1)<0?Math.max(F.length+ue,-1):Math.min(ue,F.length-1),ne=(ne??=-1)<-1?Math.max(F.length+ne,-1):Math.min(ne,F.length-1));const xe=[];for(let Ne=ue;fe*Ne<fe*ne;Ne+=le)xe.push(F[Ne]);return xe}function Re(F){return F.replace(/\b\w/g,ue=>ue.toUpperCase())}function de(F){return J(new Date,F)}function J(F,ue){const ne=new Intl.DateTimeFormat(void 0,{month:"long"}),le=new Intl.DateTimeFormat(void 0,{month:"short"}),fe=xe=>xe<10?"0"+xe:xe.toString();return ue.replace(/%[YmdbBHM%]/g,xe=>{switch(xe){case"%Y":return F.getFullYear().toString();case"%m":return fe(F.getMonth()+1);case"%d":return fe(F.getDate());case"%b":return le.format(F);case"%B":return ne.format(F);case"%H":return fe(F.getHours());case"%M":return fe(F.getMinutes());case"%%":return"%";default:return xe}})}function Ce(F){return F.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Fe(F,ue,ne,le){if(le===0)return F;let fe=le==null||le<0?1/0:le;const xe=ue.length===0?new RegExp("(?=)","gu"):new RegExp(Ce(ue),"gu");return F.replaceAll(xe,Ne=>fe>0?(--fe,ne):Ne)}var Be=class extends Error{},Ue=class extends Error{},He=class{type="RuntimeValue";value;builtins=new Map;constructor(F=void 0){this.value=F}__bool__(){return new Ge(!!this.value)}toString(){return String(this.value)}},De=class extends He{type="IntegerValue"},nt=class extends He{type="FloatValue";toString(){return this.value%1===0?this.value.toFixed(1):this.value.toString()}},ke=class extends He{type="StringValue";builtins=new Map([["upper",new wt(()=>new ke(this.value.toUpperCase()))],["lower",new wt(()=>new ke(this.value.toLowerCase()))],["strip",new wt(()=>new ke(this.value.trim()))],["title",new wt(()=>new ke(Re(this.value)))],["capitalize",new wt(()=>new ke(this.value.charAt(0).toUpperCase()+this.value.slice(1)))],["length",new De(this.value.length)],["rstrip",new wt(()=>new ke(this.value.trimEnd()))],["lstrip",new wt(()=>new ke(this.value.trimStart()))],["startswith",new wt(F=>{if(F.length===0)throw new Error("startswith() requires at least one argument");const ue=F[0];if(ue instanceof ke)return new Ge(this.value.startsWith(ue.value));if(ue instanceof it){for(const ne of ue.value){if(!(ne instanceof ke))throw new Error("startswith() tuple elements must be strings");if(this.value.startsWith(ne.value))return new Ge(!0)}return new Ge(!1)}throw new Error("startswith() argument must be a string or tuple of strings")})],["endswith",new wt(F=>{if(F.length===0)throw new Error("endswith() requires at least one argument");const ue=F[0];if(ue instanceof ke)return new Ge(this.value.endsWith(ue.value));if(ue instanceof it){for(const ne of ue.value){if(!(ne instanceof ke))throw new Error("endswith() tuple elements must be strings");if(this.value.endsWith(ne.value))return new Ge(!0)}return new Ge(!1)}throw new Error("endswith() argument must be a string or tuple of strings")})],["split",new wt(F=>{const ue=F[0]??new ot;if(!(ue instanceof ke||ue instanceof ot))throw new Error("sep argument must be a string or null");const ne=F[1]??new De(-1);if(!(ne instanceof De))throw new Error("maxsplit argument must be a number");let le=[];if(ue instanceof ot){const fe=this.value.trimStart();for(const{0:xe,index:Ne}of fe.matchAll(/\S+/g)){if(ne.value!==-1&&le.length>=ne.value&&Ne!==void 0){le.push(xe+fe.slice(Ne+xe.length));break}le.push(xe)}}else{if(ue.value==="")throw new Error("empty separator");le=this.value.split(ue.value),ne.value!==-1&&le.length>ne.value&&le.push(le.splice(ne.value).join(ue.value))}return new it(le.map(fe=>new ke(fe)))})],["replace",new wt(F=>{if(F.length<2)throw new Error("replace() requires at least two arguments");const ue=F[0],ne=F[1];if(!(ue instanceof ke&&ne instanceof ke))throw new Error("replace() arguments must be strings");let le;if(F.length>2?F[2].type==="KeywordArgumentsValue"?le=F[2].value.get("count")??new ot:le=F[2]:le=new ot,!(le instanceof De||le instanceof ot))throw new Error("replace() count argument must be a number or null");return new ke(Fe(this.value,ue.value,ne.value,le.value))})]])},Ge=class extends He{type="BooleanValue"};function dt(F,ue,ne,le=!0){const fe=ne??0;switch(F.type){case"NullValue":return"null";case"UndefinedValue":return le?"null":"undefined";case"IntegerValue":case"FloatValue":case"StringValue":case"BooleanValue":return JSON.stringify(F.value);case"ArrayValue":case"ObjectValue":{const xe=ue?" ".repeat(ue):"",Ne=`
`+xe.repeat(fe),ut=Ne+xe;if(F.type==="ArrayValue"){const xt=F.value.map(ht=>dt(ht,ue,fe+1,le));return ue?`[${ut}${xt.join(`,${ut}`)}${Ne}]`:`[${xt.join(", ")}]`}else{const xt=Array.from(F.value.entries()).map(([ht,Rt])=>{const _t=`"${ht}": ${dt(Rt,ue,fe+1,le)}`;return ue?`${ut}${_t}`:_t});return ue?`{${xt.join(",")}${Ne}}`:`{${xt.join(", ")}}`}}default:throw new Error(`Cannot convert to JSON: ${F.type}`)}}var Ye=class extends He{type="ObjectValue";__bool__(){return new Ge(this.value.size>0)}builtins=new Map([["get",new wt(([F,ue])=>{if(!(F instanceof ke))throw new Error(`Object key must be a string: got ${F.type}`);return this.value.get(F.value)??ue??new ot})],["items",new wt(()=>this.items())],["keys",new wt(()=>this.keys())],["values",new wt(()=>this.values())],["dictsort",new wt(F=>{let ue=new Map;const ne=F.filter(ut=>ut instanceof mt?(ue=ut.value,!1):!0),le=ne.at(0)??ue.get("case_sensitive")??new Ge(!1);if(!(le instanceof Ge))throw new Error("case_sensitive must be a boolean");const fe=ne.at(1)??ue.get("by")??new ke("key");if(!(fe instanceof ke))throw new Error("by must be a string");if(!["key","value"].includes(fe.value))throw new Error("by must be either 'key' or 'value'");const xe=ne.at(2)??ue.get("reverse")??new Ge(!1);if(!(xe instanceof Ge))throw new Error("reverse must be a boolean");const Ne=Array.from(this.value.entries()).map(([ut,xt])=>new it([new ke(ut),xt])).sort((ut,xt)=>{const ht=fe.value==="key"?0:1,Rt=ut.value[ht],_t=xt.value[ht],Zt=Ht(Rt,_t,le.value);return xe.value?-Zt:Zt});return new it(Ne)})]]);items(){return new it(Array.from(this.value.entries()).map(([F,ue])=>new it([new ke(F),ue])))}keys(){return new it(Array.from(this.value.keys()).map(F=>new ke(F)))}values(){return new it(Array.from(this.value.values()))}toString(){return dt(this,null,0,!1)}},mt=class extends Ye{type="KeywordArgumentsValue"},it=class extends He{type="ArrayValue";builtins=new Map([["length",new De(this.value.length)]]);__bool__(){return new Ge(this.value.length>0)}toString(){return dt(this,null,0,!1)}},Mt=class extends it{type="TupleValue"},wt=class extends He{type="FunctionValue"},ot=class extends He{type="NullValue"},Je=class extends He{type="UndefinedValue"},St=class{constructor(F){this.parent=F}variables=new Map([["namespace",new wt(F=>{if(F.length===0)return new Ye(new Map);if(F.length!==1||!(F[0]instanceof Ye))throw new Error("`namespace` expects either zero arguments or a single object argument");return F[0]})]]);tests=new Map([["boolean",F=>F.type==="BooleanValue"],["callable",F=>F instanceof wt],["odd",F=>{if(!(F instanceof De))throw new Error(`cannot odd on ${F.type}`);return F.value%2!==0}],["even",F=>{if(!(F instanceof De))throw new Error(`cannot even on ${F.type}`);return F.value%2===0}],["false",F=>F.type==="BooleanValue"&&!F.value],["true",F=>F.type==="BooleanValue"&&F.value],["none",F=>F.type==="NullValue"],["string",F=>F.type==="StringValue"],["number",F=>F instanceof De||F instanceof nt],["integer",F=>F instanceof De],["iterable",F=>F.type==="ArrayValue"||F.type==="StringValue"],["mapping",F=>F.type==="ObjectValue"],["lower",F=>{const ue=F.value;return F.type==="StringValue"&&ue===ue.toLowerCase()}],["upper",F=>{const ue=F.value;return F.type==="StringValue"&&ue===ue.toUpperCase()}],["none",F=>F.type==="NullValue"],["defined",F=>F.type!=="UndefinedValue"],["undefined",F=>F.type==="UndefinedValue"],["equalto",(F,ue)=>F.value===ue.value],["eq",(F,ue)=>F.value===ue.value]]);set(F,ue){return this.declareVariable(F,fa(ue))}declareVariable(F,ue){if(this.variables.has(F))throw new SyntaxError(`Variable already declared: ${F}`);return this.variables.set(F,ue),ue}setVariable(F,ue){return this.variables.set(F,ue),ue}resolve(F){if(this.variables.has(F))return this;if(this.parent)return this.parent.resolve(F);throw new Error(`Unknown variable: ${F}`)}lookupVariable(F){try{return this.resolve(F).variables.get(F)??new Je}catch{return new Je}}};function Lt(F){F.set("false",!1),F.set("true",!0),F.set("none",null),F.set("raise_exception",ue=>{throw new Error(ue)}),F.set("range",ze),F.set("strftime_now",de),F.set("True",!0),F.set("False",!1),F.set("None",null)}function wn(F,ue){const ne=ue.split(".");let le=F;for(const fe of ne)if(le instanceof Ye)le=le.value.get(fe)??new Je;else if(le instanceof it){const xe=parseInt(fe,10);if(!isNaN(xe)&&xe>=0&&xe<le.value.length)le=le.value[xe];else return new Je}else return new Je;return le}function Ht(F,ue,ne=!1){if(F instanceof ot&&ue instanceof ot)return 0;if(F instanceof ot||ue instanceof ot)throw new Error(`Cannot compare ${F.type} with ${ue.type}`);if(F instanceof Je&&ue instanceof Je)return 0;if(F instanceof Je||ue instanceof Je)throw new Error(`Cannot compare ${F.type} with ${ue.type}`);const le=xe=>xe instanceof De||xe instanceof nt||xe instanceof Ge,fe=xe=>xe instanceof Ge?xe.value?1:0:xe.value;if(le(F)&&le(ue)){const xe=fe(F),Ne=fe(ue);return xe<Ne?-1:xe>Ne?1:0}if(F.type!==ue.type)throw new Error(`Cannot compare different types: ${F.type} and ${ue.type}`);if(F.type==="StringValue"){let xe=F.value,Ne=ue.value;return ne||(xe=xe.toLowerCase(),Ne=Ne.toLowerCase()),xe<Ne?-1:xe>Ne?1:0}else throw new Error(`Cannot compare type: ${F.type}`)}var Mn=class{global;constructor(F){this.global=F??new St}run(F){return this.evaluate(F,this.global)}evaluateBinaryExpression(F,ue){const ne=this.evaluate(F.left,ue);switch(F.operator.value){case"and":return ne.__bool__().value?this.evaluate(F.right,ue):ne;case"or":return ne.__bool__().value?ne:this.evaluate(F.right,ue)}const le=this.evaluate(F.right,ue);switch(F.operator.value){case"==":return new Ge(ne.value==le.value);case"!=":return new Ge(ne.value!=le.value)}if(ne instanceof Je||le instanceof Je){if(le instanceof Je&&["in","not in"].includes(F.operator.value))return new Ge(F.operator.value==="not in");throw new Error(`Cannot perform operation ${F.operator.value} on undefined values`)}else{if(ne instanceof ot||le instanceof ot)throw new Error("Cannot perform operation on null values");if(F.operator.value==="~")return new ke(ne.value.toString()+le.value.toString());if((ne instanceof De||ne instanceof nt)&&(le instanceof De||le instanceof nt)){const fe=ne.value,xe=le.value;switch(F.operator.value){case"+":case"-":case"*":{const Ne=F.operator.value==="+"?fe+xe:F.operator.value==="-"?fe-xe:fe*xe;return ne instanceof nt||le instanceof nt?new nt(Ne):new De(Ne)}case"/":return new nt(fe/xe);case"%":{const Ne=fe%xe;return ne instanceof nt||le instanceof nt?new nt(Ne):new De(Ne)}case"<":return new Ge(fe<xe);case">":return new Ge(fe>xe);case">=":return new Ge(fe>=xe);case"<=":return new Ge(fe<=xe)}}else if(ne instanceof it&&le instanceof it){if(F.operator.value==="+")return new it(ne.value.concat(le.value))}else if(le instanceof it){const fe=le.value.find(xe=>xe.value===ne.value)!==void 0;switch(F.operator.value){case"in":return new Ge(fe);case"not in":return new Ge(!fe)}}}if((ne instanceof ke||le instanceof ke)&&F.operator.value==="+")return new ke(ne.value.toString()+le.value.toString());if(ne instanceof ke&&le instanceof ke)switch(F.operator.value){case"in":return new Ge(le.value.includes(ne.value));case"not in":return new Ge(!le.value.includes(ne.value))}if(ne instanceof ke&&le instanceof Ye)switch(F.operator.value){case"in":return new Ge(le.value.has(ne.value));case"not in":return new Ge(!le.value.has(ne.value))}throw new SyntaxError(`Unknown operator "${F.operator.value}" between ${ne.type} and ${le.type}`)}evaluateArguments(F,ue){const ne=[],le=new Map;for(const fe of F)if(fe.type==="SpreadExpression"){const xe=fe,Ne=this.evaluate(xe.argument,ue);if(!(Ne instanceof it))throw new Error(`Cannot unpack non-iterable type: ${Ne.type}`);for(const ut of Ne.value)ne.push(ut)}else if(fe.type==="KeywordArgumentExpression"){const xe=fe;le.set(xe.key.value,this.evaluate(xe.value,ue))}else{if(le.size>0)throw new Error("Positional arguments must come before keyword arguments");ne.push(this.evaluate(fe,ue))}return[ne,le]}applyFilter(F,ue,ne){if(ue.type==="Identifier"){const le=ue;if(le.value==="tojson")return new ke(dt(F));if(F instanceof it)switch(le.value){case"list":return F;case"first":return F.value[0];case"last":return F.value[F.value.length-1];case"length":return new De(F.value.length);case"reverse":return new it(F.value.slice().reverse());case"sort":return new it(F.value.slice().sort((fe,xe)=>Ht(fe,xe,!1)));case"join":return new ke(F.value.map(fe=>fe.value).join(""));case"string":return new ke(dt(F,null,0,!1));case"unique":{const fe=new Set,xe=[];for(const Ne of F.value)fe.has(Ne.value)||(fe.add(Ne.value),xe.push(Ne));return new it(xe)}default:throw new Error(`Unknown ArrayValue filter: ${le.value}`)}else if(F instanceof ke)switch(le.value){case"length":case"upper":case"lower":case"title":case"capitalize":{const fe=F.builtins.get(le.value);if(fe instanceof wt)return fe.value([],ne);if(fe instanceof De)return fe;throw new Error(`Unknown StringValue filter: ${le.value}`)}case"trim":return new ke(F.value.trim());case"indent":return new ke(F.value.split(`
`).map((fe,xe)=>xe===0||fe.length===0?fe:"    "+fe).join(`
`));case"join":case"string":return F;case"int":{const fe=parseInt(F.value,10);return new De(isNaN(fe)?0:fe)}case"float":{const fe=parseFloat(F.value);return new nt(isNaN(fe)?0:fe)}default:throw new Error(`Unknown StringValue filter: ${le.value}`)}else if(F instanceof De||F instanceof nt)switch(le.value){case"abs":return F instanceof De?new De(Math.abs(F.value)):new nt(Math.abs(F.value));case"int":return new De(Math.floor(F.value));case"float":return new nt(F.value);default:throw new Error(`Unknown NumericValue filter: ${le.value}`)}else if(F instanceof Ye)switch(le.value){case"items":return new it(Array.from(F.value.entries()).map(([fe,xe])=>new it([new ke(fe),xe])));case"length":return new De(F.value.size);default:{const fe=F.builtins.get(le.value);if(fe)return fe instanceof wt?fe.value([],ne):fe;throw new Error(`Unknown ObjectValue filter: ${le.value}`)}}else if(F instanceof Ge)switch(le.value){case"bool":return new Ge(F.value);case"int":return new De(F.value?1:0);case"float":return new nt(F.value?1:0);case"string":return new ke(F.value?"true":"false");default:throw new Error(`Unknown BooleanValue filter: ${le.value}`)}throw new Error(`Cannot apply filter "${le.value}" to type: ${F.type}`)}else if(ue.type==="CallExpression"){const le=ue;if(le.callee.type!=="Identifier")throw new Error(`Unknown filter: ${le.callee.type}`);const fe=le.callee.value;if(fe==="tojson"){const[,xe]=this.evaluateArguments(le.args,ne),Ne=xe.get("indent")??new ot;if(!(Ne instanceof De||Ne instanceof ot))throw new Error("If set, indent must be a number");return new ke(dt(F,Ne.value))}else if(fe==="join"){let xe;if(F instanceof ke)xe=Array.from(F.value);else if(F instanceof it)xe=F.value.map(ht=>ht.value);else throw new Error(`Cannot apply filter "${fe}" to type: ${F.type}`);const[Ne,ut]=this.evaluateArguments(le.args,ne),xt=Ne.at(0)??ut.get("separator")??new ke("");if(!(xt instanceof ke))throw new Error("separator must be a string");return new ke(xe.join(xt.value))}else if(fe==="int"||fe==="float"){const[xe,Ne]=this.evaluateArguments(le.args,ne),ut=xe.at(0)??Ne.get("default")??(fe==="int"?new De(0):new nt(0));if(F instanceof ke){const xt=fe==="int"?parseInt(F.value,10):parseFloat(F.value);return isNaN(xt)?ut:fe==="int"?new De(xt):new nt(xt)}else{if(F instanceof De||F instanceof nt)return F;if(F instanceof Ge)return fe==="int"?new De(F.value?1:0):new nt(F.value?1:0);throw new Error(`Cannot apply filter "${fe}" to type: ${F.type}`)}}else if(fe==="default"){const[xe,Ne]=this.evaluateArguments(le.args,ne),ut=xe[0]??new ke(""),xt=xe[1]??Ne.get("boolean")??new Ge(!1);if(!(xt instanceof Ge))throw new Error("`default` filter flag must be a boolean");return F instanceof Je||xt.value&&!F.__bool__().value?ut:F}if(F instanceof it){switch(fe){case"sort":{const[xe,Ne]=this.evaluateArguments(le.args,ne),ut=xe.at(0)??Ne.get("reverse")??new Ge(!1);if(!(ut instanceof Ge))throw new Error("reverse must be a boolean");const xt=xe.at(1)??Ne.get("case_sensitive")??new Ge(!1);if(!(xt instanceof Ge))throw new Error("case_sensitive must be a boolean");const ht=xe.at(2)??Ne.get("attribute")??new ot;if(!(ht instanceof ke||ht instanceof De||ht instanceof ot))throw new Error("attribute must be a string, integer, or null");const Rt=_t=>{if(ht instanceof ot)return _t;const Zt=ht instanceof De?String(ht.value):ht.value;return wn(_t,Zt)};return new it(F.value.slice().sort((_t,Zt)=>{const nn=Rt(_t),sa=Rt(Zt),ra=Ht(nn,sa,xt.value);return ut.value?-ra:ra}))}case"selectattr":case"rejectattr":{const xe=fe==="selectattr";if(F.value.some(_t=>!(_t instanceof Ye)))throw new Error(`\`${fe}\` can only be applied to array of objects`);if(le.args.some(_t=>_t.type!=="StringLiteral"))throw new Error(`arguments of \`${fe}\` must be strings`);const[Ne,ut,xt]=le.args.map(_t=>this.evaluate(_t,ne));let ht;if(ut){const _t=ne.tests.get(ut.value);if(!_t)throw new Error(`Unknown test: ${ut.value}`);ht=_t}else ht=(..._t)=>_t[0].__bool__().value;const Rt=F.value.filter(_t=>{const Zt=_t.value.get(Ne.value),nn=Zt?ht(Zt,xt):!1;return xe?nn:!nn});return new it(Rt)}case"map":{const[,xe]=this.evaluateArguments(le.args,ne);if(xe.has("attribute")){const Ne=xe.get("attribute");if(!(Ne instanceof ke))throw new Error("attribute must be a string");const ut=xe.get("default"),xt=F.value.map(ht=>{if(!(ht instanceof Ye))throw new Error("items in map must be an object");const Rt=wn(ht,Ne.value);return Rt instanceof Je?ut??new Je:Rt});return new it(xt)}else throw new Error("`map` expressions without `attribute` set are not currently supported.")}}throw new Error(`Unknown ArrayValue filter: ${fe}`)}else if(F instanceof ke){switch(fe){case"indent":{const[xe,Ne]=this.evaluateArguments(le.args,ne),ut=xe.at(0)??Ne.get("width")??new De(4);if(!(ut instanceof De))throw new Error("width must be a number");const xt=xe.at(1)??Ne.get("first")??new Ge(!1),ht=xe.at(2)??Ne.get("blank")??new Ge(!1),Rt=F.value.split(`
`),_t=" ".repeat(ut.value),Zt=Rt.map((nn,sa)=>!xt.value&&sa===0||!ht.value&&nn.length===0?nn:_t+nn);return new ke(Zt.join(`
`))}case"replace":{const xe=F.builtins.get("replace");if(!(xe instanceof wt))throw new Error("replace filter not available");const[Ne,ut]=this.evaluateArguments(le.args,ne);return xe.value([...Ne,new mt(ut)],ne)}}throw new Error(`Unknown StringValue filter: ${fe}`)}else if(F instanceof Ye){const xe=F.builtins.get(fe);if(xe&&xe instanceof wt){const[Ne,ut]=this.evaluateArguments(le.args,ne);return ut.size>0&&Ne.push(new mt(ut)),xe.value(Ne,ne)}throw new Error(`Unknown ObjectValue filter: ${fe}`)}else throw new Error(`Cannot apply filter "${fe}" to type: ${F.type}`)}throw new Error(`Unknown filter: ${ue.type}`)}evaluateFilterExpression(F,ue){const ne=this.evaluate(F.operand,ue);return this.applyFilter(ne,F.filter,ue)}evaluateTestExpression(F,ue){const ne=this.evaluate(F.operand,ue),le=ue.tests.get(F.test.value);if(!le)throw new Error(`Unknown test: ${F.test.value}`);const fe=le(ne);return new Ge(F.negate?!fe:fe)}evaluateSelectExpression(F,ue){return this.evaluate(F.test,ue).__bool__().value?this.evaluate(F.lhs,ue):new Je}evaluateUnaryExpression(F,ue){const ne=this.evaluate(F.argument,ue);if(F.operator.value==="not")return new Ge(!ne.value);throw new SyntaxError(`Unknown operator: ${F.operator.value}`)}evaluateTernaryExpression(F,ue){return this.evaluate(F.condition,ue).__bool__().value?this.evaluate(F.trueExpr,ue):this.evaluate(F.falseExpr,ue)}evalProgram(F,ue){return this.evaluateBlock(F.body,ue)}evaluateBlock(F,ue){let ne="";for(const le of F){const fe=this.evaluate(le,ue);fe.type!=="NullValue"&&fe.type!=="UndefinedValue"&&(ne+=fe.toString())}return new ke(ne)}evaluateIdentifier(F,ue){return ue.lookupVariable(F.value)}evaluateCallExpression(F,ue){const[ne,le]=this.evaluateArguments(F.args,ue);le.size>0&&ne.push(new mt(le));const fe=this.evaluate(F.callee,ue);if(fe.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${fe.type}`);return fe.value(ne,ue)}evaluateSliceExpression(F,ue,ne){if(!(F instanceof it||F instanceof ke))throw new Error("Slice object must be an array or string");const le=this.evaluate(ue.start,ne),fe=this.evaluate(ue.stop,ne),xe=this.evaluate(ue.step,ne);if(!(le instanceof De||le instanceof Je))throw new Error("Slice start must be numeric or undefined");if(!(fe instanceof De||fe instanceof Je))throw new Error("Slice stop must be numeric or undefined");if(!(xe instanceof De||xe instanceof Je))throw new Error("Slice step must be numeric or undefined");return F instanceof it?new it(Ze(F.value,le.value,fe.value,xe.value)):new ke(Ze(Array.from(F.value),le.value,fe.value,xe.value).join(""))}evaluateMemberExpression(F,ue){const ne=this.evaluate(F.object,ue);let le;if(F.computed){if(F.property.type==="SliceExpression")return this.evaluateSliceExpression(ne,F.property,ue);le=this.evaluate(F.property,ue)}else le=new ke(F.property.value);let fe;if(ne instanceof Ye){if(!(le instanceof ke))throw new Error(`Cannot access property with non-string: got ${le.type}`);fe=ne.value.get(le.value)??ne.builtins.get(le.value)}else if(ne instanceof it||ne instanceof ke)if(le instanceof De)fe=ne.value.at(le.value),ne instanceof ke&&(fe=new ke(ne.value.at(le.value)));else if(le instanceof ke)fe=ne.builtins.get(le.value);else throw new Error(`Cannot access property with non-string/non-number: got ${le.type}`);else{if(!(le instanceof ke))throw new Error(`Cannot access property with non-string: got ${le.type}`);fe=ne.builtins.get(le.value)}return fe instanceof He?fe:new Je}evaluateSet(F,ue){const ne=F.value?this.evaluate(F.value,ue):this.evaluateBlock(F.body,ue);if(F.assignee.type==="Identifier"){const le=F.assignee.value;ue.setVariable(le,ne)}else if(F.assignee.type==="TupleLiteral"){const le=F.assignee;if(!(ne instanceof it))throw new Error(`Cannot unpack non-iterable type in set: ${ne.type}`);const fe=ne.value;if(fe.length!==le.value.length)throw new Error(`Too ${le.value.length>fe.length?"few":"many"} items to unpack in set`);for(let xe=0;xe<le.value.length;++xe){const Ne=le.value[xe];if(Ne.type!=="Identifier")throw new Error(`Cannot unpack to non-identifier in set: ${Ne.type}`);ue.setVariable(Ne.value,fe[xe])}}else if(F.assignee.type==="MemberExpression"){const le=F.assignee,fe=this.evaluate(le.object,ue);if(!(fe instanceof Ye))throw new Error("Cannot assign to member of non-object");if(le.property.type!=="Identifier")throw new Error("Cannot assign to member with non-identifier property");fe.value.set(le.property.value,ne)}else throw new Error(`Invalid LHS inside assignment expression: ${JSON.stringify(F.assignee)}`);return new ot}evaluateIf(F,ue){const ne=this.evaluate(F.test,ue);return this.evaluateBlock(ne.__bool__().value?F.body:F.alternate,ue)}evaluateFor(F,ue){const ne=new St(ue);let le,fe;if(F.iterable.type==="SelectExpression"){const ht=F.iterable;fe=this.evaluate(ht.lhs,ne),le=ht.test}else fe=this.evaluate(F.iterable,ne);if(!(fe instanceof it||fe instanceof Ye))throw new Error(`Expected iterable or object type in for loop: got ${fe.type}`);fe instanceof Ye&&(fe=fe.keys());const xe=[],Ne=[];for(let ht=0;ht<fe.value.length;++ht){const Rt=new St(ne),_t=fe.value[ht];let Zt;if(F.loopvar.type==="Identifier")Zt=nn=>nn.setVariable(F.loopvar.value,_t);else if(F.loopvar.type==="TupleLiteral"){const nn=F.loopvar;if(_t.type!=="ArrayValue")throw new Error(`Cannot unpack non-iterable type: ${_t.type}`);const sa=_t;if(nn.value.length!==sa.value.length)throw new Error(`Too ${nn.value.length>sa.value.length?"few":"many"} items to unpack`);Zt=ra=>{for(let Nn=0;Nn<nn.value.length;++Nn){if(nn.value[Nn].type!=="Identifier")throw new Error(`Cannot unpack non-identifier type: ${nn.value[Nn].type}`);ra.setVariable(nn.value[Nn].value,sa.value[Nn])}}}else throw new Error(`Invalid loop variable(s): ${F.loopvar.type}`);le&&(Zt(Rt),!this.evaluate(le,Rt).__bool__().value)||(xe.push(_t),Ne.push(Zt))}let ut="",xt=!0;for(let ht=0;ht<xe.length;++ht){const Rt=new Map([["index",new De(ht+1)],["index0",new De(ht)],["revindex",new De(xe.length-ht)],["revindex0",new De(xe.length-ht-1)],["first",new Ge(ht===0)],["last",new Ge(ht===xe.length-1)],["length",new De(xe.length)],["previtem",ht>0?xe[ht-1]:new Je],["nextitem",ht<xe.length-1?xe[ht+1]:new Je]]);ne.setVariable("loop",new Ye(Rt)),Ne[ht](ne);try{const _t=this.evaluateBlock(F.body,ne);ut+=_t.value}catch(_t){if(_t instanceof Ue)continue;if(_t instanceof Be)break;throw _t}xt=!1}if(xt){const ht=this.evaluateBlock(F.defaultBlock,ne);ut+=ht.value}return new ke(ut)}evaluateMacro(F,ue){return ue.setVariable(F.name.value,new wt((ne,le)=>{const fe=new St(le);ne=ne.slice();let xe;ne.at(-1)?.type==="KeywordArgumentsValue"&&(xe=ne.pop());for(let Ne=0;Ne<F.args.length;++Ne){const ut=F.args[Ne],xt=ne[Ne];if(ut.type==="Identifier"){const ht=ut;if(!xt)throw new Error(`Missing positional argument: ${ht.value}`);fe.setVariable(ht.value,xt)}else if(ut.type==="KeywordArgumentExpression"){const ht=ut,Rt=xt??xe?.value.get(ht.key.value)??this.evaluate(ht.value,fe);fe.setVariable(ht.key.value,Rt)}else throw new Error(`Unknown argument type: ${ut.type}`)}return this.evaluateBlock(F.body,fe)})),new ot}evaluateCallStatement(F,ue){const ne=new wt((ut,xt)=>{const ht=new St(xt);if(F.callerArgs)for(let Rt=0;Rt<F.callerArgs.length;++Rt){const _t=F.callerArgs[Rt];if(_t.type!=="Identifier")throw new Error(`Caller parameter must be an identifier, got ${_t.type}`);ht.setVariable(_t.value,ut[Rt]??new Je)}return this.evaluateBlock(F.body,ht)}),[le,fe]=this.evaluateArguments(F.call.args,ue);le.push(new mt(fe));const xe=this.evaluate(F.call.callee,ue);if(xe.type!=="FunctionValue")throw new Error(`Cannot call something that is not a function: got ${xe.type}`);const Ne=new St(ue);return Ne.setVariable("caller",ne),xe.value(le,Ne)}evaluateFilterStatement(F,ue){const ne=this.evaluateBlock(F.body,ue);return this.applyFilter(ne,F.filter,ue)}evaluate(F,ue){if(!F)return new Je;switch(F.type){case"Program":return this.evalProgram(F,ue);case"Set":return this.evaluateSet(F,ue);case"If":return this.evaluateIf(F,ue);case"For":return this.evaluateFor(F,ue);case"Macro":return this.evaluateMacro(F,ue);case"CallStatement":return this.evaluateCallStatement(F,ue);case"Break":throw new Be;case"Continue":throw new Ue;case"IntegerLiteral":return new De(F.value);case"FloatLiteral":return new nt(F.value);case"StringLiteral":return new ke(F.value);case"ArrayLiteral":return new it(F.value.map(ne=>this.evaluate(ne,ue)));case"TupleLiteral":return new Mt(F.value.map(ne=>this.evaluate(ne,ue)));case"ObjectLiteral":{const ne=new Map;for(const[le,fe]of F.value){const xe=this.evaluate(le,ue);if(!(xe instanceof ke))throw new Error(`Object keys must be strings: got ${xe.type}`);ne.set(xe.value,this.evaluate(fe,ue))}return new Ye(ne)}case"Identifier":return this.evaluateIdentifier(F,ue);case"CallExpression":return this.evaluateCallExpression(F,ue);case"MemberExpression":return this.evaluateMemberExpression(F,ue);case"UnaryExpression":return this.evaluateUnaryExpression(F,ue);case"BinaryExpression":return this.evaluateBinaryExpression(F,ue);case"FilterExpression":return this.evaluateFilterExpression(F,ue);case"FilterStatement":return this.evaluateFilterStatement(F,ue);case"TestExpression":return this.evaluateTestExpression(F,ue);case"SelectExpression":return this.evaluateSelectExpression(F,ue);case"Ternary":return this.evaluateTernaryExpression(F,ue);case"Comment":return new ot;default:throw new SyntaxError(`Unknown node type: ${F.type}`)}}};function fa(F){switch(typeof F){case"number":return Number.isInteger(F)?new De(F):new nt(F);case"string":return new ke(F);case"boolean":return new Ge(F);case"undefined":return new Je;case"object":return F===null?new ot:Array.isArray(F)?new it(F.map(fa)):new Ye(new Map(Object.entries(F).map(([ue,ne])=>[ue,fa(ne)])));case"function":return new wt((ue,ne)=>{const le=F(...ue.map(fe=>fe.value))??null;return fa(le)});default:throw new Error(`Cannot convert to runtime value: ${F}`)}}var Jt=`
`,ss="{%- ",wi=" -%}";function Mi(F){switch(F.operator.type){case"MultiplicativeBinaryOperator":return 4;case"AdditiveBinaryOperator":return 3;case"ComparisonBinaryOperator":return 2;case"Identifier":return F.operator.value==="and"?1:F.operator.value==="in"||F.operator.value==="not in"?2:0}return 0}function Xs(F,ue="	"){const ne=typeof ue=="number"?" ".repeat(ue):ue;return wa(F.body,0,ne).replace(/\n$/,"")}function Wn(...F){return ss+F.join(" ")+wi}function wa(F,ue,ne){return F.map(le=>Ra(le,ue,ne)).join(Jt)}function Ra(F,ue,ne){const le=ne.repeat(ue);switch(F.type){case"Program":return wa(F.body,ue,ne);case"If":return Bs(F,ue,ne);case"For":return Ft(F,ue,ne);case"Set":return Fn(F,ue,ne);case"Macro":return Ys(F,ue,ne);case"Break":return le+Wn("break");case"Continue":return le+Wn("continue");case"CallStatement":return Us(F,ue,ne);case"FilterStatement":return Ua(F,ue,ne);case"Comment":return le+"{# "+F.value+" #}";default:return le+"{{- "+qt(F)+" -}}"}}function Bs(F,ue,ne){const le=ne.repeat(ue),fe=[];let xe=F;for(;xe&&(fe.push({test:xe.test,body:xe.body}),xe.alternate.length===1&&xe.alternate[0].type==="If");)xe=xe.alternate[0];let Ne=le+Wn("if",qt(fe[0].test))+Jt+wa(fe[0].body,ue+1,ne);for(let ut=1;ut<fe.length;++ut)Ne+=Jt+le+Wn("elif",qt(fe[ut].test))+Jt+wa(fe[ut].body,ue+1,ne);return xe&&xe.alternate.length>0&&(Ne+=Jt+le+Wn("else")+Jt+wa(xe.alternate,ue+1,ne)),Ne+=Jt+le+Wn("endif"),Ne}function Ft(F,ue,ne){const le=ne.repeat(ue);let fe="";if(F.iterable.type==="SelectExpression"){const Ne=F.iterable;fe=`${qt(Ne.lhs)} if ${qt(Ne.test)}`}else fe=qt(F.iterable);let xe=le+Wn("for",qt(F.loopvar),"in",fe)+Jt+wa(F.body,ue+1,ne);return F.defaultBlock.length>0&&(xe+=Jt+le+Wn("else")+Jt+wa(F.defaultBlock,ue+1,ne)),xe+=Jt+le+Wn("endfor"),xe}function Fn(F,ue,ne){const le=ne.repeat(ue),fe=qt(F.assignee),xe=F.value?qt(F.value):"",Ne=le+Wn("set",`${fe}${F.value?" = "+xe:""}`);return F.body.length===0?Ne:Ne+Jt+wa(F.body,ue+1,ne)+Jt+le+Wn("endset")}function Ys(F,ue,ne){const le=ne.repeat(ue),fe=F.args.map(qt).join(", ");return le+Wn("macro",`${F.name.value}(${fe})`)+Jt+wa(F.body,ue+1,ne)+Jt+le+Wn("endmacro")}function Us(F,ue,ne){const le=ne.repeat(ue),fe=F.callerArgs&&F.callerArgs.length>0?`(${F.callerArgs.map(qt).join(", ")})`:"",xe=qt(F.call);let Ne=le+Wn(`call${fe}`,xe)+Jt;return Ne+=wa(F.body,ue+1,ne)+Jt,Ne+=le+Wn("endcall"),Ne}function Ua(F,ue,ne){const le=ne.repeat(ue),fe=F.filter.type==="Identifier"?F.filter.value:qt(F.filter);let xe=le+Wn("filter",fe)+Jt;return xe+=wa(F.body,ue+1,ne)+Jt,xe+=le+Wn("endfilter"),xe}function qt(F,ue=-1){switch(F.type){case"SpreadExpression":return`*${qt(F.argument)}`;case"Identifier":return F.value;case"IntegerLiteral":return`${F.value}`;case"FloatLiteral":return`${F.value}`;case"StringLiteral":return JSON.stringify(F.value);case"BinaryExpression":{const ne=F,le=Mi(ne),fe=qt(ne.left,le),xe=qt(ne.right,le+1),Ne=`${fe} ${ne.operator.value} ${xe}`;return le<ue?`(${Ne})`:Ne}case"UnaryExpression":{const ne=F;return ne.operator.value+(ne.operator.value==="not"?" ":"")+qt(ne.argument,1/0)}case"CallExpression":{const ne=F,le=ne.args.map(qt).join(", ");return`${qt(ne.callee)}(${le})`}case"MemberExpression":{const ne=F;let le=qt(ne.object);["Identifier","MemberExpression","CallExpression","StringLiteral","IntegerLiteral","FloatLiteral","ArrayLiteral","TupleLiteral","ObjectLiteral"].includes(ne.object.type)||(le=`(${le})`);let fe=qt(ne.property);return!ne.computed&&ne.property.type!=="Identifier"&&(fe=`(${fe})`),ne.computed?`${le}[${fe}]`:`${le}.${fe}`}case"FilterExpression":{const ne=F,le=qt(ne.operand,1/0);return ne.filter.type==="CallExpression"?`${le} | ${qt(ne.filter)}`:`${le} | ${ne.filter.value}`}case"SelectExpression":{const ne=F;return`${qt(ne.lhs)} if ${qt(ne.test)}`}case"TestExpression":{const ne=F;return`${qt(ne.operand)} is${ne.negate?" not":""} ${ne.test.value}`}case"ArrayLiteral":case"TupleLiteral":{const ne=F.value.map(qt),le=F.type==="ArrayLiteral"?"[]":"()";return`${le[0]}${ne.join(", ")}${le[1]}`}case"ObjectLiteral":return`{${Array.from(F.value.entries()).map(([le,fe])=>`${qt(le)}: ${qt(fe)}`).join(", ")}}`;case"SliceExpression":{const ne=F,le=ne.start?qt(ne.start):"",fe=ne.stop?qt(ne.stop):"",xe=ne.step?`:${qt(ne.step)}`:"";return`${le}:${fe}${xe}`}case"KeywordArgumentExpression":{const ne=F;return`${ne.key.value}=${qt(ne.value)}`}case"Ternary":{const ne=F,le=`${qt(ne.trueExpr)} if ${qt(ne.condition,0)} else ${qt(ne.falseExpr)}`;return ue>-1?`(${le})`:le}default:throw new Error(`Unknown expression type: ${F.type}`)}}var Zs=class{parsed;constructor(F){const ue=_(F,{lstrip_blocks:!0,trim_blocks:!0});this.parsed=Pe(ue)}render(F){const ue=new St;if(Lt(ue),F)for(const[fe,xe]of Object.entries(F))ue.set(fe,xe);return new Mn(ue).run(this.parsed).value}format(F){return Xs(this.parsed,F?.indent||"	")}}}),"./src/backends/onnx.js":((e,n,t)=>{var s;t.r(n),t.d(n,{Tensor:()=>u.Tensor,createInferenceSession:()=>k,deviceToExecutionProviders:()=>v,isONNXProxy:()=>P,isONNXTensor:()=>w,runInferenceSession:()=>$});var i=t("./src/env.js"),l=t("?2ce3"),c=t("onnxruntime-web"),u=t("onnxruntime-common");const d=Object.freeze({auto:null,gpu:null,cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:{name:"webnn",deviceType:"cpu"},"webnn-npu":{name:"webnn",deviceType:"npu"},"webnn-gpu":{name:"webnn",deviceType:"gpu"},"webnn-cpu":{name:"webnn",deviceType:"cpu"}}),f=[];let m,_;const p=Symbol.for("onnxruntime");if(p in globalThis)_=globalThis[p];else if(i.apis.IS_NODE_ENV){switch(_=l??(s||(s=t.t(l,2))),process.platform){case"win32":f.push("dml");break;case"linux":process.arch==="x64"&&f.push("cuda");break}f.push("cpu"),m=["cpu"]}else _=c,i.apis.IS_WEBNN_AVAILABLE&&f.push("webnn-npu","webnn-gpu","webnn-cpu","webnn"),i.apis.IS_WEBGPU_AVAILABLE&&f.push("webgpu"),f.push("wasm"),m=["wasm"];const y=_.InferenceSession;function v(A=null){if(!A)return m;switch(A){case"auto":return f;case"gpu":return f.filter(I=>["webgpu","cuda","dml","webnn-gpu"].includes(I))}if(f.includes(A))return[d[A]??A];throw new Error(`Unsupported device: "${A}". Should be one of: ${f.join(", ")}.`)}let T=null;async function k(A,I,W){T&&await T;const G=y.create(A,I);T??=G;const q=await G;return q.config=W,q}let b=Promise.resolve();const S=i.apis.IS_BROWSER_ENV||i.apis.IS_WEBWORKER_ENV;async function $(A,I){const W=()=>A.run(I);return await(S?b=b.then(W):W())}function w(A){return A instanceof _.Tensor}const C=_?.env;C?.wasm&&(!(typeof ServiceWorkerGlobalScope<"u"&&self instanceof ServiceWorkerGlobalScope)&&!C.wasm.wasmPaths&&(C.wasm.wasmPaths=`https://cdn.jsdelivr.net/npm/@huggingface/transformers@${i.env.version}/dist/`),C.wasm.proxy=!1),C?.webgpu&&(C.webgpu.powerPreference="high-performance");function P(){return C?.wasm?.proxy}i.env.backends.onnx=C}),"./src/base/feature_extraction_utils.js":((e,n,t)=>{t.r(n),t.d(n,{FeatureExtractor:()=>c,validate_audio_inputs:()=>u});var s=t("./src/utils/constants.js"),i=t("./src/utils/generic.js"),l=t("./src/utils/hub.js");class c extends i.Callable{constructor(f){super(),this.config=f}static async from_pretrained(f,m={}){const _=await(0,l.getModelJSON)(f,s.FEATURE_EXTRACTOR_NAME,!0,m);return new this(_)}}function u(d,f){if(!(d instanceof Float32Array||d instanceof Float64Array))throw new Error(`${f} expects input to be a Float32Array or a Float64Array, but got ${d?.constructor?.name??typeof d} instead. If using the feature extractor directly, remember to use \`read_audio(url, sampling_rate)\` to obtain the raw audio data of the file/url.`)}}),"./src/base/image_processors_utils.js":((e,n,t)=>{t.r(n),t.d(n,{ImageProcessor:()=>w,center_to_corners_format:()=>_,post_process_instance_segmentation:()=>$,post_process_object_detection:()=>p,post_process_panoptic_segmentation:()=>S,post_process_semantic_segmentation:()=>y});var s=t("./src/utils/generic.js"),i=t("./src/utils/tensor.js"),l=t("./src/utils/maths.js");t("./src/utils/image.js");var c=t("./src/utils/core.js"),u=t("./src/utils/hub.js"),d=t("./src/utils/constants.js");function f(C,P,A=0,I=null){const W=C/P;let G=(0,l.bankers_round)(W)*P;return I!==null&&G>I&&(G=Math.floor(W)*P),G<A&&(G=Math.ceil(W)*P),G}function m([C,P],A){return[Math.max(Math.floor(C/A),1)*A,Math.max(Math.floor(P/A),1)*A]}function _([C,P,A,I]){return[C-A/2,P-I/2,C+A/2,P+I/2]}function p(C,P=.5,A=null,I=!1){const W=C.logits,G=C.pred_boxes,[q,Z,X]=W.dims;if(A!==null&&A.length!==q)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let Q=[];for(let te=0;te<q;++te){let R=A!==null?A[te]:null,ee={boxes:[],classes:[],scores:[]},ie=W[te],he=G[te];for(let _e=0;_e<Z;++_e){let U=ie[_e],K=[],H;if(I){H=U.sigmoid().data;for(let B=0;B<H.length;++B)H[B]>P&&K.push(B)}else{let B=(0,l.max)(U.data)[1];if(B===X-1||(H=(0,l.softmax)(U.data),H[B]<P))continue;K.push(B)}for(const B of K){let ce=he[_e].data;ce=_(ce),R!==null&&(ce=ce.map((ve,Pe)=>ve*R[(Pe+1)%2])),ee.boxes.push(ce),ee.classes.push(B),ee.scores.push(H[B])}}Q.push(ee)}return Q}function y(C,P=null){const A=C.logits,I=A.dims[0];if(P!==null&&P.length!==I)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const W=[];for(let G=0;G<I;++G){const q=P!==null?P[G]:null;let Z=A[G];q!==null&&(Z=(0,i.interpolate)(Z,q,"bilinear",!1));const[X,Q]=q??Z.dims.slice(-2),te=new i.Tensor("int32",new Int32Array(X*Q),[X,Q]),R=Z[0].data,ee=te.data;for(let _e=1;_e<Z.dims[0];++_e){const U=Z[_e].data;for(let K=0;K<U.length;++K)U[K]>R[K]&&(R[K]=U[K],ee[K]=_e)}const ie=new Array(Z.dims[0]);for(let _e=0;_e<ee.length;++_e){const U=ee[_e];ie[U]=U}const he=ie.filter(_e=>_e!==void 0);W.push({segmentation:te,labels:he})}return W}function v(C,P,A,I){const W=[],G=[],q=[];for(let Z=0;Z<C.dims[0];++Z){const X=C[Z],Q=P[Z],te=(0,l.max)(X.data)[1];if(te===I)continue;const ee=(0,l.softmax)(X.data)[te];ee>A&&(W.push(Q),G.push(ee),q.push(te))}return[W,G,q]}function T(C,P,A,I=.5,W=.8){const G=[];let q=0,Z=0;const X=P[A].data;for(let te=0;te<C.length;++te)C[te]===A&&(G.push(te),++q),X[te]>=I&&++Z;let Q=q>0&&Z>0;return Q&&(Q=q/Z>W),[Q,G]}function k(C,P,A,I,W,G=null,q=null){const[Z,X]=q??C[0].dims,Q=new i.Tensor("int32",new Int32Array(Z*X),[Z,X]),te=[];if(q!==null)for(let _e=0;_e<C.length;++_e)C[_e]=(0,i.interpolate)(C[_e],q,"bilinear",!1);const R=new Int32Array(C[0].data.length),ee=new Float32Array(C[0].data.length);for(let _e=0;_e<C.length;++_e){let U=P[_e];const K=C[_e].data;for(let H=0;H<K.length;++H)K[H]*=U,K[H]>ee[H]&&(R[H]=_e,ee[H]=K[H])}let ie=0;const he=Q.data;for(let _e=0;_e<A.length;++_e){const U=A[_e],[K,H]=T(R,C,_e,I,W);if(K){++ie;for(const B of H)he[B]=ie;te.push({id:ie,label_id:U,score:P[_e]})}}return[Q,te]}function b(C,P,A=28,I=3136,W=784*1280){if(C<A||P<A)throw new Error(`height:${C} or width:${P} must be larger than factor:${A}`);if(Math.max(C,P)/Math.min(C,P)>200)throw new Error(`absolute aspect ratio must be smaller than 200, got ${Math.max(C,P)/Math.min(C,P)}`);let G=Math.round(C/A)*A,q=Math.round(P/A)*A;if(G*q>W){const Z=Math.sqrt(C*P/W);G=Math.floor(C/Z/A)*A,q=Math.floor(P/Z/A)*A}else if(G*q<I){const Z=Math.sqrt(I/(C*P));G=Math.ceil(C*Z/A)*A,q=Math.ceil(P*Z/A)*A}return[G,q]}function S(C,P=.5,A=.5,I=.8,W=null,G=null){W===null&&(console.warn("`label_ids_to_fuse` unset. No instance will be fused."),W=new Set);const q=C.class_queries_logits??C.logits,X=(C.masks_queries_logits??C.pred_masks).sigmoid();let[Q,te,R]=q.dims;if(R-=1,G!==null&&G.length!==Q)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");let ee=[];for(let ie=0;ie<Q;++ie){let he=G!==null?G[ie]:null,_e=q[ie],U=X[ie],[K,H,B]=v(_e,U,P,R);if(B.length===0){let[Pe,ze]=he??U.dims.slice(-2),Ze=new i.Tensor("int32",new Int32Array(Pe*ze).fill(-1),[Pe,ze]);ee.push({segmentation:Ze,segments_info:[]});continue}let[ce,ve]=k(K,H,B,A,I,W,he);ee.push({segmentation:ce,segments_info:ve})}return ee}function $(C,P=.5,A=null){throw new Error("`post_process_instance_segmentation` is not yet implemented.")}class w extends s.Callable{constructor(P){super(),this.image_mean=P.image_mean??P.mean,this.image_std=P.image_std??P.std,this.resample=P.resample??2,this.do_rescale=P.do_rescale??!0,this.rescale_factor=P.rescale_factor??1/255,this.do_normalize=P.do_normalize,this.do_thumbnail=P.do_thumbnail,this.size=P.size??P.image_size,this.do_resize=P.do_resize??this.size!==void 0,this.size_divisibility=P.size_divisibility??P.size_divisor,this.do_center_crop=P.do_center_crop,this.crop_size=P.crop_size,this.do_convert_rgb=P.do_convert_rgb??!0,this.do_crop_margin=P.do_crop_margin,this.pad_size=P.pad_size,this.do_pad=P.do_pad,this.min_pixels=P.min_pixels,this.max_pixels=P.max_pixels,this.do_pad&&!this.pad_size&&this.size&&this.size.width!==void 0&&this.size.height!==void 0&&(this.pad_size=this.size),this.do_flip_channel_order=P.do_flip_channel_order??!1,this.config=P}async thumbnail(P,A,I=2){const W=P.height,G=P.width,q=A.height,Z=A.width;let X=Math.min(W,q),Q=Math.min(G,Z);return X===W&&Q===G?P:(W>G?Q=Math.floor(G*X/W):G>W&&(X=Math.floor(W*Q/G)),await P.resize(Q,X,{resample:I}))}async crop_margin(P,A=200){const I=P.clone().grayscale(),W=(0,l.min)(I.data)[0],q=(0,l.max)(I.data)[0]-W;if(q===0)return P;const Z=A/255;let X=I.width,Q=I.height,te=0,R=0;const ee=I.data;for(let ie=0;ie<I.height;++ie){const he=ie*I.width;for(let _e=0;_e<I.width;++_e)(ee[he+_e]-W)/q<Z&&(X=Math.min(X,_e),Q=Math.min(Q,ie),te=Math.max(te,_e),R=Math.max(R,ie))}return P=await P.crop([X,Q,te,R]),P}pad_image(P,A,I,{mode:W="constant",center:G=!1,constant_values:q=0}={}){const[Z,X,Q]=A;let te,R;if(typeof I=="number"?(te=I,R=I):I==="square"?te=R=Math.max(Z,X):(te=I.width,R=I.height),te!==X||R!==Z){const ee=new Float32Array(te*R*Q);if(Array.isArray(q))for(let _e=0;_e<ee.length;++_e)ee[_e]=q[_e%Q];else q!==0&&ee.fill(q);const[ie,he]=G?[Math.floor((te-X)/2),Math.floor((R-Z)/2)]:[0,0];for(let _e=0;_e<Z;++_e){const U=(_e+he)*te,K=_e*X;for(let H=0;H<X;++H){const B=(U+H+ie)*Q,ce=(K+H)*Q;for(let ve=0;ve<Q;++ve)ee[B+ve]=P[ce+ve]}}if(W==="symmetric"){if(G)throw new Error("`center` padding is not supported when `mode` is set to `symmetric`.");const _e=Z-1,U=X-1;for(let K=0;K<R;++K){const H=K*te,B=(0,c.calculateReflectOffset)(K,_e)*X;for(let ce=0;ce<te;++ce){if(K<Z&&ce<X)continue;const ve=(H+ce)*Q,Pe=(B+(0,c.calculateReflectOffset)(ce,U))*Q;for(let ze=0;ze<Q;++ze)ee[ve+ze]=P[Pe+ze]}}}P=ee,A=[R,te,Q]}return[P,A]}rescale(P){for(let A=0;A<P.length;++A)P[A]=this.rescale_factor*P[A]}get_resize_output_image_size(P,A){const[I,W]=P.size;let G,q;if(this.do_thumbnail){const{height:Z,width:X}=A;G=Math.min(Z,X)}else Number.isInteger(A)?(G=A,q=this.config.max_size??G):A!==void 0&&(G=A.shortest_edge,q=A.longest_edge);if(G!==void 0||q!==void 0){const Z=G===void 0?1:Math.max(G/I,G/W),X=I*Z,Q=W*Z,te=q===void 0?1:Math.min(q/X,q/Q);let R=Math.floor(Number((X*te).toFixed(2))),ee=Math.floor(Number((Q*te).toFixed(2)));return this.size_divisibility!==void 0&&([R,ee]=m([R,ee],this.size_divisibility)),[R,ee]}else if(A!==void 0&&A.width!==void 0&&A.height!==void 0){let Z=A.width,X=A.height;if(this.config.keep_aspect_ratio&&this.config.ensure_multiple_of){let Q=X/W,te=Z/I;Math.abs(1-te)<Math.abs(1-Q)?Q=te:te=Q,X=f(Q*W,this.config.ensure_multiple_of),Z=f(te*I,this.config.ensure_multiple_of)}return[Z,X]}else{if(this.size_divisibility!==void 0)return m([I,W],this.size_divisibility);if(this.min_pixels!==void 0&&this.max_pixels!==void 0){const Z=this.config.patch_size*this.config.merge_size;return b(W,I,Z,this.min_pixels,this.max_pixels)}else throw new Error(`Could not resize image due to unsupported \`this.size\` option in config: ${JSON.stringify(A)}`)}}async resize(P){const[A,I]=this.get_resize_output_image_size(P,this.size);return await P.resize(A,I,{resample:this.resample})}async preprocess(P,{do_normalize:A=null,do_pad:I=null,do_convert_rgb:W=null,do_convert_grayscale:G=null,do_flip_channel_order:q=null}={}){this.do_crop_margin&&(P=await this.crop_margin(P));const[Z,X]=P.size;if(W??this.do_convert_rgb?P=P.rgb():G&&(P=P.grayscale()),this.do_resize&&(P=await this.resize(P)),this.do_thumbnail&&(P=await this.thumbnail(P,this.size,this.resample)),this.do_center_crop){let ie,he;Number.isInteger(this.crop_size)?(ie=this.crop_size,he=this.crop_size):(ie=this.crop_size.width,he=this.crop_size.height),P=await P.center_crop(ie,he)}const Q=[P.height,P.width];let te=Float32Array.from(P.data),R=[P.height,P.width,P.channels];if(this.do_rescale&&this.rescale(te),A??this.do_normalize){let ie=this.image_mean;Array.isArray(this.image_mean)||(ie=new Array(P.channels).fill(ie));let he=this.image_std;if(Array.isArray(this.image_std)||(he=new Array(P.channels).fill(he)),ie.length!==P.channels||he.length!==P.channels)throw new Error(`When set to arrays, the length of \`image_mean\` (${ie.length}) and \`image_std\` (${he.length}) must match the number of channels in the image (${P.channels}).`);for(let _e=0;_e<te.length;_e+=P.channels)for(let U=0;U<P.channels;++U)te[_e+U]=(te[_e+U]-ie[U])/he[U]}if(I??this.do_pad){if(this.pad_size)[te,R]=this.pad_image(te,[P.height,P.width,P.channels],this.pad_size);else if(this.size_divisibility){const[ie,he]=m([R[1],R[0]],this.size_divisibility);[te,R]=this.pad_image(te,R,{width:ie,height:he})}}if(q??this.do_flip_channel_order){if(R[2]!==3)throw new Error("Flipping channel order is only supported for RGB images.");for(let ie=0;ie<te.length;ie+=3){const he=te[ie];te[ie]=te[ie+2],te[ie+2]=he}}const ee=new i.Tensor("float32",te,R).permute(2,0,1);return{original_size:[X,Z],reshaped_input_size:Q,pixel_values:ee}}async _call(P,...A){Array.isArray(P)||(P=[P]);const I=await Promise.all(P.map(G=>this.preprocess(G)));return{pixel_values:(0,i.stack)(I.map(G=>G.pixel_values),0),original_sizes:I.map(G=>G.original_size),reshaped_input_sizes:I.map(G=>G.reshaped_input_size)}}static async from_pretrained(P,A={}){const I=await(0,u.getModelJSON)(P,d.IMAGE_PROCESSOR_NAME,!0,A);return new this(I)}}}),"./src/base/processing_utils.js":((e,n,t)=>{t.r(n),t.d(n,{Processor:()=>c});var s=t("./src/utils/constants.js"),i=t("./src/utils/generic.js"),l=t("./src/utils/hub.js");class c extends i.Callable{static classes=["image_processor_class","tokenizer_class","feature_extractor_class"];static uses_processor_config=!1;static uses_chat_template_file=!1;constructor(d,f,m){super(),this.config=d,this.components=f,this.chat_template=m}get image_processor(){return this.components.image_processor}get tokenizer(){return this.components.tokenizer}get feature_extractor(){return this.components.feature_extractor}apply_chat_template(d,f={}){if(!this.tokenizer)throw new Error("Unable to apply chat template without a tokenizer.");return this.tokenizer.apply_chat_template(d,{tokenize:!1,chat_template:this.chat_template??void 0,...f})}batch_decode(...d){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.batch_decode(...d)}decode(...d){if(!this.tokenizer)throw new Error("Unable to decode without a tokenizer.");return this.tokenizer.decode(...d)}async _call(d,...f){for(const m of[this.image_processor,this.feature_extractor,this.tokenizer])if(m)return m(d,...f);throw new Error("No image processor, feature extractor, or tokenizer found.")}static async from_pretrained(d,f={}){const[m,_,p]=await Promise.all([this.uses_processor_config?(0,l.getModelJSON)(d,s.PROCESSOR_NAME,!0,f):{},Promise.all(this.classes.filter(y=>y in this).map(async y=>{const v=await this[y].from_pretrained(d,f);return[y.replace(/_class$/,""),v]})).then(Object.fromEntries),this.uses_chat_template_file?(0,l.getModelText)(d,s.CHAT_TEMPLATE_NAME,!0,f):null]);return new this(m,_,p)}}}),"./src/configs.js":((e,n,t)=>{t.r(n),t.d(n,{AutoConfig:()=>m,PretrainedConfig:()=>f,getCacheShapes:()=>u});var s=t("./src/utils/core.js"),i=t("./src/utils/hub.js");async function l(_,p){return await(0,i.getModelJSON)(_,"config.json",!0,p)}function c(_){const p={};let y={};switch(_.model_type){case"llava":case"paligemma":case"gemma3":case"florence2":case"llava_onevision":case"idefics3":case"ultravox":case"voxtral":case"smolvlm":case"gemma3n":case"mistral3":y=c(_.text_config);break;case"moondream1":y=c(_.phi_config);break;case"musicgen":y=c(_.decoder);break;case"multi_modality":y=c(_.language_config);break;case"gpt2":case"gptj":case"jais":case"codegen":case"gpt_bigcode":p.num_heads="n_head",p.num_layers="n_layer",p.hidden_size="n_embd";break;case"gpt_neox":case"stablelm":case"opt":case"falcon":case"modernbert-decoder":p.num_heads="num_attention_heads",p.num_layers="num_hidden_layers",p.hidden_size="hidden_size";break;case"llama":case"llama4_text":case"nanochat":case"arcee":case"lfm2":case"smollm3":case"olmo":case"olmo2":case"mobilellm":case"granite":case"granitemoehybrid":case"cohere":case"mistral":case"starcoder2":case"qwen2":case"qwen2_vl":case"phi":case"phi3":case"phi3_v":case"llava_qwen2":p.num_heads="num_key_value_heads",p.num_layers="num_hidden_layers",p.hidden_size="hidden_size",p.num_attention_heads="num_attention_heads",p.dim_kv="head_dim";break;case"qwen3":case"gemma":case"gemma2":case"vaultgemma":case"gemma3_text":case"gemma3n_text":case"glm":case"helium":case"ernie4_5":case"ministral":case"ministral3":p.num_heads="num_key_value_heads",p.num_layers="num_hidden_layers",p.dim_kv="head_dim";break;case"openelm":p.num_heads="num_kv_heads",p.num_layers="num_transformer_layers",p.dim_kv="head_dim";break;case"gpt_neo":case"donut-swin":p.num_heads="num_heads",p.num_layers="num_layers",p.hidden_size="hidden_size";break;case"bloom":p.num_heads="n_head",p.num_layers="n_layer",p.hidden_size="hidden_size";break;case"mpt":p.num_heads="n_heads",p.num_layers="n_layers",p.hidden_size="d_model";break;case"exaone":p.num_heads="num_key_value_heads",p.num_layers="num_layers",p.dim_kv="head_dim",p.num_attention_heads="num_attention_heads";break;case"t5":case"mt5":case"longt5":p.num_decoder_layers="num_decoder_layers",p.num_decoder_heads="num_heads",p.decoder_dim_kv="d_kv",p.num_encoder_layers="num_layers",p.num_encoder_heads="num_heads",p.encoder_dim_kv="d_kv";break;case"bart":case"mbart":case"marian":case"whisper":case"lite-whisper":case"m2m_100":case"blenderbot":case"blenderbot-small":case"florence2_language":p.num_decoder_layers="decoder_layers",p.num_decoder_heads="decoder_attention_heads",p.decoder_hidden_size="d_model",p.num_encoder_layers="encoder_layers",p.num_encoder_heads="encoder_attention_heads",p.encoder_hidden_size="d_model";break;case"speecht5":p.num_decoder_layers="decoder_layers",p.num_decoder_heads="decoder_attention_heads",p.decoder_hidden_size="hidden_size",p.num_encoder_layers="encoder_layers",p.num_encoder_heads="encoder_attention_heads",p.encoder_hidden_size="hidden_size";break;case"trocr":p.num_encoder_layers=p.num_decoder_layers="decoder_layers",p.num_encoder_heads=p.num_decoder_heads="decoder_attention_heads",p.encoder_hidden_size=p.decoder_hidden_size="d_model";break;case"musicgen_decoder":p.num_encoder_layers=p.num_decoder_layers="num_hidden_layers",p.num_encoder_heads=p.num_decoder_heads="num_attention_heads",p.encoder_hidden_size=p.decoder_hidden_size="hidden_size";break;case"moonshine":p.num_decoder_layers="decoder_num_hidden_layers",p.num_decoder_heads="decoder_num_key_value_heads",p.num_encoder_layers="encoder_num_hidden_layers",p.num_encoder_heads="encoder_num_key_value_heads",p.encoder_hidden_size=p.decoder_hidden_size="hidden_size";break;case"vision-encoder-decoder":const T=c(_.decoder),k="num_decoder_layers"in T,b=(0,s.pick)(_,["model_type","is_encoder_decoder"]);return k?(b.num_decoder_layers=T.num_decoder_layers,b.num_decoder_heads=T.num_decoder_heads,b.decoder_hidden_size=T.decoder_hidden_size,b.num_encoder_layers=T.num_encoder_layers,b.num_encoder_heads=T.num_encoder_heads,b.encoder_hidden_size=T.encoder_hidden_size):(b.num_layers=T.num_layers,b.num_heads=T.num_heads,b.hidden_size=T.hidden_size),b}const v={...y,...(0,s.pick)(_,["model_type","multi_query","is_encoder_decoder"])};for(const T in p)v[T]=_[p[T]];return v}function u(_,p){if(_.model_type==="lfm2"){const y=p?.prefix??"past_key_values",v=y==="present"?"present":"past",T={},{layer_types:k,num_attention_heads:b,num_key_value_heads:S,hidden_size:$,conv_L_cache:w}=_,C=$/b,P=p?.batch_size??1;for(let A=0;A<k.length;++A)if(k[A]==="full_attention")for(const I of["key","value"])T[`${y}.${A}.${I}`]=[P,S,0,C];else if(k[A]==="conv")T[`${v}_conv.${A}`]=[P,$,w];else throw new Error(`Unsupported layer type: ${k[A]}`);return T}return d(_,p)}function d(_,{prefix:p="past_key_values",batch_size:y=1}={}){const v={},T=_.normalized_config;if(T.is_encoder_decoder&&"num_encoder_heads"in T&&"num_decoder_heads"in T){const k=T.encoder_dim_kv??T.encoder_hidden_size/T.num_encoder_heads,b=T.decoder_dim_kv??T.decoder_hidden_size/T.num_decoder_heads,S=[y,T.num_encoder_heads,0,k],$=[y,T.num_decoder_heads,0,b];for(let w=0;w<T.num_decoder_layers;++w)v[`${p}.${w}.encoder.key`]=S,v[`${p}.${w}.encoder.value`]=S,v[`${p}.${w}.decoder.key`]=$,v[`${p}.${w}.decoder.value`]=$}else{const k=T.num_heads,b=T.num_layers,S=T.dim_kv??T.hidden_size/(T.num_attention_heads??k);if(T.model_type==="falcon"){const $=[y*k,0,S];for(let w=0;w<b;++w)v[`${p}.${w}.key`]=$,v[`${p}.${w}.value`]=$}else if(T.multi_query){const $=[y*k,0,2*S];for(let w=0;w<b;++w)v[`${p}.${w}.key_value`]=$}else if(T.model_type==="bloom"){const $=[y*k,S,0],w=[y*k,0,S];for(let C=0;C<b;++C)v[`${p}.${C}.key`]=$,v[`${p}.${C}.value`]=w}else if(T.model_type==="openelm")for(let $=0;$<b;++$){const w=[y,k[$],0,S];v[`${p}.${$}.key`]=w,v[`${p}.${$}.value`]=w}else{const $=[y,k,0,S];for(let w=0;w<b;++w)v[`${p}.${w}.key`]=$,v[`${p}.${w}.value`]=$}}return v}class f{model_type=null;is_encoder_decoder=!1;max_position_embeddings;"transformers.js_config";constructor(p){Object.assign(this,p),this.normalized_config=c(this)}static async from_pretrained(p,{progress_callback:y=null,config:v=null,cache_dir:T=null,local_files_only:k=!1,revision:b="main"}={}){v&&!(v instanceof f)&&(v=new f(v));const S=v??await l(p,{progress_callback:y,config:v,cache_dir:T,local_files_only:k,revision:b});return new this(S)}}class m{static async from_pretrained(...p){return f.from_pretrained(...p)}}}),"./src/env.js":((e,n,t)=>{t.r(n),t.d(n,{apis:()=>b,env:()=>A});var s=t("?db59"),i=t("?383f"),l=t("?fa4b");const c="3.8.1",u=typeof window<"u"&&typeof window.document<"u",d=typeof self<"u"&&["DedicatedWorkerGlobalScope","ServiceWorkerGlobalScope","SharedWorkerGlobalScope"].includes(self.constructor?.name),f=typeof self<"u"&&"caches"in self,m=typeof navigator<"u"&&"gpu"in navigator,_=typeof navigator<"u"&&"ml"in navigator,p=typeof process<"u",y=p&&process?.release?.name==="node",v=!I(s),T=!I(i),k=typeof globalThis.Deno<"u",b=Object.freeze({IS_BROWSER_ENV:u,IS_WEBWORKER_ENV:d,IS_WEB_CACHE_AVAILABLE:f,IS_WEBGPU_AVAILABLE:m,IS_WEBNN_AVAILABLE:_,IS_PROCESS_AVAILABLE:p,IS_NODE_ENV:y,IS_FS_AVAILABLE:v,IS_PATH_AVAILABLE:T}),S=v&&T;let $="./";if(S){const W=Object(import.meta).url;W?$=i.dirname(i.dirname(l.fileURLToPath(W))):typeof __dirname<"u"&&($=i.dirname(__dirname))}const w=S?i.join($,"/.cache/"):null,C="/models/",P=S?i.join($,C):C,A={version:c,backends:{onnx:{}},allowRemoteModels:!0,remoteHost:"https://huggingface.co/",remotePathTemplate:"{model}/resolve/{revision}/",allowLocalModels:!(u||d),localModelPath:P,useFS:v,useBrowserCache:f&&!k,useFSCache:v,cacheDir:w,useCustomCache:!1,customCache:null};function I(W){return Object.keys(W).length===0}}),"./src/generation/configuration_utils.js":((e,n,t)=>{t.r(n),t.d(n,{GenerationConfig:()=>i});var s=t("./src/utils/core.js");class i{max_length=20;max_new_tokens=null;min_length=0;min_new_tokens=null;early_stopping=!1;max_time=null;do_sample=!1;num_beams=1;num_beam_groups=1;penalty_alpha=null;use_cache=!0;temperature=1;top_k=50;top_p=1;typical_p=1;epsilon_cutoff=0;eta_cutoff=0;diversity_penalty=0;repetition_penalty=1;encoder_repetition_penalty=1;length_penalty=1;no_repeat_ngram_size=0;bad_words_ids=null;force_words_ids=null;renormalize_logits=!1;constraints=null;forced_bos_token_id=null;forced_eos_token_id=null;remove_invalid_values=!1;exponential_decay_length_penalty=null;suppress_tokens=null;streamer=null;begin_suppress_tokens=null;forced_decoder_ids=null;guidance_scale=null;num_return_sequences=1;output_attentions=!1;output_hidden_states=!1;output_scores=!1;return_dict_in_generate=!1;pad_token_id=null;bos_token_id=null;eos_token_id=null;encoder_no_repeat_ngram_size=0;decoder_start_token_id=null;generation_kwargs={};constructor(c){Object.assign(this,(0,s.pick)(c,Object.getOwnPropertyNames(this)))}}}),"./src/generation/logits_process.js":((e,n,t)=>{t.r(n),t.d(n,{ClassifierFreeGuidanceLogitsProcessor:()=>b,ForcedBOSTokenLogitsProcessor:()=>d,ForcedEOSTokenLogitsProcessor:()=>f,LogitsProcessor:()=>l,LogitsProcessorList:()=>u,LogitsWarper:()=>c,MinLengthLogitsProcessor:()=>v,MinNewTokensLengthLogitsProcessor:()=>T,NoBadWordsLogitsProcessor:()=>k,NoRepeatNGramLogitsProcessor:()=>p,RepetitionPenaltyLogitsProcessor:()=>y,SuppressTokensAtBeginLogitsProcessor:()=>m,TemperatureLogitsWarper:()=>S,TopKLogitsWarper:()=>w,TopPLogitsWarper:()=>$,WhisperTimeStampLogitsProcessor:()=>_});var s=t("./src/utils/generic.js");t("./src/utils/tensor.js");var i=t("./src/utils/maths.js");class l extends s.Callable{_call(P,A){throw Error("`_call` should be implemented in a subclass")}}class c extends s.Callable{_call(P,A){throw Error("`_call` should be implemented in a subclass")}}class u extends s.Callable{constructor(){super(),this.processors=[]}push(P){this.processors.push(P)}extend(P){this.processors.push(...P)}_call(P,A){let I=A;for(const W of this.processors)I=W(P,I);return I}[Symbol.iterator](){return this.processors.values()}}class d extends l{constructor(P){super(),this.bos_token_id=P}_call(P,A){for(let I=0;I<P.length;++I)if(P[I].length===1){const W=A[I].data;W.fill(-1/0),W[this.bos_token_id]=0}return A}}class f extends l{constructor(P,A){super(),this.max_length=P,this.eos_token_id=Array.isArray(A)?A:[A]}_call(P,A){for(let I=0;I<P.length;++I)if(P[I].length===this.max_length-1){const W=A[I].data;W.fill(-1/0);for(const G of this.eos_token_id)W[G]=0}return A}}class m extends l{constructor(P,A){super(),this.begin_suppress_tokens=P,this.begin_index=A}_call(P,A){for(let I=0;I<P.length;++I)if(P[I].length===this.begin_index){const W=A[I].data;for(const G of this.begin_suppress_tokens)W[G]=-1/0}return A}}class _ extends l{constructor(P,A){super(),this.eos_token_id=Array.isArray(P.eos_token_id)?P.eos_token_id[0]:P.eos_token_id,this.no_timestamps_token_id=P.no_timestamps_token_id,this.timestamp_begin=this.no_timestamps_token_id+1,this.begin_index=A.length,A.at(-1)===this.no_timestamps_token_id&&(this.begin_index-=1),this.max_initial_timestamp_index=P.max_initial_timestamp_index}_call(P,A){for(let I=0;I<P.length;++I){const W=A[I].data;if(W[this.no_timestamps_token_id]=-1/0,P[I].length===this.begin_index-1){W.fill(-1/0),W[this.timestamp_begin]=0;continue}const G=P[I].slice(this.begin_index),q=G.length>=1&&G[G.length-1]>=this.timestamp_begin,Z=G.length<2||G[G.length-2]>=this.timestamp_begin;if(q&&(Z?W.subarray(this.timestamp_begin).fill(-1/0):W.subarray(0,this.eos_token_id).fill(-1/0)),P[I].length===this.begin_index&&this.max_initial_timestamp_index!==null){const R=this.timestamp_begin+this.max_initial_timestamp_index;W.subarray(R+1).fill(-1/0)}const X=(0,i.log_softmax)(W),Q=Math.log(X.subarray(this.timestamp_begin).map(Math.exp).reduce((R,ee)=>R+ee)),te=(0,i.max)(X.subarray(0,this.timestamp_begin))[0];Q>te&&W.subarray(0,this.timestamp_begin).fill(-1/0)}return A}}class p extends l{constructor(P){super(),this.no_repeat_ngram_size=P}getNgrams(P){const A=P.length,I=[];for(let G=0;G<A+1-this.no_repeat_ngram_size;++G){const q=[];for(let Z=0;Z<this.no_repeat_ngram_size;++Z)q.push(P[G+Z]);I.push(q.map(Number))}const W=new Map;for(const G of I){const q=G.slice(0,G.length-1),Z=JSON.stringify(q),X=W.get(Z)??[];X.push(G[G.length-1]),W.set(Z,X)}return W}getGeneratedNgrams(P,A){const I=A.slice(A.length+1-this.no_repeat_ngram_size,A.length);return P.get(JSON.stringify(I.map(Number)))??[]}calcBannedNgramTokens(P){const A=[];if(P.length+1<this.no_repeat_ngram_size)return A;{const I=this.getNgrams(P);return this.getGeneratedNgrams(I,P)}}_call(P,A){for(let I=0;I<P.length;++I){const W=A[I].data,G=this.calcBannedNgramTokens(P[I]);for(const q of G)W[q]=-1/0}return A}}class y extends l{constructor(P){super(),this.penalty=P}_call(P,A){for(let I=0;I<P.length;++I){const W=A[I].data;for(const G of new Set(P[I])){const q=Number(G);W[q]<0?W[q]*=this.penalty:W[q]/=this.penalty}}return A}}class v extends l{constructor(P,A){super(),this.min_length=P,this.eos_token_id=Array.isArray(A)?A:[A]}_call(P,A){for(let I=0;I<P.length;++I)if(P[I].length<this.min_length){const W=A[I].data;for(const G of this.eos_token_id)W[G]=-1/0}return A}}class T extends l{constructor(P,A,I){super(),this.prompt_length_to_skip=P,this.min_new_tokens=A,this.eos_token_id=Array.isArray(I)?I:[I]}_call(P,A){for(let I=0;I<P.length;++I)if(P[I].length-this.prompt_length_to_skip<this.min_new_tokens){const G=A[I].data;for(const q of this.eos_token_id)G[q]=-1/0}return A}}class k extends l{constructor(P,A){super(),this.bad_words_ids=P,this.eos_token_id=Array.isArray(A)?A:[A]}_call(P,A){for(let I=0;I<P.length;++I){const W=A[I].data,G=P[I];for(const q of this.bad_words_ids){if(G.length<q.length-1)continue;let Z=!0;for(let X=1;X<=q.length-1;++X)if(q.at(-X-1)!=G.at(-X)){Z=!1;break}Z&&(W[q.at(-1)]=-1/0)}}return A}}class b extends l{constructor(P){if(super(),P<=1)throw new Error(`Require guidance scale >1 to use the classifier free guidance processor, got guidance scale ${P}.`);this.guidance_scale=P}_call(P,A){if(A.dims[0]!==2*P.length)throw new Error(`Logits should have twice the batch size of the input ids, the first half of batches corresponding to the conditional inputs, and the second half of batches corresponding to the unconditional inputs. Got batch size ${A.dims[0]} for the logits and ${P.length} for the input ids.`);const I=P.length,W=A.slice([0,I],null),G=A.slice([I,A.dims[0]],null);for(let q=0;q<G.data.length;++q)G.data[q]+=(W.data[q]-G.data[q])*this.guidance_scale;return G}}class S extends c{constructor(P){super(),this.temperature=P}_call(P,A){const I=A.data;for(let W=0;W<I.length;++W)I[W]/=this.temperature;return A}}class $ extends c{constructor(P,{filter_value:A=-1/0,min_tokens_to_keep:I=1}={}){if(super(),P<0||P>1)throw new Error(`\`top_p\` must be a float > 0 and < 1, but is ${P}`);if(!Number.isInteger(I)||I<1)throw new Error(`\`min_tokens_to_keep\` must be a positive integer, but is ${I}`);this.top_p=P,this.filter_value=A,this.min_tokens_to_keep=I}}class w extends c{constructor(P,{filter_value:A=-1/0,min_tokens_to_keep:I=1}={}){if(super(),!Number.isInteger(P)||P<0)throw new Error(`\`top_k\` must be a positive integer, but is ${P}`);this.top_k=Math.max(P,I),this.filter_value=A}}}),"./src/generation/logits_sampler.js":((e,n,t)=>{t.r(n),t.d(n,{LogitsSampler:()=>c});var s=t("./src/utils/generic.js"),i=t("./src/utils/tensor.js"),l=t("./src/utils/maths.js");t("./src/generation/configuration_utils.js");class c extends s.Callable{constructor(_){super(),this.generation_config=_}async _call(_){return this.sample(_)}async sample(_){throw Error("sample should be implemented in subclasses.")}getLogits(_,p){let y=_.dims.at(-1),v=_.data;if(p===-1)v=v.slice(-y);else{let T=p*y;v=v.slice(T,T+y)}return v}randomSelect(_){let p=0;for(let v=0;v<_.length;++v)p+=_[v];let y=Math.random()*p;for(let v=0;v<_.length;++v)if(y-=_[v],y<=0)return v;return 0}static getSampler(_){if(_.do_sample)return new d(_);if(_.num_beams>1)return new f(_);if(_.num_return_sequences>1)throw Error(`num_return_sequences has to be 1 when doing greedy search, but is ${_.num_return_sequences}.`);return new u(_)}}class u extends c{async sample(_){const p=(0,l.max)(_.data)[1];return[[BigInt(p),0]]}}class d extends c{async sample(_){let p=_.dims.at(-1);this.generation_config.top_k>0&&(p=Math.min(this.generation_config.top_k,p));const[y,v]=await(0,i.topk)(_,p),T=(0,l.softmax)(y.data);return Array.from({length:this.generation_config.num_beams},()=>{const k=this.randomSelect(T);return[v.data[k],Math.log(T[k])]})}}class f extends c{async sample(_){let p=_.dims.at(-1);this.generation_config.top_k>0&&(p=Math.min(this.generation_config.top_k,p));const[y,v]=await(0,i.topk)(_,p),T=(0,l.softmax)(y.data);return Array.from({length:this.generation_config.num_beams},(k,b)=>[v.data[b],Math.log(T[b])])}}}),"./src/generation/stopping_criteria.js":((e,n,t)=>{t.r(n),t.d(n,{EosTokenCriteria:()=>u,InterruptableStoppingCriteria:()=>d,MaxLengthCriteria:()=>c,StoppingCriteria:()=>i,StoppingCriteriaList:()=>l});var s=t("./src/utils/generic.js");class i extends s.Callable{_call(m,_){throw Error("StoppingCriteria needs to be subclassed")}}class l extends s.Callable{constructor(){super(),this.criteria=[]}push(m){this.criteria.push(m)}extend(m){m instanceof l?m=m.criteria:m instanceof i&&(m=[m]),this.criteria.push(...m)}_call(m,_){const p=new Array(m.length).fill(!1);for(const y of this.criteria){const v=y(m,_);for(let T=0;T<p.length;++T)p[T]||=v[T]}return p}[Symbol.iterator](){return this.criteria.values()}}class c extends i{constructor(m,_=null){super(),this.max_length=m,this.max_position_embeddings=_}_call(m){return m.map(_=>_.length>=this.max_length)}}class u extends i{constructor(m){super(),Array.isArray(m)||(m=[m]),this.eos_token_id=m}_call(m,_){return m.map(p=>{const y=p.at(-1);return this.eos_token_id.some(v=>y==v)})}}class d extends i{constructor(){super(),this.interrupted=!1}interrupt(){this.interrupted=!0}reset(){this.interrupted=!1}_call(m,_){return new Array(m.length).fill(this.interrupted)}}}),"./src/generation/streamers.js":((e,n,t)=>{t.r(n),t.d(n,{BaseStreamer:()=>c,TextStreamer:()=>d,WhisperTextStreamer:()=>f});var s=t("./src/utils/core.js"),i=t("./src/tokenizers.js"),l=t("./src/env.js");class c{put(_){throw Error("Not implemented")}end(){throw Error("Not implemented")}}const u=l.apis.IS_PROCESS_AVAILABLE?m=>process.stdout.write(m):m=>console.log(m);class d extends c{constructor(_,{skip_prompt:p=!1,callback_function:y=null,token_callback_function:v=null,skip_special_tokens:T=!0,decode_kwargs:k={},...b}={}){super(),this.tokenizer=_,this.skip_prompt=p,this.callback_function=y??u,this.token_callback_function=v,this.decode_kwargs={skip_special_tokens:T,...k,...b},this.token_cache=[],this.print_len=0,this.next_tokens_are_prompt=!0}put(_){if(_.length>1)throw Error("TextStreamer only supports batch size of 1");const p=this.next_tokens_are_prompt;if(p&&(this.next_tokens_are_prompt=!1,this.skip_prompt))return;const y=_[0];this.token_callback_function?.(y),this.token_cache=(0,s.mergeArrays)(this.token_cache,y);const v=this.tokenizer.decode(this.token_cache,this.decode_kwargs);let T;p||v.endsWith(`
`)?(T=v.slice(this.print_len),this.token_cache=[],this.print_len=0):v.length>0&&(0,i.is_chinese_char)(v.charCodeAt(v.length-1))?(T=v.slice(this.print_len),this.print_len+=T.length):(T=v.slice(this.print_len,v.lastIndexOf(" ")+1),this.print_len+=T.length),this.on_finalized_text(T,!1)}end(){let _;this.token_cache.length>0?(_=this.tokenizer.decode(this.token_cache,this.decode_kwargs).slice(this.print_len),this.token_cache=[],this.print_len=0):_="",this.next_tokens_are_prompt=!0,this.on_finalized_text(_,!0)}on_finalized_text(_,p){_.length>0&&this.callback_function?.(_),p&&this.callback_function===u&&l.apis.IS_PROCESS_AVAILABLE&&this.callback_function?.(`
`)}}class f extends d{constructor(_,{skip_prompt:p=!1,callback_function:y=null,token_callback_function:v=null,on_chunk_start:T=null,on_chunk_end:k=null,on_finalize:b=null,time_precision:S=.02,skip_special_tokens:$=!0,decode_kwargs:w={}}={}){super(_,{skip_prompt:p,skip_special_tokens:$,callback_function:y,token_callback_function:v,decode_kwargs:w}),this.timestamp_begin=_.timestamp_begin,this.on_chunk_start=T,this.on_chunk_end=k,this.on_finalize=b,this.time_precision=S,this.waiting_for_timestamp=!1}put(_){if(_.length>1)throw Error("WhisperTextStreamer only supports batch size of 1");const p=_[0];if(p.length===1){const y=Number(p[0])-this.timestamp_begin;if(y>=0){const v=y*this.time_precision;this.waiting_for_timestamp?this.on_chunk_end?.(v):this.on_chunk_start?.(v),this.waiting_for_timestamp=!this.waiting_for_timestamp,this.token_callback_function?.(p);return}}return super.put(_)}end(){super.end(),this.on_finalize?.()}}}),"./src/models.js":((e,n,t)=>{t.r(n),t.d(n,{ASTForAudioClassification:()=>io,ASTModel:()=>mc,ASTPreTrainedModel:()=>pc,AlbertForMaskedLM:()=>pt,AlbertForQuestionAnswering:()=>bt,AlbertForSequenceClassification:()=>gt,AlbertModel:()=>vt,AlbertPreTrainedModel:()=>qe,ArceeForCausalLM:()=>Mc,ArceeModel:()=>Gu,ArceePreTrainedModel:()=>ki,AutoModel:()=>bg,AutoModelForAudioClassification:()=>Ep,AutoModelForAudioFrameClassification:()=>n_,AutoModelForAudioTextToText:()=>hn,AutoModelForCTC:()=>Eg,AutoModelForCausalLM:()=>xp,AutoModelForDepthEstimation:()=>Cg,AutoModelForDocumentQuestionAnswering:()=>Sg,AutoModelForImageClassification:()=>Lr,AutoModelForImageFeatureExtraction:()=>Pg,AutoModelForImageMatting:()=>Sp,AutoModelForImageSegmentation:()=>lu,AutoModelForImageTextToText:()=>a_,AutoModelForImageToImage:()=>Cp,AutoModelForMaskGeneration:()=>e_,AutoModelForMaskedLM:()=>rf,AutoModelForNormalEstimation:()=>Ag,AutoModelForObjectDetection:()=>Zm,AutoModelForPoseEstimation:()=>cu,AutoModelForQuestionAnswering:()=>Tp,AutoModelForSemanticSegmentation:()=>Tg,AutoModelForSeq2SeqLM:()=>Mg,AutoModelForSequenceClassification:()=>Xm,AutoModelForSpeechSeq2Seq:()=>xg,AutoModelForTextToSpectrogram:()=>sf,AutoModelForTextToWaveform:()=>Kl,AutoModelForTokenClassification:()=>wg,AutoModelForUniversalSegmentation:()=>Ym,AutoModelForVision2Seq:()=>Ki,AutoModelForXVector:()=>t_,AutoModelForZeroShotObjectDetection:()=>Jm,BartForConditionalGeneration:()=>Vn,BartForSequenceClassification:()=>Jn,BartModel:()=>Ba,BartPretrainedModel:()=>pa,BaseModelOutput:()=>Fe,BeitForImageClassification:()=>Hf,BeitModel:()=>Fc,BeitPreTrainedModel:()=>ji,BertForMaskedLM:()=>He,BertForQuestionAnswering:()=>ke,BertForSequenceClassification:()=>De,BertForTokenClassification:()=>nt,BertModel:()=>Ue,BertPreTrainedModel:()=>Be,BlenderbotForConditionalGeneration:()=>gn,BlenderbotModel:()=>Kn,BlenderbotPreTrainedModel:()=>ma,BlenderbotSmallForConditionalGeneration:()=>Vs,BlenderbotSmallModel:()=>qa,BlenderbotSmallPreTrainedModel:()=>On,BloomForCausalLM:()=>Ml,BloomModel:()=>wl,BloomPreTrainedModel:()=>$c,CLIPModel:()=>fl,CLIPPreTrainedModel:()=>tr,CLIPSegForImageSegmentation:()=>Za,CLIPSegModel:()=>wc,CLIPSegPreTrainedModel:()=>po,CLIPTextModel:()=>Ai,CLIPTextModelWithProjection:()=>qr,CLIPVisionModel:()=>Vu,CLIPVisionModelWithProjection:()=>co,CamembertForMaskedLM:()=>xe,CamembertForQuestionAnswering:()=>xt,CamembertForSequenceClassification:()=>Ne,CamembertForTokenClassification:()=>ut,CamembertModel:()=>fe,CamembertPreTrainedModel:()=>le,CausalLMOutput:()=>hr,CausalLMOutputWithPast:()=>kg,ChineseCLIPModel:()=>pl,ChineseCLIPPreTrainedModel:()=>bc,ClapAudioModelWithProjection:()=>Wd,ClapModel:()=>Or,ClapPreTrainedModel:()=>Xc,ClapTextModelWithProjection:()=>ka,CodeGenForCausalLM:()=>rt,CodeGenModel:()=>We,CodeGenPreTrainedModel:()=>be,CohereForCausalLM:()=>Ka,CohereModel:()=>Df,CoherePreTrainedModel:()=>Cc,ConvBertForMaskedLM:()=>Ft,ConvBertForQuestionAnswering:()=>Us,ConvBertForSequenceClassification:()=>Fn,ConvBertForTokenClassification:()=>Ys,ConvBertModel:()=>Bs,ConvBertPreTrainedModel:()=>Ra,ConvNextForImageClassification:()=>Md,ConvNextModel:()=>uh,ConvNextPreTrainedModel:()=>Ol,ConvNextV2ForImageClassification:()=>hh,ConvNextV2Model:()=>fh,ConvNextV2PreTrainedModel:()=>dh,DFineForObjectDetection:()=>Do,DFineModel:()=>$l,DFinePreTrainedModel:()=>kl,DINOv3ConvNextModel:()=>Om,DINOv3ConvNextPreTrainedModel:()=>vh,DINOv3ViTModel:()=>yh,DINOv3ViTPreTrainedModel:()=>Td,DPTForDepthEstimation:()=>Xf,DPTModel:()=>Qf,DPTPreTrainedModel:()=>yd,DacDecoderModel:()=>tu,DacDecoderOutput:()=>Jc,DacEncoderModel:()=>eu,DacEncoderOutput:()=>Jd,DacModel:()=>rp,DacPreTrainedModel:()=>ts,DebertaForMaskedLM:()=>_t,DebertaForQuestionAnswering:()=>sa,DebertaForSequenceClassification:()=>Zt,DebertaForTokenClassification:()=>nn,DebertaModel:()=>Rt,DebertaPreTrainedModel:()=>ht,DebertaV2ForMaskedLM:()=>ia,DebertaV2ForQuestionAnswering:()=>Hn,DebertaV2ForSequenceClassification:()=>gs,DebertaV2ForTokenClassification:()=>Ma,DebertaV2Model:()=>Nn,DebertaV2PreTrainedModel:()=>ra,DecisionTransformerModel:()=>Zc,DecisionTransformerPreTrainedModel:()=>ap,DeiTForImageClassification:()=>$m,DeiTModel:()=>Kf,DeiTPreTrainedModel:()=>fd,DepthAnythingForDepthEstimation:()=>Zf,DepthAnythingPreTrainedModel:()=>Yf,DepthProForDepthEstimation:()=>th,DepthProPreTrainedModel:()=>eh,DetrForObjectDetection:()=>ws,DetrForSegmentation:()=>Ms,DetrModel:()=>od,DetrObjectDetectionOutput:()=>Pr,DetrPreTrainedModel:()=>Al,DetrSegmentationOutput:()=>ld,Dinov2ForImageClassification:()=>mh,Dinov2Model:()=>ph,Dinov2PreTrainedModel:()=>xd,Dinov2WithRegistersForImageClassification:()=>gh,Dinov2WithRegistersModel:()=>_h,Dinov2WithRegistersPreTrainedModel:()=>Gc,DistilBertForMaskedLM:()=>us,DistilBertForQuestionAnswering:()=>ha,DistilBertForSequenceClassification:()=>Wa,DistilBertForTokenClassification:()=>Zn,DistilBertModel:()=>Ga,DistilBertPreTrainedModel:()=>Va,DonutSwinModel:()=>Vc,DonutSwinPreTrainedModel:()=>ch,EdgeTamModel:()=>Th,EfficientNetForImageClassification:()=>Um,EfficientNetModel:()=>Jh,EfficientNetPreTrainedModel:()=>qd,ElectraForMaskedLM:()=>Zs,ElectraForQuestionAnswering:()=>ne,ElectraForSequenceClassification:()=>F,ElectraForTokenClassification:()=>ue,ElectraModel:()=>qt,ElectraPreTrainedModel:()=>Ua,Ernie4_5ForCausalLM:()=>lr,Ernie4_5Model:()=>Bl,Ernie4_5PreTrainedModel:()=>Bd,EsmForMaskedLM:()=>$s,EsmForSequenceClassification:()=>Ds,EsmForTokenClassification:()=>Ha,EsmModel:()=>Vr,EsmPreTrainedModel:()=>ks,ExaoneForCausalLM:()=>Pf,ExaoneModel:()=>Ku,ExaonePreTrainedModel:()=>Xr,FalconForCausalLM:()=>Qc,FalconModel:()=>Gd,FalconPreTrainedModel:()=>Kc,FastViTForImageClassification:()=>Uf,FastViTModel:()=>zc,FastViTPreTrainedModel:()=>Po,Florence2ForConditionalGeneration:()=>ll,Florence2PreTrainedModel:()=>Bu,GLPNForDepthEstimation:()=>Oo,GLPNModel:()=>lh,GLPNPreTrainedModel:()=>oh,GPT2LMHeadModel:()=>ml,GPT2Model:()=>mo,GPT2PreTrainedModel:()=>wr,GPTBigCodeForCausalLM:()=>re,GPTBigCodeModel:()=>Y,GPTBigCodePreTrainedModel:()=>V,GPTJForCausalLM:()=>z,GPTJModel:()=>M,GPTJPreTrainedModel:()=>Gs,GPTNeoForCausalLM:()=>yo,GPTNeoModel:()=>nr,GPTNeoPreTrainedModel:()=>go,GPTNeoXForCausalLM:()=>gl,GPTNeoXModel:()=>vo,GPTNeoXPreTrainedModel:()=>Mr,Gemma2ForCausalLM:()=>Zr,Gemma2Model:()=>Xu,Gemma2PreTrainedModel:()=>bs,Gemma3ForCausalLM:()=>vl,Gemma3Model:()=>Zu,Gemma3PreTrainedModel:()=>Jr,Gemma3nForConditionalGeneration:()=>oo,Gemma3nPreTrainedModel:()=>Hr,GemmaForCausalLM:()=>Yr,GemmaModel:()=>_n,GemmaPreTrainedModel:()=>Qn,GlmForCausalLM:()=>Tc,GlmModel:()=>Af,GlmPreTrainedModel:()=>ar,GraniteForCausalLM:()=>rr,GraniteModel:()=>sr,GraniteMoeHybridForCausalLM:()=>Qu,GraniteMoeHybridModel:()=>$f,GraniteMoeHybridPreTrainedModel:()=>ir,GranitePreTrainedModel:()=>xr,GroundingDinoForObjectDetection:()=>bh,GroundingDinoPreTrainedModel:()=>Ed,GroupViTModel:()=>Ic,GroupViTPreTrainedModel:()=>El,HeliumForCausalLM:()=>qu,HeliumModel:()=>vs,HeliumPreTrainedModel:()=>Cf,HieraForImageClassification:()=>pd,HieraModel:()=>hd,HieraPreTrainedModel:()=>jc,HubertForCTC:()=>Rh,HubertForSequenceClassification:()=>Bh,HubertModel:()=>jh,HubertPreTrainedModel:()=>Nh,IJepaForImageClassification:()=>Co,IJepaModel:()=>Nf,IJepaPreTrainedModel:()=>xl,Idefics3ForConditionalGeneration:()=>er,Idefics3PreTrainedModel:()=>vc,ImageMattingOutput:()=>Pp,JAISLMHeadModel:()=>Qr,JAISModel:()=>_l,JAISPreTrainedModel:()=>_o,JinaCLIPModel:()=>fo,JinaCLIPPreTrainedModel:()=>Pi,JinaCLIPTextModel:()=>Is,JinaCLIPVisionModel:()=>ho,Lfm2ForCausalLM:()=>$i,Lfm2Model:()=>Wu,Lfm2PreTrainedModel:()=>yl,LiteWhisperForConditionalGeneration:()=>_c,Llama4ForCausalLM:()=>vn,Llama4PreTrainedModel:()=>dn,LlamaForCausalLM:()=>Kt,LlamaModel:()=>Ct,LlamaPreTrainedModel:()=>yt,LlavaForConditionalGeneration:()=>ol,LlavaOnevisionForConditionalGeneration:()=>ju,LlavaPreTrainedModel:()=>yc,LlavaQwen2ForCausalLM:()=>cl,LongT5ForConditionalGeneration:()=>Dn,LongT5Model:()=>Tn,LongT5PreTrainedModel:()=>ga,M2M100ForConditionalGeneration:()=>Dd,M2M100Model:()=>$d,M2M100PreTrainedModel:()=>kd,MBartForCausalLM:()=>fs,MBartForConditionalGeneration:()=>ys,MBartForSequenceClassification:()=>xa,MBartModel:()=>ds,MBartPreTrainedModel:()=>ea,MPNetForMaskedLM:()=>Ca,MPNetForQuestionAnswering:()=>Te,MPNetForSequenceClassification:()=>Js,MPNetForTokenClassification:()=>ao,MPNetModel:()=>Gr,MPNetPreTrainedModel:()=>xn,MT5ForConditionalGeneration:()=>Os,MT5Model:()=>rs,MT5PreTrainedModel:()=>An,MarianMTModel:()=>Pd,MarianModel:()=>Sh,MarianPreTrainedModel:()=>zo,MaskFormerForInstanceSegmentation:()=>ih,MaskFormerModel:()=>rh,MaskFormerPreTrainedModel:()=>wd,MaskedLMOutput:()=>Da,Metric3DForDepthEstimation:()=>bd,Metric3DPreTrainedModel:()=>nh,Metric3Dv2ForDepthEstimation:()=>sh,Metric3Dv2PreTrainedModel:()=>ah,MgpstrForSceneTextRecognition:()=>Gn,MgpstrModelOutput:()=>Gm,MgpstrPreTrainedModel:()=>En,MimiDecoderModel:()=>Hl,MimiDecoderOutput:()=>Zd,MimiEncoderModel:()=>Ro,MimiEncoderOutput:()=>Wi,MimiModel:()=>Es,MimiPreTrainedModel:()=>dr,Ministral3ForCausalLM:()=>Kh,Ministral3Model:()=>ai,Ministral3PreTrainedModel:()=>Fo,MinistralForCausalLM:()=>qh,MinistralModel:()=>Rm,MinistralPreTrainedModel:()=>Hh,Mistral3ForConditionalGeneration:()=>Ci,MistralForCausalLM:()=>ta,MistralModel:()=>Rl,MistralPreTrainedModel:()=>jl,MobileBertForMaskedLM:()=>st,MobileBertForQuestionAnswering:()=>Et,MobileBertForSequenceClassification:()=>lt,MobileBertModel:()=>Ya,MobileBertPreTrainedModel:()=>_a,MobileLLMForCausalLM:()=>zs,MobileLLMModel:()=>kf,MobileLLMPreTrainedModel:()=>Ec,MobileNetV1ForImageClassification:()=>zr,MobileNetV1ForSemanticSegmentation:()=>Gi,MobileNetV1Model:()=>ep,MobileNetV1PreTrainedModel:()=>es,MobileNetV2ForImageClassification:()=>Xd,MobileNetV2ForSemanticSegmentation:()=>qs,MobileNetV2Model:()=>Qd,MobileNetV2PreTrainedModel:()=>Hs,MobileNetV3ForImageClassification:()=>Vl,MobileNetV3ForSemanticSegmentation:()=>Gl,MobileNetV3Model:()=>No,MobileNetV3PreTrainedModel:()=>Yc,MobileNetV4ForImageClassification:()=>np,MobileNetV4ForSemanticSegmentation:()=>Wl,MobileNetV4Model:()=>tp,MobileNetV4PreTrainedModel:()=>si,MobileViTForImageClassification:()=>rd,MobileViTModel:()=>sd,MobileViTPreTrainedModel:()=>Cr,MobileViTV2ForImageClassification:()=>Sl,MobileViTV2Model:()=>ei,MobileViTV2PreTrainedModel:()=>Ar,ModelOutput:()=>Ce,ModernBertDecoderForCausalLM:()=>Mn,ModernBertDecoderModel:()=>Ht,ModernBertDecoderPreTrainedModel:()=>wn,ModernBertForMaskedLM:()=>Je,ModernBertForSequenceClassification:()=>St,ModernBertForTokenClassification:()=>Lt,ModernBertModel:()=>ot,ModernBertPreTrainedModel:()=>wt,Moondream1ForConditionalGeneration:()=>Ru,MoonshineForConditionalGeneration:()=>rl,MoonshineModel:()=>Sf,MoonshinePreTrainedModel:()=>gc,MptForCausalLM:()=>So,MptModel:()=>Eo,MptPreTrainedModel:()=>Dc,MultiModalityCausalLM:()=>Vm,MultiModalityPreTrainedModel:()=>sp,MusicgenForCausalLM:()=>cr,MusicgenForConditionalGeneration:()=>Kd,MusicgenModel:()=>Ts,MusicgenPreTrainedModel:()=>Ul,NanoChatForCausalLM:()=>hs,NanoChatModel:()=>Ws,NanoChatPreTrainedModel:()=>Pn,NeoBertForMaskedLM:()=>Ye,NeoBertForQuestionAnswering:()=>Mt,NeoBertForSequenceClassification:()=>mt,NeoBertForTokenClassification:()=>it,NeoBertModel:()=>dt,NeoBertPreTrainedModel:()=>Ge,NomicBertModel:()=>Jt,NomicBertPreTrainedModel:()=>fa,OPTForCausalLM:()=>km,OPTModel:()=>Ff,OPTPreTrainedModel:()=>Lf,Olmo2ForCausalLM:()=>Fs,Olmo2Model:()=>Ls,Olmo2PreTrainedModel:()=>Mo,OlmoForCausalLM:()=>Sc,OlmoModel:()=>wo,OlmoPreTrainedModel:()=>Di,OpenELMForCausalLM:()=>Tr,OpenELMModel:()=>Oi,OpenELMPreTrainedModel:()=>Ac,OwlViTForObjectDetection:()=>Cl,OwlViTModel:()=>id,OwlViTPreTrainedModel:()=>Lc,Owlv2ForObjectDetection:()=>Wf,Owlv2Model:()=>Gf,Owlv2PreTrainedModel:()=>ko,PaliGemmaForConditionalGeneration:()=>Uu,PaliGemmaPreTrainedModel:()=>Si,ParakeetForCTC:()=>Wc,ParakeetPreTrainedModel:()=>kh,PatchTSMixerForPrediction:()=>jo,PatchTSMixerModel:()=>ri,PatchTSMixerPreTrainedModel:()=>ps,PatchTSTForPrediction:()=>In,PatchTSTModel:()=>fn,PatchTSTPreTrainedModel:()=>ln,Phi3ForCausalLM:()=>Aa,Phi3Model:()=>Pm,Phi3PreTrainedModel:()=>zf,Phi3VForCausalLM:()=>dl,Phi3VPreTrainedModel:()=>ul,PhiForCausalLM:()=>Am,PhiModel:()=>If,PhiPreTrainedModel:()=>bl,PreTrainedModel:()=>J,PretrainedMixin:()=>on,PvtForImageClassification:()=>Rf,PvtModel:()=>jf,PvtPreTrainedModel:()=>Tl,PyAnnoteForAudioFrameClassification:()=>$h,PyAnnoteModel:()=>Id,PyAnnotePreTrainedModel:()=>Od,QuestionAnsweringModelOutput:()=>Oa,Qwen2ForCausalLM:()=>Ju,Qwen2Model:()=>Sr,Qwen2PreTrainedModel:()=>Er,Qwen2VLForConditionalGeneration:()=>Qa,Qwen2VLPreTrainedModel:()=>Ii,Qwen3ForCausalLM:()=>kc,Qwen3Model:()=>To,Qwen3PreTrainedModel:()=>Pc,RFDetrForObjectDetection:()=>$o,RFDetrModel:()=>Nc,RFDetrObjectDetectionOutput:()=>Ri,RFDetrPreTrainedModel:()=>Ta,RTDetrForObjectDetection:()=>xs,RTDetrModel:()=>ti,RTDetrObjectDetectionOutput:()=>oa,RTDetrPreTrainedModel:()=>cd,RTDetrV2ForObjectDetection:()=>an,RTDetrV2Model:()=>kr,RTDetrV2ObjectDetectionOutput:()=>jn,RTDetrV2PreTrainedModel:()=>Pl,ResNetForImageClassification:()=>Rc,ResNetModel:()=>Ea,ResNetPreTrainedModel:()=>Ja,RoFormerForMaskedLM:()=>Mi,RoFormerForQuestionAnswering:()=>wa,RoFormerForSequenceClassification:()=>Xs,RoFormerForTokenClassification:()=>Wn,RoFormerModel:()=>wi,RoFormerPreTrainedModel:()=>ss,RobertaForMaskedLM:()=>tl,RobertaForQuestionAnswering:()=>dc,RobertaForSequenceClassification:()=>xi,RobertaForTokenClassification:()=>ro,RobertaModel:()=>so,RobertaPreTrainedModel:()=>br,Sam2ImageSegmentationOutput:()=>Il,Sam2Model:()=>Io,Sam2PreTrainedModel:()=>Ad,Sam3TrackerModel:()=>Eh,SamImageSegmentationOutput:()=>xh,SamModel:()=>zm,SamPreTrainedModel:()=>Im,SapiensForDepthEstimation:()=>Jf,SapiensForNormalEstimation:()=>Dm,SapiensForSemanticSegmentation:()=>vd,SapiensPreTrainedModel:()=>Uc,SegformerForImageClassification:()=>Yh,SegformerForSemanticSegmentation:()=>la,SegformerModel:()=>Bm,SegformerPreTrainedModel:()=>Hd,Seq2SeqLMOutput:()=>Ap,SequenceClassifierOutput:()=>Gt,SiglipModel:()=>hl,SiglipPreTrainedModel:()=>uo,SiglipTextModel:()=>Kr,SiglipVisionModel:()=>Pt,SmolLM3ForCausalLM:()=>bo,SmolLM3Model:()=>xc,SmolLM3PreTrainedModel:()=>Hu,SmolVLMForConditionalGeneration:()=>lo,SnacDecoderModel:()=>Bo,SnacEncoderModel:()=>ii,SnacModel:()=>ja,SnacPreTrainedModel:()=>fr,SpeechT5ForSpeechToText:()=>Dr,SpeechT5ForTextToSpeech:()=>jd,SpeechT5HifiGan:()=>jm,SpeechT5Model:()=>Nm,SpeechT5PreTrainedModel:()=>Nl,SqueezeBertForMaskedLM:()=>pe,SqueezeBertForQuestionAnswering:()=>Ie,SqueezeBertForSequenceClassification:()=>me,SqueezeBertModel:()=>oe,SqueezeBertPreTrainedModel:()=>N,StableLmForCausalLM:()=>Zh,StableLmModel:()=>Ir,StableLmPreTrainedModel:()=>is,Starcoder2ForCausalLM:()=>Qh,Starcoder2Model:()=>Vd,Starcoder2PreTrainedModel:()=>Ud,StyleTextToSpeech2Model:()=>Vh,StyleTextToSpeech2PreTrainedModel:()=>Nd,SupertonicForConditionalGeneration:()=>or,SupertonicPreTrainedModel:()=>Gh,Swin2SRForImageSuperResolution:()=>gd,Swin2SRModel:()=>_d,Swin2SRPreTrainedModel:()=>Dl,SwinForImageClassification:()=>md,SwinForSemanticSegmentation:()=>$r,SwinModel:()=>Bc,SwinPreTrainedModel:()=>Bi,T5ForConditionalGeneration:()=>qn,T5Model:()=>jt,T5PreTrainedModel:()=>Xt,TableTransformerForObjectDetection:()=>ud,TableTransformerModel:()=>ya,TableTransformerObjectDetectionOutput:()=>dd,TableTransformerPreTrainedModel:()=>qf,TokenClassifierOutput:()=>$a,TrOCRForCausalLM:()=>Wh,TrOCRPreTrainedModel:()=>Rd,UltravoxModel:()=>ur,UltravoxPreTrainedModel:()=>Yd,UniSpeechForCTC:()=>Xa,UniSpeechForSequenceClassification:()=>Oh,UniSpeechModel:()=>Pa,UniSpeechPreTrainedModel:()=>zl,UniSpeechSatForAudioFrameClassification:()=>Lh,UniSpeechSatForCTC:()=>zh,UniSpeechSatForSequenceClassification:()=>Fl,UniSpeechSatModel:()=>Ih,UniSpeechSatPreTrainedModel:()=>Ll,VaultGemmaForCausalLM:()=>xo,VaultGemmaModel:()=>Of,VaultGemmaPreTrainedModel:()=>Yu,ViTForImageClassification:()=>td,ViTMAEModel:()=>Fi,ViTMAEPreTrainedModel:()=>Li,ViTMSNForImageClassification:()=>Ao,ViTMSNModel:()=>Bf,ViTMSNPreTrainedModel:()=>ad,ViTModel:()=>zi,ViTPreTrainedModel:()=>ed,VisionEncoderDecoderModel:()=>il,VitMatteForImageMatting:()=>Vf,VitMattePreTrainedModel:()=>Ni,VitPoseForPoseEstimation:()=>Oc,VitPosePreTrainedModel:()=>nd,VitsModel:()=>Na,VitsModelOutput:()=>s_,VitsPreTrainedModel:()=>Xh,VoxtralForConditionalGeneration:()=>va,Wav2Vec2BertForCTC:()=>Fm,Wav2Vec2BertForSequenceClassification:()=>Hc,Wav2Vec2BertModel:()=>Fh,Wav2Vec2BertPreTrainedModel:()=>Lo,Wav2Vec2ForAudioFrameClassification:()=>Ph,Wav2Vec2ForCTC:()=>Ui,Wav2Vec2ForSequenceClassification:()=>Ah,Wav2Vec2Model:()=>Ch,Wav2Vec2PreTrainedModel:()=>ni,WavLMForAudioFrameClassification:()=>qc,WavLMForCTC:()=>Ld,WavLMForSequenceClassification:()=>Uh,WavLMForXVector:()=>Fd,WavLMModel:()=>zd,WavLMPreTrainedModel:()=>Vi,WeSpeakerResNetModel:()=>Lm,WeSpeakerResNetPreTrainedModel:()=>Dh,WhisperForConditionalGeneration:()=>sl,WhisperModel:()=>Nu,WhisperPreTrainedModel:()=>Wr,XLMForQuestionAnswering:()=>zu,XLMForSequenceClassification:()=>nl,XLMForTokenClassification:()=>Iu,XLMModel:()=>Du,XLMPreTrainedModel:()=>Ti,XLMRobertaForMaskedLM:()=>fc,XLMRobertaForQuestionAnswering:()=>Fu,XLMRobertaForSequenceClassification:()=>al,XLMRobertaForTokenClassification:()=>hc,XLMRobertaModel:()=>Lu,XLMRobertaPreTrainedModel:()=>Ei,XLMWithLMHeadModel:()=>Ou,XVectorOutput:()=>of,YolosForObjectDetection:()=>wh,YolosModel:()=>Cd,YolosObjectDetectionOutput:()=>Mh,YolosPreTrainedModel:()=>Sd});var s=t("./src/configs.js"),i=t("./src/backends/onnx.js"),l=t("./src/utils/dtypes.js"),c=t("./src/utils/generic.js"),u=t("./src/utils/core.js"),d=t("./src/utils/hub.js"),f=t("./src/utils/constants.js"),m=t("./src/generation/logits_process.js"),_=t("./src/generation/configuration_utils.js"),p=t("./src/utils/tensor.js"),y=t("./src/utils/image.js"),v=t("./src/utils/maths.js"),T=t("./src/generation/stopping_criteria.js"),k=t("./src/generation/logits_sampler.js"),b=t("./src/env.js"),S=t("./src/models/whisper/generation_whisper.js"),$=t("./src/models/whisper/common_whisper.js");const w={EncoderOnly:0,EncoderDecoder:1,Seq2Seq:2,Vision2Seq:3,DecoderOnly:4,MaskGeneration:5,ImageTextToText:6,Musicgen:7,MultiModality:8,Phi3V:9,AudioTextToText:10,AutoEncoder:11,ImageAudioTextToText:12,Supertonic:13},C=new Map,P=new Map,A=new Map;async function I(D,O,se){let ge=se.config?.["transformers.js_config"]??{},Ae=se.device??ge.device;Ae&&typeof Ae!="string"&&(Ae.hasOwnProperty(O)?Ae=Ae[O]:(console.warn(`device not specified for "${O}". Using the default device.`),Ae=null));const Se=Ae??(b.apis.IS_NODE_ENV?"cpu":"wasm"),Ke=(0,i.deviceToExecutionProviders)(Se),at=ge.device_config??{};at.hasOwnProperty(Se)&&(ge={...ge,...at[Se]});let ft=se.dtype??ge.dtype;if(typeof ft!="string"&&(ft&&ft.hasOwnProperty(O)?ft=ft[O]:(ft=l.DEFAULT_DEVICE_DTYPE_MAPPING[Se]??l.DATA_TYPES.fp32,console.warn(`dtype not specified for "${O}". Using the default dtype (${ft}) for this device (${Se}).`))),ft===l.DATA_TYPES.auto){let sn=ge.dtype;typeof sn!="string"&&(sn=sn?.[O]),sn&&sn!==l.DATA_TYPES.auto&&l.DATA_TYPES.hasOwnProperty(sn)?ft=sn:ft=l.DEFAULT_DEVICE_DTYPE_MAPPING[Se]??l.DATA_TYPES.fp32}const Tt=ft;if(l.DEFAULT_DTYPE_SUFFIX_MAPPING.hasOwnProperty(Tt)){if(Tt===l.DATA_TYPES.fp16&&Se==="webgpu"&&!await(0,l.isWebGpuFp16Supported)())throw new Error(`The device (${Se}) does not support fp16.`)}else throw new Error(`Invalid dtype: ${Tt}. Should be one of: ${Object.keys(l.DATA_TYPES).join(", ")}`);const Vt=ge.kv_cache_dtype,Bt=Vt?typeof Vt=="string"?Vt:Vt[Tt]??"float32":void 0;if(Bt&&!["float32","float16"].includes(Bt))throw new Error(`Invalid kv_cache_dtype: ${Bt}. Should be one of: float32, float16`);const Yt={dtype:Tt,kv_cache_dtype:Bt,device:Se},Dt=l.DEFAULT_DTYPE_SUFFIX_MAPPING[Tt],pn=`${O}${Dt}.onnx`,Ot=`${se.subfolder??""}/${pn}`,It={...se.session_options};It.executionProviders??=Ke;const cn=ge.free_dimension_overrides;cn?It.freeDimensionOverrides??=cn:Se.startsWith("webnn")&&!It.freeDimensionOverrides&&console.warn(`WebNN does not currently support dynamic shapes and requires 'free_dimension_overrides' to be set in config.json, preferably as a field within config["transformers.js_config"]["device_config"]["${Se}"]. When 'free_dimension_overrides' is not set, you may experience significant performance degradation.`);const Sn=b.apis.IS_NODE_ENV&&b.env.useFSCache,Xn=(0,d.getModelFile)(D,Ot,!0,se,Sn),ca=se.use_external_data_format??ge.use_external_data_format;let ba=[];if(ca){let sn;typeof ca=="object"?ca.hasOwnProperty(pn)?sn=ca[pn]:ca.hasOwnProperty(O)?sn=ca[O]:sn=!1:sn=ca;const ua=+sn;if(ua>d.MAX_EXTERNAL_DATA_CHUNKS)throw new Error(`The number of external data chunks (${ua}) exceeds the maximum allowed value (${d.MAX_EXTERNAL_DATA_CHUNKS}).`);for(let Ia=0;Ia<ua;++Ia){const Vo=`${pn}_data${Ia===0?"":"_"+Ia}`,_s=`${se.subfolder??""}/${Vo}`;ba.push(new Promise(async(Ks,Qi)=>{const Xi=await(0,d.getModelFile)(D,_s,!0,se,Sn);Ks(Xi instanceof Uint8Array?{path:Vo,data:Xi}:Vo)}))}}else It.externalData!==void 0&&(ba=It.externalData.map(async sn=>{if(typeof sn.data=="string"){const ua=await(0,d.getModelFile)(D,sn.data,!0,se);return{...sn,data:ua}}return sn}));if(ba.length>0){const sn=await Promise.all(ba);b.apis.IS_NODE_ENV||(It.externalData=sn)}if(Se==="webgpu"){const sn=(0,s.getCacheShapes)(se.config,{prefix:"present"});if(Object.keys(sn).length>0&&!(0,i.isONNXProxy)()){const ua={};for(const Ia in sn)ua[Ia]="gpu-buffer";It.preferredOutputLocation=ua}}return{buffer_or_path:await Xn,session_options:It,session_config:Yt}}async function W(D,O,se){return Object.fromEntries(await Promise.all(Object.keys(O).map(async ge=>{const{buffer_or_path:Ae,session_options:Se,session_config:Ke}=await I(D,O[ge],se),at=await(0,i.createInferenceSession)(Ae,Se,Ke);return[ge,at]})))}async function G(D,O,se){return Object.fromEntries(await Promise.all(Object.keys(O).map(async ge=>{const Ae=await(0,d.getModelJSON)(D,O[ge],!1,se);return[ge,Ae]})))}function q(D,O){const se=Object.create(null),ge=[];for(const Ke of D.inputNames){const at=O[Ke];if(!(at instanceof p.Tensor)){ge.push(Ke);continue}se[Ke]=(0,i.isONNXProxy)()?at.clone():at}if(ge.length>0)throw new Error(`An error occurred during model execution: "Missing the following inputs: ${ge.join(", ")}.`);const Ae=Object.keys(O).length,Se=D.inputNames.length;if(Ae>Se){let Ke=Object.keys(O).filter(at=>!D.inputNames.includes(at));console.warn(`WARNING: Too many inputs were provided (${Ae} > ${Se}). The following inputs will be ignored: "${Ke.join(", ")}".`)}return se}async function Z(D,O){const se=q(D,O);try{const ge=Object.fromEntries(Object.entries(se).map(([Se,Ke])=>[Se,Ke.ort_tensor])),Ae=await(0,i.runInferenceSession)(D,ge);return X(Ae)}catch(ge){const Ae=Object.fromEntries(Object.entries(se).map(([Se,Ke])=>{const at={type:Ke.type,dims:Ke.dims,location:Ke.location};return at.location!=="gpu-buffer"&&(at.data=Ke.data),[Se,at]}));throw console.error(`An error occurred during model execution: "${ge}".`),console.error("Inputs given to model:",Ae),ge}}function X(D){for(let O in D)(0,i.isONNXTensor)(D[O])?D[O]=new p.Tensor(D[O]):typeof D[O]=="object"&&X(D[O]);return D}function Q(D){if(D instanceof p.Tensor)return D;if(D.length===0)throw Error("items must be non-empty");if(Array.isArray(D[0])){if(D.some(O=>O.length!==D[0].length))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=True' and/or 'truncation=True' to have batched tensors with the same length.");return new p.Tensor("int64",BigInt64Array.from(D.flat().map(O=>BigInt(O))),[D.length,D[0].length])}else return new p.Tensor("int64",BigInt64Array.from(D.map(O=>BigInt(O))),[1,D.length])}function te(D){return new p.Tensor("bool",[D],[1])}async function R(D,O){let{encoder_outputs:se,input_ids:ge,decoder_input_ids:Ae,...Se}=O;if(!se){const at=(0,u.pick)(O,D.sessions.model.inputNames);se=(await ee(D,at)).last_hidden_state}return Se.input_ids=Ae,Se.encoder_hidden_states=se,D.sessions.decoder_model_merged.inputNames.includes("encoder_attention_mask")&&(Se.encoder_attention_mask=O.attention_mask),await he(D,Se,!0)}async function ee(D,O){const se=D.sessions.model,ge=(0,u.pick)(O,se.inputNames);if(se.inputNames.includes("inputs_embeds")&&!ge.inputs_embeds){if(!O.input_ids)throw new Error("Both `input_ids` and `inputs_embeds` are missing in the model inputs.");ge.inputs_embeds=await D.encode_text({input_ids:O.input_ids})}if(se.inputNames.includes("token_type_ids")&&!ge.token_type_ids){if(!ge.input_ids)throw new Error("Both `input_ids` and `token_type_ids` are missing in the model inputs.");ge.token_type_ids=(0,p.zeros_like)(ge.input_ids)}if(se.inputNames.includes("pixel_mask")&&!ge.pixel_mask){if(!ge.pixel_values)throw new Error("Both `pixel_values` and `pixel_mask` are missing in the model inputs.");const Ae=ge.pixel_values.dims;ge.pixel_mask=(0,p.ones)([Ae[0],Ae[2],Ae[3]])}return await Z(se,ge)}async function ie(D,O){const se=await D.encode(O);return await D.decode(se)}async function he(D,O,se=!1){const ge=D.sessions[se?"decoder_model_merged":"model"],{past_key_values:Ae,...Se}=O;if(ge.inputNames.includes("use_cache_branch")&&(Se.use_cache_branch=te(!!Ae)),ge.inputNames.includes("position_ids")&&Se.attention_mask&&!Se.position_ids){const at=["paligemma","gemma3_text","gemma3"].includes(D.config.model_type)?1:0;Se.position_ids=Pe(Se,Ae,at)}D.addPastKeyValues(Se,Ae);const Ke=(0,u.pick)(Se,ge.inputNames);return await Z(ge,Ke)}function _e({modality_token_id:D,inputs_embeds:O,modality_features:se,input_ids:ge,attention_mask:Ae}){const Se=ge.tolist().map(Tt=>Tt.reduce((Vt,Bt,Yt)=>(Bt==D&&Vt.push(Yt),Vt),[])),Ke=Se.reduce((Tt,Vt)=>Tt+Vt.length,0),at=se.dims[0];if(Ke!==at)throw new Error(`Number of tokens and features do not match: tokens: ${Ke}, features ${at}`);let ft=0;for(let Tt=0;Tt<Se.length;++Tt){const Vt=Se[Tt],Bt=O[Tt];for(let Yt=0;Yt<Vt.length;++Yt)Bt[Vt[Yt]].data.set(se[ft++].data)}return{inputs_embeds:O,attention_mask:Ae}}function U({image_token_id:D,inputs_embeds:O,image_features:se,input_ids:ge,attention_mask:Ae}){return _e({modality_token_id:D,inputs_embeds:O,modality_features:se,input_ids:ge,attention_mask:Ae})}function K({audio_token_id:D,inputs_embeds:O,audio_features:se,input_ids:ge,attention_mask:Ae}){return _e({modality_token_id:D,inputs_embeds:O,modality_features:se,input_ids:ge,attention_mask:Ae})}async function H(D,{encode_function:O,merge_function:se,modality_input_name:ge,modality_output_name:Ae,input_ids:Se=null,attention_mask:Ke=null,position_ids:at=null,inputs_embeds:ft=null,past_key_values:Tt=null,generation_config:Vt=null,logits_processor:Bt=null,...Yt}){const Dt=Yt[ge];if(!ft){if(ft=await D.encode_text({input_ids:Se,...Yt}),Dt&&Se.dims[1]!==1){const Ot=await O({[ge]:Dt,...Yt});({inputs_embeds:ft,attention_mask:Ke}=se({[Ae]:Ot,inputs_embeds:ft,input_ids:Se,attention_mask:Ke}))}else if(Tt&&Dt&&Se.dims[1]===1){const Ot=Se.dims[1],It=Object.values(Tt)[0].dims.at(-2);Ke=(0,p.cat)([(0,p.ones)([Se.dims[0],It]),Ke.slice(null,[Ke.dims[1]-Ot,Ke.dims[1]])],1)}}if(!at&&D.config.model_type==="qwen2_vl"){const{image_grid_thw:Ot,video_grid_thw:It}=Yt;[at]=D.get_rope_index(Se,Ot,It,Ke)}return await he(D,{inputs_embeds:ft,past_key_values:Tt,attention_mask:Ke,position_ids:at,generation_config:Vt,logits_processor:Bt},!0)}async function B(D,O){return await H(D,{...O,modality_input_name:"audio_values",modality_output_name:"audio_features",encode_function:D.encode_audio.bind(D),merge_function:D._merge_input_ids_with_audio_features.bind(D)})}async function ce(D,O){return await H(D,{...O,modality_input_name:"pixel_values",modality_output_name:"image_features",encode_function:D.encode_image.bind(D),merge_function:D._merge_input_ids_with_image_features.bind(D)})}function ve(D,O=0){const[se,ge]=D.dims,Ae=D.data,Se=new BigInt64Array(Ae.length);for(let Ke=0;Ke<se;++Ke){const at=Ke*ge;let ft=BigInt(O);for(let Tt=0;Tt<ge;++Tt){const Vt=at+Tt;Ae[Vt]===0n?Se[Vt]=BigInt(1):(Se[Vt]=ft,ft+=Ae[Vt])}}return{data:Se,dims:D.dims}}function Pe(D,O=null,se=0){const{input_ids:ge,inputs_embeds:Ae,attention_mask:Se}=D,{data:Ke,dims:at}=ve(Se,se);let ft=new p.Tensor("int64",Ke,at);if(O){const Tt=-(ge??Ae).dims.at(1);ft=ft.slice(null,[Tt,null])}return ft}function ze(D,O,se,ge){const Ae=se.past_key_values?Object.values(se.past_key_values)[0].dims.at(-2):0;if(!se.attention_mask){let Se;for(const Ke of["input_ids","inputs_embeds","position_ids"])if(se[Ke]){Se=se[Ke].dims;break}if(!Se)throw new Error("attention_mask is not provided, and unable to infer its shape from model inputs.");se.attention_mask=(0,p.ones)([Se[0],Ae+Se[1]])}if(se.past_key_values){const{input_ids:Se,attention_mask:Ke}=se;Ke&&Ke.dims[1]>Se.dims[1]||Ae<Se.dims[1]&&(se.input_ids=Se.slice(null,[Ae,null]))}return se}function Ze(D,O,se,ge){return se.past_key_values&&(O=O.map(Ae=>[Ae.at(-1)])),{...se,decoder_input_ids:Q(O)}}function Re(D,...O){return D.config.is_encoder_decoder?Ze(D,...O):ze(D,...O)}function de(D,O,se,ge){const Ae=!!se.past_key_values;return ge.guidance_scale!==null&&ge.guidance_scale>1&&(Ae?se.input_ids=(0,p.cat)([se.input_ids,se.input_ids],0):(se.input_ids=(0,p.cat)([se.input_ids,(0,p.full_like)(se.input_ids,BigInt(ge.pad_token_id))],0),se.attention_mask=(0,p.cat)([se.attention_mask,(0,p.full_like)(se.attention_mask,0n)],0))),(Ae||!se.pixel_values)&&(se.pixel_values=(0,p.full)([0,0,3,384,384],1)),Ae&&(se.images_seq_mask=new p.Tensor("bool",new Array(1).fill(!0).fill(!1,0,1),[1,1]),se.images_emb_mask=new p.Tensor("bool",new Array(0).fill(!1),[1,1,0])),se}class J extends c.Callable{main_input_name="input_ids";forward_params=["input_ids","attention_mask"];constructor(O,se,ge){super(),this.config=O,this.sessions=se,this.configs=ge;const Ae=A.get(this.constructor),Se=C.get(Ae);switch(this.can_generate=!1,this._forward=null,this._prepare_inputs_for_generation=null,Se){case w.DecoderOnly:this.can_generate=!0,this._forward=he,this._prepare_inputs_for_generation=ze;break;case w.Seq2Seq:case w.Vision2Seq:case w.Musicgen:this.can_generate=!0,this._forward=R,this._prepare_inputs_for_generation=Ze;break;case w.EncoderDecoder:this._forward=R;break;case w.ImageTextToText:this.can_generate=!0,this._forward=ce,this._prepare_inputs_for_generation=Re;break;case w.AudioTextToText:this.can_generate=!0,this._forward=B,this._prepare_inputs_for_generation=Re;break;case w.Phi3V:case w.ImageAudioTextToText:this.can_generate=!0,this._prepare_inputs_for_generation=Re;break;case w.MultiModality:this.can_generate=!0,this._prepare_inputs_for_generation=de;break;case w.AutoEncoder:this._forward=ie;break;default:this._forward=ee;break}this.can_generate&&this.forward_params.push("past_key_values"),this.custom_config=this.config["transformers.js_config"]??{}}async dispose(){const O=[];for(const se of Object.values(this.sessions))se?.handler?.dispose&&O.push(se.handler.dispose());return await Promise.all(O)}static async from_pretrained(O,{progress_callback:se=null,config:ge=null,cache_dir:Ae=null,local_files_only:Se=!1,revision:Ke="main",model_file_name:at=null,subfolder:ft="onnx",device:Tt=null,dtype:Vt=null,use_external_data_format:Bt=null,session_options:Yt={}}={}){let Dt={progress_callback:se,config:ge,cache_dir:Ae,local_files_only:Se,revision:Ke,model_file_name:at,subfolder:ft,device:Tt,dtype:Vt,use_external_data_format:Bt,session_options:Yt};const pn=A.get(this),Ot=C.get(pn);ge=Dt.config=await s.AutoConfig.from_pretrained(O,Dt);let It;if(Ot===w.DecoderOnly)It=await Promise.all([W(O,{model:Dt.model_file_name??"model"},Dt),G(O,{generation_config:"generation_config.json"},Dt)]);else if(Ot===w.Seq2Seq||Ot===w.Vision2Seq)It=await Promise.all([W(O,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},Dt),G(O,{generation_config:"generation_config.json"},Dt)]);else if(Ot===w.MaskGeneration)It=await Promise.all([W(O,{model:"vision_encoder",prompt_encoder_mask_decoder:"prompt_encoder_mask_decoder"},Dt)]);else if(Ot===w.EncoderDecoder)It=await Promise.all([W(O,{model:"encoder_model",decoder_model_merged:"decoder_model_merged"},Dt)]);else if(Ot===w.ImageTextToText){const cn={embed_tokens:"embed_tokens",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};ge.is_encoder_decoder&&(cn.model="encoder_model"),It=await Promise.all([W(O,cn,Dt),G(O,{generation_config:"generation_config.json"},Dt)])}else if(Ot===w.AudioTextToText){const cn={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",decoder_model_merged:"decoder_model_merged"};It=await Promise.all([W(O,cn,Dt),G(O,{generation_config:"generation_config.json"},Dt)])}else if(Ot===w.ImageAudioTextToText){const cn={embed_tokens:"embed_tokens",audio_encoder:"audio_encoder",vision_encoder:"vision_encoder",decoder_model_merged:"decoder_model_merged"};It=await Promise.all([W(O,cn,Dt),G(O,{generation_config:"generation_config.json"},Dt)])}else if(Ot===w.Musicgen)It=await Promise.all([W(O,{model:"text_encoder",decoder_model_merged:"decoder_model_merged",encodec_decode:"encodec_decode"},Dt),G(O,{generation_config:"generation_config.json"},Dt)]);else if(Ot===w.MultiModality)It=await Promise.all([W(O,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"language_model",lm_head:"lm_head",gen_head:"gen_head",gen_img_embeds:"gen_img_embeds",image_decode:"image_decode"},Dt),G(O,{generation_config:"generation_config.json"},Dt)]);else if(Ot===w.Phi3V)It=await Promise.all([W(O,{prepare_inputs_embeds:"prepare_inputs_embeds",model:"model",vision_encoder:"vision_encoder"},Dt),G(O,{generation_config:"generation_config.json"},Dt)]);else if(Ot===w.AutoEncoder)It=await Promise.all([W(O,{encoder_model:"encoder_model",decoder_model:"decoder_model"},Dt)]);else if(Ot===w.Supertonic)It=await Promise.all([W(O,{text_encoder:"text_encoder",latent_denoiser:"latent_denoiser",voice_decoder:"voice_decoder"},Dt)]);else{if(Ot!==w.EncoderOnly){const cn=pn??ge?.model_type;cn!=="custom"&&console.warn(`Model type for '${cn}' not found, assuming encoder-only architecture. Please report this at ${f.GITHUB_ISSUE_URL}.`)}It=await Promise.all([W(O,{model:Dt.model_file_name??"model"},Dt)])}return new this(ge,...It)}async _call(O){return await this.forward(O)}async forward(O){return await this._forward(this,O)}get generation_config(){return this.configs?.generation_config??null}_get_logits_processor(O,se,ge=null){const Ae=new m.LogitsProcessorList;if(O.repetition_penalty!==null&&O.repetition_penalty!==1&&Ae.push(new m.RepetitionPenaltyLogitsProcessor(O.repetition_penalty)),O.no_repeat_ngram_size!==null&&O.no_repeat_ngram_size>0&&Ae.push(new m.NoRepeatNGramLogitsProcessor(O.no_repeat_ngram_size)),O.bad_words_ids!==null&&Ae.push(new m.NoBadWordsLogitsProcessor(O.bad_words_ids,O.eos_token_id)),O.min_length!==null&&O.eos_token_id!==null&&O.min_length>0&&Ae.push(new m.MinLengthLogitsProcessor(O.min_length,O.eos_token_id)),O.min_new_tokens!==null&&O.eos_token_id!==null&&O.min_new_tokens>0&&Ae.push(new m.MinNewTokensLengthLogitsProcessor(se,O.min_new_tokens,O.eos_token_id)),O.forced_bos_token_id!==null&&Ae.push(new m.ForcedBOSTokenLogitsProcessor(O.forced_bos_token_id)),O.forced_eos_token_id!==null&&Ae.push(new m.ForcedEOSTokenLogitsProcessor(O.max_length,O.forced_eos_token_id)),O.begin_suppress_tokens!==null){const Se=se>1||O.forced_bos_token_id===null?se:se+1;Ae.push(new m.SuppressTokensAtBeginLogitsProcessor(O.begin_suppress_tokens,Se))}return O.guidance_scale!==null&&O.guidance_scale>1&&Ae.push(new m.ClassifierFreeGuidanceLogitsProcessor(O.guidance_scale)),O.temperature===0&&O.do_sample&&(console.warn("`do_sample` changed to false because `temperature: 0` implies greedy sampling (always selecting the most likely token), which is incompatible with `do_sample: true`."),O.do_sample=!1),O.do_sample&&O.temperature!==null&&O.temperature!==1&&Ae.push(new m.TemperatureLogitsWarper(O.temperature)),ge!==null&&Ae.extend(ge),Ae}_prepare_generation_config(O,se,ge=_.GenerationConfig){const Ae={...this.config};for(const Ke of["decoder","generator","text_config"])Ke in Ae&&Object.assign(Ae,Ae[Ke]);const Se=new ge(Ae);return Object.assign(Se,this.generation_config??{}),O&&Object.assign(Se,O),se&&Object.assign(Se,(0,u.pick)(se,Object.getOwnPropertyNames(Se))),Se}_get_stopping_criteria(O,se=null){const ge=new T.StoppingCriteriaList;return O.max_length!==null&&ge.push(new T.MaxLengthCriteria(O.max_length,this.config.max_position_embeddings??null)),O.eos_token_id!==null&&ge.push(new T.EosTokenCriteria(O.eos_token_id)),se&&ge.extend(se),ge}_validate_model_class(){if(!this.can_generate){const O=[up,qi,ef,au],se=A.get(this.constructor),ge=new Set,Ae=this.config.model_type;for(const Ke of O){const at=Ke.get(Ae);at&&ge.add(at[0])}let Se=`The current model class (${se}) is not compatible with \`.generate()\`, as it doesn't have a language model head.`;throw ge.size>0&&(Se+=` Please use the following class instead: ${[...ge].join(", ")}`),Error(Se)}}prepare_inputs_for_generation(...O){return this._prepare_inputs_for_generation(this,...O)}_update_model_kwargs_for_generation({generated_input_ids:O,outputs:se,model_inputs:ge,is_encoder_decoder:Ae}){return ge.past_key_values=this.getPastKeyValues(se,ge.past_key_values),ge.input_ids=new p.Tensor("int64",O.flat(),[O.length,1]),Ae||(ge.attention_mask=(0,p.cat)([ge.attention_mask,(0,p.ones)([ge.attention_mask.dims[0],1])],1)),ge.position_ids=null,ge}_prepare_model_inputs({inputs:O,bos_token_id:se,model_kwargs:ge}){const Ae=(0,u.pick)(ge,this.forward_params),Se=this.main_input_name;if(Se in Ae){if(O)throw new Error("`inputs`: {inputs}` were passed alongside {input_name} which is not allowed. Make sure to either pass {inputs} or {input_name}=...")}else Ae[Se]=O;return{inputs_tensor:Ae[Se],model_inputs:Ae,model_input_name:Se}}async _prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:O,model_inputs:se,model_input_name:ge,generation_config:Ae}){if(this.sessions.model.inputNames.includes("inputs_embeds")&&!se.inputs_embeds&&"_prepare_inputs_embeds"in this){const{input_ids:Ke,pixel_values:at,attention_mask:ft,...Tt}=se,Vt=await this._prepare_inputs_embeds(se);se={...Tt,...(0,u.pick)(Vt,["inputs_embeds","attention_mask"])}}let{last_hidden_state:Se}=await ee(this,se);if(Ae.guidance_scale!==null&&Ae.guidance_scale>1)Se=(0,p.cat)([Se,(0,p.full_like)(Se,0)],0),"attention_mask"in se&&(se.attention_mask=(0,p.cat)([se.attention_mask,(0,p.zeros_like)(se.attention_mask)],0));else if(se.decoder_input_ids){const Ke=Q(se.decoder_input_ids).dims[0];if(Ke!==Se.dims[0]){if(Se.dims[0]!==1)throw new Error(`The encoder outputs have a different batch size (${Se.dims[0]}) than the decoder inputs (${Ke}).`);Se=(0,p.cat)(Array.from({length:Ke},()=>Se),0)}}return se.encoder_outputs=Se,se}_prepare_decoder_input_ids_for_generation({batch_size:O,model_input_name:se,model_kwargs:ge,decoder_start_token_id:Ae,bos_token_id:Se,generation_config:Ke}){let{decoder_input_ids:at,...ft}=ge;if(!(at instanceof p.Tensor)){if(at)Array.isArray(at[0])||(at=Array.from({length:O},()=>at));else if(Ae??=Se,this.config.model_type==="musicgen")at=Array.from({length:O*this.config.decoder.num_codebooks},()=>[Ae]);else if(Array.isArray(Ae)){if(Ae.length!==O)throw new Error(`\`decoder_start_token_id\` expcted to have length ${O} but got ${Ae.length}`);at=Ae}else at=Array.from({length:O},()=>[Ae]);at=Q(at)}return ge.decoder_attention_mask=(0,p.ones_like)(at),{input_ids:at,model_inputs:ft}}async generate({inputs:O=null,generation_config:se=null,logits_processor:ge=null,stopping_criteria:Ae=null,streamer:Se=null,...Ke}){this._validate_model_class(),se=this._prepare_generation_config(se,Ke);let{inputs_tensor:at,model_inputs:ft,model_input_name:Tt}=this._prepare_model_inputs({inputs:O,model_kwargs:Ke});const Vt=this.config.is_encoder_decoder;Vt&&("encoder_outputs"in ft||(ft=await this._prepare_encoder_decoder_kwargs_for_generation({inputs_tensor:at,model_inputs:ft,model_input_name:Tt,generation_config:se})));let Bt;Vt?{input_ids:Bt,model_inputs:ft}=this._prepare_decoder_input_ids_for_generation({batch_size:ft[Tt].dims.at(0),model_input_name:Tt,model_kwargs:ft,decoder_start_token_id:se.decoder_start_token_id,bos_token_id:se.bos_token_id,generation_config:se}):Bt=ft[Tt];let Yt=Bt.dims.at(-1);se.max_new_tokens!==null&&(se.max_length=Yt+se.max_new_tokens);const Dt=this._get_logits_processor(se,Yt,ge),pn=this._get_stopping_criteria(se,Ae),Ot=ft[Tt].dims.at(0),It=k.LogitsSampler.getSampler(se),cn=new Array(Ot).fill(0),Sn=Bt.tolist();Se&&Se.put(Sn);let Xn,ca={};for(;;){if(ft=this.prepare_inputs_for_generation(Sn,ft,se),Xn=await this.forward(ft),se.output_attentions&&se.return_dict_in_generate){const _s=this.getAttentions(Xn);for(const Ks in _s)Ks in ca||(ca[Ks]=[]),ca[Ks].push(_s[Ks])}const sn=Xn.logits.slice(null,-1,null),ua=Dt(Sn,sn),Ia=[];for(let _s=0;_s<ua.dims.at(0);++_s){const Ks=ua[_s],Qi=await It(Ks);for(const[Xi,lf]of Qi){const os=BigInt(Xi);cn[_s]+=lf,Sn[_s].push(os),Ia.push([os]);break}}if(Se&&Se.put(Ia),pn(Sn).every(_s=>_s))break;ft=this._update_model_kwargs_for_generation({generated_input_ids:Ia,outputs:Xn,model_inputs:ft,is_encoder_decoder:Vt})}Se&&Se.end();const ba=this.getPastKeyValues(Xn,ft.past_key_values,!0),Bn=new p.Tensor("int64",Sn.flat(),[Sn.length,Sn[0].length]);if(se.return_dict_in_generate)return{sequences:Bn,past_key_values:ba,...ca};for(const sn of Object.values(Xn))sn.location==="gpu-buffer"&&sn.dispose();return Bn}getPastKeyValues(O,se,ge=!1){const Ae=Object.create(null);for(const Se in O)if(Se.startsWith("present")){const Ke=Se.replace("present_conv","past_conv").replace("present","past_key_values"),at=Se.includes("encoder");if(at&&se?Ae[Ke]=se[Ke]:Ae[Ke]=O[Se],se&&(!at||ge)){const ft=se[Ke];ft.location==="gpu-buffer"&&ft.dispose()}}return Ae}getAttentions(O){const se={};for(const ge of["cross_attentions","encoder_attentions","decoder_attentions"])for(const Ae in O)Ae.startsWith(ge)&&(ge in se||(se[ge]=[]),se[ge].push(O[Ae]));return se}addPastKeyValues(O,se){if(se)Object.assign(O,se);else{const ge=this.sessions.decoder_model_merged??this.sessions.model,Ae=(O[this.main_input_name]??O.attention_mask)?.dims?.[0]??1,Se=ge?.config?.kv_cache_dtype??"float32",Ke=Se==="float16"?p.DataTypeMap.float16:p.DataTypeMap.float32,at=(0,s.getCacheShapes)(this.config,{batch_size:Ae});for(const ft in at){const Tt=at[ft].reduce((Vt,Bt)=>Vt*Bt,1);O[ft]=new p.Tensor(Se,new Ke(Tt),at[ft])}}}async encode_image({pixel_values:O}){return(await Z(this.sessions.vision_encoder,{pixel_values:O})).image_features}async encode_text({input_ids:O}){return(await Z(this.sessions.embed_tokens,{input_ids:O})).inputs_embeds}async encode_audio({audio_values:O}){return(await Z(this.sessions.audio_encoder,{audio_values:O})).audio_features}}class Ce{}class Fe extends Ce{constructor({last_hidden_state:O,hidden_states:se=null,attentions:ge=null}){super(),this.last_hidden_state=O,this.hidden_states=se,this.attentions=ge}}class Be extends J{}class Ue extends Be{}class He extends Be{async _call(O){return new Da(await super._call(O))}}class De extends Be{async _call(O){return new Gt(await super._call(O))}}class nt extends Be{async _call(O){return new $a(await super._call(O))}}class ke extends Be{async _call(O){return new Oa(await super._call(O))}}class Ge extends J{}class dt extends Ge{}class Ye extends Ge{async _call(O){return new Da(await super._call(O))}}class mt extends Ge{async _call(O){return new Gt(await super._call(O))}}class it extends Ge{async _call(O){return new $a(await super._call(O))}}class Mt extends Ge{async _call(O){return new Oa(await super._call(O))}}class wt extends J{}class ot extends wt{}class Je extends wt{async _call(O){return new Da(await super._call(O))}}class St extends wt{async _call(O){return new Gt(await super._call(O))}}class Lt extends wt{async _call(O){return new $a(await super._call(O))}}class wn extends J{}class Ht extends wn{}class Mn extends wn{}class fa extends J{}class Jt extends fa{}class ss extends J{}class wi extends ss{}class Mi extends ss{async _call(O){return new Da(await super._call(O))}}class Xs extends ss{async _call(O){return new Gt(await super._call(O))}}class Wn extends ss{async _call(O){return new $a(await super._call(O))}}class wa extends ss{async _call(O){return new Oa(await super._call(O))}}class Ra extends J{}class Bs extends Ra{}class Ft extends Ra{async _call(O){return new Da(await super._call(O))}}class Fn extends Ra{async _call(O){return new Gt(await super._call(O))}}class Ys extends Ra{async _call(O){return new $a(await super._call(O))}}class Us extends Ra{async _call(O){return new Oa(await super._call(O))}}class Ua extends J{}class qt extends Ua{}class Zs extends Ua{async _call(O){return new Da(await super._call(O))}}class F extends Ua{async _call(O){return new Gt(await super._call(O))}}class ue extends Ua{async _call(O){return new $a(await super._call(O))}}class ne extends Ua{async _call(O){return new Oa(await super._call(O))}}class le extends J{}class fe extends le{}class xe extends le{async _call(O){return new Da(await super._call(O))}}class Ne extends le{async _call(O){return new Gt(await super._call(O))}}class ut extends le{async _call(O){return new $a(await super._call(O))}}class xt extends le{async _call(O){return new Oa(await super._call(O))}}class ht extends J{}class Rt extends ht{}class _t extends ht{async _call(O){return new Da(await super._call(O))}}class Zt extends ht{async _call(O){return new Gt(await super._call(O))}}class nn extends ht{async _call(O){return new $a(await super._call(O))}}class sa extends ht{async _call(O){return new Oa(await super._call(O))}}class ra extends J{}class Nn extends ra{}class ia extends ra{async _call(O){return new Da(await super._call(O))}}class gs extends ra{async _call(O){return new Gt(await super._call(O))}}class Ma extends ra{async _call(O){return new $a(await super._call(O))}}class Hn extends ra{async _call(O){return new Oa(await super._call(O))}}class Va extends J{}class Ga extends Va{}class Wa extends Va{async _call(O){return new Gt(await super._call(O))}}class Zn extends Va{async _call(O){return new $a(await super._call(O))}}class ha extends Va{async _call(O){return new Oa(await super._call(O))}}class us extends Va{async _call(O){return new Da(await super._call(O))}}class ks extends J{}class Vr extends ks{}class $s extends ks{async _call(O){return new Da(await super._call(O))}}class Ds extends ks{async _call(O){return new Gt(await super._call(O))}}class Ha extends ks{async _call(O){return new $a(await super._call(O))}}class _a extends J{}class Ya extends _a{}class st extends _a{async _call(O){return new Da(await super._call(O))}}class lt extends _a{async _call(O){return new Gt(await super._call(O))}}class Et extends _a{async _call(O){return new Oa(await super._call(O))}}class xn extends J{}class Gr extends xn{}class Ca extends xn{async _call(O){return new Da(await super._call(O))}}class Js extends xn{async _call(O){return new Gt(await super._call(O))}}class ao extends xn{async _call(O){return new $a(await super._call(O))}}class Te extends xn{async _call(O){return new Oa(await super._call(O))}}class N extends J{}class oe extends N{}class pe extends N{async _call(O){return new Da(await super._call(O))}}class me extends N{async _call(O){return new Gt(await super._call(O))}}class Ie extends N{async _call(O){return new Oa(await super._call(O))}}class qe extends J{}class vt extends qe{}class gt extends qe{async _call(O){return new Gt(await super._call(O))}}class bt extends qe{async _call(O){return new Oa(await super._call(O))}}class pt extends qe{async _call(O){return new Da(await super._call(O))}}class Xt extends J{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"]}class jt extends Xt{}class qn extends Xt{}class ga extends J{}class Tn extends ga{}class Dn extends ga{}class An extends J{}class rs extends An{}class Os extends An{}class pa extends J{}class Ba extends pa{}class Vn extends pa{}class Jn extends pa{async _call(O){return new Gt(await super._call(O))}}class ea extends J{}class ds extends ea{}class ys extends ea{}class xa extends ea{async _call(O){return new Gt(await super._call(O))}}class fs extends ea{}class ma extends J{}class Kn extends ma{}class gn extends ma{}class On extends J{}class qa extends On{}class Vs extends On{}class br extends J{}class so extends br{}class tl extends br{async _call(O){return new Da(await super._call(O))}}class xi extends br{async _call(O){return new Gt(await super._call(O))}}class ro extends br{async _call(O){return new $a(await super._call(O))}}class dc extends br{async _call(O){return new Oa(await super._call(O))}}class Ti extends J{}class Du extends Ti{}class Ou extends Ti{async _call(O){return new Da(await super._call(O))}}class nl extends Ti{async _call(O){return new Gt(await super._call(O))}}class Iu extends Ti{async _call(O){return new $a(await super._call(O))}}class zu extends Ti{async _call(O){return new Oa(await super._call(O))}}class Ei extends J{}class Lu extends Ei{}class fc extends Ei{async _call(O){return new Da(await super._call(O))}}class al extends Ei{async _call(O){return new Gt(await super._call(O))}}class hc extends Ei{async _call(O){return new $a(await super._call(O))}}class Fu extends Ei{async _call(O){return new Oa(await super._call(O))}}class pc extends J{}class mc extends pc{}class io extends pc{}class Wr extends J{requires_attention_mask=!1;main_input_name="input_features";forward_params=["input_features","attention_mask","decoder_input_ids","decoder_attention_mask","past_key_values"]}class Nu extends Wr{}class sl extends Wr{_prepare_generation_config(O,se){return super._prepare_generation_config(O,se,S.WhisperGenerationConfig)}_retrieve_init_tokens(O){const se=[O.decoder_start_token_id];let ge=O.language;const Ae=O.task;if(O.is_multilingual){ge||(console.warn("No language specified - defaulting to English (en)."),ge="en");const Ke=`<|${(0,$.whisper_language_to_code)(ge)}|>`;se.push(O.lang_to_id[Ke]),se.push(O.task_to_id[Ae??"transcribe"])}else if(ge||Ae)throw new Error("Cannot specify `task` or `language` for an English-only model. If the model is intended to be multilingual, pass `is_multilingual=true` to generate, or update the generation config.");return!O.return_timestamps&&O.no_timestamps_token_id&&se.at(-1)!==O.no_timestamps_token_id?se.push(O.no_timestamps_token_id):O.return_timestamps&&se.at(-1)===O.no_timestamps_token_id&&(console.warn("<|notimestamps|> prompt token is removed from generation_config since `return_timestamps` is set to `true`."),se.pop()),se.filter(Se=>Se!=null)}async generate({inputs:O=null,generation_config:se=null,logits_processor:ge=null,stopping_criteria:Ae=null,...Se}){se=this._prepare_generation_config(se,Se);const Ke=Se.decoder_input_ids??this._retrieve_init_tokens(se);if(se.return_timestamps&&(ge??=new m.LogitsProcessorList,ge.push(new m.WhisperTimeStampLogitsProcessor(se,Ke))),se.begin_suppress_tokens&&(ge??=new m.LogitsProcessorList,ge.push(new m.SuppressTokensAtBeginLogitsProcessor(se.begin_suppress_tokens,Ke.length))),se.return_token_timestamps){if(!se.alignment_heads)throw new Error("Model generation config has no `alignment_heads`, token-level timestamps not available. See https://gist.github.com/hollance/42e32852f24243b748ae6bc1f985b13a on how to add this property to the generation config.");se.task==="translate"&&console.warn("Token-level timestamps may not be reliable for task 'translate'."),se.output_attentions=!0,se.return_dict_in_generate=!0}const at=await super.generate({inputs:O,generation_config:se,logits_processor:ge,decoder_input_ids:Ke,...Se});return se.return_token_timestamps&&(at.token_timestamps=this._extract_token_timestamps(at,se.alignment_heads,se.num_frames)),at}_extract_token_timestamps(O,se,ge=null,Ae=.02){if(!O.cross_attentions)throw new Error("Model outputs must contain cross attentions to extract timestamps. This is most likely because the model was not exported with `output_attentions=True`.");ge==null&&console.warn("`num_frames` has not been set, meaning the entire audio will be analyzed. This may lead to inaccurate token-level timestamps for short audios (< 30 seconds).");let Se=this.config.median_filter_width;Se===void 0&&(console.warn("Model config has no `median_filter_width`, using default value of 7."),Se=7);const Ke=O.cross_attentions,at=Array.from({length:this.config.decoder_layers},(Ot,It)=>(0,p.cat)(Ke.map(cn=>cn[It]),2)),ft=(0,p.stack)(se.map(([Ot,It])=>{if(Ot>=at.length)throw new Error(`Layer index ${Ot} is out of bounds for cross attentions (length ${at.length}).`);return ge?at[Ot].slice(null,It,null,[0,ge]):at[Ot].slice(null,It)})).transpose(1,0,2,3),[Tt,Vt]=(0,p.std_mean)(ft,-2,0,!0),Bt=ft.clone();for(let Ot=0;Ot<Bt.dims[0];++Ot){const It=Bt[Ot];for(let cn=0;cn<It.dims[0];++cn){const Sn=It[cn],Xn=Tt[Ot][cn][0].data,ca=Vt[Ot][cn][0].data;for(let ba=0;ba<Sn.dims[0];++ba){let Bn=Sn[ba].data;for(let sn=0;sn<Bn.length;++sn)Bn[sn]=(Bn[sn]-ca[sn])/Xn[sn];Bn.set((0,v.medianFilter)(Bn,Se))}}}const Yt=[(0,p.mean)(Bt,1)],Dt=O.sequences.dims,pn=new p.Tensor("float32",new Float32Array(Dt[0]*Dt[1]),Dt);for(let Ot=0;Ot<Dt[0];++Ot){const It=Yt[Ot].neg().squeeze_(0),[cn,Sn]=(0,v.dynamic_time_warping)(It.tolist()),Xn=Array.from({length:cn.length-1},(Bn,sn)=>cn[sn+1]-cn[sn]),ca=(0,u.mergeArrays)([1],Xn).map(Bn=>!!Bn),ba=[];for(let Bn=0;Bn<ca.length;++Bn)ca[Bn]&&ba.push(Sn[Bn]*Ae);pn[Ot].data.set(ba,1)}return pn}}class _c extends sl{}class gc extends J{requires_attention_mask=!1;main_input_name="input_values";forward_params=["input_values","decoder_input_ids","past_key_values"]}class Sf extends gc{}class rl extends gc{}class il extends J{main_input_name="pixel_values";forward_params=["pixel_values","decoder_input_ids","encoder_hidden_states","past_key_values"]}class yc extends J{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class ol extends yc{_merge_input_ids_with_image_features(O){const se=O.image_features.dims.at(-1),ge=O.image_features.view(-1,se);return U({image_token_id:this.config.image_token_index,...O,image_features:ge})}}class ju extends ol{}class Ru extends ol{}class Bu extends J{forward_params=["input_ids","inputs_embeds","attention_mask","pixel_values","encoder_outputs","decoder_input_ids","decoder_inputs_embeds","decoder_attention_mask","past_key_values"];main_input_name="inputs_embeds"}class ll extends Bu{_merge_input_ids_with_image_features({inputs_embeds:O,image_features:se,input_ids:ge,attention_mask:Ae}){return{inputs_embeds:(0,p.cat)([se,O],1),attention_mask:(0,p.cat)([(0,p.ones)(se.dims.slice(0,2)),Ae],1)}}async _prepare_inputs_embeds({input_ids:O,pixel_values:se,inputs_embeds:ge,attention_mask:Ae}){if(!O&&!se)throw new Error("Either `input_ids` or `pixel_values` should be provided.");let Se,Ke;return O&&(Se=await this.encode_text({input_ids:O})),se&&(Ke=await this.encode_image({pixel_values:se})),Se&&Ke?{inputs_embeds:ge,attention_mask:Ae}=this._merge_input_ids_with_image_features({inputs_embeds:Se,image_features:Ke,input_ids:O,attention_mask:Ae}):ge=Se||Ke,{inputs_embeds:ge,attention_mask:Ae}}async forward({input_ids:O,pixel_values:se,attention_mask:ge,decoder_input_ids:Ae,decoder_attention_mask:Se,encoder_outputs:Ke,past_key_values:at,inputs_embeds:ft,decoder_inputs_embeds:Tt}){if(ft||({inputs_embeds:ft,attention_mask:ge}=await this._prepare_inputs_embeds({input_ids:O,pixel_values:se,inputs_embeds:ft,attention_mask:ge})),!Ke){let{last_hidden_state:Yt}=await ee(this,{inputs_embeds:ft,attention_mask:ge});Ke=Yt}if(!Tt){if(!Ae)throw new Error("Either `decoder_input_ids` or `decoder_inputs_embeds` should be provided.");Tt=await this.encode_text({input_ids:Ae})}return await he(this,{inputs_embeds:Tt,attention_mask:Se,encoder_attention_mask:ge,encoder_hidden_states:Ke,past_key_values:at},!0)}}class Si extends J{forward_params=["input_ids","attention_mask","pixel_values","position_ids","past_key_values"]}class Uu extends Si{_merge_input_ids_with_image_features(O){const se=O.image_features.dims.at(-1),ge=O.image_features.view(-1,se);return U({image_token_id:this.config.image_token_index,...O,image_features:ge})}}class cl extends yc{_merge_input_ids_with_image_features(O){const se=O.image_features.dims.at(-1),ge=O.image_features.view(-1,se);return U({image_token_id:this.config.image_token_index,...O,image_features:ge})}}class Ci extends cl{}class Hr extends J{forward_params=["input_ids","attention_mask","inputs_embeds","per_layer_inputs","position_ids","pixel_values","input_features","input_features_mask","past_key_values"]}class oo extends Hr{async forward({input_ids:O=null,attention_mask:se=null,pixel_values:ge=null,input_features:Ae=null,input_features_mask:Se=null,position_ids:Ke=null,inputs_embeds:at=null,per_layer_inputs:ft=null,past_key_values:Tt=null,generation_config:Vt=null,logits_processor:Bt=null,...Yt}){if((!at||!ft)&&({inputs_embeds:at,per_layer_inputs:ft}=await Z(this.sessions.embed_tokens,{input_ids:O}),O.dims[1]!==1)){if(ge){const{image_features:pn}=await Z(this.sessions.vision_encoder,{pixel_values:ge});({inputs_embeds:at,attention_mask:se}=this._merge_input_ids_with_image_features({image_features:pn,inputs_embeds:at,input_ids:O,attention_mask:se}))}if(Ae){const{audio_features:pn}=await Z(this.sessions.audio_encoder,{input_features:Ae,input_features_mask:Se});({inputs_embeds:at,attention_mask:se}=this._merge_input_ids_with_audio_features({audio_features:pn,inputs_embeds:at,input_ids:O,attention_mask:se}))}}return await he(this,{inputs_embeds:at,per_layer_inputs:ft,past_key_values:Tt,attention_mask:se,position_ids:Ke,generation_config:Vt,logits_processor:Bt},!0)}_merge_input_ids_with_image_features(O){const se=O.image_features.dims.at(-1),ge=O.image_features.view(-1,se);return U({image_token_id:this.config.image_token_id,...O,image_features:ge})}_merge_input_ids_with_audio_features(O){const se=O.audio_features.dims.at(-1),ge=O.audio_features.view(-1,se);return K({audio_token_id:this.config.audio_token_id,...O,audio_features:ge})}}class vc extends J{forward_params=["input_ids","attention_mask","pixel_values","pixel_attention_mask","position_ids","past_key_values"]}class er extends vc{async encode_image({pixel_values:O,pixel_attention_mask:se}){return(await Z(this.sessions.vision_encoder,{pixel_values:O,pixel_attention_mask:se})).image_features}_merge_input_ids_with_image_features(O){const se=O.image_features.dims.at(-1),ge=O.image_features.view(-1,se);return U({image_token_id:this.config.image_token_id,...O,image_features:ge})}}class lo extends er{}class ul extends J{forward_params=["input_ids","inputs_embeds","attention_mask","position_ids","pixel_values","image_sizes","past_key_values"]}class dl extends ul{async forward({input_ids:O=null,attention_mask:se=null,pixel_values:ge=null,image_sizes:Ae=null,position_ids:Se=null,inputs_embeds:Ke=null,past_key_values:at=null,generation_config:ft=null,logits_processor:Tt=null,...Vt}){if(!Ke){let Yt;if(ge&&O.dims[1]!==1){if(!Ae)throw new Error("`image_sizes` must be provided when `pixel_values` is provided.");({image_features:Yt}=await Z(this.sessions.vision_encoder,{pixel_values:ge,image_sizes:Ae}))}else{const Dt=this.config.normalized_config.hidden_size;Yt=new p.Tensor("float32",[],[0,Dt])}({inputs_embeds:Ke}=await Z(this.sessions.prepare_inputs_embeds,{input_ids:O,image_features:Yt}))}return await he(this,{inputs_embeds:Ke,past_key_values:at,attention_mask:se,position_ids:Se,generation_config:ft,logits_processor:Tt},!1)}}class tr extends J{}class fl extends tr{}class Ai extends tr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"text_model"})}}class qr extends tr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"text_model"})}}class Vu extends tr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"vision_model"})}}class co extends tr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"vision_model"})}}class uo extends J{}class hl extends uo{}class Kr extends uo{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"text_model"})}}class Pt extends tr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"vision_model"})}}class bc extends J{}class pl extends bc{}class Pi extends J{}class fo extends Pi{async forward(O){const se=!O.input_ids,ge=!O.pixel_values;if(se&&ge)throw new Error("Either `input_ids` or `pixel_values` should be provided.");if(se&&(O.input_ids=(0,p.ones)([O.pixel_values.dims[0],1])),ge){const{image_size:Tt}=this.config.vision_config;O.pixel_values=(0,p.full)([0,3,Tt,Tt],0)}const{text_embeddings:Ae,image_embeddings:Se,l2norm_text_embeddings:Ke,l2norm_image_embeddings:at}=await super.forward(O),ft={};return se||(ft.text_embeddings=Ae,ft.l2norm_text_embeddings=Ke),ge||(ft.image_embeddings=Se,ft.l2norm_image_embeddings=at),ft}}class Is extends Pi{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"text_model"})}}class ho extends Pi{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"vision_model"})}}class po extends J{}class wc extends po{}class Za extends po{}class wr extends J{}class mo extends wr{}class ml extends wr{}class _o extends J{}class _l extends _o{}class Qr extends _o{}class go extends J{}class nr extends go{}class yo extends go{}class Mr extends J{}class vo extends Mr{}class gl extends Mr{}class Gs extends J{}class M extends Gs{}class z extends Gs{}class V extends J{}class Y extends V{}class re extends V{}class be extends J{}class We extends be{}class rt extends be{}class yt extends J{}class Ct extends yt{}class Kt extends yt{}class dn extends J{}class vn extends dn{}class Pn extends J{}class Ws extends Pn{}class hs extends Pn{}class ki extends J{}class Gu extends ki{}class Mc extends ki{}class yl extends J{}class Wu extends yl{}class $i extends yl{}class Hu extends J{}class xc extends Hu{}class bo extends Hu{}class Cf extends J{}class vs extends Cf{}class qu extends Cf{}class ar extends J{}class Af extends ar{}class Tc extends ar{}class Xr extends J{}class Ku extends Xr{}class Pf extends Xr{}class Ec extends J{}class kf extends Ec{}class zs extends Ec{}class Di extends J{}class wo extends Di{}class Sc extends Di{}class Mo extends J{}class Ls extends Mo{}class Fs extends Mo{}class xr extends J{}class sr extends xr{}class rr extends xr{}class ir extends J{}class $f extends ir{}class Qu extends ir{}class Cc extends J{}class Df extends Cc{}class Ka extends Cc{}class Qn extends J{}class _n extends Qn{}class Yr extends Qn{}class bs extends J{}class Xu extends bs{}class Zr extends bs{}class Yu extends J{}class Of extends Yu{}class xo extends Yu{}class Jr extends J{}class Zu extends Jr{}class vl extends Jr{}class Ac extends J{}class Oi extends Ac{}class Tr extends Ac{}class Er extends J{}class Sr extends Er{}class Ju extends Er{}class Pc extends J{}class To extends Pc{}class kc extends Pc{}class Ii extends J{forward_params=["input_ids","attention_mask","position_ids","past_key_values","pixel_values","image_grid_thw"]}class Qa extends Ii{get_rope_index(O,se,ge,Ae){const{vision_config:Se,image_token_id:Ke,video_token_id:at,vision_start_token_id:ft}=this.config,Tt=Se.spatial_merge_size??2,Vt=[];if(se||ge){let Bt=O.tolist();Ae||(Ae=(0,p.ones_like)(O));const Yt=Ae.tolist(),Dt=Array.from({length:3},Sn=>Array.from({length:O.dims[0]},Xn=>Array.from({length:O.dims[1]},ca=>1))),pn=se?se.tolist():[],Ot=ge?ge.tolist():[];let It=0,cn=0;for(let Sn=0;Sn<Bt.length;++Sn){const Xn=Bt[Sn].filter((Yn,za)=>Yt[Sn][za]==1),ba=Xn.reduce((Yn,za,oi)=>(za==ft&&Yn.push(oi),Yn),[]).map(Yn=>Xn[Yn+1]),Bn=ba.filter(Yn=>Yn==Ke).length,sn=ba.filter(Yn=>Yn==at).length;let ua=[],Ia=0,Vo=Bn,_s=sn;for(let Yn=0;Yn<ba.length;++Yn){const za=Xn.findIndex((Zi,ls)=>ls>Ia&&Zi==Ke),oi=Xn.findIndex((Zi,ls)=>ls>Ia&&Zi==at),pr=Vo>0&&za!==-1?za:Xn.length+1,ns=_s>0&&oi!==-1?oi:Xn.length+1;let uu,Ql,mr,$p;pr<ns?([Ql,mr,$p]=pn[It],++It,--Vo,uu=pr):([Ql,mr,$p]=Ot[cn],++cn,--_s,uu=ns);const[$g,Yi,du]=[Number(Ql),Math.floor(Number(mr)/Tt),Math.floor(Number($p)/Tt)],Dp=uu-Ia,r_=ua.length>0?(0,v.max)(ua.at(-1))[0]+1:0;ua.push(Array.from({length:3*Dp},(Zi,ls)=>r_+ls%Dp));const Op=Dp+r_,cf=$g*Yi*du,Dg=Array.from({length:cf},(Zi,ls)=>Op+Math.floor(ls/(Yi*du))),Og=Array.from({length:cf},(Zi,ls)=>Op+Math.floor(ls/du)%Yi),Ig=Array.from({length:cf},(Zi,ls)=>Op+ls%du);ua.push([Dg,Og,Ig].flat()),Ia=uu+cf}if(Ia<Xn.length){const Yn=ua.length>0?(0,v.max)(ua.at(-1))[0]+1:0,za=Xn.length-Ia;ua.push(Array.from({length:3*za},(oi,pr)=>Yn+pr%za))}const Ks=ua.reduce((Yn,za)=>Yn+za.length,0),Qi=new Array(Ks);let Xi=0;for(let Yn=0;Yn<3;++Yn)for(let za=0;za<ua.length;++za){const oi=ua[za],pr=oi.length/3;for(let ns=Yn*pr;ns<(Yn+1)*pr;++ns)Qi[Xi++]=oi[ns]}let lf=0;const os=Yt[Sn];for(let Yn=0;Yn<os.length;++Yn)if(os[Yn]==1){for(let za=0;za<3;++za)Dt[za][Sn][Yn]=Qi[za*Ks/3+lf];++lf}const kp=(0,v.max)(Qi)[0];Vt.push(kp+1-Bt[Sn].length)}return[new p.Tensor("int64",Dt.flat(1/0),[3,O.dims[0],O.dims[1]]),new p.Tensor("int64",Vt,[Vt.length,1])]}else if(Ae){const{data:Bt,dims:Yt}=ve(Ae),Dt=BigInt64Array.from({length:3*Bt.length},(Ot,It)=>Bt[It%Bt.length]),pn=Array.from({length:Yt[0]},(Ot,It)=>(0,v.max)(Bt.subarray(Yt[1]*It,Yt[1]*(It+1)))[0]+1n+BigInt(Yt[1]));return[new p.Tensor("int64",Dt,[3,...Yt]),new p.Tensor("int64",pn,[pn.length,1])]}else{const[Bt,Yt]=O.dims,Dt=BigInt64Array.from({length:3*Bt*Yt},(pn,Ot)=>BigInt(Math.floor(Ot%Yt/Bt)));return[new p.Tensor("int64",Dt,[3,...O.dims]),(0,p.zeros)([Bt,1])]}}async encode_image({pixel_values:O,image_grid_thw:se}){return(await Z(this.sessions.vision_encoder,{pixel_values:O,grid_thw:se})).image_features}_merge_input_ids_with_image_features(O){return U({image_token_id:this.config.image_token_id,...O})}prepare_inputs_for_generation(O,se,ge){if(se.attention_mask&&!se.position_ids)if(!se.past_key_values)[se.position_ids,se.rope_deltas]=this.get_rope_index(se.input_ids,se.image_grid_thw,se.video_grid_thw,se.attention_mask);else{se.pixel_values=null;const Ae=BigInt(Object.values(se.past_key_values)[0].dims.at(-2)),Se=se.rope_deltas.map(Ke=>Ae+Ke);se.position_ids=(0,p.stack)([Se,Se,Se],0)}return se}}class bl extends J{}class If extends bl{}class Am extends bl{}class zf extends J{}class Pm extends zf{}class Aa extends zf{}class $c extends J{}class wl extends $c{}class Ml extends $c{}class Dc extends J{}class Eo extends Dc{}class So extends Dc{}class Lf extends J{}class Ff extends Lf{}class km extends Lf{}class ed extends J{}class zi extends ed{}class td extends ed{async _call(O){return new Gt(await super._call(O))}}class xl extends J{}class Nf extends xl{}class Co extends xl{async _call(O){return new Gt(await super._call(O))}}class nd extends J{}class Oc extends nd{}class Tl extends J{}class jf extends Tl{}class Rf extends Tl{async _call(O){return new Gt(await super._call(O))}}class Li extends J{}class Fi extends Li{}class ad extends J{}class Bf extends ad{}class Ao extends ad{async _call(O){return new Gt(await super._call(O))}}class El extends J{}class Ic extends El{}class Po extends J{}class zc extends Po{}class Uf extends Po{async _call(O){return new Gt(await super._call(O))}}class Ni extends J{}class Vf extends Ni{async _call(O){return new Pp(await super._call(O))}}class Cr extends J{}class sd extends Cr{}class rd extends Cr{async _call(O){return new Gt(await super._call(O))}}class Ar extends J{}class ei extends Ar{}class Sl extends Ar{async _call(O){return new Gt(await super._call(O))}}class Lc extends J{}class id extends Lc{}class Cl extends Lc{}class ko extends J{}class Gf extends ko{}class Wf extends ko{}class ji extends J{}class Fc extends ji{}class Hf extends ji{async _call(O){return new Gt(await super._call(O))}}class Al extends J{}class od extends Al{}class ws extends Al{async _call(O){return new Pr(await super._call(O))}}class Ms extends Al{async _call(O){return new ld(await super._call(O))}}class Pr extends Ce{constructor({logits:O,pred_boxes:se}){super(),this.logits=O,this.pred_boxes=se}}class ld extends Ce{constructor({logits:O,pred_boxes:se,pred_masks:ge}){super(),this.logits=O,this.pred_boxes=se,this.pred_masks=ge}}class cd extends J{}class ti extends cd{}class xs extends cd{async _call(O){return new oa(await super._call(O))}}class oa extends Ce{constructor({logits:O,pred_boxes:se}){super(),this.logits=O,this.pred_boxes=se}}class Pl extends J{}class kr extends Pl{}class an extends Pl{async _call(O){return new jn(await super._call(O))}}class jn extends oa{}class Ta extends J{}class Nc extends Ta{}class $o extends Ta{async _call(O){return new Ri(await super._call(O))}}class Ri extends oa{}class kl extends J{}class $l extends kl{}class Do extends kl{async _call(O){return new oa(await super._call(O))}}class qf extends J{}class ya extends qf{}class ud extends qf{async _call(O){return new dd(await super._call(O))}}class dd extends Pr{}class fd extends J{}class Kf extends fd{}class $m extends fd{async _call(O){return new Gt(await super._call(O))}}class jc extends J{}class hd extends jc{}class pd extends jc{async _call(O){return new Gt(await super._call(O))}}class Ja extends J{}class Ea extends Ja{}class Rc extends Ja{async _call(O){return new Gt(await super._call(O))}}class Bi extends J{}class Bc extends Bi{}class md extends Bi{async _call(O){return new Gt(await super._call(O))}}class $r extends Bi{}class Dl extends J{}class _d extends Dl{}class gd extends Dl{}class yd extends J{}class Qf extends yd{}class Xf extends yd{}class Yf extends J{}class Zf extends Yf{}class Uc extends J{}class vd extends Uc{}class Jf extends Uc{}class Dm extends Uc{}class eh extends J{}class th extends eh{}class nh extends J{}class bd extends nh{}class ah extends J{}class sh extends ah{}class wd extends J{}class rh extends wd{}class ih extends wd{}class oh extends J{}class lh extends oh{}class Oo extends oh{}class ch extends J{}class Vc extends ch{}class Ol extends J{}class uh extends Ol{}class Md extends Ol{async _call(O){return new Gt(await super._call(O))}}class dh extends J{}class fh extends dh{}class hh extends dh{async _call(O){return new Gt(await super._call(O))}}class xd extends J{}class ph extends xd{}class mh extends xd{async _call(O){return new Gt(await super._call(O))}}class Gc extends J{}class _h extends Gc{}class gh extends Gc{async _call(O){return new Gt(await super._call(O))}}class Td extends J{}class yh extends Td{}class vh extends J{}class Om extends vh{}class Ed extends J{}class bh extends Ed{}class Sd extends J{}class Cd extends Sd{}class wh extends Sd{async _call(O){return new Mh(await super._call(O))}}class Mh extends Ce{constructor({logits:O,pred_boxes:se}){super(),this.logits=O,this.pred_boxes=se}}class Im extends J{}class zm extends Im{async get_image_embeddings({pixel_values:O}){return await ee(this,{pixel_values:O})}async forward(O){!O.image_embeddings||!O.image_positional_embeddings?O={...O,...await this.get_image_embeddings(O)}:O={...O},O.input_labels??=(0,p.ones)(O.input_points.dims.slice(0,-1));const se={image_embeddings:O.image_embeddings,image_positional_embeddings:O.image_positional_embeddings};return O.input_points&&(se.input_points=O.input_points),O.input_labels&&(se.input_labels=O.input_labels),O.input_boxes&&(se.input_boxes=O.input_boxes),await Z(this.sessions.prompt_encoder_mask_decoder,se)}async _call(O){return new xh(await super._call(O))}}class xh extends Ce{constructor({iou_scores:O,pred_masks:se}){super(),this.iou_scores=O,this.pred_masks=se}}class Il extends Ce{constructor({iou_scores:O,pred_masks:se,object_score_logits:ge}){super(),this.iou_scores=O,this.pred_masks=se,this.object_score_logits=ge}}class Ad extends J{}class Io extends Ad{async get_image_embeddings({pixel_values:O}){return await ee(this,{pixel_values:O})}async forward(O){const{num_feature_levels:se}=this.config.vision_config;if(Array.from({length:se},(Ke,at)=>`image_embeddings.${at}`).some(Ke=>!O[Ke])?O={...O,...await this.get_image_embeddings(O)}:O={...O},O.input_points){if(O.input_boxes&&O.input_boxes.dims[1]!==1)throw new Error("When both `input_points` and `input_boxes` are provided, the number of boxes per image must be 1.");const Ke=O.input_points.dims;O.input_labels??=(0,p.ones)(Ke.slice(0,-1)),O.input_boxes??=(0,p.full)([Ke[0],0,4],0)}else if(O.input_boxes){const Ke=O.input_boxes.dims;O.input_labels=(0,p.full)([Ke[0],Ke[1],0],-1n),O.input_points=(0,p.full)([Ke[0],1,0,2],0)}else throw new Error("At least one of `input_points` or `input_boxes` must be provided.");const Ae=this.sessions.prompt_encoder_mask_decoder,Se=(0,u.pick)(O,Ae.inputNames);return await Z(Ae,Se)}async _call(O){return new Il(await super._call(O))}}class Th extends Io{}class Eh extends Io{}class zo extends J{}class Sh extends zo{}class Pd extends zo{}class kd extends J{}class $d extends kd{}class Dd extends kd{}class ni extends J{}class Ch extends ni{}class Ui extends ni{async _call(O){return new hr(await super._call(O))}}class Ah extends ni{async _call(O){return new Gt(await super._call(O))}}class Ph extends ni{async _call(O){return new $a(await super._call(O))}}class kh extends J{}class Wc extends kh{async _call(O){return new hr(await super._call(O))}}class Od extends J{}class Id extends Od{}class $h extends Od{async _call(O){return new $a(await super._call(O))}}class Dh extends J{}class Lm extends Dh{}class zl extends J{}class Pa extends zl{}class Xa extends zl{async _call(O){return new hr(await super._call(O))}}class Oh extends zl{async _call(O){return new Gt(await super._call(O))}}class Ll extends J{}class Ih extends Ll{}class zh extends Ll{async _call(O){return new hr(await super._call(O))}}class Fl extends Ll{async _call(O){return new Gt(await super._call(O))}}class Lh extends Ll{async _call(O){return new $a(await super._call(O))}}class Lo extends J{}class Fh extends Lo{}class Fm extends Lo{async _call(O){return new hr(await super._call(O))}}class Hc extends Lo{async _call(O){return new Gt(await super._call(O))}}class Nh extends J{}class jh extends ni{}class Rh extends ni{async _call(O){return new hr(await super._call(O))}}class Bh extends ni{async _call(O){return new Gt(await super._call(O))}}class Vi extends J{}class zd extends Vi{}class Ld extends Vi{async _call(O){return new hr(await super._call(O))}}class Uh extends Vi{async _call(O){return new Gt(await super._call(O))}}class Fd extends Vi{async _call(O){return new of(await super._call(O))}}class qc extends Vi{async _call(O){return new $a(await super._call(O))}}class Nd extends J{}class Vh extends Nd{}class Nl extends J{}class Nm extends Nl{}class Dr extends Nl{}class jd extends Nl{async generate_speech(O,se,{threshold:ge=.5,minlenratio:Ae=0,maxlenratio:Se=20,vocoder:Ke=null}={}){const at={input_ids:O},{encoder_outputs:ft,encoder_attention_mask:Tt}=await ee(this,at),Vt=ft.dims[1]/this.config.reduction_factor,Bt=Math.floor(Vt*Se),Yt=Math.floor(Vt*Ae),Dt=this.config.num_mel_bins;let pn=[],Ot=null,It=null,cn=0;for(;;){++cn;const ca=te(!!It);let ba;It?ba=It.output_sequence_out:ba=new p.Tensor("float32",new Float32Array(Dt),[1,1,Dt]);let Bn={use_cache_branch:ca,output_sequence:ba,encoder_attention_mask:Tt,speaker_embeddings:se,encoder_hidden_states:ft};this.addPastKeyValues(Bn,Ot),It=await Z(this.sessions.decoder_model_merged,Bn),Ot=this.getPastKeyValues(It,Ot);const{prob:sn,spectrum:ua}=It;if(pn.push(ua),cn>=Yt&&(Array.from(sn.data).filter(Ia=>Ia>=ge).length>0||cn>=Bt))break}const Sn=(0,p.cat)(pn),{waveform:Xn}=await Z(Ke.sessions.model,{spectrogram:Sn});return{spectrogram:Sn,waveform:Xn}}}class jm extends J{main_input_name="spectrogram"}class Gh extends J{}class or extends Gh{async generate_speech({input_ids:O,attention_mask:se,style:ge,num_inference_steps:Ae=5,speed:Se=1.05}){const{sampling_rate:Ke,chunk_compress_factor:at,base_chunk_size:ft,latent_dim:Tt}=this.config,{last_hidden_state:Vt,durations:Bt}=await Z(this.sessions.text_encoder,{input_ids:O,attention_mask:se,style:ge});Bt.div_(Se);const Yt=Bt.max().item()*Ke,Dt=ft*at,pn=Math.floor((Yt+Dt-1)/Dt),Ot=O.dims[0],It=(0,p.ones)([Ot,pn]),cn=(0,p.full)([Ot],Ae);let Sn=(0,p.randn)([Ot,Tt*at,pn]);for(let ca=0;ca<Ae;++ca){const ba=(0,p.full)([Ot],ca);({denoised_latents:Sn}=await Z(this.sessions.latent_denoiser,{style:ge,noisy_latents:Sn,latent_mask:It,encoder_outputs:Vt,attention_mask:se,timestep:ba,num_inference_steps:cn}))}const{waveform:Xn}=await Z(this.sessions.voice_decoder,{latents:Sn});return{waveform:Xn,durations:Bt}}}class Rd extends J{}class Wh extends Rd{}class jl extends J{}class Rl extends jl{}class ta extends jl{}class Hh extends J{}class Rm extends Hh{}class qh extends Hh{}class Fo extends J{}class ai extends Fo{}class Kh extends Fo{}class Bd extends J{}class Bl extends Bd{}class lr extends Bd{}class Ud extends J{}class Vd extends Ud{}class Qh extends Ud{}class Kc extends J{}class Gd extends Kc{}class Qc extends Kc{}class Xc extends J{}class Or extends Xc{}class ka extends Xc{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"text_model"})}}class Wd extends Xc{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"audio_model"})}}class Xh extends J{}class Na extends Xh{async _call(O){return new s_(await super._call(O))}}class Hd extends J{}class Bm extends Hd{}class Yh extends Hd{}class la extends Hd{}class is extends J{}class Ir extends is{}class Zh extends is{}class qd extends J{}class Jh extends qd{}class Um extends qd{async _call(O){return new Gt(await super._call(O))}}class Ul extends J{}class Ts extends Ul{}class cr extends Ul{}class Kd extends J{forward_params=["input_ids","attention_mask","encoder_outputs","decoder_input_ids","decoder_attention_mask","past_key_values"];_apply_and_filter_by_delay_pattern_mask(O){const[se,ge]=O.dims,Ae=this.config.decoder.num_codebooks,Se=ge-Ae;let Ke=0;for(let Tt=0;Tt<O.size;++Tt){if(O.data[Tt]===this.config.decoder.pad_token_id)continue;const Vt=Tt%ge,Bt=Math.floor(Tt/ge)%Ae,Yt=Vt-Bt;Yt>0&&Yt<=Se&&(O.data[Ke++]=O.data[Tt])}const at=Math.floor(se/Ae),ft=Ke/(at*Ae);return new p.Tensor(O.type,O.data.slice(0,Ke),[at,Ae,ft])}prepare_inputs_for_generation(O,se,ge){let Ae=structuredClone(O);for(let Ke=0;Ke<Ae.length;++Ke)for(let at=0;at<Ae[Ke].length;++at)Ke%this.config.decoder.num_codebooks>=at&&(Ae[Ke][at]=BigInt(this.config.decoder.pad_token_id));return ge.guidance_scale!==null&&ge.guidance_scale>1&&(Ae=Ae.concat(Ae)),super.prepare_inputs_for_generation(Ae,se,ge)}async generate(O){const se=await super.generate(O),ge=this._apply_and_filter_by_delay_pattern_mask(se).unsqueeze_(0),{audio_values:Ae}=await Z(this.sessions.encodec_decode,{audio_codes:ge});return Ae}}class es extends J{}class ep extends es{}class zr extends es{async _call(O){return new Gt(await super._call(O))}}class Gi extends es{}class Hs extends J{}class Qd extends Hs{}class Xd extends Hs{async _call(O){return new Gt(await super._call(O))}}class qs extends Hs{}class Yc extends J{}class No extends Yc{}class Vl extends Yc{async _call(O){return new Gt(await super._call(O))}}class Gl extends Yc{}class si extends J{}class tp extends si{}class np extends si{async _call(O){return new Gt(await super._call(O))}}class Wl extends si{}class ap extends J{}class Zc extends ap{}class sp extends J{}class Vm extends sp{forward_params=["input_ids","pixel_values","images_seq_mask","images_emb_mask","attention_mask","position_ids","past_key_values"];constructor(...O){super(...O),this._generation_mode="text"}async forward(O){const se=this._generation_mode??"text";let ge;if(se==="text"||!O.past_key_values){const ft=this.sessions.prepare_inputs_embeds,Tt=(0,u.pick)(O,ft.inputNames);ge=await Z(ft,Tt)}else{const ft=this.sessions.gen_img_embeds,Tt=(0,u.pick)({image_ids:O.input_ids},ft.inputNames);ge=await Z(ft,Tt)}const Ae={...O,...ge},Se=await he(this,Ae),Ke=this.sessions[se==="text"?"lm_head":"gen_head"];if(!Ke)throw new Error(`Unable to find "${Ke}" generation head`);const at=await Z(Ke,(0,u.pick)(Se,Ke.inputNames));return{...ge,...Se,...at}}async generate(O){return this._generation_mode="text",super.generate(O)}async generate_images(O){this._generation_mode="image";const se=(O.inputs??O[this.main_input_name]).dims[1],Ae=(await super.generate(O)).slice(null,[se,null]),Se=this.sessions.image_decode,{decoded_image:Ke}=await Z(Se,{generated_tokens:Ae}),at=Ke.add_(1).mul_(255/2).clamp_(0,255).to("uint8"),ft=[];for(const Tt of at){const Vt=y.RawImage.fromTensor(Tt);ft.push(Vt)}return ft}}class Gm extends Ce{constructor({char_logits:O,bpe_logits:se,wp_logits:ge}){super(),this.char_logits=O,this.bpe_logits=se,this.wp_logits=ge}get logits(){return[this.char_logits,this.bpe_logits,this.wp_logits]}}class En extends J{}class Gn extends En{async _call(O){return new Gm(await super._call(O))}}class ln extends J{}class fn extends ln{}class In extends ln{}class ps extends J{}class ri extends ps{}class jo extends ps{}class Yd extends J{forward_params=["input_ids","attention_mask","position_ids","audio_values","past_key_values"]}class ur extends Yd{_merge_input_ids_with_audio_features(O){const se=O.audio_features.dims.at(-1),ge=O.audio_features.view(-1,se);return K({audio_token_id:this.config.ignore_index??this.config.audio_token_id,...O,audio_features:ge})}}class va extends ur{}class dr extends J{main_input_name="input_values";forward_params=["input_values"]}class Wi extends Ce{constructor({audio_codes:O}){super(),this.audio_codes=O}}class Zd extends Ce{constructor({audio_values:O}){super(),this.audio_values=O}}class Es extends dr{async encode(O){return new Wi(await Z(this.sessions.encoder_model,O))}async decode(O){return new Zd(await Z(this.sessions.decoder_model,O))}}class Ro extends dr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"encoder_model"})}}class Hl extends dr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"decoder_model"})}}class ts extends J{main_input_name="input_values";forward_params=["input_values"]}class Jd extends Ce{constructor({audio_codes:O}){super(),this.audio_codes=O}}class Jc extends Ce{constructor({audio_values:O}){super(),this.audio_values=O}}class rp extends ts{async encode(O){return new Jd(await Z(this.sessions.encoder_model,O))}async decode(O){return new Jc(await Z(this.sessions.decoder_model,O))}}class eu extends ts{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"encoder_model"})}}class tu extends ts{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"decoder_model"})}}class fr extends J{main_input_name="input_values";forward_params=["input_values"]}class ja extends fr{async encode(O){return await Z(this.sessions.encoder_model,O)}async decode(O){return await Z(this.sessions.decoder_model,O)}}class ii extends fr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"encoder_model"})}}class Bo extends fr{static async from_pretrained(O,se={}){return super.from_pretrained(O,{...se,model_file_name:se.model_file_name??"decoder_model"})}}class on{static MODEL_CLASS_MAPPINGS=null;static BASE_IF_FAIL=!1;static async from_pretrained(O,{progress_callback:se=null,config:ge=null,cache_dir:Ae=null,local_files_only:Se=!1,revision:Ke="main",model_file_name:at=null,subfolder:ft="onnx",device:Tt=null,dtype:Vt=null,use_external_data_format:Bt=null,session_options:Yt={}}={}){const Dt={progress_callback:se,config:ge,cache_dir:Ae,local_files_only:Se,revision:Ke,model_file_name:at,subfolder:ft,device:Tt,dtype:Vt,use_external_data_format:Bt,session_options:Yt};if(Dt.config=await s.AutoConfig.from_pretrained(O,Dt),!this.MODEL_CLASS_MAPPINGS)throw new Error("`MODEL_CLASS_MAPPINGS` not implemented for this type of `AutoClass`: "+this.name);const pn=Dt.config.model_type;for(const Ot of this.MODEL_CLASS_MAPPINGS){let It=Ot.get(pn);if(!It){for(const cn of Ot.values())if(cn[0]===pn){It=cn;break}if(!It)continue}return await It[1].from_pretrained(O,Dt)}if(this.BASE_IF_FAIL)return af.has(pn)||console.warn(`Unknown model class "${pn}", attempting to construct from base class.`),await J.from_pretrained(O,Dt);throw Error(`Unsupported model type: ${pn}`)}}const ip=new Map([["bert",["BertModel",Ue]],["neobert",["NeoBertModel",dt]],["modernbert",["ModernBertModel",ot]],["nomic_bert",["NomicBertModel",Jt]],["roformer",["RoFormerModel",wi]],["electra",["ElectraModel",qt]],["esm",["EsmModel",Vr]],["convbert",["ConvBertModel",Bs]],["camembert",["CamembertModel",fe]],["deberta",["DebertaModel",Rt]],["deberta-v2",["DebertaV2Model",Nn]],["mpnet",["MPNetModel",Gr]],["albert",["AlbertModel",vt]],["distilbert",["DistilBertModel",Ga]],["roberta",["RobertaModel",so]],["xlm",["XLMModel",Du]],["xlm-roberta",["XLMRobertaModel",Lu]],["clap",["ClapModel",Or]],["clip",["CLIPModel",fl]],["clipseg",["CLIPSegModel",wc]],["chinese_clip",["ChineseCLIPModel",pl]],["siglip",["SiglipModel",hl]],["jina_clip",["JinaCLIPModel",fo]],["mobilebert",["MobileBertModel",Ya]],["squeezebert",["SqueezeBertModel",oe]],["wav2vec2",["Wav2Vec2Model",Ch]],["wav2vec2-bert",["Wav2Vec2BertModel",Fh]],["unispeech",["UniSpeechModel",Pa]],["unispeech-sat",["UniSpeechSatModel",Ih]],["hubert",["HubertModel",jh]],["wavlm",["WavLMModel",zd]],["audio-spectrogram-transformer",["ASTModel",mc]],["vits",["VitsModel",Na]],["pyannote",["PyAnnoteModel",Id]],["wespeaker-resnet",["WeSpeakerResNetModel",Lm]],["detr",["DetrModel",od]],["rt_detr",["RTDetrModel",ti]],["rt_detr_v2",["RTDetrV2Model",kr]],["rf_detr",["RFDetrModel",Nc]],["d_fine",["DFineModel",$l]],["table-transformer",["TableTransformerModel",ya]],["vit",["ViTModel",zi]],["ijepa",["IJepaModel",Nf]],["pvt",["PvtModel",jf]],["vit_msn",["ViTMSNModel",Bf]],["vit_mae",["ViTMAEModel",Fi]],["groupvit",["GroupViTModel",Ic]],["fastvit",["FastViTModel",zc]],["mobilevit",["MobileViTModel",sd]],["mobilevitv2",["MobileViTV2Model",ei]],["owlvit",["OwlViTModel",id]],["owlv2",["Owlv2Model",Gf]],["beit",["BeitModel",Fc]],["deit",["DeiTModel",Kf]],["hiera",["HieraModel",hd]],["convnext",["ConvNextModel",uh]],["convnextv2",["ConvNextV2Model",fh]],["dinov2",["Dinov2Model",ph]],["dinov2_with_registers",["Dinov2WithRegistersModel",_h]],["dinov3_vit",["DINOv3ViTModel",yh]],["dinov3_convnext",["DINOv3ConvNextModel",Om]],["resnet",["ResNetModel",Ea]],["swin",["SwinModel",Bc]],["swin2sr",["Swin2SRModel",_d]],["donut-swin",["DonutSwinModel",Vc]],["yolos",["YolosModel",Cd]],["dpt",["DPTModel",Qf]],["glpn",["GLPNModel",lh]],["hifigan",["SpeechT5HifiGan",jm]],["efficientnet",["EfficientNetModel",Jh]],["decision_transformer",["DecisionTransformerModel",Zc]],["patchtst",["PatchTSTForPrediction",fn]],["patchtsmixer",["PatchTSMixerForPrediction",ri]],["mobilenet_v1",["MobileNetV1Model",ep]],["mobilenet_v2",["MobileNetV2Model",Qd]],["mobilenet_v3",["MobileNetV3Model",No]],["mobilenet_v4",["MobileNetV4Model",tp]],["maskformer",["MaskFormerModel",rh]],["mgp-str",["MgpstrForSceneTextRecognition",Gn]],["style_text_to_speech_2",["StyleTextToSpeech2Model",Vh]]]),op=new Map([["t5",["T5Model",jt]],["longt5",["LongT5Model",Tn]],["mt5",["MT5Model",rs]],["bart",["BartModel",Ba]],["mbart",["MBartModel",ds]],["marian",["MarianModel",Sh]],["whisper",["WhisperModel",Nu]],["m2m_100",["M2M100Model",$d]],["blenderbot",["BlenderbotModel",Kn]],["blenderbot-small",["BlenderbotSmallModel",qa]]]),Wm=new Map([["mimi",["MimiModel",Es]],["dac",["DacModel",rp]],["snac",["SnacModel",ja]]]),nu=new Map([["bloom",["BloomModel",wl]],["jais",["JAISModel",_l]],["gpt2",["GPT2Model",mo]],["gptj",["GPTJModel",M]],["gpt_bigcode",["GPTBigCodeModel",Y]],["gpt_neo",["GPTNeoModel",nr]],["gpt_neox",["GPTNeoXModel",vo]],["codegen",["CodeGenModel",We]],["llama",["LlamaModel",Ct]],["nanochat",["NanoChatModel",Ws]],["arcee",["ArceeModel",Gu]],["lfm2",["Lfm2Model",Wu]],["smollm3",["SmolLM3Model",xc]],["exaone",["ExaoneModel",Ku]],["olmo",["OlmoModel",wo]],["olmo2",["Olmo2Model",Ls]],["mobilellm",["MobileLLMModel",kf]],["granite",["GraniteModel",sr]],["granitemoehybrid",["GraniteMoeHybridModel",$f]],["cohere",["CohereModel",Df]],["gemma",["GemmaModel",_n]],["gemma2",["Gemma2Model",Xu]],["vaultgemma",["VaultGemmaModel",Of]],["gemma3_text",["Gemma3Model",Zu]],["helium",["HeliumModel",vs]],["glm",["GlmModel",Af]],["openelm",["OpenELMModel",Oi]],["qwen2",["Qwen2Model",Sr]],["qwen3",["Qwen3Model",To]],["phi",["PhiModel",If]],["phi3",["Phi3Model",Pm]],["mpt",["MptModel",Eo]],["opt",["OPTModel",Ff]],["mistral",["MistralModel",Rl]],["ministral",["MinistralModel",Rm]],["ministral3",["Ministral3Model",ai]],["ernie4_5",["Ernie4_5Model",Bl]],["starcoder2",["Starcoder2Model",Vd]],["falcon",["FalconModel",Gd]],["stablelm",["StableLmModel",Ir]],["modernbert-decoder",["ModernBertDecoderModel",Ht]]]),au=new Map([["speecht5",["SpeechT5ForSpeechToText",Dr]],["whisper",["WhisperForConditionalGeneration",sl]],["lite-whisper",["LiteWhisperForConditionalGeneration",_c]],["moonshine",["MoonshineForConditionalGeneration",rl]]]),Ss=new Map([["speecht5",["SpeechT5ForTextToSpeech",jd]]]),lp=new Map([["vits",["VitsModel",Na]],["musicgen",["MusicgenForConditionalGeneration",Kd]],["supertonic",["SupertonicForConditionalGeneration",or]]]),ms=new Map([["bert",["BertForSequenceClassification",De]],["neobert",["NeoBertForSequenceClassification",mt]],["modernbert",["ModernBertForSequenceClassification",St]],["roformer",["RoFormerForSequenceClassification",Xs]],["electra",["ElectraForSequenceClassification",F]],["esm",["EsmForSequenceClassification",Ds]],["convbert",["ConvBertForSequenceClassification",Fn]],["camembert",["CamembertForSequenceClassification",Ne]],["deberta",["DebertaForSequenceClassification",Zt]],["deberta-v2",["DebertaV2ForSequenceClassification",gs]],["mpnet",["MPNetForSequenceClassification",Js]],["albert",["AlbertForSequenceClassification",gt]],["distilbert",["DistilBertForSequenceClassification",Wa]],["roberta",["RobertaForSequenceClassification",xi]],["xlm",["XLMForSequenceClassification",nl]],["xlm-roberta",["XLMRobertaForSequenceClassification",al]],["bart",["BartForSequenceClassification",Jn]],["mbart",["MBartForSequenceClassification",xa]],["mobilebert",["MobileBertForSequenceClassification",lt]],["squeezebert",["SqueezeBertForSequenceClassification",me]]]),cp=new Map([["bert",["BertForTokenClassification",nt]],["neobert",["NeoBertForTokenClassification",it]],["modernbert",["ModernBertForTokenClassification",Lt]],["roformer",["RoFormerForTokenClassification",Wn]],["electra",["ElectraForTokenClassification",ue]],["esm",["EsmForTokenClassification",Ha]],["convbert",["ConvBertForTokenClassification",Ys]],["camembert",["CamembertForTokenClassification",ut]],["deberta",["DebertaForTokenClassification",nn]],["deberta-v2",["DebertaV2ForTokenClassification",Ma]],["mpnet",["MPNetForTokenClassification",ao]],["distilbert",["DistilBertForTokenClassification",Zn]],["roberta",["RobertaForTokenClassification",ro]],["xlm",["XLMForTokenClassification",Iu]],["xlm-roberta",["XLMRobertaForTokenClassification",hc]]]),ef=new Map([["t5",["T5ForConditionalGeneration",qn]],["longt5",["LongT5ForConditionalGeneration",Dn]],["mt5",["MT5ForConditionalGeneration",Os]],["bart",["BartForConditionalGeneration",Vn]],["mbart",["MBartForConditionalGeneration",ys]],["marian",["MarianMTModel",Pd]],["m2m_100",["M2M100ForConditionalGeneration",Dd]],["blenderbot",["BlenderbotForConditionalGeneration",gn]],["blenderbot-small",["BlenderbotSmallForConditionalGeneration",Vs]]]),up=new Map([["bloom",["BloomForCausalLM",Ml]],["gpt2",["GPT2LMHeadModel",ml]],["jais",["JAISLMHeadModel",Qr]],["gptj",["GPTJForCausalLM",z]],["gpt_bigcode",["GPTBigCodeForCausalLM",re]],["gpt_neo",["GPTNeoForCausalLM",yo]],["gpt_neox",["GPTNeoXForCausalLM",gl]],["codegen",["CodeGenForCausalLM",rt]],["llama",["LlamaForCausalLM",Kt]],["nanochat",["NanoChatForCausalLM",hs]],["llama4_text",["Llama4ForCausalLM",vn]],["arcee",["ArceeForCausalLM",Mc]],["lfm2",["Lfm2ForCausalLM",$i]],["smollm3",["SmolLM3ForCausalLM",bo]],["exaone",["ExaoneForCausalLM",Pf]],["olmo",["OlmoForCausalLM",Sc]],["olmo2",["Olmo2ForCausalLM",Fs]],["mobilellm",["MobileLLMForCausalLM",zs]],["granite",["GraniteForCausalLM",rr]],["granitemoehybrid",["GraniteMoeHybridForCausalLM",Qu]],["cohere",["CohereForCausalLM",Ka]],["gemma",["GemmaForCausalLM",Yr]],["gemma2",["Gemma2ForCausalLM",Zr]],["vaultgemma",["VaultGemmaForCausalLM",xo]],["gemma3_text",["Gemma3ForCausalLM",vl]],["helium",["HeliumForCausalLM",qu]],["glm",["GlmForCausalLM",Tc]],["openelm",["OpenELMForCausalLM",Tr]],["qwen2",["Qwen2ForCausalLM",Ju]],["qwen3",["Qwen3ForCausalLM",kc]],["phi",["PhiForCausalLM",Am]],["phi3",["Phi3ForCausalLM",Aa]],["mpt",["MptForCausalLM",So]],["opt",["OPTForCausalLM",km]],["mbart",["MBartForCausalLM",fs]],["mistral",["MistralForCausalLM",ta]],["ministral",["MinistralForCausalLM",qh]],["ministral3",["Ministral3ForCausalLM",Kh]],["ernie4_5",["Ernie4_5ForCausalLM",lr]],["starcoder2",["Starcoder2ForCausalLM",Qh]],["falcon",["FalconForCausalLM",Qc]],["trocr",["TrOCRForCausalLM",Wh]],["stablelm",["StableLmForCausalLM",Zh]],["modernbert-decoder",["ModernBertDecoderForCausalLM",Mn]],["phi3_v",["Phi3VForCausalLM",dl]]]),Hi=new Map([["multi_modality",["MultiModalityCausalLM",Vm]]]),su=new Map([["bert",["BertForMaskedLM",He]],["neobert",["NeoBertForMaskedLM",Ye]],["modernbert",["ModernBertForMaskedLM",Je]],["roformer",["RoFormerForMaskedLM",Mi]],["electra",["ElectraForMaskedLM",Zs]],["esm",["EsmForMaskedLM",$s]],["convbert",["ConvBertForMaskedLM",Ft]],["camembert",["CamembertForMaskedLM",xe]],["deberta",["DebertaForMaskedLM",_t]],["deberta-v2",["DebertaV2ForMaskedLM",ia]],["mpnet",["MPNetForMaskedLM",Ca]],["albert",["AlbertForMaskedLM",pt]],["distilbert",["DistilBertForMaskedLM",us]],["roberta",["RobertaForMaskedLM",tl]],["xlm",["XLMWithLMHeadModel",Ou]],["xlm-roberta",["XLMRobertaForMaskedLM",fc]],["mobilebert",["MobileBertForMaskedLM",st]],["squeezebert",["SqueezeBertForMaskedLM",pe]]]),tf=new Map([["bert",["BertForQuestionAnswering",ke]],["neobert",["NeoBertForQuestionAnswering",Mt]],["roformer",["RoFormerForQuestionAnswering",wa]],["electra",["ElectraForQuestionAnswering",ne]],["convbert",["ConvBertForQuestionAnswering",Us]],["camembert",["CamembertForQuestionAnswering",xt]],["deberta",["DebertaForQuestionAnswering",sa]],["deberta-v2",["DebertaV2ForQuestionAnswering",Hn]],["mpnet",["MPNetForQuestionAnswering",Te]],["albert",["AlbertForQuestionAnswering",bt]],["distilbert",["DistilBertForQuestionAnswering",ha]],["roberta",["RobertaForQuestionAnswering",dc]],["xlm",["XLMForQuestionAnswering",zu]],["xlm-roberta",["XLMRobertaForQuestionAnswering",Fu]],["mobilebert",["MobileBertForQuestionAnswering",Et]],["squeezebert",["SqueezeBertForQuestionAnswering",Ie]]]),qi=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",il]],["idefics3",["Idefics3ForConditionalGeneration",er]],["smolvlm",["SmolVLMForConditionalGeneration",lo]]]),dp=new Map([["llava",["LlavaForConditionalGeneration",ol]],["llava_onevision",["LlavaOnevisionForConditionalGeneration",ju]],["moondream1",["Moondream1ForConditionalGeneration",Ru]],["florence2",["Florence2ForConditionalGeneration",ll]],["qwen2-vl",["Qwen2VLForConditionalGeneration",Qa]],["idefics3",["Idefics3ForConditionalGeneration",er]],["smolvlm",["SmolVLMForConditionalGeneration",lo]],["paligemma",["PaliGemmaForConditionalGeneration",Uu]],["llava_qwen2",["LlavaQwen2ForCausalLM",cl]],["gemma3n",["Gemma3nForConditionalGeneration",oo]],["mistral3",["Mistral3ForConditionalGeneration",Ci]]]),fp=new Map([["ultravox",["UltravoxModel",ur]],["voxtral",["VoxtralForConditionalGeneration",va]]]),Hm=new Map([["vision-encoder-decoder",["VisionEncoderDecoderModel",il]]]),hp=new Map([["vit",["ViTForImageClassification",td]],["ijepa",["IJepaForImageClassification",Co]],["pvt",["PvtForImageClassification",Rf]],["vit_msn",["ViTMSNForImageClassification",Ao]],["fastvit",["FastViTForImageClassification",Uf]],["mobilevit",["MobileViTForImageClassification",rd]],["mobilevitv2",["MobileViTV2ForImageClassification",Sl]],["beit",["BeitForImageClassification",Hf]],["deit",["DeiTForImageClassification",$m]],["hiera",["HieraForImageClassification",pd]],["convnext",["ConvNextForImageClassification",Md]],["convnextv2",["ConvNextV2ForImageClassification",hh]],["dinov2",["Dinov2ForImageClassification",mh]],["dinov2_with_registers",["Dinov2WithRegistersForImageClassification",gh]],["resnet",["ResNetForImageClassification",Rc]],["swin",["SwinForImageClassification",md]],["segformer",["SegformerForImageClassification",Yh]],["efficientnet",["EfficientNetForImageClassification",Um]],["mobilenet_v1",["MobileNetV1ForImageClassification",zr]],["mobilenet_v2",["MobileNetV2ForImageClassification",Xd]],["mobilenet_v3",["MobileNetV3ForImageClassification",Vl]],["mobilenet_v4",["MobileNetV4ForImageClassification",np]]]),ru=new Map([["detr",["DetrForObjectDetection",ws]],["rt_detr",["RTDetrForObjectDetection",xs]],["rt_detr_v2",["RTDetrV2ForObjectDetection",an]],["rf_detr",["RFDetrForObjectDetection",$o]],["d_fine",["DFineForObjectDetection",Do]],["table-transformer",["TableTransformerForObjectDetection",ud]],["yolos",["YolosForObjectDetection",wh]]]),nf=new Map([["owlvit",["OwlViTForObjectDetection",Cl]],["owlv2",["Owlv2ForObjectDetection",Wf]],["grounding-dino",["GroundingDinoForObjectDetection",bh]]]),ql=new Map([["detr",["DetrForSegmentation",Ms]],["clipseg",["CLIPSegForImageSegmentation",Za]]]),qm=new Map([["segformer",["SegformerForSemanticSegmentation",la]],["sapiens",["SapiensForSemanticSegmentation",vd]],["swin",["SwinForSemanticSegmentation",$r]],["mobilenet_v1",["MobileNetV1ForSemanticSegmentation",Gi]],["mobilenet_v2",["MobileNetV2ForSemanticSegmentation",qs]],["mobilenet_v3",["MobileNetV3ForSemanticSegmentation",Gl]],["mobilenet_v4",["MobileNetV4ForSemanticSegmentation",Wl]]]),Km=new Map([["detr",["DetrForSegmentation",Ms]],["maskformer",["MaskFormerForInstanceSegmentation",ih]]]),pp=new Map([["sam",["SamModel",zm]],["sam2",["Sam2Model",Io]],["edgetam",["EdgeTamModel",Th]],["sam3_tracker",["Sam3TrackerModel",Eh]]]),mp=new Map([["wav2vec2",["Wav2Vec2ForCTC",Ui]],["wav2vec2-bert",["Wav2Vec2BertForCTC",Fm]],["unispeech",["UniSpeechForCTC",Xa]],["unispeech-sat",["UniSpeechSatForCTC",zh]],["wavlm",["WavLMForCTC",Ld]],["hubert",["HubertForCTC",Rh]],["parakeet_ctc",["ParakeetForCTC",Wc]]]),Uo=new Map([["wav2vec2",["Wav2Vec2ForSequenceClassification",Ah]],["wav2vec2-bert",["Wav2Vec2BertForSequenceClassification",Hc]],["unispeech",["UniSpeechForSequenceClassification",Oh]],["unispeech-sat",["UniSpeechSatForSequenceClassification",Fl]],["wavlm",["WavLMForSequenceClassification",Uh]],["hubert",["HubertForSequenceClassification",Bh]],["audio-spectrogram-transformer",["ASTForAudioClassification",io]]]),iu=new Map([["wavlm",["WavLMForXVector",Fd]]]),_p=new Map([["unispeech-sat",["UniSpeechSatForAudioFrameClassification",Lh]],["wavlm",["WavLMForAudioFrameClassification",qc]],["wav2vec2",["Wav2Vec2ForAudioFrameClassification",Ph]],["pyannote",["PyAnnoteForAudioFrameClassification",$h]]]),gp=new Map([["vitmatte",["VitMatteForImageMatting",Vf]]]),Qm=new Map([["patchtst",["PatchTSTForPrediction",In]],["patchtsmixer",["PatchTSMixerForPrediction",jo]]]),yp=new Map([["swin2sr",["Swin2SRForImageSuperResolution",gd]]]),vp=new Map([["dpt",["DPTForDepthEstimation",Xf]],["depth_anything",["DepthAnythingForDepthEstimation",Zf]],["glpn",["GLPNForDepthEstimation",Oo]],["sapiens",["SapiensForDepthEstimation",Jf]],["depth_pro",["DepthProForDepthEstimation",th]],["metric3d",["Metric3DForDepthEstimation",bd]],["metric3dv2",["Metric3Dv2ForDepthEstimation",sh]]]),bp=new Map([["sapiens",["SapiensForNormalEstimation",Dm]]]),ou=new Map([["vitpose",["VitPoseForPoseEstimation",Oc]]]),wp=new Map([["clip",["CLIPVisionModelWithProjection",co]],["siglip",["SiglipVisionModel",Pt]],["jina_clip",["JinaCLIPVisionModel",ho]]]),Mp=[[ip,w.EncoderOnly],[op,w.EncoderDecoder],[nu,w.DecoderOnly],[Wm,w.AutoEncoder],[ms,w.EncoderOnly],[cp,w.EncoderOnly],[ef,w.Seq2Seq],[au,w.Seq2Seq],[up,w.DecoderOnly],[Hi,w.MultiModality],[su,w.EncoderOnly],[tf,w.EncoderOnly],[qi,w.Vision2Seq],[dp,w.ImageTextToText],[fp,w.AudioTextToText],[hp,w.EncoderOnly],[ql,w.EncoderOnly],[Km,w.EncoderOnly],[qm,w.EncoderOnly],[gp,w.EncoderOnly],[Qm,w.EncoderOnly],[yp,w.EncoderOnly],[vp,w.EncoderOnly],[bp,w.EncoderOnly],[ou,w.EncoderOnly],[ru,w.EncoderOnly],[nf,w.EncoderOnly],[pp,w.MaskGeneration],[mp,w.EncoderOnly],[Uo,w.EncoderOnly],[Ss,w.Seq2Seq],[lp,w.EncoderOnly],[iu,w.EncoderOnly],[_p,w.EncoderOnly],[wp,w.EncoderOnly]];for(const[D,O]of Mp)for(const[se,ge]of D.values())C.set(se,O),A.set(ge,se),P.set(se,ge);const Rn=[["MusicgenForConditionalGeneration",Kd,w.Musicgen],["Phi3VForCausalLM",dl,w.Phi3V],["CLIPTextModelWithProjection",qr,w.EncoderOnly],["SiglipTextModel",Kr,w.EncoderOnly],["JinaCLIPTextModel",Is,w.EncoderOnly],["ClapTextModelWithProjection",ka,w.EncoderOnly],["ClapAudioModelWithProjection",Wd,w.EncoderOnly],["DacEncoderModel",eu,w.EncoderOnly],["DacDecoderModel",tu,w.EncoderOnly],["MimiEncoderModel",Ro,w.EncoderOnly],["MimiDecoderModel",Hl,w.EncoderOnly],["SnacEncoderModel",ii,w.EncoderOnly],["SnacDecoderModel",Bo,w.EncoderOnly],["Gemma3nForConditionalGeneration",oo,w.ImageAudioTextToText],["SupertonicForConditionalGeneration",or,w.Supertonic]];for(const[D,O,se]of Rn)C.set(D,se),A.set(O,D),P.set(D,O);const af=new Map([["modnet",ql],["birefnet",ql],["isnet",ql],["ben",ql]]);for(const[D,O]of af.entries())O.set(D,["PreTrainedModel",J]),C.set(D,w.EncoderOnly),A.set(J,D),P.set(D,J);class bg extends on{static MODEL_CLASS_MAPPINGS=Mp.map(O=>O[0]);static BASE_IF_FAIL=!0}class Xm extends on{static MODEL_CLASS_MAPPINGS=[ms]}class wg extends on{static MODEL_CLASS_MAPPINGS=[cp]}class Mg extends on{static MODEL_CLASS_MAPPINGS=[ef]}class xg extends on{static MODEL_CLASS_MAPPINGS=[au]}class sf extends on{static MODEL_CLASS_MAPPINGS=[Ss]}class Kl extends on{static MODEL_CLASS_MAPPINGS=[lp]}class xp extends on{static MODEL_CLASS_MAPPINGS=[up]}class rf extends on{static MODEL_CLASS_MAPPINGS=[su]}class Tp extends on{static MODEL_CLASS_MAPPINGS=[tf]}class Ki extends on{static MODEL_CLASS_MAPPINGS=[qi]}class Lr extends on{static MODEL_CLASS_MAPPINGS=[hp]}class lu extends on{static MODEL_CLASS_MAPPINGS=[ql]}class Tg extends on{static MODEL_CLASS_MAPPINGS=[qm]}class Ym extends on{static MODEL_CLASS_MAPPINGS=[Km]}class Zm extends on{static MODEL_CLASS_MAPPINGS=[ru]}class Jm extends on{static MODEL_CLASS_MAPPINGS=[nf]}class e_ extends on{static MODEL_CLASS_MAPPINGS=[pp]}class Eg extends on{static MODEL_CLASS_MAPPINGS=[mp]}class Ep extends on{static MODEL_CLASS_MAPPINGS=[Uo]}class t_ extends on{static MODEL_CLASS_MAPPINGS=[iu]}class n_ extends on{static MODEL_CLASS_MAPPINGS=[_p]}class Sg extends on{static MODEL_CLASS_MAPPINGS=[Hm]}class Sp extends on{static MODEL_CLASS_MAPPINGS=[gp]}class Cp extends on{static MODEL_CLASS_MAPPINGS=[yp]}class Cg extends on{static MODEL_CLASS_MAPPINGS=[vp]}class Ag extends on{static MODEL_CLASS_MAPPINGS=[bp]}class cu extends on{static MODEL_CLASS_MAPPINGS=[ou]}class Pg extends on{static MODEL_CLASS_MAPPINGS=[wp]}class a_ extends on{static MODEL_CLASS_MAPPINGS=[dp]}class hn extends on{static MODEL_CLASS_MAPPINGS=[fp]}class Ap extends Ce{constructor({logits:O,past_key_values:se,encoder_outputs:ge,decoder_attentions:Ae=null,cross_attentions:Se=null}){super(),this.logits=O,this.past_key_values=se,this.encoder_outputs=ge,this.decoder_attentions=Ae,this.cross_attentions=Se}}class Gt extends Ce{constructor({logits:O,...se}){super(),this.logits=O;const ge=Object.values(se);ge.length>0&&(this.attentions=ge)}}class of extends Ce{constructor({logits:O,embeddings:se}){super(),this.logits=O,this.embeddings=se}}class $a extends Ce{constructor({logits:O}){super(),this.logits=O}}class Da extends Ce{constructor({logits:O}){super(),this.logits=O}}class Oa extends Ce{constructor({start_logits:O,end_logits:se}){super(),this.start_logits=O,this.end_logits=se}}class hr extends Ce{constructor({logits:O}){super(),this.logits=O}}class kg extends Ce{constructor({logits:O,past_key_values:se}){super(),this.logits=O,this.past_key_values=se}}class Pp extends Ce{constructor({alphas:O}){super(),this.alphas=O}}class s_ extends Ce{constructor({waveform:O,spectrogram:se}){super(),this.waveform=O,this.spectrogram=se}}}),"./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js":((e,n,t)=>{t.r(n),t.d(n,{ASTFeatureExtractor:()=>l});var s=t("./src/base/feature_extraction_utils.js");t("./src/utils/tensor.js");var i=t("./src/utils/audio.js");class l extends s.FeatureExtractor{constructor(u){super(u);const d=this.config.sampling_rate,f=(0,i.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(d/2),d,null,"kaldi",!0);this.mel_filters=f,this.window=(0,i.window_function)(400,"hann",{periodic:!1}),this.mean=this.config.mean,this.std=this.config.std}async _extract_fbank_features(u,d){return(0,i.spectrogram)(u,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:d,transpose:!0})}async _call(u){(0,s.validate_audio_inputs)(u,"ASTFeatureExtractor");const d=await this._extract_fbank_features(u,this.config.max_length);if(this.config.do_normalize){const f=this.std*2,m=d.data;for(let _=0;_<m.length;++_)m[_]=(m[_]-this.mean)/f}return{input_values:d.unsqueeze_(0)}}}}),"./src/models/auto/feature_extraction_auto.js":((e,n,t)=>{t.r(n),t.d(n,{AutoFeatureExtractor:()=>c});var s=t("./src/utils/constants.js"),i=t("./src/utils/hub.js");t("./src/base/feature_extraction_utils.js");var l=t("./src/models/feature_extractors.js");class c{static async from_pretrained(d,f={}){const m=await(0,i.getModelJSON)(d,s.FEATURE_EXTRACTOR_NAME,!0,f),_=m.feature_extractor_type,p=l[_];if(!p)throw new Error(`Unknown feature_extractor_type: '${_}'. Please report this at ${s.GITHUB_ISSUE_URL}.`);return new p(m)}}}),"./src/models/auto/image_processing_auto.js":((e,n,t)=>{t.r(n),t.d(n,{AutoImageProcessor:()=>u});var s=t("./src/utils/constants.js"),i=t("./src/utils/hub.js"),l=t("./src/base/image_processors_utils.js"),c=t("./src/models/image_processors.js");class u{static async from_pretrained(f,m={}){const _=await(0,i.getModelJSON)(f,s.IMAGE_PROCESSOR_NAME,!0,m),p=_.image_processor_type??_.feature_extractor_type;let y=c[p?.replace(/Fast$/,"")];return y||(p!==void 0&&console.warn(`Image processor type '${p}' not found, assuming base ImageProcessor. Please report this at ${s.GITHUB_ISSUE_URL}.`),y=l.ImageProcessor),new y(_)}}}),"./src/models/auto/processing_auto.js":((e,n,t)=>{t.r(n),t.d(n,{AutoProcessor:()=>f});var s=t("./src/utils/constants.js"),i=t("./src/utils/hub.js"),l=t("./src/base/processing_utils.js"),c=t("./src/models/processors.js"),u=t("./src/models/image_processors.js"),d=t("./src/models/feature_extractors.js");class f{static async from_pretrained(_,p={}){const y=await(0,i.getModelJSON)(_,s.IMAGE_PROCESSOR_NAME,!0,p),{image_processor_type:v,feature_extractor_type:T,processor_class:k}=y;if(k&&c[k])return c[k].from_pretrained(_,p);if(!v&&!T)throw new Error("No `image_processor_type` or `feature_extractor_type` found in the config.");const b={};if(v){const $=u[v.replace(/Fast$/,"")];if(!$)throw new Error(`Unknown image_processor_type: '${v}'.`);b.image_processor=new $(y)}if(T){const $=u[T];if($)b.image_processor=new $(y);else{const w=d[T];if(!w)throw new Error(`Unknown feature_extractor_type: '${T}'.`);b.feature_extractor=new w(y)}}const S={};return new l.Processor(S,b,null)}}}),"./src/models/beit/image_processing_beit.js":((e,n,t)=>{t.r(n),t.d(n,{BeitFeatureExtractor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/bit/image_processing_bit.js":((e,n,t)=>{t.r(n),t.d(n,{BitImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/chinese_clip/image_processing_chinese_clip.js":((e,n,t)=>{t.r(n),t.d(n,{ChineseCLIPFeatureExtractor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/clap/feature_extraction_clap.js":((e,n,t)=>{t.r(n),t.d(n,{ClapFeatureExtractor:()=>l});var s=t("./src/base/feature_extraction_utils.js");t("./src/utils/tensor.js");var i=t("./src/utils/audio.js");class l extends s.FeatureExtractor{constructor(u){super(u),this.mel_filters=(0,i.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,null,"htk"),this.mel_filters_slaney=(0,i.mel_filter_bank)(this.config.nb_frequency_bins,this.config.feature_size,this.config.frequency_min,this.config.frequency_max,this.config.sampling_rate,"slaney","slaney"),this.window=(0,i.window_function)(this.config.fft_window_size,"hann")}async _get_input_mel(u,d,f,m){let _;const p=u.length-d;if(p>0)if(f==="rand_trunc"){const y=Math.floor(Math.random()*(p+1));u=u.subarray(y,y+d),_=await this._extract_fbank_features(u,this.mel_filters_slaney,this.config.nb_max_samples)}else throw new Error(`Truncation strategy "${f}" not implemented`);else{if(p<0){let y=new Float64Array(d);if(y.set(u),m==="repeat")for(let v=u.length;v<d;v+=u.length)y.set(u.subarray(0,Math.min(u.length,d-v)),v);else if(m==="repeatpad")for(let v=u.length;v<-p;v+=u.length)y.set(u,v);u=y}if(f==="fusion")throw new Error(`Truncation strategy "${f}" not implemented`);_=await this._extract_fbank_features(u,this.mel_filters_slaney,this.config.nb_max_samples)}return _.unsqueeze_(0)}async _extract_fbank_features(u,d,f=null){return(0,i.spectrogram)(u,this.window,this.config.fft_window_size,this.config.hop_length,{power:2,mel_filters:d,log_mel:"dB",max_num_frames:f,do_pad:!1,transpose:!0})}async _call(u,{max_length:d=null}={}){return(0,s.validate_audio_inputs)(u,"ClapFeatureExtractor"),{input_features:(await this._get_input_mel(u,d??this.config.nb_max_samples,this.config.truncation,this.config.padding)).unsqueeze_(0)}}}}),"./src/models/clip/image_processing_clip.js":((e,n,t)=>{t.r(n),t.d(n,{CLIPFeatureExtractor:()=>l,CLIPImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/convnext/image_processing_convnext.js":((e,n,t)=>{t.r(n),t.d(n,{ConvNextFeatureExtractor:()=>l,ConvNextImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{constructor(u){super(u),this.crop_pct=this.config.crop_pct??224/256}async resize(u){const d=this.size?.shortest_edge;if(d===void 0)throw new Error("Size dictionary must contain 'shortest_edge' key.");if(d<384){const f=Math.floor(d/this.crop_pct),[m,_]=this.get_resize_output_image_size(u,{shortest_edge:f});u=await u.resize(m,_,{resample:this.resample}),u=await u.center_crop(d,d)}else u=await u.resize(d,d,{resample:this.resample});return u}}class l extends i{}}),"./src/models/dac/feature_extraction_dac.js":((e,n,t)=>{t.r(n),t.d(n,{DacFeatureExtractor:()=>i});var s=t("./src/models/encodec/feature_extraction_encodec.js");class i extends s.EncodecFeatureExtractor{}}),"./src/models/deit/image_processing_deit.js":((e,n,t)=>{t.r(n),t.d(n,{DeiTFeatureExtractor:()=>l,DeiTImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/detr/image_processing_detr.js":((e,n,t)=>{t.r(n),t.d(n,{DetrFeatureExtractor:()=>c,DetrImageProcessor:()=>l});var s=t("./src/base/image_processors_utils.js"),i=t("./src/utils/tensor.js");class l extends s.ImageProcessor{async _call(d){const f=await super._call(d),m=[f.pixel_values.dims[0],64,64],_=(0,i.full)(m,1n);return{...f,pixel_mask:_}}post_process_object_detection(...d){return(0,s.post_process_object_detection)(...d)}post_process_panoptic_segmentation(...d){return(0,s.post_process_panoptic_segmentation)(...d)}post_process_instance_segmentation(...d){return(0,s.post_process_instance_segmentation)(...d)}}class c extends l{}}),"./src/models/dinov3_vit/image_processing_dinov3_vit.js":((e,n,t)=>{t.r(n),t.d(n,{DINOv3ViTImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/donut/image_processing_donut.js":((e,n,t)=>{t.r(n),t.d(n,{DonutFeatureExtractor:()=>l,DonutImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{pad_image(u,d,f,m={}){const[_,p,y]=d;let v=this.image_mean;Array.isArray(this.image_mean)||(v=new Array(y).fill(v));let T=this.image_std;Array.isArray(T)||(T=new Array(y).fill(v));const k=v.map((b,S)=>-b/T[S]);return super.pad_image(u,d,f,{center:!0,constant_values:k,...m})}}class l extends i{}}),"./src/models/dpt/image_processing_dpt.js":((e,n,t)=>{t.r(n),t.d(n,{DPTFeatureExtractor:()=>l,DPTImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/efficientnet/image_processing_efficientnet.js":((e,n,t)=>{t.r(n),t.d(n,{EfficientNetImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{constructor(c){super(c),this.include_top=this.config.include_top??!0,this.include_top&&(this.image_std=this.image_std.map(u=>u*u))}}}),"./src/models/encodec/feature_extraction_encodec.js":((e,n,t)=>{t.r(n),t.d(n,{EncodecFeatureExtractor:()=>l});var s=t("./src/base/feature_extraction_utils.js"),i=t("./src/utils/tensor.js");class l extends s.FeatureExtractor{async _call(u){(0,s.validate_audio_inputs)(u,"EncodecFeatureExtractor"),u instanceof Float64Array&&(u=new Float32Array(u));const d=this.config.feature_size;if(u.length%d!==0)throw new Error(`The length of the audio data must be a multiple of the number of channels (${d}).`);const f=[1,d,u.length/d];return{input_values:new i.Tensor("float32",u,f)}}}}),"./src/models/feature_extractors.js":((e,n,t)=>{t.r(n),t.d(n,{ASTFeatureExtractor:()=>s.ASTFeatureExtractor,ClapFeatureExtractor:()=>l.ClapFeatureExtractor,DacFeatureExtractor:()=>c.DacFeatureExtractor,EncodecFeatureExtractor:()=>i.EncodecFeatureExtractor,Gemma3nAudioFeatureExtractor:()=>u.Gemma3nAudioFeatureExtractor,ImageFeatureExtractor:()=>b.ImageProcessor,MoonshineFeatureExtractor:()=>d.MoonshineFeatureExtractor,ParakeetFeatureExtractor:()=>f.ParakeetFeatureExtractor,PyAnnoteFeatureExtractor:()=>m.PyAnnoteFeatureExtractor,SeamlessM4TFeatureExtractor:()=>_.SeamlessM4TFeatureExtractor,SnacFeatureExtractor:()=>p.SnacFeatureExtractor,SpeechT5FeatureExtractor:()=>y.SpeechT5FeatureExtractor,Wav2Vec2FeatureExtractor:()=>v.Wav2Vec2FeatureExtractor,WeSpeakerFeatureExtractor:()=>T.WeSpeakerFeatureExtractor,WhisperFeatureExtractor:()=>k.WhisperFeatureExtractor});var s=t("./src/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.js"),i=t("./src/models/encodec/feature_extraction_encodec.js"),l=t("./src/models/clap/feature_extraction_clap.js"),c=t("./src/models/dac/feature_extraction_dac.js"),u=t("./src/models/gemma3n/feature_extraction_gemma3n.js"),d=t("./src/models/moonshine/feature_extraction_moonshine.js"),f=t("./src/models/parakeet/feature_extraction_parakeet.js"),m=t("./src/models/pyannote/feature_extraction_pyannote.js"),_=t("./src/models/seamless_m4t/feature_extraction_seamless_m4t.js"),p=t("./src/models/snac/feature_extraction_snac.js"),y=t("./src/models/speecht5/feature_extraction_speecht5.js"),v=t("./src/models/wav2vec2/feature_extraction_wav2vec2.js"),T=t("./src/models/wespeaker/feature_extraction_wespeaker.js"),k=t("./src/models/whisper/feature_extraction_whisper.js"),b=t("./src/base/image_processors_utils.js")}),"./src/models/florence2/processing_florence2.js":((e,n,t)=>{t.r(n),t.d(n,{Florence2Processor:()=>c});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");class c extends s.Processor{static tokenizer_class=l.AutoTokenizer;static image_processor_class=i.AutoImageProcessor;constructor(d,f,m){super(d,f,m);const{tasks_answer_post_processing_type:_,task_prompts_without_inputs:p,task_prompts_with_input:y}=this.image_processor.config;this.tasks_answer_post_processing_type=new Map(Object.entries(_??{})),this.task_prompts_without_inputs=new Map(Object.entries(p??{})),this.task_prompts_with_input=new Map(Object.entries(y??{})),this.regexes={quad_boxes:/(.+?)<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm,bboxes:/([^<]+)?<loc_(\d+)><loc_(\d+)><loc_(\d+)><loc_(\d+)>/gm},this.size_per_bin=1e3}construct_prompts(d){typeof d=="string"&&(d=[d]);const f=[];for(const m of d)if(this.task_prompts_without_inputs.has(m))f.push(this.task_prompts_without_inputs.get(m));else{for(const[_,p]of this.task_prompts_with_input)if(m.includes(_)){f.push(p.replaceAll("{input}",m).replaceAll(_,""));break}f.length!==d.length&&f.push(m)}return f}post_process_generation(d,f,m){const _=this.tasks_answer_post_processing_type.get(f)??"pure_text";d=d.replaceAll("<s>","").replaceAll("</s>","");let p;switch(_){case"pure_text":p=d;break;case"description_with_bboxes":case"bboxes":case"phrase_grounding":case"ocr":const y=_==="ocr"?"quad_boxes":"bboxes",v=d.matchAll(this.regexes[y]),T=[],k=[];for(const[b,S,...$]of v)T.push(S?S.trim():T.at(-1)??""),k.push($.map((w,C)=>(Number(w)+.5)/this.size_per_bin*m[C%2]));p={labels:T,[y]:k};break;default:throw new Error(`Task "${f}" (of type "${_}") not yet implemented.`)}return{[f]:p}}async _call(d,f=null,m={}){if(!d&&!f)throw new Error("Either text or images must be provided");const _=await this.image_processor(d,m),p=f?this.tokenizer(this.construct_prompts(f),m):{};return{..._,...p}}}}),"./src/models/gemma3n/feature_extraction_gemma3n.js":((e,n,t)=>{t.r(n),t.d(n,{Gemma3nAudioFeatureExtractor:()=>c});var s=t("./src/base/feature_extraction_utils.js"),i=t("./src/utils/tensor.js"),l=t("./src/utils/audio.js");class c extends s.FeatureExtractor{constructor(d){super(d);const{fft_length:f,feature_size:m,min_frequency:_,max_frequency:p,sampling_rate:y,frame_length:v}=this.config,T=(0,l.mel_filter_bank)(Math.floor(1+f/2),m,_,p,y,null,"htk",!1);this.mel_filters=T,this.window=(0,l.window_function)(v,"hann")}async _extract_fbank_features(d,f){return(0,l.spectrogram)(d,this.window,this.config.frame_length,this.config.hop_length,{fft_length:this.config.fft_length,center:!1,onesided:!0,preemphasis:this.config.preemphasis,preemphasis_htk_flavor:this.config.preemphasis_htk_flavor,mel_filters:this.mel_filters,log_mel:"log",mel_floor:this.config.mel_floor,remove_dc_offset:!1,transpose:!0})}async _call(d,{max_length:f=48e4,truncation:m=!0,padding:_=!0,pad_to_multiple_of:p=128}={}){if((0,s.validate_audio_inputs)(d,"Gemma3nAudioFeatureExtractor"),m&&d.length>f&&(d=d.slice(0,f)),_&&d.length%p!==0){const T=p-d.length%p,k=new Float64Array(d.length+T);k.set(d),this.config.padding_value!==0&&k.fill(this.config.padding_value,d.length),d=k}const y=await this._extract_fbank_features(d,this.config.max_length),v=(0,i.full)([1,y.dims[0]],!0);return{input_features:y.unsqueeze_(0),input_features_mask:v}}}}),"./src/models/gemma3n/processing_gemma3n.js":((e,n,t)=>{t.r(n),t.d(n,{Gemma3nProcessor:()=>u});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/models/auto/feature_extraction_auto.js"),c=t("./src/tokenizers.js");t("./src/utils/image.js"),t("./src/utils/audio.js");class u extends s.Processor{static image_processor_class=i.AutoImageProcessor;static feature_extractor_class=l.AutoFeatureExtractor;static tokenizer_class=c.AutoTokenizer;static uses_processor_config=!0;static uses_chat_template_file=!0;constructor(f,m,_){super(f,m,_),this.audio_seq_length=this.config.audio_seq_length,this.image_seq_length=this.config.image_seq_length;const{audio_token_id:p,boa_token:y,audio_token:v,eoa_token:T,image_token_id:k,boi_token:b,image_token:S,eoi_token:$}=this.tokenizer.config;this.audio_token_id=p,this.boa_token=y,this.audio_token=v;const w=v.repeat(this.audio_seq_length);this.full_audio_sequence=`

${y}${w}${T}

`,this.image_token_id=k,this.boi_token=b,this.image_token=S;const C=S.repeat(this.image_seq_length);this.full_image_sequence=`

${b}${C}${$}

`}async _call(f,m=null,_=null,p={}){typeof f=="string"&&(f=[f]);let y;_&&(y=await this.feature_extractor(_,p),f=f.map(k=>k.replaceAll(this.audio_token,this.full_audio_sequence)));let v;return m&&(v=await this.image_processor(m,p),f=f.map(k=>k.replaceAll(this.image_token,this.full_image_sequence))),{...this.tokenizer(f,p),...v,...y}}}}),"./src/models/glpn/image_processing_glpn.js":((e,n,t)=>{t.r(n),t.d(n,{GLPNFeatureExtractor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/grounding_dino/image_processing_grounding_dino.js":((e,n,t)=>{t.r(n),t.d(n,{GroundingDinoImageProcessor:()=>l});var s=t("./src/base/image_processors_utils.js"),i=t("./src/utils/tensor.js");class l extends s.ImageProcessor{async _call(u){const d=await super._call(u),f=d.pixel_values.dims,m=(0,i.ones)([f[0],f[2],f[3]]);return{...d,pixel_mask:m}}}}),"./src/models/grounding_dino/processing_grounding_dino.js":((e,n,t)=>{t.r(n),t.d(n,{GroundingDinoProcessor:()=>d});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js"),c=t("./src/base/image_processors_utils.js");function u(f,m){const p=f.dims.at(-1)-1,y=f.tolist();y.fill(!1,0,1),y.fill(!1,p);const v=m.tolist();return y.map((T,k)=>T?k:null).filter(T=>T!==null).map(T=>v[T])}class d extends s.Processor{static tokenizer_class=l.AutoTokenizer;static image_processor_class=i.AutoImageProcessor;async _call(m,_,p={}){const y=m?await this.image_processor(m,p):{};return{..._?this.tokenizer(_,p):{},...y}}post_process_grounded_object_detection(m,_,{box_threshold:p=.25,text_threshold:y=.25,target_sizes:v=null}={}){const{logits:T,pred_boxes:k}=m,b=T.dims[0];if(v!==null&&v.length!==b)throw Error("Make sure that you pass in as many target sizes as the batch dimension of the logits");const S=T.dims.at(1),$=T.sigmoid(),w=$.max(-1).tolist(),C=k.tolist().map(A=>A.map(I=>(0,c.center_to_corners_format)(I))),P=[];for(let A=0;A<b;++A){const I=v!==null?v[A]:null;I!==null&&(C[A]=C[A].map(X=>X.map((Q,te)=>Q*I[(te+1)%2])));const W=w[A],G=[],q=[],Z=[];for(let X=0;X<S;++X){const Q=W[X];if(Q<=p)continue;const te=C[A][X],R=$[A][X];G.push(Q),Z.push(te);const ee=u(R.gt(y),_[A]);q.push(ee)}P.push({scores:G,boxes:Z,labels:this.batch_decode(q)})}return P}}}),"./src/models/idefics3/image_processing_idefics3.js":((e,n,t)=>{t.r(n),t.d(n,{Idefics3ImageProcessor:()=>l});var s=t("./src/base/image_processors_utils.js"),i=t("./src/utils/tensor.js");class l extends s.ImageProcessor{constructor(u){super(u),this.do_image_splitting=u.do_image_splitting??!0,this.max_image_size=u.max_image_size}get_resize_for_vision_encoder(u,d){let[f,m]=u.dims.slice(-2);const _=m/f;return m>=f?(m=Math.ceil(m/d)*d,f=Math.floor(m/_),f=Math.ceil(f/d)*d):(f=Math.ceil(f/d)*d,m=Math.floor(f*_),m=Math.ceil(m/d)*d),{height:f,width:m}}async _call(u,{do_image_splitting:d=null,return_row_col_info:f=!1}={}){let m;if(!Array.isArray(u))m=[[u]];else{if(u.length===0||!u[0])throw new Error("No images provided.");Array.isArray(u[0])?m=u:m=[u]}let _=[],p=[],y=[];const v=[],T=[];for(const A of m){let I=await Promise.all(A.map(q=>this.preprocess(q)));v.push(...I.map(q=>q.original_size)),T.push(...I.map(q=>q.reshaped_input_size)),I.forEach(q=>q.pixel_values.unsqueeze_(0));const{longest_edge:W}=this.max_image_size;let G;if(d??this.do_image_splitting){let q=new Array(I.length),Z=new Array(I.length);G=await Promise.all(I.map(async(X,Q)=>{const te=this.get_resize_for_vision_encoder(X.pixel_values,W),R=await(0,i.interpolate_4d)(X.pixel_values,{size:[te.height,te.width]}),{frames:ee,num_splits_h:ie,num_splits_w:he}=await this.split_image(R,this.max_image_size);return q[Q]=ie,Z[Q]=he,(0,i.cat)(ee,0)})),p.push(q),y.push(Z)}else{const q=[W,W];G=await Promise.all(I.map(Z=>(0,i.interpolate_4d)(Z.pixel_values,{size:q}))),p.push(new Array(I.length).fill(0)),y.push(new Array(I.length).fill(0))}_.push((0,i.cat)(G,0))}const k=_.length,[b,S,$,w]=_[0].dims;let C,P;if(k===1)C=_[0].unsqueeze_(0),P=(0,i.full)([k,b,$,w],!0);else{const A=Math.max(..._.map(G=>G.dims.at(0)));P=(0,i.full)([k,A,$,w],!0);const I=P.data,W=A*$*w;for(let G=0;G<k;++G){const q=_[G].dims[0];if(q<A){_[G]=(0,i.cat)([_[G],(0,i.full)([A-q,S,$,w],0)],0);const Z=G*W+q*$*w,X=(G+1)*W;I.fill(!1,Z,X)}}C=(0,i.stack)(_,0)}return{pixel_values:C,pixel_attention_mask:P,original_sizes:v,reshaped_input_sizes:T,...f?{rows:p,cols:y}:{}}}async split_image(u,{longest_edge:d}){const f=d,m=d,_=[],[p,y]=u.dims.slice(-2);let v=0,T=0;if(p>f||y>m){v=Math.ceil(p/f),T=Math.ceil(y/m);const k=Math.ceil(p/v),b=Math.ceil(y/T);for(let w=0;w<v;++w)for(let C=0;C<T;++C){let P,A,I,W;w===v-1?(A=p-k,W=p):(A=w*k,W=(w+1)*k),C===T-1?(P=y-b,I=y):(P=C*b,I=(C+1)*b);const G=[A,P],q=[W,I],Z=await(0,i.slice)(u,G,q,[2,3]);_.push(Z)}const S=f,$=m;(p!==S||y!==$)&&(u=await(0,i.interpolate_4d)(u,{size:[S,$]}))}return _.push(u),{frames:_,num_splits_h:v,num_splits_w:T}}}}),"./src/models/idefics3/processing_idefics3.js":((e,n,t)=>{t.r(n),t.d(n,{Idefics3Processor:()=>m});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");t("./src/utils/image.js");var c=t("./src/utils/core.js");function u(_,p,y,v,T,k){let b="";for(let S=0;S<p;++S){for(let $=0;$<y;++$)b+=v+`<row_${S+1}_col_${$+1}>`+T.repeat(_);b+=`
`}return b+=`
${v}${k}`+T.repeat(_)+`${v}`,b}function d(_,p,y,v){return`${p}${v}`+y.repeat(_)+`${p}`}function f(_,p,y,v,T,k){return _===0&&p===0?d(y,v,T,k):u(y,_,p,v,T,k)}class m extends s.Processor{static image_processor_class=i.AutoImageProcessor;static tokenizer_class=l.AutoTokenizer;static uses_processor_config=!0;fake_image_token="<fake_token_around_image>";image_token="<image>";global_img_token="<global-img>";async _call(p,y=null,v={}){v.return_row_col_info??=!0;let T;y&&(T=await this.image_processor(y,v)),Array.isArray(p)||(p=[p]);const k=T.rows??[new Array(p.length).fill(0)],b=T.cols??[new Array(p.length).fill(0)],S=this.config.image_seq_len,$=[],w=[];for(let P=0;P<p.length;++P){const A=p[P],I=k[P],W=b[P];$.push((0,c.count)(A,this.image_token));const G=I.map((X,Q)=>f(X,W[Q],S,this.fake_image_token,this.image_token,this.global_img_token)),q=A.split(this.image_token);if(q.length===0)throw new Error("The image token should be present in the text.");let Z=q[0];for(let X=0;X<G.length;++X)Z+=G[X]+q[X+1];w.push(Z)}return{...this.tokenizer(w),...T}}}}),"./src/models/image_processors.js":((e,n,t)=>{t.r(n),t.d(n,{BeitFeatureExtractor:()=>s.BeitFeatureExtractor,BitImageProcessor:()=>i.BitImageProcessor,CLIPFeatureExtractor:()=>c.CLIPFeatureExtractor,CLIPImageProcessor:()=>c.CLIPImageProcessor,ChineseCLIPFeatureExtractor:()=>l.ChineseCLIPFeatureExtractor,ConvNextFeatureExtractor:()=>u.ConvNextFeatureExtractor,ConvNextImageProcessor:()=>u.ConvNextImageProcessor,DINOv3ViTImageProcessor:()=>m.DINOv3ViTImageProcessor,DPTFeatureExtractor:()=>p.DPTFeatureExtractor,DPTImageProcessor:()=>p.DPTImageProcessor,DeiTFeatureExtractor:()=>d.DeiTFeatureExtractor,DeiTImageProcessor:()=>d.DeiTImageProcessor,DetrFeatureExtractor:()=>f.DetrFeatureExtractor,DetrImageProcessor:()=>f.DetrImageProcessor,DonutFeatureExtractor:()=>_.DonutFeatureExtractor,DonutImageProcessor:()=>_.DonutImageProcessor,EfficientNetImageProcessor:()=>y.EfficientNetImageProcessor,GLPNFeatureExtractor:()=>v.GLPNFeatureExtractor,GroundingDinoImageProcessor:()=>T.GroundingDinoImageProcessor,Idefics3ImageProcessor:()=>k.Idefics3ImageProcessor,JinaCLIPImageProcessor:()=>S.JinaCLIPImageProcessor,LlavaOnevisionImageProcessor:()=>$.LlavaOnevisionImageProcessor,Mask2FormerImageProcessor:()=>w.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>C.MaskFormerFeatureExtractor,MaskFormerImageProcessor:()=>C.MaskFormerImageProcessor,MobileNetV1FeatureExtractor:()=>P.MobileNetV1FeatureExtractor,MobileNetV1ImageProcessor:()=>P.MobileNetV1ImageProcessor,MobileNetV2FeatureExtractor:()=>A.MobileNetV2FeatureExtractor,MobileNetV2ImageProcessor:()=>A.MobileNetV2ImageProcessor,MobileNetV3FeatureExtractor:()=>I.MobileNetV3FeatureExtractor,MobileNetV3ImageProcessor:()=>I.MobileNetV3ImageProcessor,MobileNetV4FeatureExtractor:()=>W.MobileNetV4FeatureExtractor,MobileNetV4ImageProcessor:()=>W.MobileNetV4ImageProcessor,MobileViTFeatureExtractor:()=>G.MobileViTFeatureExtractor,MobileViTImageProcessor:()=>G.MobileViTImageProcessor,NougatImageProcessor:()=>q.NougatImageProcessor,OwlViTFeatureExtractor:()=>X.OwlViTFeatureExtractor,OwlViTImageProcessor:()=>X.OwlViTImageProcessor,Owlv2ImageProcessor:()=>Z.Owlv2ImageProcessor,Phi3VImageProcessor:()=>Q.Phi3VImageProcessor,PixtralImageProcessor:()=>te.PixtralImageProcessor,PvtImageProcessor:()=>R.PvtImageProcessor,Qwen2VLImageProcessor:()=>ee.Qwen2VLImageProcessor,RTDetrImageProcessor:()=>ie.RTDetrImageProcessor,Sam2ImageProcessor:()=>_e.Sam2ImageProcessor,Sam3ImageProcessor:()=>U.Sam3ImageProcessor,SamImageProcessor:()=>he.SamImageProcessor,SegformerFeatureExtractor:()=>K.SegformerFeatureExtractor,SegformerImageProcessor:()=>K.SegformerImageProcessor,SiglipImageProcessor:()=>H.SiglipImageProcessor,SmolVLMImageProcessor:()=>B.SmolVLMImageProcessor,Swin2SRImageProcessor:()=>ce.Swin2SRImageProcessor,VLMImageProcessor:()=>b.VLMImageProcessor,ViTFeatureExtractor:()=>ve.ViTFeatureExtractor,ViTImageProcessor:()=>ve.ViTImageProcessor,VitMatteImageProcessor:()=>Pe.VitMatteImageProcessor,VitPoseImageProcessor:()=>ze.VitPoseImageProcessor,YolosFeatureExtractor:()=>Ze.YolosFeatureExtractor,YolosImageProcessor:()=>Ze.YolosImageProcessor});var s=t("./src/models/beit/image_processing_beit.js"),i=t("./src/models/bit/image_processing_bit.js"),l=t("./src/models/chinese_clip/image_processing_chinese_clip.js"),c=t("./src/models/clip/image_processing_clip.js"),u=t("./src/models/convnext/image_processing_convnext.js"),d=t("./src/models/deit/image_processing_deit.js"),f=t("./src/models/detr/image_processing_detr.js"),m=t("./src/models/dinov3_vit/image_processing_dinov3_vit.js"),_=t("./src/models/donut/image_processing_donut.js"),p=t("./src/models/dpt/image_processing_dpt.js"),y=t("./src/models/efficientnet/image_processing_efficientnet.js"),v=t("./src/models/glpn/image_processing_glpn.js"),T=t("./src/models/grounding_dino/image_processing_grounding_dino.js"),k=t("./src/models/idefics3/image_processing_idefics3.js"),b=t("./src/models/janus/image_processing_janus.js"),S=t("./src/models/jina_clip/image_processing_jina_clip.js"),$=t("./src/models/llava_onevision/image_processing_llava_onevision.js"),w=t("./src/models/mask2former/image_processing_mask2former.js"),C=t("./src/models/maskformer/image_processing_maskformer.js"),P=t("./src/models/mobilenet_v1/image_processing_mobilenet_v1.js"),A=t("./src/models/mobilenet_v2/image_processing_mobilenet_v2.js"),I=t("./src/models/mobilenet_v3/image_processing_mobilenet_v3.js"),W=t("./src/models/mobilenet_v4/image_processing_mobilenet_v4.js"),G=t("./src/models/mobilevit/image_processing_mobilevit.js"),q=t("./src/models/nougat/image_processing_nougat.js"),Z=t("./src/models/owlv2/image_processing_owlv2.js"),X=t("./src/models/owlvit/image_processing_owlvit.js"),Q=t("./src/models/phi3_v/image_processing_phi3_v.js"),te=t("./src/models/pixtral/image_processing_pixtral.js"),R=t("./src/models/pvt/image_processing_pvt.js"),ee=t("./src/models/qwen2_vl/image_processing_qwen2_vl.js"),ie=t("./src/models/rt_detr/image_processing_rt_detr.js"),he=t("./src/models/sam/image_processing_sam.js"),_e=t("./src/models/sam2/image_processing_sam2.js"),U=t("./src/models/sam3/image_processing_sam3.js"),K=t("./src/models/segformer/image_processing_segformer.js"),H=t("./src/models/siglip/image_processing_siglip.js"),B=t("./src/models/smolvlm/image_processing_smolvlm.js"),ce=t("./src/models/swin2sr/image_processing_swin2sr.js"),ve=t("./src/models/vit/image_processing_vit.js"),Pe=t("./src/models/vitmatte/image_processing_vitmatte.js"),ze=t("./src/models/vitpose/image_processing_vitpose.js"),Ze=t("./src/models/yolos/image_processing_yolos.js")}),"./src/models/janus/image_processing_janus.js":((e,n,t)=>{t.r(n),t.d(n,{VLMImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{constructor(c){super({do_pad:!0,pad_size:{width:c.image_size,height:c.image_size},...c}),this.constant_values=this.config.background_color.map(u=>u*this.rescale_factor)}pad_image(c,u,d,f){return super.pad_image(c,u,d,{constant_values:this.constant_values,center:!0,...f})}}}),"./src/models/janus/processing_janus.js":((e,n,t)=>{t.r(n),t.d(n,{VLChatProcessor:()=>f});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js"),c=t("./src/utils/core.js"),u=t("./src/utils/tensor.js"),d=t("./src/utils/image.js");class f extends s.Processor{static image_processor_class=i.AutoImageProcessor;static tokenizer_class=l.AutoTokenizer;static uses_processor_config=!0;constructor(_,p,y){super(_,p,y),this.image_tag=this.config.image_tag,this.image_start_tag=this.config.image_start_tag,this.image_end_tag=this.config.image_end_tag,this.num_image_tokens=this.config.num_image_tokens}async _call(_,{images:p=null,chat_template:y="default"}={}){p?Array.isArray(p)||(p=[p]):p=await Promise.all(_.filter(G=>G.images).flatMap(G=>G.images).map(G=>d.RawImage.read(G)));const v=this.tokenizer,T=v.apply_chat_template(_,{tokenize:!1,add_generation_prompt:!0,chat_template:y}),k=G=>v.encode(G,{add_special_tokens:!1}),b=T.split(this.image_tag),S=b.length-1;if(p.length!==S)throw new Error(`Number of images provided (${p.length}) does not match number of "${this.image_tag}" image tags (${S})`);const[$,w,C]=v.model.convert_tokens_to_ids([this.image_tag,this.image_start_tag,this.image_end_tag]);let P=k(b[0]),A=new Array(P.length).fill(!1);for(let G=1;G<b.length;++G){const q=new Array(this.num_image_tokens).fill($),Z=k(b[G]);P=(0,c.mergeArrays)(P,[w],q,[C],Z);const X=new Array(this.num_image_tokens).fill(!0);A=(0,c.mergeArrays)(A,[!1],X,[!1],new Array(Z.length).fill(!1))}const I=[1,P.length],W={input_ids:new u.Tensor("int64",P,I),attention_mask:new u.Tensor("int64",new Array(P.length).fill(1),I),images_seq_mask:new u.Tensor("bool",A,I),images_emb_mask:new u.Tensor("bool",new Array(S*this.num_image_tokens).fill(!0),[1,S,this.num_image_tokens])};if(p&&p.length>0){const G=await this.image_processor(p);return G.pixel_values.unsqueeze_(0),{...W,...G}}return W}}}),"./src/models/jina_clip/image_processing_jina_clip.js":((e,n,t)=>{t.r(n),t.d(n,{JinaCLIPImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{constructor(c){const{resize_mode:u,fill_color:d,interpolation:f,size:m,..._}=c,p=u==="squash"?{width:m,height:m}:u==="shortest"?{shortest_edge:m}:{longest_edge:m},y=f==="bicubic"?3:2;super({..._,size:p,resample:y,do_center_crop:!0,crop_size:m,do_normalize:!0})}}}),"./src/models/jina_clip/processing_jina_clip.js":((e,n,t)=>{t.r(n),t.d(n,{JinaCLIPProcessor:()=>c});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");class c extends s.Processor{static tokenizer_class=l.AutoTokenizer;static image_processor_class=i.AutoImageProcessor;async _call(d=null,f=null,m={}){if(!d&&!f)throw new Error("Either text or images must be provided");const _=d?this.tokenizer(d,m):{},p=f?await this.image_processor(f,m):{};return{..._,...p}}}}),"./src/models/llava/processing_llava.js":((e,n,t)=>{t.r(n),t.d(n,{LlavaProcessor:()=>c});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");class c extends s.Processor{static tokenizer_class=l.AutoTokenizer;static image_processor_class=i.AutoImageProcessor;static uses_processor_config=!0;async _call(d,f=null,m={}){const _=await this.image_processor(d,m);if(f){const[y,v]=_.pixel_values.dims.slice(-2),{image_token:T,patch_size:k,num_additional_image_tokens:b}=this.config,S=Math.floor(y/k)*Math.floor(v/k)+b;f=structuredClone(f),Array.isArray(f)||(f=[f]);for(let $=0;$<f.length;++$)f[$]=f[$].replace(T,T.repeat(S))}const p=f?this.tokenizer(f,m):{};return{..._,...p}}}}),"./src/models/llava_onevision/image_processing_llava_onevision.js":((e,n,t)=>{t.r(n),t.d(n,{LlavaOnevisionImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/mask2former/image_processing_mask2former.js":((e,n,t)=>{t.r(n),t.d(n,{Mask2FormerImageProcessor:()=>i});var s=t("./src/models/maskformer/image_processing_maskformer.js");class i extends s.MaskFormerImageProcessor{}}),"./src/models/maskformer/image_processing_maskformer.js":((e,n,t)=>{t.r(n),t.d(n,{MaskFormerFeatureExtractor:()=>l,MaskFormerImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_panoptic_segmentation(...u){return(0,s.post_process_panoptic_segmentation)(...u)}post_process_instance_segmentation(...u){return(0,s.post_process_instance_segmentation)(...u)}}class l extends i{}}),"./src/models/mgp_str/processing_mgp_str.js":((e,n,t)=>{t.r(n),t.d(n,{MgpstrProcessor:()=>d});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js"),c=t("./src/utils/maths.js");const u={char:["char_decode",1],bpe:["bpe_decode",2],wp:["wp_decode",102]};class d extends s.Processor{static tokenizer_class=l.AutoTokenizer;static image_processor_class=i.AutoImageProcessor;get char_tokenizer(){return this.components.char_tokenizer}get bpe_tokenizer(){return this.components.bpe_tokenizer}get wp_tokenizer(){return this.components.wp_tokenizer}_decode_helper(m,_){if(!u.hasOwnProperty(_))throw new Error(`Format ${_} is not supported.`);const[p,y]=u[_],v=this[p].bind(this),[T,k]=m.dims,b=[],S=[],$=m.tolist();for(let C=0;C<T;++C){const P=$[C],A=[],I=[];for(let G=1;G<k;++G){const[q,Z]=(0,c.max)((0,c.softmax)(P[G]));if(I.push(q),Z==y)break;A.push(Z)}const W=I.length>0?I.reduce((G,q)=>G*q,1):0;S.push(A),b.push(W)}return[v(S),b]}char_decode(m){return this.char_tokenizer.batch_decode(m).map(_=>_.replaceAll(" ",""))}bpe_decode(m){return this.bpe_tokenizer.batch_decode(m)}wp_decode(m){return this.wp_tokenizer.batch_decode(m).map(_=>_.replaceAll(" ",""))}batch_decode([m,_,p]){const[y,v]=this._decode_helper(m,"char"),[T,k]=this._decode_helper(_,"bpe"),[b,S]=this._decode_helper(p,"wp"),$=[],w=[];for(let C=0;C<y.length;++C){const[P,A]=(0,c.max)([v[C],k[C],S[C]]);$.push([y[C],T[C],b[C]][A]),w.push(P)}return{generated_text:$,scores:w,char_preds:y,bpe_preds:T,wp_preds:b}}static async from_pretrained(...m){const _=await super.from_pretrained(...m),p=await l.AutoTokenizer.from_pretrained("Xenova/gpt2"),y=await l.AutoTokenizer.from_pretrained("Xenova/bert-base-uncased");return _.components={image_processor:_.image_processor,char_tokenizer:_.tokenizer,bpe_tokenizer:p,wp_tokenizer:y},_}async _call(m,_=null){const p=await this.image_processor(m);return _&&(p.labels=this.tokenizer(_).input_ids),p}}}),"./src/models/mobilenet_v1/image_processing_mobilenet_v1.js":((e,n,t)=>{t.r(n),t.d(n,{MobileNetV1FeatureExtractor:()=>l,MobileNetV1ImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/mobilenet_v2/image_processing_mobilenet_v2.js":((e,n,t)=>{t.r(n),t.d(n,{MobileNetV2FeatureExtractor:()=>l,MobileNetV2ImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/mobilenet_v3/image_processing_mobilenet_v3.js":((e,n,t)=>{t.r(n),t.d(n,{MobileNetV3FeatureExtractor:()=>l,MobileNetV3ImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/mobilenet_v4/image_processing_mobilenet_v4.js":((e,n,t)=>{t.r(n),t.d(n,{MobileNetV4FeatureExtractor:()=>l,MobileNetV4ImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/mobilevit/image_processing_mobilevit.js":((e,n,t)=>{t.r(n),t.d(n,{MobileViTFeatureExtractor:()=>l,MobileViTImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/moonshine/feature_extraction_moonshine.js":((e,n,t)=>{t.r(n),t.d(n,{MoonshineFeatureExtractor:()=>l});var s=t("./src/base/feature_extraction_utils.js"),i=t("./src/utils/tensor.js");class l extends s.FeatureExtractor{async _call(u){(0,s.validate_audio_inputs)(u,"MoonshineFeatureExtractor"),u instanceof Float64Array&&(u=new Float32Array(u));const d=[1,u.length];return{input_values:new i.Tensor("float32",u,d)}}}}),"./src/models/moonshine/processing_moonshine.js":((e,n,t)=>{t.r(n),t.d(n,{MoonshineProcessor:()=>c});var s=t("./src/models/auto/feature_extraction_auto.js"),i=t("./src/tokenizers.js"),l=t("./src/base/processing_utils.js");class c extends l.Processor{static tokenizer_class=i.AutoTokenizer;static feature_extractor_class=s.AutoFeatureExtractor;async _call(d){return await this.feature_extractor(d)}}}),"./src/models/nougat/image_processing_nougat.js":((e,n,t)=>{t.r(n),t.d(n,{NougatImageProcessor:()=>i});var s=t("./src/models/donut/image_processing_donut.js");class i extends s.DonutImageProcessor{}}),"./src/models/owlv2/image_processing_owlv2.js":((e,n,t)=>{t.r(n),t.d(n,{Owlv2ImageProcessor:()=>i});var s=t("./src/models/owlvit/image_processing_owlvit.js");class i extends s.OwlViTImageProcessor{}}),"./src/models/owlvit/image_processing_owlvit.js":((e,n,t)=>{t.r(n),t.d(n,{OwlViTFeatureExtractor:()=>l,OwlViTImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_object_detection(...u){return(0,s.post_process_object_detection)(...u)}}class l extends i{}}),"./src/models/owlvit/processing_owlvit.js":((e,n,t)=>{t.r(n),t.d(n,{OwlViTProcessor:()=>c});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");class c extends s.Processor{static tokenizer_class=l.AutoTokenizer;static image_processor_class=i.AutoImageProcessor}}),"./src/models/paligemma/processing_paligemma.js":((e,n,t)=>{t.r(n),t.d(n,{PaliGemmaProcessor:()=>d});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");const c="<image>";function u(f,m,_,p,y){return`${p.repeat(_*y)}${m}${f}
`}class d extends s.Processor{static tokenizer_class=l.AutoTokenizer;static image_processor_class=i.AutoImageProcessor;static uses_processor_config=!1;async _call(m,_=null,p={}){_||(console.warn("You are using PaliGemma without a text prefix. It will perform as a picture-captioning model."),_=""),Array.isArray(m)||(m=[m]),Array.isArray(_)||(_=[_]);const y=this.tokenizer.bos_token,v=this.image_processor.config.image_seq_length;let T;_.some(S=>S.includes(c))?T=_.map(S=>{const $=S.replaceAll(c,c.repeat(v)),w=$.lastIndexOf(c),C=w===-1?0:w+c.length;return $.slice(0,C)+y+$.slice(C)+`
`}):(console.warn("You are passing both `text` and `images` to `PaliGemmaProcessor`. The processor expects special image tokens in the text, as many tokens as there are images per each text. It is recommended to add `<image>` tokens in the very beginning of your text. For this call, we will infer how many images each text has and add special tokens."),T=_.map(S=>u(S,y,v,c,m.length)));const k=this.tokenizer(T,p);return{...await this.image_processor(m,p),...k}}}}),"./src/models/parakeet/feature_extraction_parakeet.js":((e,n,t)=>{t.r(n),t.d(n,{ParakeetFeatureExtractor:()=>u});var s=t("./src/base/feature_extraction_utils.js"),i=t("./src/utils/tensor.js"),l=t("./src/utils/audio.js");const c=1e-5;class u extends s.FeatureExtractor{constructor(f){super(f),this.config.mel_filters??=(0,l.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,this.config.sampling_rate/2,this.config.sampling_rate,"slaney","slaney");const m=(0,l.window_function)(this.config.win_length,"hann",{periodic:!1});this.window=new Float64Array(this.config.n_fft);const _=Math.floor((this.config.n_fft-this.config.win_length)/2);this.window.set(m,_)}async _extract_fbank_features(f){const m=this.config.preemphasis;f=new Float64Array(f);for(let p=f.length-1;p>=1;--p)f[p]-=m*f[p-1];return await(0,l.spectrogram)(f,this.window,this.window.length,this.config.hop_length,{fft_length:this.config.n_fft,power:2,mel_filters:this.config.mel_filters,log_mel:"log",mel_floor:-1/0,pad_mode:"constant",center:!0,transpose:!0,mel_offset:2**-24})}async _call(f){(0,s.validate_audio_inputs)(f,"ParakeetFeatureExtractor");const m=await this._extract_fbank_features(f),_=Math.floor((f.length+Math.floor(this.config.n_fft/2)*2-this.config.n_fft)/this.config.hop_length),p=m.data;p.fill(0,_*m.dims[1]);const[y,v]=m.dims,T=new Float64Array(v),k=new Float64Array(v);for(let $=0;$<_;++$){const w=$*v;for(let C=0;C<v;++C){const P=p[w+C];T[C]+=P,k[C]+=P*P}}const b=_>1?_-1:1;for(let $=0;$<v;++$){const w=T[$]/_,C=(k[$]-_*w*w)/b,A=1/(Math.sqrt(C)+c);for(let I=0;I<_;++I){const W=I*v+$;p[W]=(p[W]-w)*A}}const S=new BigInt64Array(y);return S.fill(1n,0,_),{input_features:m.unsqueeze_(0),attention_mask:new i.Tensor("int64",S,[1,y])}}}}),"./src/models/phi3_v/image_processing_phi3_v.js":((e,n,t)=>{t.r(n),t.d(n,{Phi3VImageProcessor:()=>m});var s=t("./src/base/image_processors_utils.js"),i=t("./src/utils/tensor.js");const l=336,c=[2,3],{ceil:u,floor:d,sqrt:f}=Math;class m extends s.ImageProcessor{constructor(p){super({...p,do_normalize:!0,do_pad:!0,pad_size:"custom",do_convert_rgb:!0,do_resize:!0}),this._num_crops=p.num_crops}calc_num_image_tokens_from_image_size(p,y){const{num_img_tokens:v}=this.config;return d((d(y/l)*d(p/l)+1)*v+1+(d(y/l)+1)*f(v))}get_resize_output_image_size(p,y){const v=this._num_crops,[T,k]=p.size;let b=T/k,S=1;for(;S*Math.ceil(S/b)<=v;)S+=1;S-=1;const $=Math.floor(S*336),w=Math.floor($/b);return[$,w]}pad_image(p,y,v,T={}){const[k,b]=y,S=l*u(k/l),$=l*u(b/l),w=[1,1,1].map((C,P)=>(C-this.image_mean[P])/this.image_std[P]);return super.pad_image(p,y,{width:$,height:S},{center:!0,constant_values:w,...T})}async _call(p,{num_crops:y=null}={}){if(this._num_crops=y??=this.config.num_crops,y<4||f(y)%1!==0)throw new Error("num_crops must be a square number >= 4");Array.isArray(p)||(p=[p]);const v=p.length,T=await Promise.all(p.map(A=>this.preprocess(A))),k=T.map(A=>A.original_size),b=T.map(A=>A.reshaped_input_size),S=[];for(const{pixel_values:A}of T){A.unsqueeze_(0);const[I,W]=A.dims.slice(-2),G=await(0,i.interpolate_4d)(A,{size:[l,l],mode:"bicubic"});if(y>0){const q=[],Z=f(y),X=d(W/Z),Q=d(I/Z);for(let R=0;R<Z;++R)for(let ee=0;ee<Z;++ee){let ie,he,_e,U;R===Z-1?(he=I-Q,U=I):(he=R*Q,U=(R+1)*Q),ee===Z-1?(ie=W-X,_e=W):(ie=ee*X,_e=(ee+1)*X);const K=[he,ie],H=[U,_e],B=await(0,i.slice)(A,K,H,c);q.push(B)}const te=await(0,i.interpolate_4d)((0,i.cat)(q,0),{size:[l,l],mode:"bicubic"});S.push((0,i.cat)([G,te],0))}else S.push(G)}const $=(0,i.stack)(S,0),w=b.map(A=>A.map(I=>l*u(I/l))),C=new i.Tensor("int64",w.flat(),[v,2]),P=w.map(([A,I])=>this.calc_num_image_tokens_from_image_size(I,A));return{pixel_values:$,original_sizes:k,reshaped_input_sizes:b,image_sizes:C,num_img_tokens:P}}}}),"./src/models/phi3_v/processing_phi3_v.js":((e,n,t)=>{t.r(n),t.d(n,{Phi3VProcessor:()=>d});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");t("./src/utils/image.js");const c="<|image|>",u=/<\|image_\d+\|>/g;class d extends s.Processor{static image_processor_class=i.AutoImageProcessor;static tokenizer_class=l.AutoTokenizer;async _call(m,_=null,{padding:p=!0,truncation:y=!0,num_crops:v=null}={}){Array.isArray(m)||(m=[m]);let T,k;if(_){k=await this.image_processor(_,{num_crops:v});const{num_img_tokens:b}=k,S=m.map((w,C)=>w.split(u).join(c.repeat(b[C])));T=this.tokenizer(S,{padding:p,truncation:y});const $=this.tokenizer.model.convert_tokens_to_ids([c])[0];T.input_ids.map_(w=>w==$?-w:w)}else T=this.tokenizer(m);return{...T,...k}}}}),"./src/models/pixtral/image_processing_pixtral.js":((e,n,t)=>{t.r(n),t.d(n,{PixtralImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{get_resize_output_image_size(c,u){const{longest_edge:d}=u;if(d===void 0)throw new Error("size must contain 'longest_edge'");const[f,m]=c.size,_=Math.max(f,m)/d;let p=f,y=m;_>1&&(p=Math.floor(f/_),y=Math.floor(m/_));const{patch_size:v,spatial_merge_size:T}=this.config;if(!T)throw new Error("config must contain 'spatial_merge_size'");const k=v*T,b=Math.floor((p-1)/k)+1,S=Math.floor((y-1)/k)+1;return[b*k,S*k]}}}),"./src/models/pixtral/processing_pixtral.js":((e,n,t)=>{t.r(n),t.d(n,{PixtralProcessor:()=>c});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");class c extends s.Processor{static tokenizer_class=l.AutoTokenizer;static image_processor_class=i.AutoImageProcessor;static uses_processor_config=!0;async _call(d,f=null,m={}){const _=await this.image_processor(d,m);if(f){const[y,v]=_.pixel_values.dims.slice(-2),{image_token:T,image_break_token:k,image_end_token:b,patch_size:S,spatial_merge_size:$}=this.config,w=S*$,C=Math.floor(y/w),P=Math.floor(v/w);f=structuredClone(f),Array.isArray(f)||(f=[f]);for(let A=0;A<f.length;++A){const I=T.repeat(P),W=I+k,G=I+b,q=W.repeat(C-1)+G;f[A]=f[A].replace(T,q)}}const p=f?this.tokenizer(f,m):{};return{..._,...p}}}}),"./src/models/processors.js":((e,n,t)=>{t.r(n),t.d(n,{Florence2Processor:()=>s.Florence2Processor,Gemma3nProcessor:()=>i.Gemma3nProcessor,GroundingDinoProcessor:()=>l.GroundingDinoProcessor,Idefics3Processor:()=>c.Idefics3Processor,JinaCLIPProcessor:()=>d.JinaCLIPProcessor,LlavaProcessor:()=>f.LlavaProcessor,MgpstrProcessor:()=>m.MgpstrProcessor,MoonshineProcessor:()=>_.MoonshineProcessor,OwlViTProcessor:()=>p.OwlViTProcessor,PaliGemmaProcessor:()=>y.PaliGemmaProcessor,Phi3VProcessor:()=>v.Phi3VProcessor,PixtralProcessor:()=>T.PixtralProcessor,PyAnnoteProcessor:()=>k.PyAnnoteProcessor,Qwen2VLProcessor:()=>b.Qwen2VLProcessor,Sam2Processor:()=>$.Sam2Processor,Sam2VideoProcessor:()=>$.Sam2VideoProcessor,SamProcessor:()=>S.SamProcessor,SmolVLMProcessor:()=>w.SmolVLMProcessor,SpeechT5Processor:()=>C.SpeechT5Processor,UltravoxProcessor:()=>P.UltravoxProcessor,VLChatProcessor:()=>u.VLChatProcessor,VoxtralProcessor:()=>A.VoxtralProcessor,Wav2Vec2Processor:()=>I.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>W.Wav2Vec2ProcessorWithLM,WhisperProcessor:()=>G.WhisperProcessor});var s=t("./src/models/florence2/processing_florence2.js"),i=t("./src/models/gemma3n/processing_gemma3n.js"),l=t("./src/models/grounding_dino/processing_grounding_dino.js"),c=t("./src/models/idefics3/processing_idefics3.js"),u=t("./src/models/janus/processing_janus.js"),d=t("./src/models/jina_clip/processing_jina_clip.js"),f=t("./src/models/llava/processing_llava.js"),m=t("./src/models/mgp_str/processing_mgp_str.js"),_=t("./src/models/moonshine/processing_moonshine.js"),p=t("./src/models/owlvit/processing_owlvit.js"),y=t("./src/models/paligemma/processing_paligemma.js"),v=t("./src/models/phi3_v/processing_phi3_v.js"),T=t("./src/models/pixtral/processing_pixtral.js"),k=t("./src/models/pyannote/processing_pyannote.js"),b=t("./src/models/qwen2_vl/processing_qwen2_vl.js"),S=t("./src/models/sam/processing_sam.js"),$=t("./src/models/sam2/processing_sam2.js"),w=t("./src/models/smolvlm/processing_smolvlm.js"),C=t("./src/models/speecht5/processing_speecht5.js"),P=t("./src/models/ultravox/processing_ultravox.js"),A=t("./src/models/voxtral/processing_voxtral.js"),I=t("./src/models/wav2vec2/processing_wav2vec2.js"),W=t("./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js"),G=t("./src/models/whisper/processing_whisper.js")}),"./src/models/pvt/image_processing_pvt.js":((e,n,t)=>{t.r(n),t.d(n,{PvtImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/pyannote/feature_extraction_pyannote.js":((e,n,t)=>{t.r(n),t.d(n,{PyAnnoteFeatureExtractor:()=>c});var s=t("./src/base/feature_extraction_utils.js"),i=t("./src/utils/tensor.js"),l=t("./src/utils/maths.js");class c extends s.FeatureExtractor{async _call(d){(0,s.validate_audio_inputs)(d,"PyAnnoteFeatureExtractor"),d instanceof Float64Array&&(d=new Float32Array(d));const f=[1,1,d.length];return{input_values:new i.Tensor("float32",d,f)}}samples_to_frames(d){return(d-this.config.offset)/this.config.step}post_process_speaker_diarization(d,f){const m=f/this.samples_to_frames(f)/this.config.sampling_rate,_=[];for(const p of d.tolist()){const y=[];let v=-1;for(let T=0;T<p.length;++T){const k=(0,l.softmax)(p[T]),[b,S]=(0,l.max)(k),[$,w]=[T,T+1];S!==v?(v=S,y.push({id:S,start:$,end:w,score:b})):(y.at(-1).end=w,y.at(-1).score+=b)}_.push(y.map(({id:T,start:k,end:b,score:S})=>({id:T,start:k*m,end:b*m,confidence:S/(b-k)})))}return _}}}),"./src/models/pyannote/processing_pyannote.js":((e,n,t)=>{t.r(n),t.d(n,{PyAnnoteProcessor:()=>l});var s=t("./src/base/processing_utils.js"),i=t("./src/models/pyannote/feature_extraction_pyannote.js");class l extends s.Processor{static feature_extractor_class=i.PyAnnoteFeatureExtractor;async _call(u){return await this.feature_extractor(u)}post_process_speaker_diarization(...u){return this.feature_extractor.post_process_speaker_diarization(...u)}get sampling_rate(){return this.feature_extractor.config.sampling_rate}}}),"./src/models/qwen2_vl/image_processing_qwen2_vl.js":((e,n,t)=>{t.r(n),t.d(n,{Qwen2VLImageProcessor:()=>l});var s=t("./src/base/image_processors_utils.js"),i=t("./src/utils/tensor.js");class l extends s.ImageProcessor{async _call(u,...d){const{pixel_values:f,original_sizes:m,reshaped_input_sizes:_}=await super._call(u,...d);let p=f;const{temporal_patch_size:y,merge_size:v,patch_size:T}=this.config;p.dims[0]===1&&(p=(0,i.cat)(Array.from({length:y},()=>p),0));const k=p.dims[0]/y,b=p.dims[1],S=Math.floor(p.dims[2]/T),$=Math.floor(p.dims[3]/T),w=p.view(k,y,b,Math.floor(S/v),v,T,Math.floor($/v),v,T).permute(0,3,6,4,7,2,1,5,8).view(k*S*$,b*y*T*T),C=new i.Tensor("int64",[k,S,$],[1,3]);return{pixel_values:w,image_grid_thw:C,original_sizes:m,reshaped_input_sizes:_}}}}),"./src/models/qwen2_vl/processing_qwen2_vl.js":((e,n,t)=>{t.r(n),t.d(n,{Qwen2VLProcessor:()=>c});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js"),l=t("./src/tokenizers.js");t("./src/utils/image.js");class c extends s.Processor{static image_processor_class=i.AutoImageProcessor;static tokenizer_class=l.AutoTokenizer;async _call(d,f=null,...m){Array.isArray(d)||(d=[d]);let _,p;if(f&&(_=await this.image_processor(f),p=_.image_grid_thw),p){let v=this.image_processor.config.merge_size**2,T=0;const k=p.tolist();d=d.map(b=>{for(;b.includes("<|image_pad|>");){const S=Number(k[T++].reduce(($,w)=>$*w,1n));b=b.replace("<|image_pad|>","<|placeholder|>".repeat(Math.floor(S/v)))}return b.replaceAll("<|placeholder|>","<|image_pad|>")})}return{...this.tokenizer(d),..._}}}}),"./src/models/rt_detr/image_processing_rt_detr.js":((e,n,t)=>{t.r(n),t.d(n,{RTDetrImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_object_detection(...c){return(0,s.post_process_object_detection)(...c)}}}),"./src/models/sam/image_processing_sam.js":((e,n,t)=>{t.r(n),t.d(n,{SamImageProcessor:()=>c});var s=t("./src/base/image_processors_utils.js"),i=t("./src/utils/core.js"),l=t("./src/utils/tensor.js");class c extends s.ImageProcessor{reshape_input_points(d,f,m,_=!1){d=structuredClone(d);let p=(0,i.calculateDimensions)(d);if(p.length===3)_||(p=[1,...p]),d=[d];else if(p.length!==4)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");for(let y=0;y<d.length;++y){const[v,T]=f[y],[k,b]=m[y],S=[b/T,k/v];for(let $=0;$<d[y].length;++$)for(let w=0;w<d[y][$].length;++w)for(let C=0;C<d[y][$][w].length;++C)d[y][$][w][C]*=S[C%2]}return new l.Tensor("float32",Float32Array.from(d.flat(1/0)),p)}add_input_labels(d,f){let m=(0,i.calculateDimensions)(d);if(m.length===2)m=[1,...m],d=[d];else if(m.length!==3)throw Error("The input_points must be a 4D tensor of shape `batch_size`, `point_batch_size`, `nb_points_per_image`, `2`.");if(m.some((_,p)=>_!==f.dims[p]))throw Error(`The first ${m.length} dimensions of 'input_points' and 'input_labels' must be the same.`);return new l.Tensor("int64",d.flat(1/0).map(BigInt),m)}async _call(d,{input_points:f=null,input_labels:m=null,input_boxes:_=null}={}){const p=await super._call(d);if(f&&(p.input_points=this.reshape_input_points(f,p.original_sizes,p.reshaped_input_sizes)),m){if(!p.input_points)throw Error("`input_points` must be provided if `input_labels` are provided.");p.input_labels=this.add_input_labels(m,p.input_points)}return _&&(p.input_boxes=this.reshape_input_points(_,p.original_sizes,p.reshaped_input_sizes,!0)),p}async post_process_masks(d,f,m,{mask_threshold:_=0,binarize:p=!0,pad_size:y=null}={}){const v=[];y=y??this.pad_size??this.size;const T=[y.height,y.width];for(let k=0;k<f.length;++k){const b=f[k],S=m[k];let $=await(0,l.interpolate_4d)(d[k],{mode:"bilinear",size:T});if($=$.slice(null,null,[0,S[0]],[0,S[1]]),$=await(0,l.interpolate_4d)($,{mode:"bilinear",size:b}),p){const w=$.data,C=new Uint8Array(w.length);for(let P=0;P<w.length;++P)w[P]>_&&(C[P]=1);$=new l.Tensor("bool",C,$.dims)}v.push($)}return v}generate_crop_boxes(d,f,{crop_n_layers:m=0,overlap_ratio:_=512/1500,points_per_crop:p=32,crop_n_points_downscale_factor:y=1}={}){}}}),"./src/models/sam/processing_sam.js":((e,n,t)=>{t.r(n),t.d(n,{SamProcessor:()=>l});var s=t("./src/base/processing_utils.js"),i=t("./src/models/auto/image_processing_auto.js");class l extends s.Processor{static image_processor_class=i.AutoImageProcessor;async _call(...u){return await this.image_processor(...u)}post_process_masks(...u){return this.image_processor.post_process_masks(...u)}reshape_input_points(...u){return this.image_processor.reshape_input_points(...u)}}}),"./src/models/sam2/image_processing_sam2.js":((e,n,t)=>{t.r(n),t.d(n,{Sam2ImageProcessor:()=>s.SamImageProcessor});var s=t("./src/models/sam/image_processing_sam.js")}),"./src/models/sam2/processing_sam2.js":((e,n,t)=>{t.r(n),t.d(n,{Sam2Processor:()=>i,Sam2VideoProcessor:()=>l});var s=t("./src/models/sam/processing_sam.js");class i extends s.SamProcessor{}class l extends i{}}),"./src/models/sam3/image_processing_sam3.js":((e,n,t)=>{t.r(n),t.d(n,{Sam3ImageProcessor:()=>s.Sam2ImageProcessor});var s=t("./src/models/sam2/image_processing_sam2.js")}),"./src/models/seamless_m4t/feature_extraction_seamless_m4t.js":((e,n,t)=>{t.r(n),t.d(n,{SeamlessM4TFeatureExtractor:()=>c});var s=t("./src/base/feature_extraction_utils.js"),i=t("./src/utils/tensor.js"),l=t("./src/utils/audio.js");class c extends s.FeatureExtractor{constructor(d){super(d);const f=this.config.sampling_rate,m=(0,l.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(f/2),f,null,"kaldi",!0);this.mel_filters=m,this.window=(0,l.window_function)(400,"povey",{periodic:!1})}async _extract_fbank_features(d,f){return d=d.map(m=>m*32768),(0,l.spectrogram)(d,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,max_num_frames:f,transpose:!0})}async _call(d,{padding:f=!0,pad_to_multiple_of:m=2,do_normalize_per_mel_bins:_=!0,return_attention_mask:p=!0}={}){(0,s.validate_audio_inputs)(d,"SeamlessM4TFeatureExtractor");let y=await this._extract_fbank_features(d,this.config.max_length);if(_){const[C,P]=y.dims,A=y.data;for(let I=0;I<P;++I){let W=0;for(let X=0;X<C;++X)W+=A[X*P+I];const G=W/C;let q=0;for(let X=0;X<C;++X)q+=(A[X*P+I]-G)**2;q/=C-1;const Z=Math.sqrt(q+1e-7);for(let X=0;X<C;++X){const Q=X*P+I;A[Q]=(A[Q]-G)/Z}}}let v;if(f){const[C,P]=y.dims,A=y.data,I=C%m;if(I>0){const W=new Float32Array(P*(C+I));W.set(A),W.fill(this.config.padding_value,A.length);const G=C+I;y=new i.Tensor(y.type,W,[G,P]),p&&(v=new i.Tensor("int64",new BigInt64Array(G),[1,G]),v.data.fill(1n,0,C))}}const[T,k]=y.dims,b=this.config.stride;if(T%b!==0)throw new Error(`The number of frames (${T}) must be a multiple of the stride (${b}).`);const $=y.view(1,Math.floor(T/b),k*b),w={input_features:$};if(p){const C=$.dims[1],P=new BigInt64Array(C);if(v){const A=v.data;for(let I=1,W=0;I<T;I+=b,++W)P[W]=A[I]}else P.fill(1n);w.attention_mask=new i.Tensor("int64",P,[1,C])}return w}}}),"./src/models/segformer/image_processing_segformer.js":((e,n,t)=>{t.r(n),t.d(n,{SegformerFeatureExtractor:()=>l,SegformerImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_semantic_segmentation(...u){return(0,s.post_process_semantic_segmentation)(...u)}}class l extends i{}}),"./src/models/siglip/image_processing_siglip.js":((e,n,t)=>{t.r(n),t.d(n,{SiglipImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}}),"./src/models/smolvlm/image_processing_smolvlm.js":((e,n,t)=>{t.r(n),t.d(n,{SmolVLMImageProcessor:()=>s.Idefics3ImageProcessor});var s=t("./src/models/idefics3/image_processing_idefics3.js")}),"./src/models/smolvlm/processing_smolvlm.js":((e,n,t)=>{t.r(n),t.d(n,{SmolVLMProcessor:()=>s.Idefics3Processor});var s=t("./src/models/idefics3/processing_idefics3.js")}),"./src/models/snac/feature_extraction_snac.js":((e,n,t)=>{t.r(n),t.d(n,{SnacFeatureExtractor:()=>i});var s=t("./src/models/dac/feature_extraction_dac.js");class i extends s.DacFeatureExtractor{}}),"./src/models/speecht5/feature_extraction_speecht5.js":((e,n,t)=>{t.r(n),t.d(n,{SpeechT5FeatureExtractor:()=>i});var s=t("./src/base/feature_extraction_utils.js");class i extends s.FeatureExtractor{}}),"./src/models/speecht5/processing_speecht5.js":((e,n,t)=>{t.r(n),t.d(n,{SpeechT5Processor:()=>c});var s=t("./src/base/processing_utils.js"),i=t("./src/tokenizers.js"),l=t("./src/models/auto/feature_extraction_auto.js");class c extends s.Processor{static tokenizer_class=i.AutoTokenizer;static feature_extractor_class=l.AutoFeatureExtractor;async _call(d){return await this.feature_extractor(d)}}}),"./src/models/swin2sr/image_processing_swin2sr.js":((e,n,t)=>{t.r(n),t.d(n,{Swin2SRImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{pad_image(c,u,d,f={}){const[m,_,p]=u;return super.pad_image(c,u,{width:_+(d-_%d)%d,height:m+(d-m%d)%d},{mode:"symmetric",center:!1,constant_values:-1,...f})}}}),"./src/models/ultravox/processing_ultravox.js":((e,n,t)=>{t.r(n),t.d(n,{UltravoxProcessor:()=>c});var s=t("./src/models/auto/feature_extraction_auto.js"),i=t("./src/tokenizers.js"),l=t("./src/base/processing_utils.js");class c extends l.Processor{static tokenizer_class=i.AutoTokenizer;static feature_extractor_class=s.AutoFeatureExtractor;static uses_processor_config=!0;async _call(d,f=null,m={}){if(Array.isArray(d))throw new Error("Batched inputs are not supported yet.");let _={};if(f){const y=f.length,{input_features:v}=await this.feature_extractor(f,{...m,max_length:y}),T=Math.round(y/this.config.encoder_ds_factor+1e-4),k=1+Math.ceil(T/this.config.stack_factor);_.audio_token_len=[k],_.audio_values=v;const b=this.config.audio_placeholder;if(!d.includes(b))throw new Error(`The input text does not contain the image token ${b}.`);d=d.replaceAll(b,b.repeat(k))}return{...this.tokenizer(d,{add_special_tokens:!1,...m}),..._}}}}),"./src/models/vit/image_processing_vit.js":((e,n,t)=>{t.r(n),t.d(n,{ViTFeatureExtractor:()=>l,ViTImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{}class l extends i{}}),"./src/models/vitmatte/image_processing_vitmatte.js":((e,n,t)=>{t.r(n),t.d(n,{VitMatteImageProcessor:()=>l});var s=t("./src/base/image_processors_utils.js"),i=t("./src/utils/tensor.js");class l extends s.ImageProcessor{async _call(u,d){Array.isArray(u)||(u=[u]),Array.isArray(d)||(d=[d]);const f=await Promise.all(u.map(p=>this.preprocess(p))),m=await Promise.all(d.map(p=>this.preprocess(p,{do_normalize:!1,do_convert_rgb:!1,do_convert_grayscale:!0})));return{pixel_values:(0,i.stack)(f.map((p,y)=>(0,i.cat)([p.pixel_values,m[y].pixel_values],0)),0),original_sizes:f.map(p=>p.original_size),reshaped_input_sizes:f.map(p=>p.reshaped_input_size)}}}}),"./src/models/vitpose/image_processing_vitpose.js":((e,n,t)=>{t.r(n),t.d(n,{VitPoseImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_pose_estimation(c,u,{threshold:d=null}={}){const f=c.tolist(),[m,_,p,y]=c.dims,v=[];for(let T=0;T<m;++T){const k=f[T],b=u[T],S=[];for(let $=0;$<b.length;++$){const w=b[$],C=[],P=[],A=[],I=w.at(-2)/y,W=w.at(-1)/p;for(let G=0;G<k.length;++G){let[q,Z]=[0,0],X=0,Q=-1/0;const te=k[G];for(let ee=0;ee<te.length;++ee){const ie=te[ee];for(let he=0;he<ie.length;++he){const _e=ie[he];X+=_e,Q=Math.max(Q,_e),q+=(he+.5)*_e,Z+=ee*_e}}if(d!=null&&Q<d)continue;const R=[I*q/X,W*Z/X];C.push(R),A.push(G),P.push(Q)}S.push({bbox:w,scores:P,labels:A,keypoints:C})}v.push(S)}return v}}}),"./src/models/voxtral/processing_voxtral.js":((e,n,t)=>{t.r(n),t.d(n,{VoxtralProcessor:()=>_});var s=t("./src/models/auto/feature_extraction_auto.js"),i=t("./src/tokenizers.js"),l=t("./src/base/processing_utils.js"),c=t("./src/utils/tensor.js");const u="[AUDIO]",d="[BEGIN_AUDIO]",f=375;function m(p,y){const v=[];for(let T=0;T<p.length;T+=y)v.push(p.subarray(T,Math.min(T+y,p.length)));return v}class _ extends l.Processor{static tokenizer_class=i.AutoTokenizer;static feature_extractor_class=s.AutoFeatureExtractor;static uses_processor_config=!1;async _call(y,v=null,T={}){if(Array.isArray(y))throw new Error("Batched inputs are not supported yet.");const k={};if(v){if(!y.includes(u))throw new Error(`The input text does not contain the audio token ${u}.`);Array.isArray(v)||(v=[v]);const S=y.split(u),$=S.length-1;if($!==v.length)throw new Error(`The number of audio inputs (${v.length}) does not match the number of audio tokens in the text (${$}).`);const w=this.feature_extractor.config.n_samples,C=v.map(G=>m(G,w)),P=C.map(G=>G.length),A=C.flat(),I=(await Promise.all(A.map(G=>this.feature_extractor(G,T)))).map(G=>G.input_features);k.audio_values=I.length>1?(0,c.cat)(I,0):I[0];let W=S[0];for(let G=0;G<P.length;++G){W+=d;for(let q=0;q<P[G];++q)W+=u.repeat(f);W+=S[G+1]}y=W}return{...this.tokenizer(y,{add_special_tokens:!1,...T}),...k}}}}),"./src/models/wav2vec2/feature_extraction_wav2vec2.js":((e,n,t)=>{t.r(n),t.d(n,{Wav2Vec2FeatureExtractor:()=>l});var s=t("./src/base/feature_extraction_utils.js"),i=t("./src/utils/tensor.js");class l extends s.FeatureExtractor{_zero_mean_unit_var_norm(u){const f=u.reduce((_,p)=>_+p,0)/u.length,m=u.reduce((_,p)=>_+(p-f)**2,0)/u.length;return u.map(_=>(_-f)/Math.sqrt(m+1e-7))}async _call(u){(0,s.validate_audio_inputs)(u,"Wav2Vec2FeatureExtractor"),u instanceof Float64Array&&(u=new Float32Array(u));let d=u;this.config.do_normalize&&(d=this._zero_mean_unit_var_norm(d));const f=[1,d.length];return{input_values:new i.Tensor("float32",d,f),attention_mask:new i.Tensor("int64",new BigInt64Array(d.length).fill(1n),f)}}}}),"./src/models/wav2vec2/processing_wav2vec2.js":((e,n,t)=>{t.r(n),t.d(n,{Wav2Vec2Processor:()=>c});var s=t("./src/tokenizers.js"),i=t("./src/models/auto/feature_extraction_auto.js"),l=t("./src/base/processing_utils.js");class c extends l.Processor{static tokenizer_class=s.AutoTokenizer;static feature_extractor_class=i.AutoFeatureExtractor;async _call(d){return await this.feature_extractor(d)}}}),"./src/models/wav2vec2_with_lm/processing_wav2vec2_with_lm.js":((e,n,t)=>{t.r(n),t.d(n,{Wav2Vec2ProcessorWithLM:()=>c});var s=t("./src/tokenizers.js"),i=t("./src/models/auto/feature_extraction_auto.js"),l=t("./src/base/processing_utils.js");class c extends l.Processor{static tokenizer_class=s.AutoTokenizer;static feature_extractor_class=i.AutoFeatureExtractor;async _call(d){return await this.feature_extractor(d)}}}),"./src/models/wespeaker/feature_extraction_wespeaker.js":((e,n,t)=>{t.r(n),t.d(n,{WeSpeakerFeatureExtractor:()=>l});var s=t("./src/base/feature_extraction_utils.js");t("./src/utils/tensor.js");var i=t("./src/utils/audio.js");class l extends s.FeatureExtractor{constructor(u){super(u);const d=this.config.sampling_rate,f=(0,i.mel_filter_bank)(257,this.config.num_mel_bins,20,Math.floor(d/2),d,null,"kaldi",!0);this.mel_filters=f,this.window=(0,i.window_function)(400,"hamming",{periodic:!1}),this.min_num_frames=this.config.min_num_frames}async _extract_fbank_features(u){return u=u.map(d=>d*32768),(0,i.spectrogram)(u,this.window,400,160,{fft_length:512,power:2,center:!1,preemphasis:.97,mel_filters:this.mel_filters,log_mel:"log",mel_floor:1192092955078125e-22,remove_dc_offset:!0,transpose:!0,min_num_frames:this.min_num_frames})}async _call(u){(0,s.validate_audio_inputs)(u,"WeSpeakerFeatureExtractor");const d=(await this._extract_fbank_features(u)).unsqueeze_(0);if(this.config.fbank_centering_span===null){const f=d.mean(1).data,m=d.data,[_,p,y]=d.dims;for(let v=0;v<_;++v){const T=v*p*y,k=v*y;for(let b=0;b<p;++b){const S=T+b*y;for(let $=0;$<y;++$)m[S+$]-=f[k+$]}}}return{input_features:d}}}}),"./src/models/whisper/common_whisper.js":((e,n,t)=>{t.r(n),t.d(n,{WHISPER_LANGUAGE_MAPPING:()=>i,WHISPER_TO_LANGUAGE_CODE_MAPPING:()=>l,whisper_language_to_code:()=>c});const s=[["en","english"],["zh","chinese"],["de","german"],["es","spanish"],["ru","russian"],["ko","korean"],["fr","french"],["ja","japanese"],["pt","portuguese"],["tr","turkish"],["pl","polish"],["ca","catalan"],["nl","dutch"],["ar","arabic"],["sv","swedish"],["it","italian"],["id","indonesian"],["hi","hindi"],["fi","finnish"],["vi","vietnamese"],["he","hebrew"],["uk","ukrainian"],["el","greek"],["ms","malay"],["cs","czech"],["ro","romanian"],["da","danish"],["hu","hungarian"],["ta","tamil"],["no","norwegian"],["th","thai"],["ur","urdu"],["hr","croatian"],["bg","bulgarian"],["lt","lithuanian"],["la","latin"],["mi","maori"],["ml","malayalam"],["cy","welsh"],["sk","slovak"],["te","telugu"],["fa","persian"],["lv","latvian"],["bn","bengali"],["sr","serbian"],["az","azerbaijani"],["sl","slovenian"],["kn","kannada"],["et","estonian"],["mk","macedonian"],["br","breton"],["eu","basque"],["is","icelandic"],["hy","armenian"],["ne","nepali"],["mn","mongolian"],["bs","bosnian"],["kk","kazakh"],["sq","albanian"],["sw","swahili"],["gl","galician"],["mr","marathi"],["pa","punjabi"],["si","sinhala"],["km","khmer"],["sn","shona"],["yo","yoruba"],["so","somali"],["af","afrikaans"],["oc","occitan"],["ka","georgian"],["be","belarusian"],["tg","tajik"],["sd","sindhi"],["gu","gujarati"],["am","amharic"],["yi","yiddish"],["lo","lao"],["uz","uzbek"],["fo","faroese"],["ht","haitian creole"],["ps","pashto"],["tk","turkmen"],["nn","nynorsk"],["mt","maltese"],["sa","sanskrit"],["lb","luxembourgish"],["my","myanmar"],["bo","tibetan"],["tl","tagalog"],["mg","malagasy"],["as","assamese"],["tt","tatar"],["haw","hawaiian"],["ln","lingala"],["ha","hausa"],["ba","bashkir"],["jw","javanese"],["su","sundanese"]],i=new Map(s),l=new Map([...s.map(([u,d])=>[d,u]),["burmese","my"],["valencian","ca"],["flemish","nl"],["haitian","ht"],["letzeburgesch","lb"],["pushto","ps"],["panjabi","pa"],["moldavian","ro"],["moldovan","ro"],["sinhalese","si"],["castilian","es"]]);function c(u){u=u.toLowerCase();let d=l.get(u);if(d===void 0){const f=u.match(/^<\|([a-z]{2})\|>$/);if(f&&(u=f[1]),i.has(u))d=u;else{const _=u.length===2?i.keys():i.values();throw new Error(`Language "${u}" is not supported. Must be one of: ${JSON.stringify(Array.from(_))}`)}}return d}}),"./src/models/whisper/feature_extraction_whisper.js":((e,n,t)=>{t.r(n),t.d(n,{WhisperFeatureExtractor:()=>c});var s=t("./src/base/feature_extraction_utils.js");t("./src/utils/tensor.js");var i=t("./src/utils/audio.js"),l=t("./src/utils/maths.js");class c extends s.FeatureExtractor{constructor(d){super(d),this.config.mel_filters??=(0,i.mel_filter_bank)(Math.floor(1+this.config.n_fft/2),this.config.feature_size,0,8e3,this.config.sampling_rate,"slaney","slaney"),this.window=(0,i.window_function)(this.config.n_fft,"hann")}async _extract_fbank_features(d){const f=await(0,i.spectrogram)(d,this.window,this.config.n_fft,this.config.hop_length,{power:2,mel_filters:this.config.mel_filters,log_mel:"log10",max_num_frames:Math.min(Math.floor(d.length/this.config.hop_length),this.config.nb_max_frames)}),m=f.data,_=(0,l.max)(m)[0];for(let p=0;p<m.length;++p)m[p]=(Math.max(m[p],_-8)+4)/4;return f}async _call(d,{max_length:f=null}={}){(0,s.validate_audio_inputs)(d,"WhisperFeatureExtractor");let m;const _=f??this.config.n_samples;return d.length>_?(d.length>this.config.n_samples&&console.warn("Attempting to extract features for audio longer than 30 seconds. If using a pipeline to extract transcript from a long audio clip, remember to specify `chunk_length_s` and/or `stride_length_s`."),m=d.slice(0,_)):(m=new Float32Array(_),m.set(d)),{input_features:(await this._extract_fbank_features(m)).unsqueeze_(0)}}}}),"./src/models/whisper/generation_whisper.js":((e,n,t)=>{t.r(n),t.d(n,{WhisperGenerationConfig:()=>i});var s=t("./src/generation/configuration_utils.js");class i extends s.GenerationConfig{return_timestamps=null;return_token_timestamps=null;num_frames=null;alignment_heads=null;task=null;language=null;no_timestamps_token_id=null;prompt_ids=null;is_multilingual=null;lang_to_id=null;task_to_id=null;max_initial_timestamp_index=1}}),"./src/models/whisper/processing_whisper.js":((e,n,t)=>{t.r(n),t.d(n,{WhisperProcessor:()=>c});var s=t("./src/models/auto/feature_extraction_auto.js"),i=t("./src/tokenizers.js"),l=t("./src/base/processing_utils.js");class c extends l.Processor{static tokenizer_class=i.AutoTokenizer;static feature_extractor_class=s.AutoFeatureExtractor;async _call(d){return await this.feature_extractor(d)}}}),"./src/models/yolos/image_processing_yolos.js":((e,n,t)=>{t.r(n),t.d(n,{YolosFeatureExtractor:()=>l,YolosImageProcessor:()=>i});var s=t("./src/base/image_processors_utils.js");class i extends s.ImageProcessor{post_process_object_detection(...u){return(0,s.post_process_object_detection)(...u)}}class l extends i{}}),"./src/ops/registry.js":((e,n,t)=>{t.r(n),t.d(n,{TensorOpRegistry:()=>c});var s=t("./src/backends/onnx.js"),i=t("./src/utils/tensor.js");const l=async(u,d,f)=>{const m=await(0,s.createInferenceSession)(new Uint8Array(u),d);return(async _=>{const p=(0,s.isONNXProxy)(),y=Object.fromEntries(Object.entries(_).map(([T,k])=>[T,(p?k.clone():k).ort_tensor])),v=await(0,s.runInferenceSession)(m,y);return Array.isArray(f)?f.map(T=>new i.Tensor(v[T])):new i.Tensor(v[f])})};class c{static session_options={};static get nearest_interpolate_4d(){return this._nearest_interpolate_4d||(this._nearest_interpolate_4d=l([8,10,18,0,58,129,1,10,41,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,18,10,4,109,111,100,101,34,7,110,101,97,114,101,115,116,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,21],this.session_options,"y")),this._nearest_interpolate_4d}static get bilinear_interpolate_4d(){return this._bilinear_interpolate_4d||(this._bilinear_interpolate_4d=l([8,9,18,0,58,128,1,10,40,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,17,10,4,109,111,100,101,34,6,108,105,110,101,97,114,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bilinear_interpolate_4d}static get bicubic_interpolate_4d(){return this._bicubic_interpolate_4d||(this._bicubic_interpolate_4d=l([8,9,18,0,58,127,10,39,10,1,120,10,0,10,0,10,1,115,18,1,121,34,6,82,101,115,105,122,101,42,16,10,4,109,111,100,101,34,5,99,117,98,105,99,160,1,3,18,1,114,90,31,10,1,120,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,90,15,10,1,115,18,10,10,8,8,7,18,4,10,2,8,4,98,31,10,1,121,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,99,10,3,18,1,104,10,3,18,1,119,66,2,16,20],this.session_options,"y")),this._bicubic_interpolate_4d}static get matmul(){return this._matmul||(this._matmul=l([8,9,18,0,58,55,10,17,10,1,97,10,1,98,18,1,99,34,6,77,97,116,77,117,108,18,1,114,90,9,10,1,97,18,4,10,2,8,1,90,9,10,1,98,18,4,10,2,8,1,98,9,10,1,99,18,4,10,2,8,1,66,2,16,20],this.session_options,"c")),this._matmul}static get stft(){return this._stft||(this._stft=l([8,7,18,0,58,148,1,10,38,10,1,115,10,1,106,10,1,119,10,1,108,18,1,111,34,4,83,84,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,115,90,26,10,1,115,18,21,10,19,8,1,18,15,10,3,18,1,98,10,3,18,1,115,10,3,18,1,99,90,11,10,1,106,18,6,10,4,8,7,18,0,90,16,10,1,119,18,11,10,9,8,1,18,5,10,3,18,1,119,90,11,10,1,108,18,6,10,4,8,7,18,0,98,31,10,1,111,18,26,10,24,8,1,18,20,10,3,18,1,98,10,3,18,1,102,10,3,18,1,100,10,3,18,1,99,66,2,16,17],this.session_options,"o")),this._stft}static get rfft(){return this._rfft||(this._rfft=l([8,9,18,0,58,97,10,33,10,1,120,10,0,10,1,97,18,1,121,34,3,68,70,84,42,15,10,8,111,110,101,115,105,100,101,100,24,1,160,1,2,18,1,100,90,21,10,1,120,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,90,11,10,1,97,18,6,10,4,8,7,18,0,98,21,10,1,121,18,16,10,14,8,1,18,10,10,3,18,1,115,10,3,18,1,99,66,2,16,20],this.session_options,"y")),this._rfft}static get top_k(){return this._top_k||(this._top_k=l([8,10,18,0,58,73,10,18,10,1,120,10,1,107,18,1,118,18,1,105,34,4,84,111,112,75,18,1,116,90,9,10,1,120,18,4,10,2,8,1,90,15,10,1,107,18,10,10,8,8,7,18,4,10,2,8,1,98,9,10,1,118,18,4,10,2,8,1,98,9,10,1,105,18,4,10,2,8,7,66,2,16,21],this.session_options,["v","i"])),this._top_k}static get slice(){return this._slice||(this._slice=l([8,7,18,0,58,96,10,25,10,1,120,10,1,115,10,1,101,10,1,97,10,1,116,18,1,121,34,5,83,108,105,99,101,18,1,114,90,9,10,1,120,18,4,10,2,8,1,90,9,10,1,115,18,4,10,2,8,7,90,9,10,1,101,18,4,10,2,8,7,90,9,10,1,97,18,4,10,2,8,7,90,9,10,1,116,18,4,10,2,8,7,98,9,10,1,121,18,4,10,2,8,1,66,2,16,13],this.session_options,"y")),this._slice}}}),"./src/pipelines.js":((e,n,t)=>{t.r(n),t.d(n,{AudioClassificationPipeline:()=>Z,AutomaticSpeechRecognitionPipeline:()=>Q,BackgroundRemovalPipeline:()=>ie,DepthEstimationPipeline:()=>ce,DocumentQuestionAnsweringPipeline:()=>K,FeatureExtractionPipeline:()=>G,FillMaskPipeline:()=>$,ImageClassificationPipeline:()=>R,ImageFeatureExtractionPipeline:()=>q,ImageSegmentationPipeline:()=>ee,ImageToImagePipeline:()=>B,ImageToTextPipeline:()=>te,ObjectDetectionPipeline:()=>_e,Pipeline:()=>T,QuestionAnsweringPipeline:()=>S,SummarizationPipeline:()=>C,Text2TextGenerationPipeline:()=>w,TextClassificationPipeline:()=>k,TextGenerationPipeline:()=>I,TextToAudioPipeline:()=>H,TokenClassificationPipeline:()=>b,TranslationPipeline:()=>P,ZeroShotAudioClassificationPipeline:()=>X,ZeroShotClassificationPipeline:()=>W,ZeroShotImageClassificationPipeline:()=>he,ZeroShotObjectDetectionPipeline:()=>U,pipeline:()=>ze});var s=t("./src/tokenizers.js"),i=t("./src/models.js"),l=t("./src/models/auto/processing_auto.js");t("./src/base/processing_utils.js");var c=t("./src/utils/generic.js"),u=t("./src/utils/core.js"),d=t("./src/utils/maths.js"),f=t("./src/utils/audio.js"),m=t("./src/utils/tensor.js"),_=t("./src/utils/image.js");async function p(Re){return Array.isArray(Re)||(Re=[Re]),await Promise.all(Re.map(de=>_.RawImage.read(de)))}async function y(Re,de){return Array.isArray(Re)||(Re=[Re]),await Promise.all(Re.map(J=>typeof J=="string"||J instanceof URL?(0,f.read_audio)(J,de):J instanceof Float64Array?new Float32Array(J):J))}function v(Re,de){de&&(Re=Re.map(Ue=>Ue|0));const[J,Ce,Fe,Be]=Re;return{xmin:J,ymin:Ce,xmax:Fe,ymax:Be}}class T extends c.Callable{constructor({task:de,model:J,tokenizer:Ce=null,processor:Fe=null}){super(),this.task=de,this.model=J,this.tokenizer=Ce,this.processor=Fe}async dispose(){await this.model.dispose()}}class k extends T{constructor(de){super(de)}async _call(de,{top_k:J=1}={}){const Ce=this.tokenizer(de,{padding:!0,truncation:!0}),Fe=await this.model(Ce),Be=this.model.config.problem_type==="multi_label_classification"?De=>De.sigmoid():De=>new m.Tensor("float32",(0,d.softmax)(De.data),De.dims),Ue=this.model.config.id2label,He=[];for(const De of Fe.logits){const nt=Be(De),ke=await(0,m.topk)(nt,J),Ge=ke[0].tolist(),Ye=ke[1].tolist().map((mt,it)=>({label:Ue?Ue[mt]:`LABEL_${mt}`,score:Ge[it]}));J===1?He.push(...Ye):He.push(Ye)}return Array.isArray(de)||J===1?He:He[0]}}class b extends T{constructor(de){super(de)}async _call(de,{ignore_labels:J=["O"]}={}){const Ce=Array.isArray(de),Fe=this.tokenizer(Ce?de:[de],{padding:!0,truncation:!0}),Ue=(await this.model(Fe)).logits,He=this.model.config.id2label,De=[];for(let nt=0;nt<Ue.dims[0];++nt){const ke=Fe.input_ids[nt],Ge=Ue[nt],dt=[];for(let Ye=0;Ye<Ge.dims[0];++Ye){const mt=Ge[Ye],it=(0,d.max)(mt.data)[1],Mt=He?He[it]:`LABEL_${it}`;if(J.includes(Mt))continue;const wt=this.tokenizer.decode([ke[Ye].item()],{skip_special_tokens:!0});if(wt==="")continue;const ot=(0,d.softmax)(mt.data);dt.push({entity:Mt,score:ot[it],index:Ye,word:wt})}De.push(dt)}return Ce?De:De[0]}}class S extends T{constructor(de){super(de)}async _call(de,J,{top_k:Ce=1}={}){const Fe=this.tokenizer(de,{text_pair:J,padding:!0,truncation:!0}),{start_logits:Be,end_logits:Ue}=await this.model(Fe),He=Fe.input_ids.tolist(),De=Fe.attention_mask.tolist(),nt=this.tokenizer.all_special_ids,ke=[];for(let Ge=0;Ge<Be.dims[0];++Ge){const dt=He[Ge],Ye=dt.findIndex(Je=>Je==this.tokenizer.sep_token_id);De[Ge].map((Je,St)=>Je==1&&(St===0||St>Ye&&nt.findIndex(Lt=>Lt==dt[St])===-1));const mt=Be[Ge].tolist(),it=Ue[Ge].tolist();for(let Je=1;Je<mt.length;++Je)(De[Ge]==0||Je<=Ye||nt.findIndex(St=>St==dt[Je])!==-1)&&(mt[Je]=-1/0,it[Je]=-1/0);const Mt=(0,d.softmax)(mt).map((Je,St)=>[Je,St]),wt=(0,d.softmax)(it).map((Je,St)=>[Je,St]);Mt[0][0]=0,wt[0][0]=0;const ot=(0,u.product)(Mt,wt).filter(Je=>Je[0][1]<=Je[1][1]).map(Je=>[Je[0][1],Je[1][1],Je[0][0]*Je[1][0]]).sort((Je,St)=>St[2]-Je[2]);for(let Je=0;Je<Math.min(ot.length,Ce);++Je){const[St,Lt,wn]=ot[Je],Ht=dt.slice(St,Lt+1),Mn=this.tokenizer.decode(Ht,{skip_special_tokens:!0});ke.push({answer:Mn,score:wn})}}return Ce===1?ke[0]:ke}}class $ extends T{constructor(de){super(de)}async _call(de,{top_k:J=5}={}){const Ce=this.tokenizer(de,{padding:!0,truncation:!0}),{logits:Fe}=await this.model(Ce),Be=[],Ue=Ce.input_ids.tolist();for(let He=0;He<Ue.length;++He){const De=Ue[He],nt=De.findIndex(mt=>mt==this.tokenizer.mask_token_id);if(nt===-1)throw Error(`Mask token (${this.tokenizer.mask_token}) not found in text.`);const ke=Fe[He][nt],Ge=await(0,m.topk)(new m.Tensor("float32",(0,d.softmax)(ke.data),ke.dims),J),dt=Ge[0].tolist(),Ye=Ge[1].tolist();Be.push(Ye.map((mt,it)=>{const Mt=De.slice();return Mt[nt]=mt,{score:dt[it],token:Number(mt),token_str:this.tokenizer.decode([mt]),sequence:this.tokenizer.decode(Mt,{skip_special_tokens:!0})}}))}return Array.isArray(de)?Be:Be[0]}}class w extends T{_key="generated_text";constructor(de){super(de)}async _call(de,J={}){Array.isArray(de)||(de=[de]),this.model.config.prefix&&(de=de.map(De=>this.model.config.prefix+De));const Ce=this.model.config.task_specific_params;Ce&&Ce[this.task]&&Ce[this.task].prefix&&(de=de.map(De=>Ce[this.task].prefix+De));const Fe=this.tokenizer,Be={padding:!0,truncation:!0};let Ue;this instanceof P&&"_build_translation_inputs"in Fe?Ue=Fe._build_translation_inputs(de,Be,J):Ue=Fe(de,Be);const He=await this.model.generate({...Ue,...J});return Fe.batch_decode(He,{skip_special_tokens:!0}).map(De=>({[this._key]:De}))}}class C extends w{_key="summary_text";constructor(de){super(de)}}class P extends w{_key="translation_text";constructor(de){super(de)}}function A(Re){return Array.isArray(Re)&&Re.every(de=>"role"in de&&"content"in de)}class I extends T{constructor(de){super(de)}async _call(de,J={}){let Ce=!1,Fe=!1,Be=J.add_special_tokens??(this.tokenizer.add_bos_token||this.tokenizer.add_eos_token)??!1,Ue;if(typeof de=="string")Ue=de=[de];else if(Array.isArray(de)&&de.every(Ye=>typeof Ye=="string"))Ce=!0,Ue=de;else{if(A(de))de=[de];else if(Array.isArray(de)&&de.every(A))Ce=!0;else throw new Error("Input must be a string, an array of strings, a Chat, or an array of Chats");Fe=!0,Ue=de.map(Ye=>this.tokenizer.apply_chat_template(Ye,{tokenize:!1,add_generation_prompt:!0})),Be=!1}const He=Fe?!1:J.return_full_text??!0;this.tokenizer.padding_side="left";const De=this.tokenizer(Ue,{add_special_tokens:Be,padding:!0,truncation:!0}),nt=await this.model.generate({...De,...J}),ke=this.tokenizer.batch_decode(nt,{skip_special_tokens:!0});let Ge;!He&&De.input_ids.dims.at(-1)>0&&(Ge=this.tokenizer.batch_decode(De.input_ids,{skip_special_tokens:!0}).map(Ye=>Ye.length));const dt=Array.from({length:de.length},Ye=>[]);for(let Ye=0;Ye<ke.length;++Ye){const mt=Math.floor(Ye/nt.dims[0]*de.length);Ge&&(ke[Ye]=ke[Ye].slice(Ge[mt])),dt[mt].push({generated_text:Fe?[...de[mt],{role:"assistant",content:ke[Ye]}]:ke[Ye]})}return!Ce&&dt.length===1?dt[0]:dt}}class W extends T{constructor(de){super(de),this.label2id=Object.fromEntries(Object.entries(this.model.config.label2id).map(([J,Ce])=>[J.toLowerCase(),Ce])),this.entailment_id=this.label2id.entailment,this.entailment_id===void 0&&(console.warn("Could not find 'entailment' in label2id mapping. Using 2 as entailment_id."),this.entailment_id=2),this.contradiction_id=this.label2id.contradiction??this.label2id.not_entailment,this.contradiction_id===void 0&&(console.warn("Could not find 'contradiction' in label2id mapping. Using 0 as contradiction_id."),this.contradiction_id=0)}async _call(de,J,{hypothesis_template:Ce="This example is {}.",multi_label:Fe=!1}={}){const Be=Array.isArray(de);Be||(de=[de]),Array.isArray(J)||(J=[J]);const Ue=J.map(nt=>Ce.replace("{}",nt)),He=Fe||J.length===1,De=[];for(const nt of de){const ke=[];for(const Ye of Ue){const mt=this.tokenizer(nt,{text_pair:Ye,padding:!0,truncation:!0}),it=await this.model(mt);He?ke.push([it.logits.data[this.contradiction_id],it.logits.data[this.entailment_id]]):ke.push(it.logits.data[this.entailment_id])}const dt=(He?ke.map(Ye=>(0,d.softmax)(Ye)[1]):(0,d.softmax)(ke)).map((Ye,mt)=>[Ye,mt]).sort((Ye,mt)=>mt[0]-Ye[0]);De.push({sequence:nt,labels:dt.map(Ye=>J[Ye[1]]),scores:dt.map(Ye=>Ye[0])})}return Be?De:De[0]}}class G extends T{constructor(de){super(de)}async _call(de,{pooling:J="none",normalize:Ce=!1,quantize:Fe=!1,precision:Be="binary"}={}){const Ue=this.tokenizer(de,{padding:!0,truncation:!0}),He=await this.model(Ue);let De=He.last_hidden_state??He.logits??He.token_embeddings;switch(J){case"none":break;case"mean":De=(0,m.mean_pooling)(De,Ue.attention_mask);break;case"first_token":case"cls":De=De.slice(null,0);break;case"last_token":case"eos":De=De.slice(null,-1);break;default:throw Error(`Pooling method '${J}' not supported.`)}return Ce&&(De=De.normalize(2,-1)),Fe&&(De=(0,m.quantize_embeddings)(De,Be)),De}}class q extends T{constructor(de){super(de)}async _call(de,{pool:J=null}={}){const Ce=await p(de),{pixel_values:Fe}=await this.processor(Ce),Be=await this.model({pixel_values:Fe});let Ue;if(J){if(!("pooler_output"in Be))throw Error("No pooled output was returned. Make sure the model has a 'pooler' layer when using the 'pool' option.");Ue=Be.pooler_output}else Ue=Be.last_hidden_state??Be.logits??Be.image_embeds;return Ue}}class Z extends T{constructor(de){super(de)}async _call(de,{top_k:J=5}={}){const Ce=this.processor.feature_extractor.config.sampling_rate,Fe=await y(de,Ce),Be=this.model.config.id2label,Ue=[];for(const He of Fe){const De=await this.processor(He),ke=(await this.model(De)).logits[0],Ge=await(0,m.topk)(new m.Tensor("float32",(0,d.softmax)(ke.data),ke.dims),J),dt=Ge[0].tolist(),mt=Ge[1].tolist().map((it,Mt)=>({label:Be?Be[it]:`LABEL_${it}`,score:dt[Mt]}));Ue.push(mt)}return Array.isArray(de)?Ue:Ue[0]}}class X extends T{constructor(de){super(de)}async _call(de,J,{hypothesis_template:Ce="This is a sound of {}."}={}){const Fe=!Array.isArray(de);Fe&&(de=[de]);const Be=J.map(ke=>Ce.replace("{}",ke)),Ue=this.tokenizer(Be,{padding:!0,truncation:!0}),He=this.processor.feature_extractor.config.sampling_rate,De=await y(de,He),nt=[];for(const ke of De){const Ge=await this.processor(ke),dt=await this.model({...Ue,...Ge}),Ye=(0,d.softmax)(dt.logits_per_audio.data);nt.push([...Ye].map((mt,it)=>({score:mt,label:J[it]})))}return Fe?nt[0]:nt}}class Q extends T{constructor(de){super(de)}async _call(de,J={}){switch(this.model.config.model_type){case"whisper":case"lite-whisper":return this._call_whisper(de,J);case"wav2vec2":case"wav2vec2-bert":case"unispeech":case"unispeech-sat":case"hubert":case"parakeet_ctc":return this._call_wav2vec2(de,J);case"moonshine":return this._call_moonshine(de,J);default:throw new Error(`AutomaticSpeechRecognitionPipeline does not support model type '${this.model.config.model_type}'.`)}}async _call_wav2vec2(de,J){J.language&&console.warn('`language` parameter is not yet supported for `wav2vec2` models, defaulting to "English".'),J.task&&console.warn('`task` parameter is not yet supported for `wav2vec2` models, defaulting to "transcribe".');const Ce=!Array.isArray(de);Ce&&(de=[de]);const Fe=this.processor.feature_extractor.config.sampling_rate,Be=await y(de,Fe),Ue=[];for(const He of Be){const De=await this.processor(He),ke=(await this.model(De)).logits[0],Ge=[];for(const Ye of ke)Ge.push((0,d.max)(Ye.data)[1]);const dt=this.tokenizer.decode(Ge,{skip_special_tokens:!0}).trim();Ue.push({text:dt})}return Ce?Ue[0]:Ue}async _call_whisper(de,J){const Ce=J.return_timestamps??!1,Fe=J.chunk_length_s??0,Be=J.force_full_sequences??!1;let Ue=J.stride_length_s??null;const He={...J};Ce==="word"&&(He.return_token_timestamps=!0,He.return_timestamps=!1);const De=!Array.isArray(de);De&&(de=[de]);const nt=this.processor.feature_extractor.config.chunk_length/this.model.config.max_source_positions,ke=this.processor.feature_extractor.config.hop_length,Ge=this.processor.feature_extractor.config.sampling_rate,dt=await y(de,Ge),Ye=[];for(const mt of dt){let it=[];if(Fe>0){if(Ue===null)Ue=Fe/6;else if(Fe<=Ue)throw Error("`chunk_length_s` must be larger than `stride_length_s`.");const ot=Ge*Fe,Je=Ge*Ue,St=ot-2*Je;let Lt=0;for(;;){const wn=Lt+ot,Ht=mt.subarray(Lt,wn),Mn=await this.processor(Ht),fa=Lt===0,Jt=wn>=mt.length;if(it.push({stride:[Ht.length,fa?0:Je,Jt?0:Je],input_features:Mn.input_features,is_last:Jt}),Jt)break;Lt+=St}}else it=[{stride:[mt.length,0,0],input_features:(await this.processor(mt)).input_features,is_last:!0}];for(const ot of it){He.num_frames=Math.floor(ot.stride[0]/ke);const Je=await this.model.generate({inputs:ot.input_features,...He});Ce==="word"?(ot.tokens=Je.sequences.tolist()[0],ot.token_timestamps=Je.token_timestamps.tolist()[0].map(St=>(0,d.round)(St,2))):ot.tokens=Je[0].tolist(),ot.stride=ot.stride.map(St=>St/Ge)}const[Mt,wt]=this.tokenizer._decode_asr(it,{time_precision:nt,return_timestamps:Ce,force_full_sequences:Be});Ye.push({text:Mt,...wt})}return De?Ye[0]:Ye}async _call_moonshine(de,J){const Ce=!Array.isArray(de);Ce&&(de=[de]);const Fe=this.processor.feature_extractor.config.sampling_rate,Be=await y(de,Fe),Ue=[];for(const He of Be){const De=await this.processor(He),nt=Math.floor(He.length/Fe)*6,ke=await this.model.generate({max_new_tokens:nt,...J,...De}),Ge=this.processor.batch_decode(ke,{skip_special_tokens:!0})[0];Ue.push({text:Ge})}return Ce?Ue[0]:Ue}}class te extends T{constructor(de){super(de)}async _call(de,J={}){const Ce=Array.isArray(de),Fe=await p(de),{pixel_values:Be}=await this.processor(Fe),Ue=[];for(const He of Be){He.dims=[1,...He.dims];const De=await this.model.generate({inputs:He,...J}),nt=this.tokenizer.batch_decode(De,{skip_special_tokens:!0}).map(ke=>({generated_text:ke.trim()}));Ue.push(nt)}return Ce?Ue:Ue[0]}}class R extends T{constructor(de){super(de)}async _call(de,{top_k:J=5}={}){const Ce=await p(de),{pixel_values:Fe}=await this.processor(Ce),Be=await this.model({pixel_values:Fe}),Ue=this.model.config.id2label,He=[];for(const De of Be.logits){const nt=await(0,m.topk)(new m.Tensor("float32",(0,d.softmax)(De.data),De.dims),J),ke=nt[0].tolist(),dt=nt[1].tolist().map((Ye,mt)=>({label:Ue?Ue[Ye]:`LABEL_${Ye}`,score:ke[mt]}));He.push(dt)}return Array.isArray(de)?He:He[0]}}class ee extends T{constructor(de){super(de),this.subtasks_mapping={panoptic:"post_process_panoptic_segmentation",instance:"post_process_instance_segmentation",semantic:"post_process_semantic_segmentation"}}async _call(de,{threshold:J=.5,mask_threshold:Ce=.5,overlap_mask_area_threshold:Fe=.8,label_ids_to_fuse:Be=null,target_sizes:Ue=null,subtask:He=null}={}){if(Array.isArray(de)&&de.length!==1)throw Error("Image segmentation pipeline currently only supports a batch size of 1.");const nt=await p(de),ke=nt.map(ot=>[ot.height,ot.width]),Ge=await this.processor(nt),{inputNames:dt,outputNames:Ye}=this.model.sessions.model;if(!dt.includes("pixel_values")){if(dt.length!==1)throw Error(`Expected a single input name, but got ${dt.length} inputs: ${dt}.`);const ot=dt[0];if(ot in Ge)throw Error(`Input name ${ot} already exists in the inputs.`);Ge[ot]=Ge.pixel_values}const mt=await this.model(Ge);let it=null;if(He!==null)it=this.subtasks_mapping[He];else if(this.processor.image_processor){for(const[ot,Je]of Object.entries(this.subtasks_mapping))if(Je in this.processor.image_processor){it=this.processor.image_processor[Je].bind(this.processor.image_processor),He=ot;break}}const Mt=this.model.config.id2label,wt=[];if(He)if(He==="panoptic"||He==="instance"){const ot=it(mt,J,Ce,Fe,Be,Ue??ke)[0],Je=ot.segmentation;for(const St of ot.segments_info){const Lt=new Uint8ClampedArray(Je.data.length);for(let Ht=0;Ht<Je.data.length;++Ht)Je.data[Ht]===St.id&&(Lt[Ht]=255);const wn=new _.RawImage(Lt,Je.dims[1],Je.dims[0],1);wt.push({score:St.score,label:Mt[St.label_id],mask:wn})}}else if(He==="semantic"){const{segmentation:ot,labels:Je}=it(mt,Ue??ke)[0];for(const St of Je){const Lt=new Uint8ClampedArray(ot.data.length);for(let Ht=0;Ht<ot.data.length;++Ht)ot.data[Ht]===St&&(Lt[Ht]=255);const wn=new _.RawImage(Lt,ot.dims[1],ot.dims[0],1);wt.push({score:null,label:Mt[St],mask:wn})}}else throw Error(`Subtask ${He} not supported.`);else{const Je=mt[Ye[0]];for(let St=0;St<ke.length;++St){const Lt=ke[St],wn=Je[St];wn.data.some(Mn=>Mn<-1e-5||Mn>1+1e-5)&&wn.sigmoid_();const Ht=await _.RawImage.fromTensor(wn.mul_(255).to("uint8")).resize(Lt[1],Lt[0]);wt.push({label:null,score:null,mask:Ht})}}return wt}}class ie extends ee{constructor(de){super(de)}async _call(de,J={}){if(Array.isArray(de)&&de.length!==1)throw Error("Background removal pipeline currently only supports a batch size of 1.");const Fe=await p(de),Be=await super._call(de,J);return Fe.map((He,De)=>{const nt=He.clone();return nt.putAlpha(Be[De].mask),nt})}}class he extends T{constructor(de){super(de)}async _call(de,J,{hypothesis_template:Ce="This is a photo of {}"}={}){const Fe=Array.isArray(de),Be=await p(de),Ue=J.map(dt=>Ce.replace("{}",dt)),He=this.tokenizer(Ue,{padding:this.model.config.model_type==="siglip"?"max_length":!0,truncation:!0}),{pixel_values:De}=await this.processor(Be),nt=await this.model({...He,pixel_values:De}),ke=this.model.config.model_type==="siglip"?dt=>dt.sigmoid().data:dt=>(0,d.softmax)(dt.data),Ge=[];for(const dt of nt.logits_per_image){const mt=[...ke(dt)].map((it,Mt)=>({score:it,label:J[Mt]}));mt.sort((it,Mt)=>Mt.score-it.score),Ge.push(mt)}return Fe?Ge:Ge[0]}}class _e extends T{constructor(de){super(de)}async _call(de,{threshold:J=.9,percentage:Ce=!1}={}){const Fe=Array.isArray(de);if(Fe&&de.length!==1)throw Error("Object detection pipeline currently only supports a batch size of 1.");const Be=await p(de),Ue=Ce?null:Be.map(Ye=>[Ye.height,Ye.width]),{pixel_values:He,pixel_mask:De}=await this.processor(Be),nt=await this.model({pixel_values:He,pixel_mask:De}),ke=this.processor.image_processor.post_process_object_detection(nt,J,Ue),Ge=this.model.config.id2label,dt=ke.map(Ye=>Ye.boxes.map((mt,it)=>({score:Ye.scores[it],label:Ge[Ye.classes[it]],box:v(mt,!Ce)})));return Fe?dt:dt[0]}}class U extends T{constructor(de){super(de)}async _call(de,J,{threshold:Ce=.1,top_k:Fe=null,percentage:Be=!1}={}){const Ue=Array.isArray(de),He=await p(de),De=this.tokenizer(J,{padding:!0,truncation:!0}),nt=await this.processor(He),ke=[];for(let Ge=0;Ge<He.length;++Ge){const dt=He[Ge],Ye=Be?null:[[dt.height,dt.width]],mt=nt.pixel_values[Ge].unsqueeze_(0),it=await this.model({...De,pixel_values:mt});let Mt;if("post_process_grounded_object_detection"in this.processor){const wt=this.processor.post_process_grounded_object_detection(it,De.input_ids,{box_threshold:Ce,text_threshold:Ce,target_sizes:Ye})[0];Mt=wt.boxes.map((ot,Je)=>({score:wt.scores[Je],label:wt.labels[Je],box:v(ot,!Be)}))}else{const wt=this.processor.image_processor.post_process_object_detection(it,Ce,Ye,!0)[0];Mt=wt.boxes.map((ot,Je)=>({score:wt.scores[Je],label:J[wt.classes[Je]],box:v(ot,!Be)}))}Mt.sort((wt,ot)=>ot.score-wt.score),Fe!==null&&(Mt=Mt.slice(0,Fe)),ke.push(Mt)}return Ue?ke:ke[0]}}class K extends T{constructor(de){super(de)}async _call(de,J,Ce={}){const Fe=(await p(de))[0],{pixel_values:Be}=await this.processor(Fe),Ue=`<s_docvqa><s_question>${J}</s_question><s_answer>`,He=this.tokenizer(Ue,{add_special_tokens:!1,padding:!0,truncation:!0}).input_ids,De=await this.model.generate({inputs:Be,max_length:this.model.config.decoder.max_position_embeddings,decoder_input_ids:He,...Ce}),ke=this.tokenizer.batch_decode(De)[0].match(/<s_answer>(.*?)<\/s_answer>/);let Ge=null;return ke&&ke.length>=2&&(Ge=ke[1].trim()),[{answer:Ge}]}}class H extends T{DEFAULT_VOCODER_ID="Xenova/speecht5_hifigan";constructor(de){super(de),this.vocoder=de.vocoder??null}async _prepare_speaker_embeddings(de){if((typeof de=="string"||de instanceof URL)&&(de=new Float32Array(await(await fetch(de)).arrayBuffer())),de instanceof Float32Array)de=new m.Tensor("float32",de,[de.length]);else if(!(de instanceof m.Tensor))throw new Error("Speaker embeddings must be a `Tensor`, `Float32Array`, `string`, or `URL`.");return de}async _call(de,{speaker_embeddings:J=null,num_inference_steps:Ce,speed:Fe}={}){return this.processor?this._call_text_to_spectrogram(de,{speaker_embeddings:J}):this.model.config.model_type==="supertonic"?this._call_supertonic(de,{speaker_embeddings:J,num_inference_steps:Ce,speed:Fe}):this._call_text_to_waveform(de)}async _call_supertonic(de,{speaker_embeddings:J,num_inference_steps:Ce,speed:Fe}){if(!J)throw new Error("Speaker embeddings must be provided for Supertonic models.");J=await this._prepare_speaker_embeddings(J);const{sampling_rate:Be,style_dim:Ue}=this.model.config;J=J.view(1,-1,Ue);const He=this.tokenizer(de,{padding:!0,truncation:!0}),{waveform:De}=await this.model.generate_speech({...He,style:J,num_inference_steps:Ce,speed:Fe});return new f.RawAudio(De.data,Be)}async _call_text_to_waveform(de){const J=this.tokenizer(de,{padding:!0,truncation:!0}),{waveform:Ce}=await this.model(J),Fe=this.model.config.sampling_rate;return new f.RawAudio(Ce.data,Fe)}async _call_text_to_spectrogram(de,{speaker_embeddings:J}){this.vocoder||(console.log("No vocoder specified, using default HifiGan vocoder."),this.vocoder=await i.AutoModel.from_pretrained(this.DEFAULT_VOCODER_ID,{dtype:"fp32"}));const{input_ids:Ce}=this.tokenizer(de,{padding:!0,truncation:!0});J=await this._prepare_speaker_embeddings(J),J=J.view(1,-1);const{waveform:Fe}=await this.model.generate_speech(Ce,J,{vocoder:this.vocoder}),Be=this.processor.feature_extractor.config.sampling_rate;return new f.RawAudio(Fe.data,Be)}}class B extends T{constructor(de){super(de)}async _call(de){const J=await p(de),Ce=await this.processor(J),Fe=await this.model(Ce),Be=[];for(const Ue of Fe.reconstruction){const He=Ue.squeeze().clamp_(0,1).mul_(255).round_().to("uint8");Be.push(_.RawImage.fromTensor(He))}return Be.length>1?Be:Be[0]}}class ce extends T{constructor(de){super(de)}async _call(de){const J=await p(de),Ce=await this.processor(J),{predicted_depth:Fe}=await this.model(Ce),Be=[];for(let Ue=0;Ue<J.length;++Ue){const He=Fe[Ue],[De,nt]=He.dims.slice(-2),[ke,Ge]=J[Ue].size,dt=(await(0,m.interpolate_4d)(He.view(1,1,De,nt),{size:[Ge,ke],mode:"bilinear"})).view(Ge,ke),Ye=dt.min().item(),mt=dt.max().item(),it=dt.sub(Ye).div_(mt-Ye).mul_(255).to("uint8").unsqueeze(0),Mt=_.RawImage.fromTensor(it);Be.push({predicted_depth:dt,depth:Mt})}return Be.length>1?Be:Be[0]}}const ve=Object.freeze({"text-classification":{tokenizer:s.AutoTokenizer,pipeline:k,model:i.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-finetuned-sst-2-english"},type:"text"},"token-classification":{tokenizer:s.AutoTokenizer,pipeline:b,model:i.AutoModelForTokenClassification,default:{model:"Xenova/bert-base-multilingual-cased-ner-hrl"},type:"text"},"question-answering":{tokenizer:s.AutoTokenizer,pipeline:S,model:i.AutoModelForQuestionAnswering,default:{model:"Xenova/distilbert-base-cased-distilled-squad"},type:"text"},"fill-mask":{tokenizer:s.AutoTokenizer,pipeline:$,model:i.AutoModelForMaskedLM,default:{model:"Xenova/bert-base-uncased"},type:"text"},summarization:{tokenizer:s.AutoTokenizer,pipeline:C,model:i.AutoModelForSeq2SeqLM,default:{model:"Xenova/distilbart-cnn-6-6"},type:"text"},translation:{tokenizer:s.AutoTokenizer,pipeline:P,model:i.AutoModelForSeq2SeqLM,default:{model:"Xenova/t5-small"},type:"text"},"text2text-generation":{tokenizer:s.AutoTokenizer,pipeline:w,model:i.AutoModelForSeq2SeqLM,default:{model:"Xenova/flan-t5-small"},type:"text"},"text-generation":{tokenizer:s.AutoTokenizer,pipeline:I,model:i.AutoModelForCausalLM,default:{model:"Xenova/gpt2"},type:"text"},"zero-shot-classification":{tokenizer:s.AutoTokenizer,pipeline:W,model:i.AutoModelForSequenceClassification,default:{model:"Xenova/distilbert-base-uncased-mnli"},type:"text"},"audio-classification":{pipeline:Z,model:i.AutoModelForAudioClassification,processor:l.AutoProcessor,default:{model:"Xenova/wav2vec2-base-superb-ks"},type:"audio"},"zero-shot-audio-classification":{tokenizer:s.AutoTokenizer,pipeline:X,model:i.AutoModel,processor:l.AutoProcessor,default:{model:"Xenova/clap-htsat-unfused"},type:"multimodal"},"automatic-speech-recognition":{tokenizer:s.AutoTokenizer,pipeline:Q,model:[i.AutoModelForSpeechSeq2Seq,i.AutoModelForCTC],processor:l.AutoProcessor,default:{model:"Xenova/whisper-tiny.en"},type:"multimodal"},"text-to-audio":{tokenizer:s.AutoTokenizer,pipeline:H,model:[i.AutoModelForTextToWaveform,i.AutoModelForTextToSpectrogram],processor:[l.AutoProcessor,null],default:{model:"Xenova/speecht5_tts"},type:"text"},"image-to-text":{tokenizer:s.AutoTokenizer,pipeline:te,model:i.AutoModelForVision2Seq,processor:l.AutoProcessor,default:{model:"Xenova/vit-gpt2-image-captioning"},type:"multimodal"},"image-classification":{pipeline:R,model:i.AutoModelForImageClassification,processor:l.AutoProcessor,default:{model:"Xenova/vit-base-patch16-224"},type:"multimodal"},"image-segmentation":{pipeline:ee,model:[i.AutoModelForImageSegmentation,i.AutoModelForSemanticSegmentation,i.AutoModelForUniversalSegmentation],processor:l.AutoProcessor,default:{model:"Xenova/detr-resnet-50-panoptic"},type:"multimodal"},"background-removal":{pipeline:ie,model:[i.AutoModelForImageSegmentation,i.AutoModelForSemanticSegmentation,i.AutoModelForUniversalSegmentation],processor:l.AutoProcessor,default:{model:"Xenova/modnet"},type:"image"},"zero-shot-image-classification":{tokenizer:s.AutoTokenizer,pipeline:he,model:i.AutoModel,processor:l.AutoProcessor,default:{model:"Xenova/clip-vit-base-patch32"},type:"multimodal"},"object-detection":{pipeline:_e,model:i.AutoModelForObjectDetection,processor:l.AutoProcessor,default:{model:"Xenova/detr-resnet-50"},type:"multimodal"},"zero-shot-object-detection":{tokenizer:s.AutoTokenizer,pipeline:U,model:i.AutoModelForZeroShotObjectDetection,processor:l.AutoProcessor,default:{model:"Xenova/owlvit-base-patch32"},type:"multimodal"},"document-question-answering":{tokenizer:s.AutoTokenizer,pipeline:K,model:i.AutoModelForDocumentQuestionAnswering,processor:l.AutoProcessor,default:{model:"Xenova/donut-base-finetuned-docvqa"},type:"multimodal"},"image-to-image":{pipeline:B,model:i.AutoModelForImageToImage,processor:l.AutoProcessor,default:{model:"Xenova/swin2SR-classical-sr-x2-64"},type:"image"},"depth-estimation":{pipeline:ce,model:i.AutoModelForDepthEstimation,processor:l.AutoProcessor,default:{model:"Xenova/dpt-large"},type:"image"},"feature-extraction":{tokenizer:s.AutoTokenizer,pipeline:G,model:i.AutoModel,default:{model:"Xenova/all-MiniLM-L6-v2"},type:"text"},"image-feature-extraction":{processor:l.AutoProcessor,pipeline:q,model:[i.AutoModelForImageFeatureExtraction,i.AutoModel],default:{model:"Xenova/vit-base-patch16-224-in21k"},type:"image"}}),Pe=Object.freeze({"sentiment-analysis":"text-classification",ner:"token-classification",asr:"automatic-speech-recognition","text-to-speech":"text-to-audio",embeddings:"feature-extraction"});async function ze(Re,de=null,{progress_callback:J=null,config:Ce=null,cache_dir:Fe=null,local_files_only:Be=!1,revision:Ue="main",device:He=null,dtype:De=null,subfolder:nt="onnx",use_external_data_format:ke=null,model_file_name:Ge=null,session_options:dt={}}={}){Re=Pe[Re]??Re;const Ye=ve[Re.split("_",1)[0]];if(!Ye)throw Error(`Unsupported pipeline: ${Re}. Must be one of [${Object.keys(ve)}]`);de||(de=Ye.default.model,console.log(`No model specified. Using default model: "${de}".`));const mt={progress_callback:J,config:Ce,cache_dir:Fe,local_files_only:Be,revision:Ue,device:He,dtype:De,subfolder:nt,use_external_data_format:ke,model_file_name:Ge,session_options:dt},it=new Map([["tokenizer",Ye.tokenizer],["model",Ye.model],["processor",Ye.processor]]),Mt=await Ze(it,de,mt);Mt.task=Re,(0,u.dispatchCallback)(J,{status:"ready",task:Re,model:de});const wt=Ye.pipeline;return new wt(Mt)}async function Ze(Re,de,J){const Ce=Object.create(null),Fe=[];for(const[Be,Ue]of Re.entries()){if(!Ue)continue;let He;Array.isArray(Ue)?He=new Promise(async(De,nt)=>{let ke;for(const Ge of Ue){if(Ge===null){De(null);return}try{De(await Ge.from_pretrained(de,J));return}catch(dt){if(dt.message?.includes("Unsupported model type"))ke=dt;else if(dt.message?.includes("Could not locate file"))ke=dt;else{nt(dt);return}}}nt(ke)}):He=Ue.from_pretrained(de,J),Ce[Be]=He,Fe.push(He)}await Promise.all(Fe);for(const[Be,Ue]of Object.entries(Ce))Ce[Be]=await Ue;return Ce}}),"./src/tokenizers.js":((e,n,t)=>{t.r(n),t.d(n,{AlbertTokenizer:()=>Ys,AutoTokenizer:()=>ao,BartTokenizer:()=>ht,BertTokenizer:()=>Fn,BlenderbotSmallTokenizer:()=>lt,BlenderbotTokenizer:()=>st,BloomTokenizer:()=>nn,CLIPTokenizer:()=>Ds,CamembertTokenizer:()=>fe,CodeGenTokenizer:()=>$s,CodeLlamaTokenizer:()=>Nn,CohereTokenizer:()=>Ca,ConvBertTokenizer:()=>ue,DebertaTokenizer:()=>qt,DebertaV2Tokenizer:()=>Zs,DistilBertTokenizer:()=>le,ElectraTokenizer:()=>Ne,EsmTokenizer:()=>Va,FalconTokenizer:()=>Ma,GPT2Tokenizer:()=>xt,GPTNeoXTokenizer:()=>Hn,GemmaTokenizer:()=>Wa,Grok1Tokenizer:()=>Zn,HerbertTokenizer:()=>F,LlamaTokenizer:()=>ra,M2M100Tokenizer:()=>ks,MBart50Tokenizer:()=>_t,MBartTokenizer:()=>Rt,MPNetTokenizer:()=>gs,MarianTokenizer:()=>_a,MgpstrTokenizer:()=>Js,MobileBertTokenizer:()=>Us,NllbTokenizer:()=>us,NougatTokenizer:()=>xn,PreTrainedTokenizer:()=>Ft,Qwen2Tokenizer:()=>Ga,RoFormerTokenizer:()=>ne,RobertaTokenizer:()=>Zt,SiglipTokenizer:()=>Ha,SpeechT5Tokenizer:()=>Et,SqueezeBertTokenizer:()=>Ua,T5Tokenizer:()=>ut,TokenizerModel:()=>q,VitsTokenizer:()=>Gr,Wav2Vec2CTCTokenizer:()=>Ya,WhisperTokenizer:()=>Vr,XLMRobertaTokenizer:()=>ia,XLMTokenizer:()=>xe,is_chinese_char:()=>$});var s=t("./src/utils/generic.js"),i=t("./src/utils/core.js"),l=t("./src/utils/hub.js"),c=t("./src/utils/maths.js"),u=t("./src/utils/tensor.js"),d=t("./src/utils/data-structures.js"),f=t("./node_modules/@huggingface/jinja/dist/index.js"),m=t("./src/models/whisper/common_whisper.js");async function _(Te,N){const oe=await Promise.all([(0,l.getModelJSON)(Te,"tokenizer.json",!0,N),(0,l.getModelJSON)(Te,"tokenizer_config.json",!0,N)]);return N.legacy!==null&&(oe[1].legacy=N.legacy),oe}function p(Te,N){const oe=[];let pe=0;for(const me of Te.matchAll(N)){const Ie=me[0];pe<me.index&&oe.push(Te.slice(pe,me.index)),Ie.length>0&&oe.push(Ie),pe=me.index+Ie.length}return pe<Te.length&&oe.push(Te.slice(pe)),oe}function y(Te,N=!0){if(Te.Regex!==void 0){let oe=Te.Regex.replace(/\\([#&~])/g,"$1");for(const[pe,me]of W)oe=oe.replaceAll(pe,me);return new RegExp(oe,"gu")}else if(Te.String!==void 0){const oe=(0,i.escapeRegExp)(Te.String);return new RegExp(N?oe:`(${oe})`,"gu")}else return console.warn("Unknown pattern type:",Te),null}function v(Te){return new Map(Object.entries(Te))}function T(Te){const N=Te.dims;switch(N.length){case 1:return Te.tolist();case 2:if(N[0]!==1)throw new Error("Unable to decode tensor with `batch size !== 1`. Use `tokenizer.batch_decode(...)` for batched inputs.");return Te.tolist()[0];default:throw new Error(`Expected tensor to have 1-2 dimensions, got ${N.length}.`)}}function k(Te){return Te.replace(/ \./g,".").replace(/ \?/g,"?").replace(/ \!/g,"!").replace(/ ,/g,",").replace(/ \' /g,"'").replace(/ n\'t/g,"n't").replace(/ \'m/g,"'m").replace(/ \'s/g,"'s").replace(/ \'ve/g,"'ve").replace(/ \'re/g,"'re")}function b(Te){return Te.replace(new RegExp("\\p{M}","gu"),"")}function S(Te){return b(Te.toLowerCase())}function $(Te){return Te>=19968&&Te<=40959||Te>=13312&&Te<=19903||Te>=131072&&Te<=173791||Te>=173824&&Te<=177983||Te>=177984&&Te<=178207||Te>=178208&&Te<=183983||Te>=63744&&Te<=64255||Te>=194560&&Te<=195103}function w(Te,N,oe){const pe=[];let me=0;for(;me<Te.length;){if(pe.push(Te[me]),(N.get(Te[me])??oe)!==oe){++me;continue}for(;++me<Te.length&&(N.get(Te[me])??oe)===oe;)N.get(pe.at(-1))!==oe&&(pe[pe.length-1]+=Te[me])}return pe}function C(Te){return Te.match(/\S+/g)||[]}const P="\\p{P}\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E",A=new RegExp(`^[${P}]+$`,"gu"),I=".,!?",W=new Map([["(?i:'s|'t|'re|'ve|'m|'ll|'d)","(?:'([sS]|[tT]|[rR][eE]|[vV][eE]|[mM]|[lL][lL]|[dD]))"],["(?i:[sdmt]|ll|ve|re)","(?:[sS]|[dD]|[mM]|[tT]|[lL][lL]|[vV][eE]|[rR][eE])"],["[^\\r\\n\\p{L}\\p{N}]?+","[^\\r\\n\\p{L}\\p{N}]?"],["[^\\s\\p{L}\\p{N}]++","[^\\s\\p{L}\\p{N}]+"],[` ?[^(\\s|[${I}])]+`,` ?[^\\s${I}]+`]]);class G{constructor(N){this.content=N.content,this.id=N.id,this.single_word=N.single_word??!1,this.lstrip=N.lstrip??!1,this.rstrip=N.rstrip??!1,this.special=N.special??!1,this.normalized=N.normalized??null}}class q extends s.Callable{constructor(N){super(),this.config=N,this.vocab=[],this.tokens_to_ids=new Map,this.unk_token_id=void 0,this.unk_token=void 0,this.end_of_word_suffix=void 0,this.fuse_unk=this.config.fuse_unk??!1}static fromConfig(N,...oe){switch(N.type){case"WordPiece":return new Z(N);case"Unigram":return new X(N,...oe);case"BPE":return new R(N);default:if(N.vocab)return Array.isArray(N.vocab)?new X(N,...oe):Object.hasOwn(N,"continuing_subword_prefix")&&Object.hasOwn(N,"unk_token")?Object.hasOwn(N,"merges")?new R(N):new Z(N):new ee(N,...oe);throw new Error(`Unknown TokenizerModel type: ${N.type}`)}}_call(N){return N=this.encode(N),this.fuse_unk&&(N=w(N,this.tokens_to_ids,this.unk_token_id)),N}encode(N){throw Error("encode should be implemented in subclass.")}convert_tokens_to_ids(N){return N.map(oe=>this.tokens_to_ids.get(oe)??this.unk_token_id)}convert_ids_to_tokens(N){return N.map(oe=>this.vocab[oe]??this.unk_token)}}class Z extends q{constructor(N){super(N),this.tokens_to_ids=v(N.vocab),this.unk_token_id=this.tokens_to_ids.get(N.unk_token),this.unk_token=N.unk_token,this.max_input_chars_per_word=N.max_input_chars_per_word??100,this.vocab=new Array(this.tokens_to_ids.size);for(const[oe,pe]of this.tokens_to_ids)this.vocab[pe]=oe}encode(N){const oe=[];for(const pe of N){const me=[...pe];if(me.length>this.max_input_chars_per_word){oe.push(this.unk_token);continue}let Ie=!1,qe=0;const vt=[];for(;qe<me.length;){let gt=me.length,bt=null;for(;qe<gt;){let pt=me.slice(qe,gt).join("");if(qe>0&&(pt=this.config.continuing_subword_prefix+pt),this.tokens_to_ids.has(pt)){bt=pt;break}--gt}if(bt===null){Ie=!0;break}vt.push(bt),qe=gt}Ie?oe.push(this.unk_token):oe.push(...vt)}return oe}}class X extends q{constructor(N,oe){super(N);const pe=N.vocab.length;this.vocab=new Array(pe),this.scores=new Array(pe);for(let me=0;me<pe;++me)[this.vocab[me],this.scores[me]]=N.vocab[me];this.unk_token_id=N.unk_id,this.unk_token=this.vocab[N.unk_id],this.tokens_to_ids=new Map(this.vocab.map((me,Ie)=>[me,Ie])),this.bos_token=" ",this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=oe.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.unk_token=this.vocab[this.unk_token_id],this.minScore=(0,c.min)(this.scores)[0],this.unk_score=this.minScore-10,this.scores[this.unk_token_id]=this.unk_score,this.trie=new d.CharTrie,this.trie.extend(this.vocab),this.fuse_unk=!0}populateNodes(N){const oe=N.chars,pe=1;let me=0;for(;me<oe.length;){let Ie=!1;const qe=oe.slice(me).join(""),vt=this.trie.commonPrefixSearch(qe);for(const gt of vt){const bt=this.tokens_to_ids.get(gt),pt=this.scores[bt],Xt=(0,i.len)(gt);N.insert(me,Xt,pt,bt),!Ie&&Xt===pe&&(Ie=!0)}Ie||N.insert(me,pe,this.unk_score,this.unk_token_id),me+=pe}}tokenize(N){const oe=new d.TokenLattice(N,this.bos_token_id,this.eos_token_id);return this.populateNodes(oe),oe.tokens()}encode(N){const oe=[];for(const pe of N){const me=this.tokenize(pe);oe.push(...me)}return oe}}const Q=(()=>{const Te=[...Array.from({length:94},(me,Ie)=>Ie+33),...Array.from({length:12},(me,Ie)=>Ie+161),...Array.from({length:82},(me,Ie)=>Ie+174)],N=Te.slice();let oe=0;for(let me=0;me<256;++me)Te.includes(me)||(Te.push(me),N.push(256+oe),oe+=1);const pe=N.map(me=>String.fromCharCode(me));return Object.fromEntries(Te.map((me,Ie)=>[me,pe[Ie]]))})(),te=(0,i.reverseDictionary)(Q);class R extends q{constructor(N){super(N),this.tokens_to_ids=v(N.vocab),this.unk_token_id=this.tokens_to_ids.get(N.unk_token),this.unk_token=N.unk_token,this.vocab=new Array(this.tokens_to_ids.size);for(const[pe,me]of this.tokens_to_ids)this.vocab[me]=pe;const oe=Array.isArray(N.merges[0]);this.merges=oe?N.merges:N.merges.map(pe=>pe.split(" ",2)),this.bpe_ranks=new Map(this.merges.map((pe,me)=>[JSON.stringify(pe),me])),this.end_of_word_suffix=N.end_of_word_suffix,this.continuing_subword_suffix=N.continuing_subword_suffix??null,this.byte_fallback=this.config.byte_fallback??!1,this.byte_fallback&&(this.text_encoder=new TextEncoder),this.ignore_merges=this.config.ignore_merges??!1,this.max_length_to_cache=256,this.cache_capacity=1e4,this.cache=new d.LRUCache(this.cache_capacity)}clear_cache(){this.cache.clear()}bpe(N){if(N.length===0)return[];const oe=this.cache.get(N);if(oe!==void 0)return oe;const pe=Array.from(N);this.end_of_word_suffix&&(pe[pe.length-1]+=this.end_of_word_suffix);let me=[];if(pe.length>1){const Ie=new d.PriorityQueue((gt,bt)=>gt.score<bt.score);let qe={token:pe[0],bias:0,prev:null,next:null},vt=qe;for(let gt=1;gt<pe.length;++gt){const bt={bias:gt/pe.length,token:pe[gt],prev:vt,next:null};vt.next=bt,this._add_node(Ie,vt),vt=bt}for(;!Ie.isEmpty();){const gt=Ie.pop();if(gt.deleted||!gt.next||gt.next.deleted)continue;if(gt.deleted=!0,gt.next.deleted=!0,gt.prev){const pt={...gt.prev};gt.prev.deleted=!0,gt.prev=pt,pt.prev?pt.prev.next=pt:qe=pt}const bt={token:gt.token+gt.next.token,bias:gt.bias,prev:gt.prev,next:gt.next.next};bt.prev?(bt.prev.next=bt,this._add_node(Ie,bt.prev)):qe=bt,bt.next&&(bt.next.prev=bt,this._add_node(Ie,bt))}for(let gt=qe;gt!==null;gt=gt.next)me.push(gt.token)}else me=pe;if(this.continuing_subword_suffix)for(let Ie=0;Ie<me.length-1;++Ie)me[Ie]+=this.continuing_subword_suffix;return N.length<this.max_length_to_cache&&this.cache.put(N,me),me}_add_node(N,oe){const pe=this.bpe_ranks.get(JSON.stringify([oe.token,oe.next.token]));pe!==void 0&&(oe.score=pe+oe.bias,N.push(oe))}encode(N){const oe=[];for(const pe of N){if(this.ignore_merges&&this.tokens_to_ids.has(pe)){oe.push(pe);continue}const me=this.bpe(pe);for(const Ie of me)if(this.tokens_to_ids.has(Ie))oe.push(Ie);else if(this.byte_fallback){const qe=Array.from(this.text_encoder.encode(Ie)).map(vt=>`<0x${vt.toString(16).toUpperCase().padStart(2,"0")}>`);qe.every(vt=>this.tokens_to_ids.has(vt))?oe.push(...qe):oe.push(this.unk_token)}else oe.push(this.unk_token)}return oe}}class ee extends q{constructor(N,oe){super(N),this.tokens_to_ids=v(oe.target_lang?N.vocab[oe.target_lang]:N.vocab),this.bos_token=oe.bos_token,this.bos_token_id=this.tokens_to_ids.get(this.bos_token),this.eos_token=oe.eos_token,this.eos_token_id=this.tokens_to_ids.get(this.eos_token),this.pad_token=oe.pad_token,this.pad_token_id=this.tokens_to_ids.get(this.pad_token),this.unk_token=oe.unk_token,this.unk_token_id=this.tokens_to_ids.get(this.unk_token),this.vocab=new Array(this.tokens_to_ids.size);for(const[pe,me]of this.tokens_to_ids)this.vocab[me]=pe}encode(N){return N}}class ie extends s.Callable{constructor(N){super(),this.config=N}static fromConfig(N){if(N===null)return null;switch(N.type){case"BertNormalizer":return new Re(N);case"Precompiled":return new Jt(N);case"Sequence":return new Ze(N);case"Replace":return new he(N);case"NFC":return new U(N);case"NFD":return new K(N);case"NFKC":return new H(N);case"NFKD":return new B(N);case"Strip":return new ce(N);case"StripAccents":return new ve(N);case"Lowercase":return new Pe(N);case"Prepend":return new ze(N);default:throw new Error(`Unknown Normalizer type: ${N.type}`)}}normalize(N){throw Error("normalize should be implemented in subclass.")}_call(N){return this.normalize(N)}}class he extends ie{normalize(N){const oe=y(this.config.pattern);return oe===null?N:N.replaceAll(oe,this.config.content)}}class _e extends ie{form=void 0;normalize(N){return N=N.normalize(this.form),N}}class U extends _e{form="NFC"}class K extends _e{form="NFD"}class H extends _e{form="NFKC"}class B extends _e{form="NFKD"}class ce extends ie{normalize(N){return this.config.strip_left&&this.config.strip_right?N=N.trim():(this.config.strip_left&&(N=N.trimStart()),this.config.strip_right&&(N=N.trimEnd())),N}}class ve extends ie{normalize(N){return N=b(N),N}}class Pe extends ie{normalize(N){return N=N.toLowerCase(),N}}class ze extends ie{normalize(N){return N=this.config.prepend+N,N}}class Ze extends ie{constructor(N){super(N),this.normalizers=N.normalizers.map(oe=>ie.fromConfig(oe))}normalize(N){return this.normalizers.reduce((oe,pe)=>pe.normalize(oe),N)}}class Re extends ie{_tokenize_chinese_chars(N){const oe=[];for(let pe=0;pe<N.length;++pe){const me=N[pe],Ie=me.charCodeAt(0);$(Ie)?(oe.push(" "),oe.push(me),oe.push(" ")):oe.push(me)}return oe.join("")}stripAccents(N){return N.normalize("NFD").replace(new RegExp("\\p{Mn}","gu"),"")}_is_control(N){switch(N){case"	":case`
`:case"\r":return!1;default:return new RegExp("^\\p{Cc}|\\p{Cf}|\\p{Co}|\\p{Cs}$","u").test(N)}}_clean_text(N){const oe=[];for(const pe of N){const me=pe.charCodeAt(0);me===0||me===65533||this._is_control(pe)||(/^\s$/.test(pe)?oe.push(" "):oe.push(pe))}return oe.join("")}normalize(N){return this.config.clean_text&&(N=this._clean_text(N)),this.config.handle_chinese_chars&&(N=this._tokenize_chinese_chars(N)),this.config.lowercase?(N=N.toLowerCase(),this.config.strip_accents!==!1&&(N=this.stripAccents(N))):this.config.strip_accents&&(N=this.stripAccents(N)),N}}class de extends s.Callable{static fromConfig(N){if(N===null)return null;switch(N.type){case"BertPreTokenizer":return new J(N);case"Sequence":return new ss(N);case"Whitespace":return new wi(N);case"WhitespaceSplit":return new Mi(N);case"Metaspace":return new Mn(N);case"ByteLevel":return new Ce(N);case"Split":return new Fe(N);case"Punctuation":return new Be(N);case"Digits":return new Ue(N);case"Replace":return new Xs(N);case"FixedLength":return new Wn(N);default:throw new Error(`Unknown PreTokenizer type: ${N.type}`)}}pre_tokenize_text(N,oe){throw Error("pre_tokenize_text should be implemented in subclass.")}pre_tokenize(N,oe){return(Array.isArray(N)?N.map(pe=>this.pre_tokenize_text(pe,oe)):this.pre_tokenize_text(N,oe)).flat()}_call(N,oe){return this.pre_tokenize(N,oe)}}class J extends de{constructor(N){super(),this.pattern=new RegExp(`[^\\s${P}]+|[${P}]`,"gu")}pre_tokenize_text(N,oe){return N.trim().match(this.pattern)||[]}}class Ce extends de{constructor(N){super(),this.config=N,this.add_prefix_space=this.config.add_prefix_space,this.trim_offsets=this.config.trim_offsets,this.use_regex=this.config.use_regex??!0,this.pattern=new RegExp("'s|'t|'re|'ve|'m|'ll|'d| ?\\p{L}+| ?\\p{N}+| ?[^\\s\\p{L}\\p{N}]+|\\s+(?!\\S)|\\s+","gu"),this.byte_encoder=Q,this.text_encoder=new TextEncoder}pre_tokenize_text(N,oe){return this.add_prefix_space&&!N.startsWith(" ")&&(N=" "+N),(this.use_regex?N.match(this.pattern)||[]:[N]).map(me=>Array.from(this.text_encoder.encode(me),Ie=>this.byte_encoder[Ie]).join(""))}}class Fe extends de{constructor(N){super(),this.config=N,this.pattern=y(this.config.pattern,this.config.invert)}pre_tokenize_text(N,oe){return this.pattern===null?[]:this.config.invert?N.match(this.pattern)||[]:this.config.behavior?.toLowerCase()==="removed"?N.split(this.pattern).filter(pe=>pe):p(N,this.pattern)}}class Be extends de{constructor(N){super(),this.config=N,this.pattern=new RegExp(`[^${P}]+|[${P}]+`,"gu")}pre_tokenize_text(N,oe){return N.match(this.pattern)||[]}}class Ue extends de{constructor(N){super(),this.config=N;const oe=`[^\\d]+|\\d${this.config.individual_digits?"":"+"}`;this.pattern=new RegExp(oe,"gu")}pre_tokenize_text(N,oe){return N.match(this.pattern)||[]}}class He extends s.Callable{constructor(N){super(),this.config=N}static fromConfig(N){if(N===null)return null;switch(N.type){case"TemplateProcessing":return new ke(N);case"ByteLevel":return new Ge(N);case"RobertaProcessing":return new nt(N);case"BertProcessing":return new De(N);case"Sequence":return new dt(N);default:throw new Error(`Unknown PostProcessor type: ${N.type}`)}}post_process(N,...oe){throw Error("post_process should be implemented in subclass.")}_call(N,...oe){return this.post_process(N,...oe)}}class De extends He{constructor(N){super(N),this.cls=N.cls[0],this.sep=N.sep[0]}post_process(N,oe=null,{add_special_tokens:pe=!0}={}){pe&&(N=(0,i.mergeArrays)([this.cls],N,[this.sep]));let me=new Array(N.length).fill(0);if(oe!==null){const Ie=pe&&this instanceof nt?[this.sep]:[],qe=pe?[this.sep]:[];N=(0,i.mergeArrays)(N,Ie,oe,qe),me=(0,i.mergeArrays)(me,new Array(oe.length+Ie.length+qe.length).fill(1))}return{tokens:N,token_type_ids:me}}}class nt extends De{}class ke extends He{constructor(N){super(N),this.single=N.single,this.pair=N.pair}post_process(N,oe=null,{add_special_tokens:pe=!0}={}){const me=oe===null?this.single:this.pair;let Ie=[],qe=[];for(const vt of me)"SpecialToken"in vt?pe&&(Ie.push(vt.SpecialToken.id),qe.push(vt.SpecialToken.type_id)):"Sequence"in vt&&(vt.Sequence.id==="A"?(Ie=(0,i.mergeArrays)(Ie,N),qe=(0,i.mergeArrays)(qe,new Array(N.length).fill(vt.Sequence.type_id))):vt.Sequence.id==="B"&&(Ie=(0,i.mergeArrays)(Ie,oe),qe=(0,i.mergeArrays)(qe,new Array(oe.length).fill(vt.Sequence.type_id))));return{tokens:Ie,token_type_ids:qe}}}class Ge extends He{post_process(N,oe=null){return oe&&(N=(0,i.mergeArrays)(N,oe)),{tokens:N}}}class dt extends He{constructor(N){super(N),this.processors=N.processors.map(oe=>He.fromConfig(oe))}post_process(N,oe=null,pe={}){let me;for(const Ie of this.processors)if(Ie instanceof Ge)N=Ie.post_process(N).tokens,oe&&(oe=Ie.post_process(oe).tokens);else{const qe=Ie.post_process(N,oe,pe);N=qe.tokens,me=qe.token_type_ids}return{tokens:N,token_type_ids:me}}}class Ye extends s.Callable{constructor(N){super(),this.config=N,this.added_tokens=[],this.end_of_word_suffix=null,this.trim_offsets=N.trim_offsets}static fromConfig(N){if(N===null)return null;switch(N.type){case"WordPiece":return new ot(N);case"Metaspace":return new fa(N);case"ByteLevel":return new Je(N);case"Replace":return new mt(N);case"ByteFallback":return new it(N);case"Fuse":return new Mt(N);case"Strip":return new wt(N);case"Sequence":return new Lt(N);case"CTC":return new St(N);case"BPEDecoder":return new wn(N);default:throw new Error(`Unknown Decoder type: ${N.type}`)}}_call(N){return this.decode(N)}decode(N){return this.decode_chain(N).join("")}decode_chain(N){throw Error("`decode_chain` should be implemented in subclass.")}}class mt extends Ye{decode_chain(N){const oe=y(this.config.pattern);return oe===null?N:N.map(pe=>pe.replaceAll(oe,this.config.content))}}class it extends Ye{constructor(N){super(N),this.text_decoder=new TextDecoder}decode_chain(N){const oe=[];let pe=[];for(const me of N){let Ie=null;if(me.length===6&&me.startsWith("<0x")&&me.endsWith(">")){const qe=parseInt(me.slice(3,5),16);isNaN(qe)||(Ie=qe)}if(Ie!==null)pe.push(Ie);else{if(pe.length>0){const qe=this.text_decoder.decode(Uint8Array.from(pe));oe.push(qe),pe=[]}oe.push(me)}}if(pe.length>0){const me=this.text_decoder.decode(Uint8Array.from(pe));oe.push(me),pe=[]}return oe}}class Mt extends Ye{decode_chain(N){return[N.join("")]}}class wt extends Ye{constructor(N){super(N),this.content=this.config.content,this.start=this.config.start,this.stop=this.config.stop}decode_chain(N){return N.map(oe=>{let pe=0;for(let Ie=0;Ie<this.start&&oe[Ie]===this.content;++Ie){pe=Ie+1;continue}let me=oe.length;for(let Ie=0;Ie<this.stop;++Ie){const qe=oe.length-Ie-1;if(oe[qe]===this.content){me=qe;continue}else break}return oe.slice(pe,me)})}}class ot extends Ye{constructor(N){super(N),this.cleanup=N.cleanup}decode_chain(N){return N.map((oe,pe)=>(pe!==0&&(oe.startsWith(this.config.prefix)?oe=oe.replace(this.config.prefix,""):oe=" "+oe),this.cleanup&&(oe=k(oe)),oe))}}class Je extends Ye{constructor(N){super(N),this.byte_decoder=te,this.text_decoder=new TextDecoder("utf-8",{fatal:!1,ignoreBOM:!0}),this.end_of_word_suffix=null}convert_tokens_to_string(N){const oe=N.join(""),pe=new Uint8Array([...oe].map(Ie=>this.byte_decoder[Ie]));return this.text_decoder.decode(pe)}decode_chain(N){const oe=[];let pe=[];for(const me of N)this.added_tokens.find(Ie=>Ie.content===me)!==void 0?(pe.length>0&&(oe.push(this.convert_tokens_to_string(pe)),pe=[]),oe.push(me)):pe.push(me);return pe.length>0&&oe.push(this.convert_tokens_to_string(pe)),oe}}class St extends Ye{constructor(N){super(N),this.pad_token=this.config.pad_token,this.word_delimiter_token=this.config.word_delimiter_token,this.cleanup=this.config.cleanup}convert_tokens_to_string(N){if(N.length===0)return"";const oe=[N[0]];for(let Ie=1;Ie<N.length;++Ie)N[Ie]!==oe.at(-1)&&oe.push(N[Ie]);let me=oe.filter(Ie=>Ie!==this.pad_token).join("");return this.cleanup&&(me=k(me).replaceAll(this.word_delimiter_token," ").trim()),me}decode_chain(N){return[this.convert_tokens_to_string(N)]}}class Lt extends Ye{constructor(N){super(N),this.decoders=N.decoders.map(oe=>Ye.fromConfig(oe))}decode_chain(N){return this.decoders.reduce((oe,pe)=>pe.decode_chain(oe),N)}}class wn extends Ye{constructor(N){super(N),this.suffix=this.config.suffix}decode_chain(N){return N.map((oe,pe)=>oe.replaceAll(this.suffix,pe===N.length-1?"":" "))}}class Ht extends Ye{decode_chain(N){let oe="";for(let pe=1;pe<N.length;pe+=2)oe+=N[pe];return[oe]}}class Mn extends de{constructor(N){super(),this.replacement=N.replacement,this.strRep=N.str_rep||this.replacement,this.prepend_scheme=N.prepend_scheme??"always"}pre_tokenize_text(N,{section_index:oe=void 0}={}){let pe=N.replaceAll(" ",this.strRep);return!pe.startsWith(this.replacement)&&(this.prepend_scheme==="always"||this.prepend_scheme==="first"&&oe===0)&&(pe=this.strRep+pe),[pe]}}class fa extends Ye{constructor(N){super(N),this.replacement=N.replacement}decode_chain(N){const oe=[];for(let pe=0;pe<N.length;++pe){let me=N[pe].replaceAll(this.replacement," ");pe==0&&me.startsWith(" ")&&(me=me.substring(1)),oe.push(me)}return oe}}class Jt extends ie{constructor(N){super(N),this.charsmap=N.precompiled_charsmap}normalize(N){return N=N.replace(/[\u0001-\u0008\u000B\u000E-\u001F\u007F\u008F\u009F]/gm,""),N=N.replace(/[\u0009\u000A\u000C\u000D\u00A0\u1680\u2000-\u200F\u2028\u2029\u202F\u205F\u2581\u3000\uFEFF\uFFFD]/gm," "),N.includes("")?N=N.split("").map(pe=>pe.normalize("NFKC")).join(""):N=N.normalize("NFKC"),N}}class ss extends de{constructor(N){super(),this.tokenizers=N.pretokenizers.map(oe=>de.fromConfig(oe))}pre_tokenize_text(N,oe){return this.tokenizers.reduce((pe,me)=>me.pre_tokenize(pe,oe),[N])}}class wi extends de{constructor(N){super()}pre_tokenize_text(N,oe){return N.match(/\w+|[^\w\s]+/g)||[]}}class Mi extends de{constructor(N){super()}pre_tokenize_text(N,oe){return C(N)}}class Xs extends de{constructor(N){super(),this.config=N,this.pattern=y(this.config.pattern),this.content=this.config.content}pre_tokenize_text(N,oe){return this.pattern===null?[N]:[N.replaceAll(this.pattern,this.config.content)]}}class Wn extends de{constructor(N){super(),this._length=N.length}pre_tokenize_text(N,oe){const pe=[];for(let me=0;me<N.length;me+=this._length)pe.push(N.slice(me,me+this._length));return pe}}const wa=["bos_token","eos_token","unk_token","sep_token","pad_token","cls_token","mask_token"];function Ra(Te,N,oe,pe){for(const me of Object.keys(Te)){const Ie=N-Te[me].length,qe=oe(me),vt=new Array(Ie).fill(qe);Te[me]=pe==="right"?(0,i.mergeArrays)(Te[me],vt):(0,i.mergeArrays)(vt,Te[me])}}function Bs(Te,N){for(const oe of Object.keys(Te))Te[oe].length=N}class Ft extends s.Callable{return_token_type_ids=!1;padding_side="right";constructor(N,oe){super(),this.config=oe,this.normalizer=ie.fromConfig(N.normalizer),this.pre_tokenizer=de.fromConfig(N.pre_tokenizer),this.model=q.fromConfig(N.model,oe),this.post_processor=He.fromConfig(N.post_processor),this.decoder=Ye.fromConfig(N.decoder),this.special_tokens=[],this.all_special_ids=[],this.added_tokens=[];for(const pe of N.added_tokens){const me=new G(pe);this.added_tokens.push(me),this.model.tokens_to_ids.set(me.content,me.id),this.model.vocab[me.id]=me.content,me.special&&(this.special_tokens.push(me.content),this.all_special_ids.push(me.id))}if(this.additional_special_tokens=oe.additional_special_tokens??[],this.special_tokens.push(...this.additional_special_tokens),this.special_tokens=[...new Set(this.special_tokens)],this.decoder&&(this.decoder.added_tokens=this.added_tokens,this.decoder.end_of_word_suffix=this.model.end_of_word_suffix),this.added_tokens_splitter=new d.DictionarySplitter(this.added_tokens.map(pe=>pe.content)),this.added_tokens_map=new Map(this.added_tokens.map(pe=>[pe.content,pe])),this.mask_token=this.getToken("mask_token"),this.mask_token_id=this.model.tokens_to_ids.get(this.mask_token),this.pad_token=this.getToken("pad_token","eos_token"),this.pad_token_id=this.model.tokens_to_ids.get(this.pad_token),this.sep_token=this.getToken("sep_token"),this.sep_token_id=this.model.tokens_to_ids.get(this.sep_token),this.unk_token=this.getToken("unk_token"),this.unk_token_id=this.model.tokens_to_ids.get(this.unk_token),this.bos_token=this.getToken("bos_token"),this.bos_token_id=this.model.tokens_to_ids.get(this.bos_token),this.eos_token=this.getToken("eos_token"),this.eos_token_id=this.model.tokens_to_ids.get(this.eos_token),this.model_max_length=oe.model_max_length,this.remove_space=oe.remove_space,this.clean_up_tokenization_spaces=oe.clean_up_tokenization_spaces??!0,this.do_lowercase_and_remove_accent=oe.do_lowercase_and_remove_accent??!1,oe.padding_side&&(this.padding_side=oe.padding_side),this.add_bos_token=oe.add_bos_token,this.add_eos_token=oe.add_eos_token,this.legacy=!1,this.chat_template=oe.chat_template??null,Array.isArray(this.chat_template)){const pe=Object.create(null);for(const{name:me,template:Ie}of this.chat_template){if(typeof me!="string"||typeof Ie!="string")throw new Error('Chat template must be a list of objects with "name" and "template" properties');pe[me]=Ie}this.chat_template=pe}this._compiled_template_cache=new Map}getToken(...N){for(const oe of N){const pe=this.config[oe];if(pe)if(typeof pe=="object"){if(pe.__type==="AddedToken")return pe.content;throw Error(`Unknown token: ${pe}`)}else return pe}return null}static async from_pretrained(N,{progress_callback:oe=null,config:pe=null,cache_dir:me=null,local_files_only:Ie=!1,revision:qe="main",legacy:vt=null}={}){const gt=await _(N,{progress_callback:oe,config:pe,cache_dir:me,local_files_only:Ie,revision:qe,legacy:vt});return new this(...gt)}_call(N,{text_pair:oe=null,add_special_tokens:pe=!0,padding:me=!1,truncation:Ie=null,max_length:qe=null,return_tensor:vt=!0,return_token_type_ids:gt=null}={}){const bt=Array.isArray(N);let pt;if(bt){if(N.length===0)throw Error("text array must be non-empty");if(oe!==null){if(Array.isArray(oe)){if(N.length!==oe.length)throw Error("text and text_pair must have the same length")}else throw Error("text_pair must also be an array");pt=N.map((jt,qn)=>this._encode_plus(jt,{text_pair:oe[qn],add_special_tokens:pe,return_token_type_ids:gt}))}else pt=N.map(jt=>this._encode_plus(jt,{add_special_tokens:pe,return_token_type_ids:gt}))}else{if(N==null)throw Error("text may not be null or undefined");if(Array.isArray(oe))throw Error("When specifying `text_pair`, since `text` is a string, `text_pair` must also be a string (i.e., not an array).");pt=[this._encode_plus(N,{text_pair:oe,add_special_tokens:pe,return_token_type_ids:gt})]}if(qe===null?qe=this.model_max_length:Ie===null&&(me===!0?(console.warn("`max_length` is ignored when `padding: true` and there is no truncation strategy. To pad to max length, use `padding: 'max_length'`."),qe=this.model_max_length):me===!1&&(console.warn("Truncation was not explicitly activated but `max_length` is provided a specific value, please use `truncation: true` to explicitly truncate examples to max length."),Ie=!0)),me===!0&&(qe=Math.min((0,c.max)(pt.map(jt=>jt.input_ids.length))[0],qe??1/0)),qe=Math.min(qe,this.model_max_length??1/0),me||Ie)for(let jt=0;jt<pt.length;++jt)pt[jt].input_ids.length!==qe&&(pt[jt].input_ids.length>qe?Ie&&Bs(pt[jt],qe):me&&Ra(pt[jt],qe,qn=>qn==="input_ids"?this.pad_token_id:0,this.padding_side));const Xt={};if(vt){if(!(me&&Ie)&&pt.some(qn=>{for(const ga of Object.keys(qn))if(qn[ga].length!==pt[0][ga]?.length)return!0;return!1}))throw Error("Unable to create tensor, you should probably activate truncation and/or padding with 'padding=true' and 'truncation=true' to have batched tensors with the same length.");const jt=[pt.length,pt[0].input_ids.length];for(const qn of Object.keys(pt[0]))Xt[qn]=new u.Tensor("int64",BigInt64Array.from(pt.flatMap(ga=>ga[qn]).map(BigInt)),jt)}else{for(const jt of Object.keys(pt[0]))Xt[jt]=pt.map(qn=>qn[jt]);if(!bt)for(const jt of Object.keys(Xt))Xt[jt]=Xt[jt][0]}return Xt}_encode_text(N){if(N===null)return null;const oe=this.added_tokens_splitter.split(N);for(let me=0;me<oe.length;++me){const Ie=this.added_tokens_map.get(oe[me]);Ie&&(Ie.lstrip&&me>0&&(oe[me-1]=oe[me-1].trimEnd()),Ie.rstrip&&me<oe.length-1&&(oe[me+1]=oe[me+1].trimStart()))}return oe.flatMap((me,Ie)=>{if(me.length===0)return[];if(this.added_tokens_map.has(me))return[me];if(this.remove_space===!0&&(me=me.trim().split(/\s+/).join(" ")),this.do_lowercase_and_remove_accent&&(me=S(me)),this.normalizer!==null&&(me=this.normalizer(me)),me.length===0)return[];const qe=this.pre_tokenizer!==null?this.pre_tokenizer(me,{section_index:Ie}):[me];return this.model(qe)})}_encode_plus(N,{text_pair:oe=null,add_special_tokens:pe=!0,return_token_type_ids:me=null}={}){const{tokens:Ie,token_type_ids:qe}=this._tokenize_helper(N,{pair:oe,add_special_tokens:pe}),vt=this.model.convert_tokens_to_ids(Ie),gt={input_ids:vt,attention_mask:new Array(vt.length).fill(1)};return(me??this.return_token_type_ids)&&qe&&(gt.token_type_ids=qe),gt}_tokenize_helper(N,{pair:oe=null,add_special_tokens:pe=!1}={}){const me=this._encode_text(N),Ie=this._encode_text(oe);return this.post_processor?this.post_processor(me,Ie,{add_special_tokens:pe}):{tokens:(0,i.mergeArrays)(me??[],Ie??[])}}tokenize(N,{pair:oe=null,add_special_tokens:pe=!1}={}){return this._tokenize_helper(N,{pair:oe,add_special_tokens:pe}).tokens}encode(N,{text_pair:oe=null,add_special_tokens:pe=!0,return_token_type_ids:me=null}={}){return this._encode_plus(N,{text_pair:oe,add_special_tokens:pe,return_token_type_ids:me}).input_ids}batch_decode(N,oe={}){return N instanceof u.Tensor&&(N=N.tolist()),N.map(pe=>this.decode(pe,oe))}decode(N,oe={}){if(N instanceof u.Tensor&&(N=T(N)),!Array.isArray(N)||N.length===0||!(0,i.isIntegralNumber)(N[0]))throw Error("token_ids must be a non-empty array of integers.");return this.decode_single(N,oe)}decode_single(N,{skip_special_tokens:oe=!1,clean_up_tokenization_spaces:pe=null}){let me=this.model.convert_ids_to_tokens(N);oe&&(me=me.filter(qe=>!this.special_tokens.includes(qe)));let Ie=this.decoder?this.decoder(me):me.join(" ");return this.decoder&&this.decoder.end_of_word_suffix&&(Ie=Ie.replaceAll(this.decoder.end_of_word_suffix," "),oe&&(Ie=Ie.trim())),(pe??this.clean_up_tokenization_spaces)&&(Ie=k(Ie)),Ie}get_chat_template({chat_template:N=null,tools:oe=null}={}){if(this.chat_template&&typeof this.chat_template=="object"){const pe=this.chat_template;if(N!==null&&Object.hasOwn(pe,N))N=pe[N];else if(N===null)if(oe!==null&&"tool_use"in pe)N=pe.tool_use;else if("default"in pe)N=pe.default;else throw Error(`This model has multiple chat templates with no default specified! Please either pass a chat template or the name of the template you wish to use to the 'chat_template' argument. Available template names are ${Object.keys(pe).sort()}.`)}else if(N===null)if(this.chat_template)N=this.chat_template;else throw Error("Cannot use apply_chat_template() because tokenizer.chat_template is not set and no template argument was passed! For information about writing templates and setting the tokenizer.chat_template attribute, please see the documentation at https://huggingface.co/docs/transformers/main/en/chat_templating");return N}apply_chat_template(N,{tools:oe=null,documents:pe=null,chat_template:me=null,add_generation_prompt:Ie=!1,tokenize:qe=!0,padding:vt=!1,truncation:gt=!1,max_length:bt=null,return_tensor:pt=!0,return_dict:Xt=!1,tokenizer_kwargs:jt={},...qn}={}){if(me=this.get_chat_template({chat_template:me,tools:oe}),typeof me!="string")throw Error(`chat_template must be a string, but got ${typeof me}`);let ga=this._compiled_template_cache.get(me);ga===void 0&&(ga=new f.Template(me),this._compiled_template_cache.set(me,ga));const Tn=Object.create(null);for(const An of wa){const rs=this.getToken(An);rs&&(Tn[An]=rs)}const Dn=ga.render({messages:N,add_generation_prompt:Ie,tools:oe,documents:pe,...Tn,...qn});if(qe){const An=this._call(Dn,{add_special_tokens:!1,padding:vt,truncation:gt,max_length:bt,return_tensor:pt,...jt});return Xt?An:An.input_ids}return Dn}}class Fn extends Ft{return_token_type_ids=!0}class Ys extends Ft{return_token_type_ids=!0}class Us extends Ft{return_token_type_ids=!0}class Ua extends Ft{return_token_type_ids=!0}class qt extends Ft{return_token_type_ids=!0}class Zs extends Ft{return_token_type_ids=!0}class F extends Ft{return_token_type_ids=!0}class ue extends Ft{return_token_type_ids=!0}class ne extends Ft{return_token_type_ids=!0}class le extends Ft{}class fe extends Ft{}class xe extends Ft{return_token_type_ids=!0;constructor(N,oe){super(N,oe),console.warn('WARNING: `XLMTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}}class Ne extends Ft{return_token_type_ids=!0}class ut extends Ft{}class xt extends Ft{}class ht extends Ft{}class Rt extends Ft{constructor(N,oe){super(N,oe),this.languageRegex=/^[a-z]{2}_[A-Z]{2}$/,this.language_codes=this.special_tokens.filter(pe=>this.languageRegex.test(pe)),this.lang_to_token=pe=>pe}_build_translation_inputs(N,oe,pe){return ha(this,N,oe,pe)}}class _t extends Rt{}class Zt extends Ft{}class nn extends Ft{}const sa="";class ra extends Ft{padding_side="left";constructor(N,oe){super(N,oe),this.legacy=oe.legacy??!0,this.legacy||(this.normalizer=null,this.pre_tokenizer=new Mn({replacement:sa,prepend_scheme:"first"}))}_encode_text(N){if(N===null)return null;if(this.legacy||N.length===0)return super._encode_text(N);let oe=super._encode_text(sa+N.replaceAll(sa," "));return oe.length>1&&oe[0]===sa&&this.special_tokens.includes(oe[1])&&(oe=oe.slice(1)),oe}}class Nn extends Ft{}class ia extends Ft{}class gs extends Ft{}class Ma extends Ft{}class Hn extends Ft{}class Va extends Ft{}class Ga extends Ft{}class Wa extends Ft{}class Zn extends Ft{}function ha(Te,N,oe,pe){if(!("language_codes"in Te)||!Array.isArray(Te.language_codes))throw new Error("Tokenizer must have `language_codes` attribute set and it should be an array of language ids.");if(!("languageRegex"in Te)||!(Te.languageRegex instanceof RegExp))throw new Error("Tokenizer must have `languageRegex` attribute set and it should be a regular expression.");if(!("lang_to_token"in Te)||typeof Te.lang_to_token!="function")throw new Error("Tokenizer must have `lang_to_token` attribute set and it should be a function.");const me=pe.src_lang,Ie=pe.tgt_lang;if(!Te.language_codes.includes(Ie))throw new Error(`Target language code "${Ie}" is not valid. Must be one of: {${Te.language_codes.join(", ")}}`);if(me!==void 0){if(!Te.language_codes.includes(me))throw new Error(`Source language code "${me}" is not valid. Must be one of: {${Te.language_codes.join(", ")}}`);for(const qe of Te.post_processor.config.single)if("SpecialToken"in qe&&Te.languageRegex.test(qe.SpecialToken.id)){qe.SpecialToken.id=Te.lang_to_token(me);break}}return pe.forced_bos_token_id=Te.model.convert_tokens_to_ids([Te.lang_to_token(Ie)])[0],Te._call(N,oe)}class us extends Ft{constructor(N,oe){super(N,oe),this.languageRegex=/^[a-z]{3}_[A-Z][a-z]{3}$/,this.language_codes=this.special_tokens.filter(pe=>this.languageRegex.test(pe)),this.lang_to_token=pe=>pe}_build_translation_inputs(N,oe,pe){return ha(this,N,oe,pe)}}class ks extends Ft{constructor(N,oe){super(N,oe),this.languageRegex=/^__[a-z]{2,3}__$/,this.language_codes=this.special_tokens.filter(pe=>this.languageRegex.test(pe)).map(pe=>pe.slice(2,-2)),this.lang_to_token=pe=>`__${pe}__`}_build_translation_inputs(N,oe,pe){return ha(this,N,oe,pe)}}class Vr extends Ft{get timestamp_begin(){return this.model.convert_tokens_to_ids(["<|notimestamps|>"])[0]+1}_decode_asr(N,{return_timestamps:oe=!1,return_language:pe=!1,time_precision:me=null,force_full_sequences:Ie=!0}={}){if(me===null)throw Error("Must specify time_precision");let qe=null;const vt=oe==="word";function gt(){return{language:qe,timestamp:[null,null],text:""}}const bt=[];let pt=gt(),Xt=0;const jt=this.timestamp_begin,ga=jt+1500;let Tn=[],Dn=[],An=!1,rs=null;const Os=new Set(this.all_special_ids);for(const Vn of N){const Jn=Vn.tokens,ea=vt?Vn.token_timestamps:null;let ds=null,ys=jt;if("stride"in Vn){const[ma,Kn,gn]=Vn.stride;if(Xt-=Kn,rs=ma-gn,Kn&&(ys=Kn/me+jt),gn)for(let On=Jn.length-1;On>=0;--On){const qa=Number(Jn[On]);if(qa>=jt){if(ds!==null&&(qa-jt)*me<rs)break;ds=qa}}}let xa=[],fs=[];for(let ma=0;ma<Jn.length;++ma){const Kn=Number(Jn[ma]);if(Os.has(Kn)){const gn=this.decode([Kn]),On=m.WHISPER_LANGUAGE_MAPPING.get(gn.slice(2,-2));if(On!==void 0){if(qe!==null&&On!==qe&&!oe){Tn.push(xa);const qa=this.findLongestCommonSequence(Tn)[0],Vs=this.decode(qa);pt.text=Vs,bt.push(pt),Tn=[],xa=[],pt=gt()}qe=pt.language=On}}else if(Kn>=jt&&Kn<=ga){const gn=(Kn-jt)*me+Xt,On=(0,c.round)(gn,2);if(ds!==null&&Kn>=ds)An=!0;else if(An||Tn.length>0&&Kn<ys)An=!1;else if(pt.timestamp[0]===null)pt.timestamp[0]=On;else if(On!==pt.timestamp[0]){pt.timestamp[1]=On,Tn.push(xa),vt&&Dn.push(fs);const[qa,Vs]=this.findLongestCommonSequence(Tn,Dn),br=this.decode(qa);pt.text=br,vt&&(pt.words=this.collateWordTimestamps(qa,Vs,qe)),bt.push(pt),Tn=[],xa=[],Dn=[],fs=[],pt=gt()}}else if(xa.push(Kn),vt){let gn=(0,c.round)(ea[ma]+Xt,2),On;if(ma+1<ea.length){On=(0,c.round)(ea[ma+1]+Xt,2);const qa=this.decode([Kn]);A.test(qa)&&(On=(0,c.round)(Math.min(gn+me,On),2))}else On=null;fs.push([gn,On])}}if("stride"in Vn){const[ma,Kn,gn]=Vn.stride;Xt+=ma-gn}xa.length>0?(Tn.push(xa),vt&&Dn.push(fs)):Tn.every(ma=>ma.length===0)&&(pt=gt(),Tn=[],xa=[],Dn=[],fs=[])}if(Tn.length>0){if(Ie&&oe)throw new Error("Whisper did not predict an ending timestamp, which can happen if audio is cut off in the middle of a word. Also make sure WhisperTimeStampLogitsProcessor was used during generation.");const[Vn,Jn]=this.findLongestCommonSequence(Tn,Dn),ea=this.decode(Vn);pt.text=ea,vt&&(pt.words=this.collateWordTimestamps(Vn,Jn,qe)),bt.push(pt)}let pa=Object.create(null);const Ba=bt.map(Vn=>Vn.text).join("");if(oe||pe){for(let Vn=0;Vn<bt.length;++Vn){const Jn=bt[Vn];oe||delete Jn.timestamp,pe||delete Jn.language}if(vt){const Vn=[];for(const Jn of bt)for(const ea of Jn.words)Vn.push(ea);pa={chunks:Vn}}else pa={chunks:bt}}return[Ba,pa]}findLongestCommonSequence(N,oe=null){let pe=N[0],me=pe.length,Ie=[];const qe=Array.isArray(oe)&&oe.length>0;let vt=qe?[]:null,gt=qe?oe[0]:null;for(let bt=1;bt<N.length;++bt){const pt=N[bt];let Xt=0,jt=[me,me,0,0];const qn=pt.length;for(let pa=1;pa<me+qn;++pa){const Ba=Math.max(0,me-pa),Vn=Math.min(me,me+qn-pa),Jn=pe.slice(Ba,Vn),ea=Math.max(0,pa-me),ds=Math.min(qn,pa),ys=pt.slice(ea,ds);if(Jn.length!==ys.length)throw new Error("There is a bug within whisper `decode_asr` function, please report it. Dropping to prevent bad inference.");let xa;qe?xa=Jn.filter((Kn,gn)=>Kn===ys[gn]&&gt[Ba+gn]<=oe[bt][ea+gn]).length:xa=Jn.filter((Kn,gn)=>Kn===ys[gn]).length;const fs=pa/1e4,ma=xa/pa+fs;xa>1&&ma>Xt&&(Xt=ma,jt=[Ba,Vn,ea,ds])}const[ga,Tn,Dn,An]=jt,rs=Math.floor((Tn+ga)/2),Os=Math.floor((An+Dn)/2);Ie.push(...pe.slice(0,rs)),pe=pt.slice(Os),me=pe.length,qe&&(vt.push(...gt.slice(0,rs)),gt=oe[bt].slice(Os))}return Ie.push(...pe),qe?(vt.push(...gt),[Ie,vt]):[Ie,[]]}collateWordTimestamps(N,oe,pe){const[me,Ie,qe]=this.combineTokensIntoWords(N,pe),vt=[];for(let gt=0;gt<me.length;++gt){const bt=qe[gt];vt.push({text:me[gt],timestamp:[oe[bt.at(0)][0],oe[bt.at(-1)][1]]})}return vt}combineTokensIntoWords(N,oe,pe=`"'([{-`,me=`"'.,!?:)]}`){oe=oe??"english";let Ie,qe,vt;return["chinese","japanese","thai","lao","myanmar"].includes(oe)?[Ie,qe,vt]=this.splitTokensOnUnicode(N):[Ie,qe,vt]=this.splitTokensOnSpaces(N),this.mergePunctuations(Ie,qe,vt,pe,me)}decode(N,oe){let pe;return oe?.decode_with_timestamps?(N instanceof u.Tensor&&(N=T(N)),pe=this.decodeWithTimestamps(N,oe)):pe=super.decode(N,oe),pe}decodeWithTimestamps(N,oe){const pe=oe?.time_precision??.02,me=Array.from(this.all_special_ids).at(-1)+1;let Ie=[[]];for(let qe of N)if(qe=Number(qe),qe>=me){const vt=((qe-me)*pe).toFixed(2);Ie.push(`<|${vt}|>`),Ie.push([])}else Ie[Ie.length-1].push(qe);return Ie=Ie.map(qe=>typeof qe=="string"?qe:super.decode(qe,oe)),Ie.join("")}splitTokensOnUnicode(N){const oe=this.decode(N,{decode_with_timestamps:!0}),pe="",me=[],Ie=[],qe=[];let vt=[],gt=[],bt=0;for(let pt=0;pt<N.length;++pt){const Xt=N[pt];vt.push(Xt),gt.push(pt);const jt=this.decode(vt,{decode_with_timestamps:!0});(!jt.includes(pe)||oe[bt+jt.indexOf(pe)]===pe)&&(me.push(jt),Ie.push(vt),qe.push(gt),vt=[],gt=[],bt+=jt.length)}return[me,Ie,qe]}splitTokensOnSpaces(N){const[oe,pe,me]=this.splitTokensOnUnicode(N),Ie=[],qe=[],vt=[],gt=new RegExp(`^[${P}]$`,"gu");for(let bt=0;bt<oe.length;++bt){const pt=oe[bt],Xt=pe[bt],jt=me[bt],qn=Xt[0]>=this.model.tokens_to_ids.get("<|endoftext|>"),ga=pt.startsWith(" "),Tn=pt.trim(),Dn=gt.test(Tn);if(qn||ga||Dn||Ie.length===0)Ie.push(pt),qe.push(Xt),vt.push(jt);else{const An=Ie.length-1;Ie[An]+=pt,qe[An].push(...Xt),vt[An].push(...jt)}}return[Ie,qe,vt]}mergePunctuations(N,oe,pe,me,Ie){const qe=structuredClone(N),vt=structuredClone(oe),gt=structuredClone(pe);let bt=qe.length-2,pt=qe.length-1;for(;bt>=0;)qe[bt].startsWith(" ")&&me.includes(qe[bt].trim())?(qe[pt]=qe[bt]+qe[pt],vt[pt]=(0,i.mergeArrays)(vt[bt],vt[pt]),gt[pt]=(0,i.mergeArrays)(gt[bt],gt[pt]),qe[bt]="",vt[bt]=[],gt[bt]=[]):pt=bt,--bt;for(bt=0,pt=1;pt<qe.length;)!qe[bt].endsWith(" ")&&Ie.includes(qe[pt])?(qe[bt]+=qe[pt],vt[bt]=(0,i.mergeArrays)(vt[bt],vt[pt]),gt[bt]=(0,i.mergeArrays)(gt[bt],gt[pt]),qe[pt]="",vt[pt]=[],gt[pt]=[]):bt=pt,++pt;return[qe.filter(Xt=>Xt),vt.filter(Xt=>Xt.length>0),gt.filter(Xt=>Xt.length>0)]}}class $s extends Ft{}class Ds extends Ft{}class Ha extends Ft{}class _a extends Ft{constructor(N,oe){super(N,oe),this.languageRegex=/^(>>\w+<<)\s*/g,this.supported_language_codes=this.model.vocab.filter(pe=>this.languageRegex.test(pe)),console.warn('WARNING: `MarianTokenizer` is not yet supported by Hugging Face\'s "fast" tokenizers library. Therefore, you may experience slightly inaccurate results.')}_encode_text(N){if(N===null)return null;const[oe,...pe]=N.trim().split(this.languageRegex);if(pe.length===0)return super._encode_text(oe);if(pe.length===2){const[me,Ie]=pe;return this.supported_language_codes.includes(me)||console.warn(`Unsupported language code "${me}" detected, which may lead to unexpected behavior. Should be one of: ${JSON.stringify(this.supported_language_codes)}`),(0,i.mergeArrays)([me],super._encode_text(Ie))}}}class Ya extends Ft{}class st extends Ft{}class lt extends Ft{}class Et extends Ft{}class xn extends Ft{}class Gr extends Ft{constructor(N,oe){super(N,oe),this.decoder=new Ht({})}}class Ca extends Ft{}class Js extends Ft{}class ao{static TOKENIZER_CLASS_MAPPING={T5Tokenizer:ut,DistilBertTokenizer:le,CamembertTokenizer:fe,DebertaTokenizer:qt,DebertaV2Tokenizer:Zs,BertTokenizer:Fn,HerbertTokenizer:F,ConvBertTokenizer:ue,RoFormerTokenizer:ne,XLMTokenizer:xe,ElectraTokenizer:Ne,MobileBertTokenizer:Us,SqueezeBertTokenizer:Ua,AlbertTokenizer:Ys,GPT2Tokenizer:xt,BartTokenizer:ht,MBartTokenizer:Rt,MBart50Tokenizer:_t,RobertaTokenizer:Zt,WhisperTokenizer:Vr,CodeGenTokenizer:$s,CLIPTokenizer:Ds,SiglipTokenizer:Ha,MarianTokenizer:_a,BloomTokenizer:nn,NllbTokenizer:us,M2M100Tokenizer:ks,LlamaTokenizer:ra,CodeLlamaTokenizer:Nn,XLMRobertaTokenizer:ia,MPNetTokenizer:gs,FalconTokenizer:Ma,GPTNeoXTokenizer:Hn,EsmTokenizer:Va,Wav2Vec2CTCTokenizer:Ya,BlenderbotTokenizer:st,BlenderbotSmallTokenizer:lt,SpeechT5Tokenizer:Et,NougatTokenizer:xn,VitsTokenizer:Gr,Qwen2Tokenizer:Ga,GemmaTokenizer:Wa,Grok1Tokenizer:Zn,CohereTokenizer:Ca,MgpstrTokenizer:Js,PreTrainedTokenizer:Ft};static async from_pretrained(N,{progress_callback:oe=null,config:pe=null,cache_dir:me=null,local_files_only:Ie=!1,revision:qe="main",legacy:vt=null}={}){const[gt,bt]=await _(N,{progress_callback:oe,config:pe,cache_dir:me,local_files_only:Ie,revision:qe,legacy:vt}),pt=bt.tokenizer_class?.replace(/Fast$/,"")??"PreTrainedTokenizer";let Xt=this.TOKENIZER_CLASS_MAPPING[pt];return Xt||(console.warn(`Unknown tokenizer class "${pt}", attempting to construct from base class.`),Xt=Ft),new Xt(gt,bt)}}}),"./src/utils/audio.js":((e,n,t)=>{t.r(n),t.d(n,{RawAudio:()=>Z,hamming:()=>p,hanning:()=>_,mel_filter_bank:()=>$,read_audio:()=>f,spectrogram:()=>I,window_function:()=>W});var s=t("./src/utils/hub.js"),i=t("./src/utils/maths.js"),l=t("./src/utils/core.js"),c=t("./src/env.js"),u=t("./src/utils/tensor.js"),d=t("?7992");async function f(X,Q){if(typeof AudioContext>"u")throw Error("Unable to load audio from path/URL since `AudioContext` is not available in your environment. Instead, audio data should be passed directly to the pipeline/processor. For more information and some example code, see https://huggingface.co/docs/transformers.js/guides/node-audio-processing.");const te=await(await(0,s.getFile)(X)).arrayBuffer(),R=new AudioContext({sampleRate:Q});typeof Q>"u"&&console.warn(`No sampling rate provided, using default of ${R.sampleRate}Hz.`);const ee=await R.decodeAudioData(te);let ie;if(ee.numberOfChannels===2){const he=Math.sqrt(2),_e=ee.getChannelData(0),U=ee.getChannelData(1);ie=new Float32Array(_e.length);for(let K=0;K<ee.length;++K)ie[K]=he*(_e[K]+U[K])/2}else ie=ee.getChannelData(0);return ie}function m(X,Q){if(X<1)return new Float64Array;if(X===1)return new Float64Array([1]);const te=1-Q,R=2*Math.PI/(X-1),ee=new Float64Array(X);for(let ie=0;ie<X;++ie)ee[ie]=Q-te*Math.cos(ie*R);return ee}function _(X){return m(X,.5)}function p(X){return m(X,.54)}const y={htk:X=>2595*Math.log10(1+X/700),kaldi:X=>1127*Math.log(1+X/700),slaney:(X,Q=1e3,te=15,R=27/Math.log(6.4))=>X>=Q?te+Math.log(X/Q)*R:3*X/200};function v(X,Q="htk"){const te=y[Q];if(!te)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof X=="number"?te(X):X.map(R=>te(R))}const T={htk:X=>700*(10**(X/2595)-1),kaldi:X=>700*(Math.exp(X/1127)-1),slaney:(X,Q=1e3,te=15,R=Math.log(6.4)/27)=>X>=te?Q*Math.exp(R*(X-te)):200*X/3};function k(X,Q="htk"){const te=T[Q];if(!te)throw new Error('mel_scale should be one of "htk", "slaney" or "kaldi".');return typeof X=="number"?te(X):X.map(R=>te(R))}function b(X,Q){const te=Float64Array.from({length:Q.length-1},(he,_e)=>Q[_e+1]-Q[_e]),R=Array.from({length:X.length},()=>new Array(Q.length));for(let he=0;he<X.length;++he){const _e=R[he];for(let U=0;U<Q.length;++U)_e[U]=Q[U]-X[he]}const ee=Q.length-2,ie=Array.from({length:ee},()=>new Array(X.length));for(let he=0;he<X.length;++he){const _e=R[he];for(let U=0;U<ee;++U){const K=-_e[U]/te[U],H=_e[U+2]/te[U+1];ie[U][he]=Math.max(0,Math.min(K,H))}}return ie}function S(X,Q,te){const R=(Q-X)/(te-1);return Float64Array.from({length:te},(ee,ie)=>X+R*ie)}function $(X,Q,te,R,ee,ie=null,he="htk",_e=!1){if(ie!==null&&ie!=="slaney")throw new Error('norm must be one of null or "slaney"');if(X<2)throw new Error(`Require num_frequency_bins: ${X} >= 2`);if(te>R)throw new Error(`Require min_frequency: ${te} <= max_frequency: ${R}`);const U=v(te,he),K=v(R,he),H=S(U,K,Q+2);let B=k(H,he),ce;if(_e){const Pe=ee/((X-1)*2);ce=v(Float64Array.from({length:X},(ze,Ze)=>Ze*Pe),he),B=H}else ce=S(0,Math.floor(ee/2),X);const ve=b(ce,B);if(ie!==null&&ie==="slaney")for(let Pe=0;Pe<Q;++Pe){const ze=ve[Pe],Ze=2/(B[Pe+2]-B[Pe]);for(let Re=0;Re<X;++Re)ze[Re]*=Ze}return ve}function w(X,Q,te){const R=new X.constructor(X.length+Q+te),ee=X.length-1;for(let ie=0;ie<X.length;++ie)R[Q+ie]=X[ie];for(let ie=1;ie<=Q;++ie)R[Q-ie]=X[(0,l.calculateReflectOffset)(ie,ee)];for(let ie=1;ie<=te;++ie)R[ee+Q+ie]=X[(0,l.calculateReflectOffset)(ee-ie,ee)];return R}function C(X,Q,te,R,ee){if(te<=0)throw new Error("reference must be greater than zero");if(R<=0)throw new Error("min_value must be greater than zero");te=Math.max(R,te);const ie=Math.log10(te);for(let he=0;he<X.length;++he)X[he]=Q*Math.log10(Math.max(R,X[he])-ie);if(ee!==null){if(ee<=0)throw new Error("db_range must be greater than zero");const he=(0,i.max)(X)[0]-ee;for(let _e=0;_e<X.length;++_e)X[_e]=Math.max(X[_e],he)}return X}function P(X,Q=1,te=1e-5,R=null){return C(X,20,Q,te,R)}function A(X,Q=1,te=1e-10,R=null){return C(X,10,Q,te,R)}async function I(X,Q,te,R,{fft_length:ee=null,power:ie=1,center:he=!0,pad_mode:_e="reflect",onesided:U=!0,preemphasis:K=null,preemphasis_htk_flavor:H=!0,mel_filters:B=null,mel_floor:ce=1e-10,log_mel:ve=null,reference:Pe=1,min_value:ze=1e-10,db_range:Ze=null,remove_dc_offset:Re=null,min_num_frames:de=null,max_num_frames:J=null,do_pad:Ce=!0,transpose:Fe=!1,mel_offset:Be=0}={}){const Ue=Q.length;if(ee===null&&(ee=te),te>ee)throw Error(`frame_length (${te}) may not be larger than fft_length (${ee})`);if(Ue!==te)throw new Error(`Length of the window (${Ue}) must equal frame_length (${te})`);if(R<=0)throw new Error("hop_length must be greater than zero");if(ie===null&&B!==null)throw new Error("You have provided `mel_filters` but `power` is `None`. Mel spectrogram computation is not yet supported for complex-valued spectrogram. Specify `power` to fix this issue.");if(!H)throw new Error("`preemphasis_htk_flavor=false` is not currently supported.");if(he)switch(_e){case"reflect":{const ot=Math.floor((ee-1)/2)+1;X=w(X,ot,ot);break}case"constant":{const ot=Math.floor(ee/2),Je=new X.constructor(X.length+2*ot);Je.set(X,ot),X=Je;break}default:throw new Error(`pad_mode="${_e}" not implemented yet.`)}let He=Math.floor(1+Math.floor((X.length-te)/R));de!==null&&He<de&&(He=de);const De=U?Math.floor(ee/2)+1:ee;let nt=He,ke=He;J!==null&&(J>He?Ce&&(ke=J):ke=nt=J);const Ge=new i.FFT(ee),dt=new Float64Array(ee),Ye=new Float64Array(Ge.outputBufferSize),mt=new Float32Array(De*ke);for(let ot=0;ot<nt;++ot){const Je=ot*R,St=Math.min(X.length-Je,te);St!==te&&dt.fill(0,0,te);for(let Lt=0;Lt<St;++Lt)dt[Lt]=X[Je+Lt];if(Re){let Lt=0;for(let Ht=0;Ht<St;++Ht)Lt+=dt[Ht];const wn=Lt/St;for(let Ht=0;Ht<St;++Ht)dt[Ht]-=wn}if(K!==null){for(let Lt=St-1;Lt>=1;--Lt)dt[Lt]-=K*dt[Lt-1];dt[0]*=1-K}for(let Lt=0;Lt<Q.length;++Lt)dt[Lt]*=Q[Lt];Ge.realTransform(Ye,dt);for(let Lt=0;Lt<De;++Lt){const wn=Lt<<1;mt[Lt*ke+ot]=Ye[wn]**2+Ye[wn+1]**2}}if(ie!==null&&ie!==2){const ot=ie/2;for(let Je=0;Je<mt.length;++Je)mt[Je]**=ot}const it=B.length;let Mt=await(0,u.matmul)(new u.Tensor("float32",B.flat(),[it,De]),new u.Tensor("float32",mt,[De,ke]));Fe&&(Mt=Mt.transpose(1,0));const wt=Mt.data;for(let ot=0;ot<wt.length;++ot)wt[ot]=Be+Math.max(ce,wt[ot]);if(ie!==null&&ve!==null){const ot=Math.min(wt.length,nt*it);switch(ve){case"log":for(let Je=0;Je<ot;++Je)wt[Je]=Math.log(wt[Je]);break;case"log10":for(let Je=0;Je<ot;++Je)wt[Je]=Math.log10(wt[Je]);break;case"dB":if(ie===1)P(wt,Pe,ze,Ze);else if(ie===2)A(wt,Pe,ze,Ze);else throw new Error(`Cannot use log_mel option '${ve}' with power ${ie}`);break;default:throw new Error(`log_mel must be one of null, 'log', 'log10' or 'dB'. Got '${ve}'`)}}return Mt}function W(X,Q,{periodic:te=!0,frame_length:R=null,center:ee=!0}={}){const ie=te?X+1:X;let he;switch(Q){case"boxcar":he=new Float64Array(ie).fill(1);break;case"hann":case"hann_window":he=_(ie);break;case"hamming":he=p(ie);break;case"povey":he=_(ie).map(_e=>Math.pow(_e,.85));break;default:throw new Error(`Unknown window type ${Q}.`)}if(te&&(he=he.subarray(0,X)),R===null)return he;if(X>R)throw new Error(`Length of the window (${X}) may not be larger than frame_length (${R})`);return he}function G(X,Q){let te=44;const R=new ArrayBuffer(te+X.length*4),ee=new DataView(R);q(ee,0,"RIFF"),ee.setUint32(4,36+X.length*4,!0),q(ee,8,"WAVE"),q(ee,12,"fmt "),ee.setUint32(16,16,!0),ee.setUint16(20,3,!0),ee.setUint16(22,1,!0),ee.setUint32(24,Q,!0),ee.setUint32(28,Q*4,!0),ee.setUint16(32,4,!0),ee.setUint16(34,32,!0),q(ee,36,"data"),ee.setUint32(40,X.length*4,!0);for(let ie=0;ie<X.length;++ie,te+=4)ee.setFloat32(te,X[ie],!0);return R}function q(X,Q,te){for(let R=0;R<te.length;++R)X.setUint8(Q+R,te.charCodeAt(R))}class Z{constructor(Q,te){this.audio=Q,this.sampling_rate=te}toWav(){return G(this.audio,this.sampling_rate)}toBlob(){const Q=this.toWav();return new Blob([Q],{type:"audio/wav"})}async save(Q){let te;if(c.apis.IS_BROWSER_ENV){if(c.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save a file from a Web Worker.");te=l.saveBlob}else if(c.apis.IS_FS_AVAILABLE)te=async(R,ee)=>{let ie=await ee.arrayBuffer();d.writeFileSync(R,Buffer.from(ie))};else throw new Error("Unable to save because filesystem is disabled in this environment.");await te(Q,this.toBlob())}}}),"./src/utils/constants.js":((e,n,t)=>{t.r(n),t.d(n,{CHAT_TEMPLATE_NAME:()=>d,CONFIG_NAME:()=>i,FEATURE_EXTRACTOR_NAME:()=>l,GENERATION_CONFIG_NAME:()=>f,GITHUB_ISSUE_URL:()=>s,IMAGE_PROCESSOR_NAME:()=>c,PROCESSOR_NAME:()=>u});const s="https://github.com/huggingface/transformers.js/issues/new/choose",i="config.json",l="preprocessor_config.json",c=l,u="processor_config.json",d="chat_template.jinja",f="generation_config.json"}),"./src/utils/core.js":((e,n,t)=>{t.r(n),t.d(n,{calculateDimensions:()=>f,calculateReflectOffset:()=>y,count:()=>b,dispatchCallback:()=>s,escapeRegExp:()=>l,isIntegralNumber:()=>u,isNullishDimension:()=>d,isTypedArray:()=>c,len:()=>k,mergeArrays:()=>_,pick:()=>T,pop:()=>m,product:()=>p,reverseDictionary:()=>i,saveBlob:()=>v});function s(S,$){S&&S($)}function i(S){return Object.fromEntries(Object.entries(S).map(([$,w])=>[w,$]))}function l(S){return S.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function c(S){return S?.prototype?.__proto__?.constructor?.name==="TypedArray"}function u(S){return Number.isInteger(S)||typeof S=="bigint"}function d(S){return S==null||S===-1}function f(S){const $=[];let w=S;for(;Array.isArray(w);)$.push(w.length),w=w[0];return $}function m(S,$,w=void 0){const C=S[$];if(C!==void 0)return delete S[$],C;if(w===void 0)throw Error(`Key ${$} does not exist in object.`);return w}function _(...S){return Array.prototype.concat.apply([],S)}function p(...S){return S.reduce(($,w)=>$.flatMap(C=>w.map(P=>[C,P])))}function y(S,$){return Math.abs((S+$)%(2*$)-$)}function v(S,$){const w=URL.createObjectURL($),C=document.createElement("a");C.href=w,C.download=S,C.click(),C.remove(),URL.revokeObjectURL(w)}function T(S,$){return Object.assign({},...$.map(w=>{if(S[w]!==void 0)return{[w]:S[w]}}))}function k(S){let $=0;for(const w of S)++$;return $}function b(S,$){let w=0;for(const C of S)C===$&&++w;return w}}),"./src/utils/data-structures.js":((e,n,t)=>{t.r(n),t.d(n,{CharTrie:()=>i,DictionarySplitter:()=>d,LRUCache:()=>f,PriorityQueue:()=>s,TokenLattice:()=>c});class s{constructor(_=(y,v)=>y>v,p=1/0){this._heap=[],this._comparator=_,this._maxSize=p}get size(){return this._heap.length}isEmpty(){return this.size===0}peek(){return this._heap[0]}push(..._){return this.extend(_)}extend(_){for(const p of _)if(this.size<this._maxSize)this._heap.push(p),this._siftUp();else{const y=this._smallest();this._comparator(p,this._heap[y])&&(this._heap[y]=p,this._siftUpFrom(y))}return this.size}pop(){const _=this.peek(),p=this.size-1;return p>0&&this._swap(0,p),this._heap.pop(),this._siftDown(),_}replace(_){const p=this.peek();return this._heap[0]=_,this._siftDown(),p}_parent(_){return(_+1>>>1)-1}_left(_){return(_<<1)+1}_right(_){return _+1<<1}_greater(_,p){return this._comparator(this._heap[_],this._heap[p])}_swap(_,p){const y=this._heap[_];this._heap[_]=this._heap[p],this._heap[p]=y}_siftUp(){this._siftUpFrom(this.size-1)}_siftUpFrom(_){for(;_>0&&this._greater(_,this._parent(_));)this._swap(_,this._parent(_)),_=this._parent(_)}_siftDown(){let _=0;for(;this._left(_)<this.size&&this._greater(this._left(_),_)||this._right(_)<this.size&&this._greater(this._right(_),_);){const p=this._right(_)<this.size&&this._greater(this._right(_),this._left(_))?this._right(_):this._left(_);this._swap(_,p),_=p}}_smallest(){return 2**Math.floor(Math.log2(this.size))-1}}class i{constructor(){this.root=l.default()}extend(_){for(const p of _)this.push(p)}push(_){let p=this.root;for(const y of _){let v=p.children.get(y);v===void 0&&(v=l.default(),p.children.set(y,v)),p=v}p.isLeaf=!0}*commonPrefixSearch(_){let p=this.root;if(p===void 0)return;let y="";for(const v of _){if(y+=v,p=p.children.get(v),p===void 0)return;p.isLeaf&&(yield y)}}}class l{constructor(_,p){this.isLeaf=_,this.children=p}static default(){return new l(!1,new Map)}}class c{constructor(_,p,y){this.chars=Array.from(_),this.len=this.chars.length,this.bosTokenId=p,this.eosTokenId=y,this.nodes=[],this.beginNodes=Array.from({length:this.len+1},()=>[]),this.endNodes=Array.from({length:this.len+1},()=>[]);const v=new u(this.bosTokenId,0,0,0,0),T=new u(this.eosTokenId,1,this.len,0,0);this.nodes.push(v.clone()),this.nodes.push(T.clone()),this.beginNodes[this.len].push(T),this.endNodes[0].push(v)}insert(_,p,y,v){const T=this.nodes.length,k=new u(v,T,_,p,y);this.beginNodes[_].push(k),this.endNodes[_+p].push(k),this.nodes.push(k)}viterbi(){const _=this.len;let p=0;for(;p<=_;){if(this.beginNodes[p].length==0)return[];for(let b of this.beginNodes[p]){b.prev=null;let S=0,$=null;for(let w of this.endNodes[p]){const C=w.backtraceScore+b.score;($===null||C>S)&&($=w.clone(),S=C)}if($!==null)b.prev=$,b.backtraceScore=S;else return[]}++p}const y=[],T=this.beginNodes[_][0].prev;if(T===null)return[];let k=T.clone();for(;k.prev!==null;)y.push(k.clone()),k=k.clone().prev.clone();return y.reverse(),y}piece(_){return this.chars.slice(_.pos,_.pos+_.length).join("")}tokens(){return this.viterbi().map(p=>this.piece(p))}tokenIds(){return this.viterbi().map(p=>p.tokenId)}}class u{constructor(_,p,y,v,T){this.tokenId=_,this.nodeId=p,this.pos=y,this.length=v,this.score=T,this.prev=null,this.backtraceScore=0}clone(){const _=new u(this.tokenId,this.nodeId,this.pos,this.length,this.score);return _.prev=this.prev,_.backtraceScore=this.backtraceScore,_}}class d{constructor(_){this.trie=this._buildTrie(_)}_buildTrie(_){const p=Object.create(null);for(const y of _){let v=p;for(let T=0;T<y.length;++T)v=v[y[T]]??=Object.create(null);v.end=y}return p}split(_){const p=[],y=_.length;let v=0,T=0;for(;T<y;){let k=this.trie,b=null,S=T;for(;S<y&&(k=k[_[S]]);)k.end&&(b=k.end),++S;b?(T>v&&p.push(_.slice(v,T)),p.push(b),T+=b.length,v=T):++T}return v<y&&p.push(_.slice(v)),p}}class f{constructor(_){this.capacity=_,this.cache=new Map}get(_){if(!this.cache.has(_))return;const p=this.cache.get(_);return this.cache.delete(_),this.cache.set(_,p),p}put(_,p){this.cache.has(_)&&this.cache.delete(_),this.cache.set(_,p),this.cache.size>this.capacity&&this.cache.delete(this.cache.keys().next().value)}clear(){this.cache.clear()}}}),"./src/utils/devices.js":((e,n,t)=>{t.r(n),t.d(n,{DEVICE_TYPES:()=>s});const s=Object.freeze({auto:"auto",gpu:"gpu",cpu:"cpu",wasm:"wasm",webgpu:"webgpu",cuda:"cuda",dml:"dml",webnn:"webnn","webnn-npu":"webnn-npu","webnn-gpu":"webnn-gpu","webnn-cpu":"webnn-cpu"})}),"./src/utils/dtypes.js":((e,n,t)=>{t.r(n),t.d(n,{DATA_TYPES:()=>c,DEFAULT_DEVICE_DTYPE_MAPPING:()=>u,DEFAULT_DTYPE_SUFFIX_MAPPING:()=>d,isWebGpuFp16Supported:()=>l});var s=t("./src/env.js"),i=t("./src/utils/devices.js");const l=(function(){let f;return async function(){if(f===void 0)if(!s.apis.IS_WEBGPU_AVAILABLE)f=!1;else try{f=(await navigator.gpu.requestAdapter()).features.has("shader-f16")}catch{f=!1}return f}})(),c=Object.freeze({auto:"auto",fp32:"fp32",fp16:"fp16",q8:"q8",int8:"int8",uint8:"uint8",q4:"q4",bnb4:"bnb4",q4f16:"q4f16"}),u=Object.freeze({[i.DEVICE_TYPES.wasm]:c.q8}),d=Object.freeze({[c.fp32]:"",[c.fp16]:"_fp16",[c.int8]:"_int8",[c.uint8]:"_uint8",[c.q8]:"_quantized",[c.q4]:"_q4",[c.q4f16]:"_q4f16",[c.bnb4]:"_bnb4"})}),"./src/utils/generic.js":((e,n,t)=>{t.r(n),t.d(n,{Callable:()=>s});const s=class{constructor(){let i=function(...l){return i._call(...l)};return Object.setPrototypeOf(i,new.target.prototype)}_call(...i){throw Error("Must implement _call method in subclass")}}}),"./src/utils/hub.js":((e,n,t)=>{t.r(n),t.d(n,{MAX_EXTERNAL_DATA_CHUNKS:()=>u,getFile:()=>y,getModelFile:()=>S,getModelJSON:()=>w,getModelText:()=>$});var s=t("?7992"),i=t("?5af5"),l=t("./src/env.js"),c=t("./src/utils/core.js");const u=100,d={txt:"text/plain",html:"text/html",css:"text/css",js:"text/javascript",json:"application/json",png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif"};class f{constructor(I){if(this.filePath=I,this.headers=new Headers,this.exists=s.existsSync(I),this.exists){this.status=200,this.statusText="OK";let W=s.statSync(I);this.headers.set("content-length",W.size.toString()),this.updateContentType();const G=s.createReadStream(I);this.body=new ReadableStream({start(q){G.on("data",Z=>q.enqueue(Z)),G.on("end",()=>q.close()),G.on("error",Z=>q.error(Z))},cancel(){G.destroy()}})}else this.status=404,this.statusText="Not Found",this.body=null}updateContentType(){const I=this.filePath.toString().split(".").pop().toLowerCase();this.headers.set("content-type",d[I]??"application/octet-stream")}clone(){let I=new f(this.filePath);return I.exists=this.exists,I.status=this.status,I.statusText=this.statusText,I.headers=new Headers(this.headers),I}async arrayBuffer(){return(await s.promises.readFile(this.filePath)).buffer}async blob(){const I=await s.promises.readFile(this.filePath);return new Blob([I],{type:this.headers.get("content-type")})}async text(){return await s.promises.readFile(this.filePath,"utf8")}async json(){return JSON.parse(await this.text())}}function m(A,I=null,W=null){let G;try{G=new URL(A)}catch{return!1}return!(I&&!I.includes(G.protocol)||W&&!W.includes(G.hostname))}const _=/^(\b[\w\-.]+\b\/)?\b[\w\-.]{1,96}\b$/;function p(A){return!(!_.test(A)||A.includes("..")||A.includes("--")||A.endsWith(".git")||A.endsWith(".ipynb"))}async function y(A){if(l.env.useFS&&!m(A,["http:","https:","blob:"]))return new f(A instanceof URL?A.protocol==="file:"?A.pathname:A.toString():A);if(typeof process<"u"&&process?.release?.name==="node"){const I=!!t0?.TESTING_REMOTELY,W=l.env.version,G=new Headers;if(G.set("User-Agent",`transformers.js/${W}; is_ci/${I};`),m(A,["http:","https:"],["huggingface.co","hf.co"])){const Z=t0?.HF_TOKEN??t0?.HF_ACCESS_TOKEN;Z&&G.set("Authorization",`Bearer ${Z}`)}return fetch(A,{headers:G})}else return fetch(A)}const v={400:"Bad request error occurred while trying to load file",401:"Unauthorized access to file",403:"Forbidden access to file",404:"Could not locate file",408:"Request timeout error occurred while trying to load file",500:"Internal server error error occurred while trying to load file",502:"Bad gateway error occurred while trying to load file",503:"Service unavailable error occurred while trying to load file",504:"Gateway timeout error occurred while trying to load file"};function T(A,I,W){if(!W)return null;const G=v[A]??`Error (${A}) occurred while trying to load file`;throw Error(`${G}: "${I}".`)}class k{constructor(I){this.path=I}async match(I){let W=i.join(this.path,I),G=new f(W);if(G.exists)return G}async put(I,W,G=void 0){let q=i.join(this.path,I);try{const Z=W.headers.get("Content-Length"),X=parseInt(Z??"0");let Q=0;await s.promises.mkdir(i.dirname(q),{recursive:!0});const te=s.createWriteStream(q),R=W.body.getReader();for(;;){const{done:ee,value:ie}=await R.read();if(ee)break;await new Promise((_e,U)=>{te.write(ie,K=>{if(K){U(K);return}_e()})}),Q+=ie.length;const he=X?Q/X*100:0;G?.({progress:he,loaded:Q,total:X})}te.close()}catch(Z){try{await s.promises.unlink(q)}catch{}throw Z}}}async function b(A,...I){for(let W of I)try{let G=await A.match(W);if(G)return G}catch{continue}}async function S(A,I,W=!0,G={},q=!1){if(!l.env.allowLocalModels){if(G.local_files_only)throw Error("Invalid configuration detected: local models are disabled (`env.allowLocalModels=false`) but you have requested to only use local models (`local_files_only=true`).");if(!l.env.allowRemoteModels)throw Error("Invalid configuration detected: both local and remote models are disabled. Fix by setting `env.allowLocalModels` or `env.allowRemoteModels` to `true`.")}(0,c.dispatchCallback)(G.progress_callback,{status:"initiate",name:A,file:I});let Z;if(!Z&&l.env.useCustomCache){if(!l.env.customCache)throw Error("`env.useCustomCache=true`, but `env.customCache` is not defined.");if(!l.env.customCache.match||!l.env.customCache.put)throw new Error("`env.customCache` must be an object which implements the `match` and `put` functions of the Web Cache API. For more information, see https://developer.mozilla.org/en-US/docs/Web/API/Cache");Z=l.env.customCache}if(!Z&&l.env.useBrowserCache){if(typeof caches>"u")throw Error("Browser cache is not available in this environment.");try{Z=await caches.open("transformers-cache")}catch(ce){console.warn("An error occurred while opening the browser cache:",ce)}}if(!Z&&l.env.useFSCache){if(!l.apis.IS_FS_AVAILABLE)throw Error("File System Cache is not available in this environment.");Z=new k(G.cache_dir??l.env.cacheDir)}const X=G.revision??"main",Q=P(A,I),te=p(A),R=te?P(l.env.localModelPath,Q):Q,ee=P(l.env.remoteHost,l.env.remotePathTemplate.replaceAll("{model}",A).replaceAll("{revision}",encodeURIComponent(X)),I);let ie;const he=Z instanceof k?X==="main"?Q:P(A,X,I):ee;let _e=!1,U;Z&&(U=await b(Z,R,he));const K=U!==void 0;if(U===void 0){if(l.env.allowLocalModels)if(m(Q,["http:","https:"])){if(G.local_files_only)throw new Error(`\`local_files_only=true\`, but attempted to load a remote file from: ${Q}.`);if(!l.env.allowRemoteModels)throw new Error(`\`env.allowRemoteModels=false\`, but attempted to load a remote file from: ${Q}.`)}else try{U=await y(R),ie=R}catch(ve){console.warn(`Unable to load from local path "${R}": "${ve}"`)}if(U===void 0||U.status===404){if(G.local_files_only||!l.env.allowRemoteModels){if(W)throw Error(`\`local_files_only=true\` or \`env.allowRemoteModels=false\` and file was not found locally at "${R}".`);return null}if(!te)throw Error(`Local file missing at "${R}" and download aborted due to invalid model ID "${A}".`);if(U=await y(ee),U.status!==200)return T(U.status,ee,W);ie=he}_e=Z&&typeof Response<"u"&&U instanceof Response&&U.status===200}(0,c.dispatchCallback)(G.progress_callback,{status:"download",name:A,file:I});let H;if(!(l.apis.IS_NODE_ENV&&q)){let ce;G.progress_callback?K&&typeof navigator<"u"&&/firefox/i.test(navigator.userAgent)?(ce=new Uint8Array(await U.arrayBuffer()),(0,c.dispatchCallback)(G.progress_callback,{status:"progress",name:A,file:I,progress:100,loaded:ce.length,total:ce.length})):ce=await C(U,ve=>{(0,c.dispatchCallback)(G.progress_callback,{status:"progress",name:A,file:I,...ve})}):ce=new Uint8Array(await U.arrayBuffer()),H=ce}if(_e&&ie&&await Z.match(ie)===void 0)if(H)await Z.put(ie,new Response(H,{headers:U.headers})).catch(ce=>{console.warn(`Unable to add response to browser cache: ${ce}.`)});else{const ce=G.progress_callback?ve=>(0,c.dispatchCallback)(G.progress_callback,{status:"progress",name:A,file:I,...ve}):void 0;await Z.put(ie,U,ce)}if((0,c.dispatchCallback)(G.progress_callback,{status:"done",name:A,file:I}),H){if(!l.apis.IS_NODE_ENV&&q)throw new Error("Cannot return path in a browser environment.");return H}if(U instanceof f)return U.filePath;const B=await Z?.match(ie);if(B instanceof f)return B.filePath;if(B instanceof Response)return new Uint8Array(await B.arrayBuffer());if(typeof B=="string")return B;throw new Error("Unable to get model file path or buffer.")}async function $(A,I,W=!0,G={}){const q=await S(A,I,W,G,!1);return q===null?null:new TextDecoder("utf-8").decode(q)}async function w(A,I,W=!0,G={}){const q=await $(A,I,W,G);return q===null?{}:JSON.parse(q)}async function C(A,I){const W=A.headers.get("Content-Length");W===null&&console.warn("Unable to determine content-length from response headers. Will expand buffer when needed.");let G=parseInt(W??"0"),q=new Uint8Array(G),Z=0;const X=A.body.getReader();async function Q(){const{done:te,value:R}=await X.read();if(te)return;const ee=Z+R.length;if(ee>G){G=ee;const he=new Uint8Array(G);he.set(q),q=he}q.set(R,Z),Z=ee;const ie=Z/G*100;return I({progress:ie,loaded:Z,total:G}),Q()}return await Q(),q}function P(...A){return A=A.map((I,W)=>(W&&(I=I.replace(new RegExp("^/"),"")),W!==A.length-1&&(I=I.replace(new RegExp("/$"),"")),I)),A.join("/")}}),"./src/utils/image.js":((e,n,t)=>{t.r(n),t.d(n,{RawImage:()=>v,load_image:()=>T});var s=t("./src/utils/core.js"),i=t("./src/utils/hub.js"),l=t("./src/env.js"),c=t("./src/utils/tensor.js"),u=t("?2b25");let d,f,m;const _=l.apis.IS_BROWSER_ENV||l.apis.IS_WEBWORKER_ENV;if(_)d=(k,b)=>{if(!self.OffscreenCanvas)throw new Error("OffscreenCanvas not supported by this browser.");return new self.OffscreenCanvas(k,b)},m=self.createImageBitmap,f=self.ImageData;else if(u)m=async k=>{const S=(await k.metadata()).channels,{data:$,info:w}=await k.rotate().raw().toBuffer({resolveWithObject:!0}),C=new v(new Uint8ClampedArray($),w.width,w.height,w.channels);return S!==void 0&&S!==w.channels&&C.convert(S),C};else throw new Error("Unable to load image processing library.");const p={0:"nearest",1:"lanczos",2:"bilinear",3:"bicubic",4:"box",5:"hamming"},y=new Map([["png","image/png"],["jpg","image/jpeg"],["jpeg","image/jpeg"],["gif","image/gif"]]);class v{constructor(b,S,$,w){this.data=b,this.width=S,this.height=$,this.channels=w}get size(){return[this.width,this.height]}static async read(b){if(b instanceof v)return b;if(typeof b=="string"||b instanceof URL)return await this.fromURL(b);if(b instanceof Blob)return await this.fromBlob(b);if(typeof HTMLCanvasElement<"u"&&b instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&b instanceof OffscreenCanvas)return this.fromCanvas(b);throw new Error(`Unsupported input type: ${typeof b}`)}static fromCanvas(b){if(!_)throw new Error("fromCanvas() is only supported in browser environments.");const $=b.getContext("2d").getImageData(0,0,b.width,b.height).data;return new v($,b.width,b.height,4)}static async fromURL(b){const S=await(0,i.getFile)(b);if(S.status!==200)throw new Error(`Unable to read image from "${b}" (${S.status} ${S.statusText})`);const $=await S.blob();return this.fromBlob($)}static async fromBlob(b){if(_){const S=await m(b),$=d(S.width,S.height).getContext("2d");return $.drawImage(S,0,0),new this($.getImageData(0,0,S.width,S.height).data,S.width,S.height,4)}else{const S=u(await b.arrayBuffer());return await m(S)}}static fromTensor(b,S="CHW"){if(b.dims.length!==3)throw new Error(`Tensor should have 3 dimensions, but has ${b.dims.length} dimensions.`);if(S==="CHW")b=b.transpose(1,2,0);else if(S!=="HWC")throw new Error(`Unsupported channel format: ${S}`);if(!(b.data instanceof Uint8ClampedArray||b.data instanceof Uint8Array))throw new Error(`Unsupported tensor type: ${b.type}`);switch(b.dims[2]){case 1:case 2:case 3:case 4:return new v(b.data,b.dims[1],b.dims[0],b.dims[2]);default:throw new Error(`Unsupported number of channels: ${b.dims[2]}`)}}grayscale(){if(this.channels===1)return this;const b=new Uint8ClampedArray(this.width*this.height*1);switch(this.channels){case 3:case 4:for(let S=0,$=0;S<this.data.length;S+=this.channels){const w=this.data[S],C=this.data[S+1],P=this.data[S+2];b[$++]=Math.round(.2989*w+.587*C+.114*P)}break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(b,this.width,this.height,1)}rgb(){if(this.channels===3)return this;const b=new Uint8ClampedArray(this.width*this.height*3);switch(this.channels){case 1:for(let S=0,$=0;S<this.data.length;++S)b[$++]=this.data[S],b[$++]=this.data[S],b[$++]=this.data[S];break;case 4:for(let S=0,$=0;S<this.data.length;S+=4)b[$++]=this.data[S],b[$++]=this.data[S+1],b[$++]=this.data[S+2];break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(b,this.width,this.height,3)}rgba(){if(this.channels===4)return this;const b=new Uint8ClampedArray(this.width*this.height*4);switch(this.channels){case 1:for(let S=0,$=0;S<this.data.length;++S)b[$++]=this.data[S],b[$++]=this.data[S],b[$++]=this.data[S],b[$++]=255;break;case 3:for(let S=0,$=0;S<this.data.length;S+=3)b[$++]=this.data[S],b[$++]=this.data[S+1],b[$++]=this.data[S+2],b[$++]=255;break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this._update(b,this.width,this.height,4)}putAlpha(b){if(b.width!==this.width||b.height!==this.height)throw new Error(`Expected mask size to be ${this.width}x${this.height}, but got ${b.width}x${b.height}`);if(b.channels!==1)throw new Error(`Expected mask to have 1 channel, but got ${b.channels}`);const S=this.data,$=b.data,w=this.width*this.height;if(this.channels===3){const C=new Uint8ClampedArray(w*4);for(let P=0,A=0,I=0;P<w;++P)C[I++]=S[A++],C[I++]=S[A++],C[I++]=S[A++],C[I++]=$[P];return this._update(C,this.width,this.height,4)}else if(this.channels===4){for(let C=0;C<w;++C)S[4*C+3]=$[C];return this}throw new Error(`Expected image to have 3 or 4 channels, but got ${this.channels}`)}async resize(b,S,{resample:$=2}={}){if(this.width===b&&this.height===S)return this;let w=p[$]??$;const C=(0,s.isNullishDimension)(b),P=(0,s.isNullishDimension)(S);if(C&&P)return this;if(C?b=S/this.height*this.width:P&&(S=b/this.width*this.height),_){const A=this.channels,I=this.toCanvas(),W=d(b,S).getContext("2d");return W.drawImage(I,0,0,b,S),new v(W.getImageData(0,0,b,S).data,b,S,4).convert(A)}else{let A=this.toSharp();switch(w){case"box":case"hamming":(w==="box"||w==="hamming")&&(console.warn(`Resampling method ${w} is not yet supported. Using bilinear instead.`),w="bilinear");case"nearest":case"bilinear":case"bicubic":A=A.affine([b/this.width,0,0,S/this.height],{interpolator:w});break;case"lanczos":A=A.resize({width:b,height:S,fit:"fill",kernel:"lanczos3"});break;default:throw new Error(`Resampling method ${w} is not supported.`)}return await m(A)}}async pad([b,S,$,w]){if(b=Math.max(b,0),S=Math.max(S,0),$=Math.max($,0),w=Math.max(w,0),b===0&&S===0&&$===0&&w===0)return this;if(_){const C=this.channels,P=this.toCanvas(),A=this.width+b+S,I=this.height+$+w,W=d(A,I).getContext("2d");return W.drawImage(P,0,0,this.width,this.height,b,$,this.width,this.height),new v(W.getImageData(0,0,A,I).data,A,I,4).convert(C)}else{const C=this.toSharp().extend({left:b,right:S,top:$,bottom:w});return await m(C)}}async crop([b,S,$,w]){if(b=Math.max(b,0),S=Math.max(S,0),$=Math.min($,this.width-1),w=Math.min(w,this.height-1),b===0&&S===0&&$===this.width-1&&w===this.height-1)return this;const C=$-b+1,P=w-S+1;if(_){const A=this.channels,I=this.toCanvas(),W=d(C,P).getContext("2d");return W.drawImage(I,b,S,C,P,0,0,C,P),new v(W.getImageData(0,0,C,P).data,C,P,4).convert(A)}else{const A=this.toSharp().extract({left:b,top:S,width:C,height:P});return await m(A)}}async center_crop(b,S){if(this.width===b&&this.height===S)return this;const $=(this.width-b)/2,w=(this.height-S)/2;if(_){const C=this.channels,P=this.toCanvas(),A=d(b,S).getContext("2d");let I=0,W=0,G=0,q=0;return $>=0?I=$:G=-$,w>=0?W=w:q=-w,A.drawImage(P,I,W,b,S,G,q,b,S),new v(A.getImageData(0,0,b,S).data,b,S,4).convert(C)}else{let C=this.toSharp();if($>=0&&w>=0)C=C.extract({left:Math.floor($),top:Math.floor(w),width:b,height:S});else if($<=0&&w<=0){const P=Math.floor(-w),A=Math.floor(-$);C=C.extend({top:P,left:A,right:b-this.width-A,bottom:S-this.height-P})}else{let P=[0,0],A=0;w<0?(P[0]=Math.floor(-w),P[1]=S-this.height-P[0]):A=Math.floor(w);let I=[0,0],W=0;$<0?(I[0]=Math.floor(-$),I[1]=b-this.width-I[0]):W=Math.floor($),C=C.extend({top:P[0],bottom:P[1],left:I[0],right:I[1]}).extract({left:W,top:A,width:b,height:S})}return await m(C)}}async toBlob(b="image/png",S=1){if(!_)throw new Error("toBlob() is only supported in browser environments.");return await this.toCanvas().convertToBlob({type:b,quality:S})}toTensor(b="CHW"){let S=new c.Tensor("uint8",new Uint8Array(this.data),[this.height,this.width,this.channels]);if(b!=="HWC")if(b==="CHW")S=S.permute(2,0,1);else throw new Error(`Unsupported channel format: ${b}`);return S}toCanvas(){if(!_)throw new Error("toCanvas() is only supported in browser environments.");const b=this.clone().rgba(),S=d(b.width,b.height),$=new f(b.data,b.width,b.height);return S.getContext("2d").putImageData($,0,0),S}split(){const{data:b,width:S,height:$,channels:w}=this,C=b.constructor,P=b.length/w,A=Array.from({length:w},()=>new C(P));for(let I=0;I<P;++I){const W=w*I;for(let G=0;G<w;++G)A[G][I]=b[W+G]}return A.map(I=>new v(I,S,$,1))}_update(b,S,$,w=null){return this.data=b,this.width=S,this.height=$,w!==null&&(this.channels=w),this}clone(){return new v(this.data.slice(),this.width,this.height,this.channels)}convert(b){if(this.channels===b)return this;switch(b){case 1:this.grayscale();break;case 3:this.rgb();break;case 4:this.rgba();break;default:throw new Error(`Conversion failed due to unsupported number of channels: ${this.channels}`)}return this}async save(b){if(_){if(l.apis.IS_WEBWORKER_ENV)throw new Error("Unable to save an image from a Web Worker.");const S=b.split(".").pop().toLowerCase(),$=y.get(S)??"image/png",w=await this.toBlob($);(0,s.saveBlob)(b,w)}else{if(l.apis.IS_FS_AVAILABLE)return await this.toSharp().toFile(b);throw new Error("Unable to save the image because filesystem is disabled in this environment.")}}toSharp(){if(_)throw new Error("toSharp() is only supported in server-side environments.");return u(this.data,{raw:{width:this.width,height:this.height,channels:this.channels}})}}const T=v.read.bind(v)}),"./src/utils/maths.js":((e,n,t)=>{t.r(n),t.d(n,{FFT:()=>T,bankers_round:()=>S,cos_sim:()=>d,dot:()=>u,dynamic_time_warping:()=>$,interpolate_data:()=>s,log_softmax:()=>c,magnitude:()=>f,max:()=>_,medianFilter:()=>k,min:()=>m,permute_data:()=>i,round:()=>b,softmax:()=>l});function s(w,[C,P,A],[I,W],G="bilinear",q=!1){const Z=W/A,X=I/P,Q=new w.constructor(I*W*C),te=P*A,R=I*W;for(let ee=0;ee<I;++ee)for(let ie=0;ie<W;++ie){const he=ee*W+ie,_e=(ie+.5)/Z-.5,U=(ee+.5)/X-.5;let K=Math.floor(_e),H=Math.floor(U);const B=Math.min(K+1,A-1),ce=Math.min(H+1,P-1);K=Math.max(K,0),H=Math.max(H,0);const ve=_e-K,Pe=U-H,ze=(1-ve)*(1-Pe),Ze=ve*(1-Pe),Re=(1-ve)*Pe,de=ve*Pe,J=H*A,Ce=ce*A,Fe=J+K,Be=J+B,Ue=Ce+K,He=Ce+B;for(let De=0;De<C;++De){const nt=De*te;Q[De*R+he]=ze*w[nt+Fe]+Ze*w[nt+Be]+Re*w[nt+Ue]+de*w[nt+He]}}return Q}function i(w,C,P){const A=new Array(P.length),I=new Array(P.length);for(let q=P.length-1,Z=1;q>=0;--q)I[q]=Z,A[q]=C[P[q]],Z*=A[q];const W=P.map((q,Z)=>I[P.indexOf(Z)]),G=new w.constructor(w.length);for(let q=0;q<w.length;++q){let Z=0;for(let X=C.length-1,Q=q;X>=0;--X)Z+=Q%C[X]*W[X],Q=Math.floor(Q/C[X]);G[Z]=w[q]}return[G,A]}function l(w){const C=_(w)[0],P=w.map(W=>Math.exp(W-C)),A=P.reduce((W,G)=>W+G,0);return P.map(W=>W/A)}function c(w){const C=_(w)[0];let P=0;for(let W=0;W<w.length;++W)P+=Math.exp(w[W]-C);const A=Math.log(P);return w.map(W=>W-C-A)}function u(w,C){let P=0;for(let A=0;A<w.length;++A)P+=w[A]*C[A];return P}function d(w,C){const P=u(w,C),A=f(w),I=f(C);return P/(A*I)}function f(w){return Math.sqrt(w.reduce((C,P)=>C+P*P,0))}function m(w){if(w.length===0)throw Error("Array must not be empty");let C=w[0],P=0;for(let A=1;A<w.length;++A)w[A]<C&&(C=w[A],P=A);return[C,P]}function _(w){if(w.length===0)throw Error("Array must not be empty");let C=w[0],P=0;for(let A=1;A<w.length;++A)w[A]>C&&(C=w[A],P=A);return[C,P]}function p(w){return w>0&&(w&w-1)===0}class y{constructor(C){if(this.size=C|0,this.size<=1||!p(this.size))throw new Error("FFT size must be a power of two larger than 1");this._csize=C<<1,this.table=new Float64Array(this.size*2);for(let A=0;A<this.table.length;A+=2){const I=Math.PI*A/this.size;this.table[A]=Math.cos(I),this.table[A+1]=-Math.sin(I)}let P=0;for(let A=1;this.size>A;A<<=1)++P;this._width=P%2===0?P-1:P,this._bitrev=new Int32Array(1<<this._width);for(let A=0;A<this._bitrev.length;++A){this._bitrev[A]=0;for(let I=0;I<this._width;I+=2){const W=this._width-I-2;this._bitrev[A]|=(A>>>I&3)<<W}}}createComplexArray(){return new Float64Array(this._csize)}fromComplexArray(C,P){const A=P||new Array(C.length>>>1);for(let I=0;I<C.length;I+=2)A[I>>>1]=C[I];return A}toComplexArray(C,P){const A=P||this.createComplexArray();for(let I=0;I<A.length;I+=2)A[I]=C[I>>>1],A[I+1]=0;return A}transform(C,P){if(C===P)throw new Error("Input and output buffers must be different");this._transform4(C,P,1)}realTransform(C,P){if(C===P)throw new Error("Input and output buffers must be different");this._realTransform4(C,P,1)}inverseTransform(C,P){if(C===P)throw new Error("Input and output buffers must be different");this._transform4(C,P,-1);for(let A=0;A<C.length;++A)C[A]/=this.size}_transform4(C,P,A){const I=this._csize;let G=1<<this._width,q=I/G<<1,Z,X;const Q=this._bitrev;if(q===4)for(Z=0,X=0;Z<I;Z+=q,++X){const R=Q[X];this._singleTransform2(P,C,Z,R,G)}else for(Z=0,X=0;Z<I;Z+=q,++X){const R=Q[X];this._singleTransform4(P,C,Z,R,G,A)}const te=this.table;for(G>>=2;G>=2;G>>=2){q=I/G<<1;const R=q>>>2;for(Z=0;Z<I;Z+=q){const ee=Z+R-1;for(let ie=Z,he=0;ie<ee;ie+=2,he+=G){const _e=ie,U=_e+R,K=U+R,H=K+R,B=C[_e],ce=C[_e+1],ve=C[U],Pe=C[U+1],ze=C[K],Ze=C[K+1],Re=C[H],de=C[H+1],J=te[he],Ce=A*te[he+1],Fe=ve*J-Pe*Ce,Be=ve*Ce+Pe*J,Ue=te[2*he],He=A*te[2*he+1],De=ze*Ue-Ze*He,nt=ze*He+Ze*Ue,ke=te[3*he],Ge=A*te[3*he+1],dt=Re*ke-de*Ge,Ye=Re*Ge+de*ke,mt=B+De,it=ce+nt,Mt=B-De,wt=ce-nt,ot=Fe+dt,Je=Be+Ye,St=A*(Fe-dt),Lt=A*(Be-Ye);C[_e]=mt+ot,C[_e+1]=it+Je,C[U]=Mt+Lt,C[U+1]=wt-St,C[K]=mt-ot,C[K+1]=it-Je,C[H]=Mt-Lt,C[H+1]=wt+St}}}}_singleTransform2(C,P,A,I,W){const G=C[I],q=C[I+1],Z=C[I+W],X=C[I+W+1];P[A]=G+Z,P[A+1]=q+X,P[A+2]=G-Z,P[A+3]=q-X}_singleTransform4(C,P,A,I,W,G){const q=W*2,Z=W*3,X=C[I],Q=C[I+1],te=C[I+W],R=C[I+W+1],ee=C[I+q],ie=C[I+q+1],he=C[I+Z],_e=C[I+Z+1],U=X+ee,K=Q+ie,H=X-ee,B=Q-ie,ce=te+he,ve=R+_e,Pe=G*(te-he),ze=G*(R-_e);P[A]=U+ce,P[A+1]=K+ve,P[A+2]=H+ze,P[A+3]=B-Pe,P[A+4]=U-ce,P[A+5]=K-ve,P[A+6]=H-ze,P[A+7]=B+Pe}_realTransform4(C,P,A){const I=this._csize;let G=1<<this._width,q=I/G<<1,Z,X;const Q=this._bitrev;if(q===4)for(Z=0,X=0;Z<I;Z+=q,++X){const ee=Q[X];this._singleRealTransform2(P,C,Z,ee>>>1,G>>>1)}else for(Z=0,X=0;Z<I;Z+=q,++X){const ee=Q[X];this._singleRealTransform4(P,C,Z,ee>>>1,G>>>1,A)}const te=this.table;for(G>>=2;G>=2;G>>=2){q=I/G<<1;const ee=q>>>1,ie=ee>>>1,he=ie>>>1;for(Z=0;Z<I;Z+=q)for(let _e=0,U=0;_e<=he;_e+=2,U+=G){const K=Z+_e,H=K+ie,B=H+ie,ce=B+ie,ve=C[K],Pe=C[K+1],ze=C[H],Ze=C[H+1],Re=C[B],de=C[B+1],J=C[ce],Ce=C[ce+1],Fe=ve,Be=Pe,Ue=te[U],He=A*te[U+1],De=ze*Ue-Ze*He,nt=ze*He+Ze*Ue,ke=te[2*U],Ge=A*te[2*U+1],dt=Re*ke-de*Ge,Ye=Re*Ge+de*ke,mt=te[3*U],it=A*te[3*U+1],Mt=J*mt-Ce*it,wt=J*it+Ce*mt,ot=Fe+dt,Je=Be+Ye,St=Fe-dt,Lt=Be-Ye,wn=De+Mt,Ht=nt+wt,Mn=A*(De-Mt),fa=A*(nt-wt);if(C[K]=ot+wn,C[K+1]=Je+Ht,C[H]=St+fa,C[H+1]=Lt-Mn,_e===0){C[B]=ot-wn,C[B+1]=Je-Ht;continue}if(_e===he)continue;const Jt=Z+ie-_e,ss=Z+ee-_e;C[Jt]=St-A*fa,C[Jt+1]=-Lt-A*Mn,C[ss]=ot-A*wn,C[ss+1]=-Je+A*Ht}}const R=I>>>1;for(let ee=2;ee<R;ee+=2)C[I-ee]=C[ee],C[I-ee+1]=-C[ee+1]}_singleRealTransform2(C,P,A,I,W){const G=C[I],q=C[I+W];P[A]=G+q,P[A+1]=0,P[A+2]=G-q,P[A+3]=0}_singleRealTransform4(C,P,A,I,W,G){const q=W*2,Z=W*3,X=C[I],Q=C[I+W],te=C[I+q],R=C[I+Z],ee=X+te,ie=X-te,he=Q+R,_e=G*(Q-R);P[A]=ee+he,P[A+1]=0,P[A+2]=ie,P[A+3]=-_e,P[A+4]=ee-he,P[A+5]=0,P[A+6]=ie,P[A+7]=_e}}class v{constructor(C){const P=2*(C-1),A=2*(2*C-1),I=2**Math.ceil(Math.log2(A));this.bufferSize=I,this._a=P;const W=new Float64Array(A),G=new Float64Array(I);this._chirpBuffer=new Float64Array(I),this._buffer1=new Float64Array(I),this._buffer2=new Float64Array(I),this._outBuffer1=new Float64Array(I),this._outBuffer2=new Float64Array(I);const q=-2*Math.PI/C,Z=Math.cos(q),X=Math.sin(q);for(let Q=0;Q<A>>1;++Q){const te=(Q+1-C)**2/2,R=Math.sqrt(Z**2+X**2)**te,ee=te*Math.atan2(X,Z),ie=2*Q;W[ie]=R*Math.cos(ee),W[ie+1]=R*Math.sin(ee),G[ie]=W[ie],G[ie+1]=-W[ie+1]}this._slicedChirpBuffer=W.subarray(P,A),this._f=new y(I>>1),this._f.transform(this._chirpBuffer,G)}_transform(C,P,A){const I=this._buffer1,W=this._buffer2,G=this._outBuffer1,q=this._outBuffer2,Z=this._chirpBuffer,X=this._slicedChirpBuffer,Q=this._a;if(A)for(let te=0;te<X.length;te+=2){const R=te+1,ee=te>>1,ie=P[ee];I[te]=ie*X[te],I[R]=ie*X[R]}else for(let te=0;te<X.length;te+=2){const R=te+1;I[te]=P[te]*X[te]-P[R]*X[R],I[R]=P[te]*X[R]+P[R]*X[te]}this._f.transform(G,I);for(let te=0;te<Z.length;te+=2){const R=te+1;W[te]=G[te]*Z[te]-G[R]*Z[R],W[R]=G[te]*Z[R]+G[R]*Z[te]}this._f.inverseTransform(q,W);for(let te=0;te<q.length;te+=2){const R=q[te+Q],ee=q[te+Q+1],ie=X[te],he=X[te+1];C[te]=R*ie-ee*he,C[te+1]=R*he+ee*ie}}transform(C,P){this._transform(C,P,!1)}realTransform(C,P){this._transform(C,P,!0)}}class T{constructor(C){this.fft_length=C,this.isPowerOfTwo=p(C),this.isPowerOfTwo?(this.fft=new y(C),this.outputBufferSize=2*C):(this.fft=new v(C),this.outputBufferSize=this.fft.bufferSize)}realTransform(C,P){this.fft.realTransform(C,P)}transform(C,P){this.fft.transform(C,P)}}function k(w,C){if(C%2===0||C<=0)throw new Error("Window size must be a positive odd number");const P=new w.constructor(w.length),A=new w.constructor(C),I=Math.floor(C/2);for(let W=0;W<w.length;++W){let G=0;for(let q=-I;q<=I;++q){let Z=W+q;Z<0?Z=Math.abs(Z):Z>=w.length&&(Z=2*(w.length-1)-Z),A[G++]=w[Z]}A.sort(),P[W]=A[I]}return P}function b(w,C){const P=Math.pow(10,C);return Math.round(w*P)/P}function S(w){const C=Math.round(w);return Math.abs(w)%1===.5?C%2===0?C:C-1:C}function $(w){const C=w.length,P=w[0].length,A=[C+1,P+1],I=Array.from({length:A[0]},()=>Array(A[1]).fill(1/0));I[0][0]=0;const W=Array.from({length:A[0]},()=>Array(A[1]).fill(-1));for(let Q=1;Q<A[1];++Q)for(let te=1;te<A[0];++te){const R=I[te-1][Q-1],ee=I[te-1][Q],ie=I[te][Q-1];let he,_e;R<ee&&R<ie?(he=R,_e=0):ee<R&&ee<ie?(he=ee,_e=1):(he=ie,_e=2),I[te][Q]=w[te-1][Q-1]+he,W[te][Q]=_e}for(let Q=0;Q<A[1];++Q)W[0][Q]=2;for(let Q=0;Q<A[0];++Q)W[Q][0]=1;let G=C,q=P,Z=[],X=[];for(;G>0||q>0;)switch(Z.push(G-1),X.push(q-1),W[G][q]){case 0:--G,--q;break;case 1:--G;break;case 2:--q;break;default:throw new Error(`Internal error in dynamic time warping. Unexpected trace[${G}, ${q}]. Please file a bug report.`)}return Z.reverse(),X.reverse(),[Z,X]}}),"./src/utils/tensor.js":((e,n,t)=>{t.r(n),t.d(n,{DataTypeMap:()=>c,Tensor:()=>u,cat:()=>P,full:()=>X,full_like:()=>Q,interpolate:()=>m,interpolate_4d:()=>_,layer_norm:()=>S,matmul:()=>p,mean:()=>G,mean_pooling:()=>b,ones:()=>te,ones_like:()=>R,permute:()=>f,quantize_embeddings:()=>U,rand:()=>he,randn:()=>_e,rfft:()=>y,slice:()=>k,stack:()=>A,std_mean:()=>W,topk:()=>v,zeros:()=>ee,zeros_like:()=>ie});var s=t("./src/utils/maths.js"),i=t("./src/backends/onnx.js"),l=t("./src/ops/registry.js");const c=Object.freeze({float32:Float32Array,float16:typeof Float16Array<"u"?Float16Array:Uint16Array,float64:Float64Array,string:Array,int8:Int8Array,uint8:Uint8Array,int16:Int16Array,uint16:Uint16Array,int32:Int32Array,uint32:Uint32Array,int64:BigInt64Array,uint64:BigUint64Array,bool:Uint8Array,uint4:Uint8Array,int4:Int8Array});class u{get dims(){return this.ort_tensor.dims}set dims(H){this.ort_tensor.dims=H}get type(){return this.ort_tensor.type}get data(){return this.ort_tensor.data}get size(){return this.ort_tensor.size}get location(){return this.ort_tensor.location}ort_tensor;constructor(...H){return(0,i.isONNXTensor)(H[0])?this.ort_tensor=H[0]:this.ort_tensor=new i.Tensor(H[0],H[1],H[2]),new Proxy(this,{get:(B,ce)=>{if(typeof ce=="string"){let ve=Number(ce);if(Number.isInteger(ve))return B._getitem(ve)}return B[ce]},set:(B,ce,ve)=>B[ce]=ve})}dispose(){this.ort_tensor.dispose()}*[Symbol.iterator](){const[H,...B]=this.dims;if(B.length>0){const ce=B.reduce((ve,Pe)=>ve*Pe);for(let ve=0;ve<H;++ve)yield this._subarray(ve,ce,B)}else yield*this.data}_getitem(H){const[B,...ce]=this.dims;if(H=C(H,B),ce.length>0){const ve=ce.reduce((Pe,ze)=>Pe*ze);return this._subarray(H,ve,ce)}else return new u(this.type,[this.data[H]],ce)}indexOf(H){const B=this.data;for(let ce=0;ce<B.length;++ce)if(B[ce]==H)return ce;return-1}_subarray(H,B,ce){const ve=H*B,Pe=(H+1)*B,ze="subarray"in this.data?this.data.subarray(ve,Pe):this.data.slice(ve,Pe);return new u(this.type,ze,ce)}item(){const H=this.data;if(H.length!==1)throw new Error(`a Tensor with ${H.length} elements cannot be converted to Scalar`);return H[0]}tolist(){return d(this.data,this.dims)}sigmoid(){return this.clone().sigmoid_()}sigmoid_(){const H=this.data;for(let B=0;B<H.length;++B)H[B]=1/(1+Math.exp(-H[B]));return this}map(H){return this.clone().map_(H)}map_(H){const B=this.data;for(let ce=0;ce<B.length;++ce)B[ce]=H(B[ce],ce,B);return this}mul(H){return this.clone().mul_(H)}mul_(H){const B=this.data;for(let ce=0;ce<B.length;++ce)B[ce]*=H;return this}div(H){return this.clone().div_(H)}div_(H){const B=this.data;for(let ce=0;ce<B.length;++ce)B[ce]/=H;return this}add(H){return this.clone().add_(H)}add_(H){const B=this.data;for(let ce=0;ce<B.length;++ce)B[ce]+=H;return this}sub(H){return this.clone().sub_(H)}sub_(H){const B=this.data;for(let ce=0;ce<B.length;++ce)B[ce]-=H;return this}clone(){return new u(this.type,this.data.slice(),this.dims.slice())}slice(...H){const B=[],ce=[];for(let J=0;J<this.dims.length;++J){let Ce=H[J];if(Ce==null)ce.push([0,this.dims[J]]),B.push(this.dims[J]);else if(typeof Ce=="number")Ce=C(Ce,this.dims[J],J),ce.push([Ce,Ce+1]);else if(Array.isArray(Ce)&&Ce.length===2){let[Fe,Be]=Ce;if(Fe=Fe===null?0:C(Fe,this.dims[J],J,!1),Be=Be===null?this.dims[J]:C(Be,this.dims[J],J,!1),Fe>Be)throw new Error(`Invalid slice: ${Ce}`);const Ue=[Math.max(Fe,0),Math.min(Be,this.dims[J])];ce.push(Ue),B.push(Ue[1]-Ue[0])}else throw new Error(`Invalid slice: ${Ce}`)}const ve=ce.map(([J,Ce])=>Ce-J),Pe=ve.reduce((J,Ce)=>J*Ce),ze=this.data,Ze=new ze.constructor(Pe),Re=this.stride();let de=!0;for(let J=1;J<ve.length;++J)if(ce[J][0]!==0||ce[J][1]!==this.dims[J]){de=!1;break}if(de){const J=ce[0][0]*Re[0],Ce=ce[0][1]*Re[0];if(ArrayBuffer.isView(ze))Ze.set(ze.subarray(J,Ce));else if(Array.isArray(ze)){const Fe=ze.slice(J,Ce);for(let Be=0;Be<Fe.length;++Be)Ze[Be]=Fe[Be]}else throw new Error("Unsupported data type for slicing")}else for(let J=0;J<Pe;++J){let Ce=0;for(let Fe=ve.length-1,Be=J;Fe>=0;--Fe){const Ue=ve[Fe];Ce+=(Be%Ue+ce[Fe][0])*Re[Fe],Be=Math.floor(Be/Ue)}Ze[J]=ze[Ce]}return new u(this.type,Ze,B)}permute(...H){return f(this,H)}transpose(...H){return this.permute(...H)}sum(H=null,B=!1){return this.norm(1,H,B)}norm(H="fro",B=null,ce=!1){if(H==="fro")H=2;else if(typeof H=="string")throw Error(`Unsupported norm: ${H}`);const ve=this.data,Pe=(de,J)=>de+J**H;if(B===null){const de=ve.reduce(Pe,0)**(1/H);return new u(this.type,[de],[])}const[ze,Ze,Re]=I(Pe,this,B,ce);if(H!==1)for(let de=0;de<Ze.length;++de)Ze[de]=Ze[de]**(1/H);return new u(ze,Ze,Re)}normalize_(H=2,B=1){B=C(B,this.dims.length);const ce=this.norm(H,B,!0),ve=this.data,Pe=ce.data;for(let ze=0;ze<ve.length;++ze){let Ze=0;for(let Re=this.dims.length-1,de=ze,J=1;Re>=0;--Re){const Ce=this.dims[Re];if(Re!==B){const Fe=de%Ce;Ze+=Fe*J,J*=this.dims[Re]}de=Math.floor(de/Ce)}ve[ze]/=Pe[Ze]}return this}normalize(H=2,B=1){return this.clone().normalize_(H,B)}stride(){return q(this.dims)}squeeze(H=null){return new u(this.type,this.data,$(this.dims,H))}squeeze_(H=null){return this.dims=$(this.dims,H),this}unsqueeze(H=null){return new u(this.type,this.data,w(this.dims,H))}unsqueeze_(H=null){return this.dims=w(this.dims,H),this}flatten_(H=0,B=-1){B=(B+this.dims.length)%this.dims.length;let ce=this.dims.slice(0,H),ve=this.dims.slice(H,B+1),Pe=this.dims.slice(B+1);return this.dims=[...ce,ve.reduce((ze,Ze)=>ze*Ze,1),...Pe],this}flatten(H=0,B=-1){return this.clone().flatten_(H,B)}view(...H){let B=-1;for(let ve=0;ve<H.length;++ve)if(H[ve]===-1){if(B!==-1)throw new Error("Only one dimension can be inferred");B=ve}const ce=this.data;if(B!==-1){const ve=H.reduce((Pe,ze,Ze)=>Ze!==B?Pe*ze:Pe,1);H[B]=ce.length/ve}return new u(this.type,ce,H)}neg_(){const H=this.data;for(let B=0;B<H.length;++B)H[B]=-H[B];return this}neg(){return this.clone().neg_()}gt(H){const B=new Uint8Array(this.data.length),ce=this.data;for(let ve=0;ve<ce.length;++ve)B[ve]=ce[ve]>H?1:0;return new u("bool",B,this.dims)}lt(H){const B=new Uint8Array(this.data.length),ce=this.data;for(let ve=0;ve<ce.length;++ve)B[ve]=ce[ve]<H?1:0;return new u("bool",B,this.dims)}clamp_(H,B){const ce=this.data;for(let ve=0;ve<ce.length;++ve)ce[ve]=Math.min(Math.max(ce[ve],H),B);return this}clamp(H,B){return this.clone().clamp_(H,B)}round_(){const H=this.data;for(let B=0;B<H.length;++B)H[B]=Math.round(H[B]);return this}round(){return this.clone().round_()}mean(H=null,B=!1){return G(this,H,B)}min(H=null,B=!1){if(H===null){const ze=(0,s.min)(this.data)[0];return new u(this.type,[ze],[])}const[ce,ve,Pe]=I((ze,Ze)=>Math.min(ze,Ze),this,H,B,1/0);return new u(ce,ve,Pe)}max(H=null,B=!1){if(H===null){const ze=(0,s.max)(this.data)[0];return new u(this.type,[ze],[])}const[ce,ve,Pe]=I((ze,Ze)=>Math.max(ze,Ze),this,H,B,-1/0);return new u(ce,ve,Pe)}argmin(H=null,B=!1){if(H!==null)throw new Error("`dim !== null` not yet implemented.");const ce=(0,s.min)(this.data)[1];return new u("int64",[BigInt(ce)],[])}argmax(H=null,B=!1){if(H!==null)throw new Error("`dim !== null` not yet implemented.");const ce=(0,s.max)(this.data)[1];return new u("int64",[BigInt(ce)],[])}to(H){if(this.type===H)return this;if(!c.hasOwnProperty(H))throw new Error(`Unsupported type: ${H}`);let B;const ce=["int64","uint64"].includes(this.type),ve=["int64","uint64"].includes(H);return ce&&!ve?B=Number:!ce&&ve&&(["float16","float32","float64"].includes(this.type)?B=Pe=>BigInt(Math.floor(Pe)):B=BigInt),new u(H,c[H].from(this.data,B),this.dims)}}function d(K,H){const B=K.length,ce=H.reduce((Pe,ze)=>Pe*ze);if(B!==ce)throw Error(`cannot reshape array of size ${B} into shape (${H})`);let ve=K;for(let Pe=H.length-1;Pe>=0;Pe--)ve=ve.reduce((ze,Ze)=>{let Re=ze[ze.length-1];return Re.length<H[Pe]?Re.push(Ze):ze.push([Ze]),ze},[[]]);return ve[0]}function f(K,H){const[B,ce]=(0,s.permute_data)(K.data,K.dims,H);return new u(K.type,B,ce)}function m(K,[H,B],ce="bilinear",ve=!1){const Pe=K.dims.at(-3)??1,ze=K.dims.at(-2),Ze=K.dims.at(-1);let Re=(0,s.interpolate_data)(K.data,[Pe,ze,Ze],[H,B],ce,ve);return new u(K.type,Re,[Pe,H,B])}async function _(K,{size:H=null,mode:B="bilinear"}={}){if(K.dims.length!==4)throw new Error("`interpolate_4d` currently only supports 4D input.");if(!H)throw new Error("`interpolate_4d` requires a `size` argument.");let ce;if(H.length===2)ce=[...K.dims.slice(0,2),...H];else if(H.length===3)ce=[K.dims[0],...H];else if(H.length===4)ce=H;else throw new Error("`size` must be of length 2, 3, or 4.");let ve;if(B==="nearest")ve=await l.TensorOpRegistry.nearest_interpolate_4d;else if(B==="bilinear")ve=await l.TensorOpRegistry.bilinear_interpolate_4d;else if(B==="bicubic")ve=await l.TensorOpRegistry.bicubic_interpolate_4d;else throw new Error(`Unsupported mode: ${B}`);const Pe=new u("int64",new BigInt64Array(ce.map(BigInt)),[ce.length]);return await ve({x:K,s:Pe})}async function p(K,H){return await(await l.TensorOpRegistry.matmul)({a:K,b:H})}async function y(K,H){return await(await l.TensorOpRegistry.rfft)({x:K,a:H})}async function v(K,H){const B=await l.TensorOpRegistry.top_k;return H==null?H=K.dims.at(-1):H=Math.min(H,K.dims.at(-1)),await B({x:K,k:new u("int64",[BigInt(H)],[1])})}const T=K=>new u("int64",K,[K.length]);async function k(K,H,B,ce,ve){return await(await l.TensorOpRegistry.slice)({x:K,s:T(H),e:T(B),a:T(ce),t:T(ve??new Array(ce.length).fill(1))})}function b(K,H){const B=K.data,ce=H.data,ve=[K.dims[0],K.dims[2]],Pe=new B.constructor(ve[0]*ve[1]),[ze,Ze,Re]=K.dims;let de=0;for(let J=0;J<ze;++J){const Ce=J*Re*Ze;for(let Fe=0;Fe<Re;++Fe){let Be=0,Ue=0;const He=J*Ze,De=Ce+Fe;for(let ke=0;ke<Ze;++ke){const Ge=Number(ce[He+ke]);Ue+=Ge,Be+=B[De+ke*Re]*Ge}const nt=Be/Ue;Pe[de++]=nt}}return new u(K.type,Pe,ve)}function S(K,H,{eps:B=1e-5}={}){if(K.dims.length!==2)throw new Error("`layer_norm` currently only supports 2D input.");const[ce,ve]=K.dims;if(H.length!==1&&H[0]!==ve)throw new Error("`normalized_shape` must be a 1D array with shape `[input.dims[1]]`.");const[Pe,ze]=W(K,1,0,!0),Ze=Pe.data,Re=ze.data,de=K.data,J=new de.constructor(de.length);for(let Ce=0;Ce<ce;++Ce){const Fe=Ce*ve;for(let Be=0;Be<ve;++Be){const Ue=Fe+Be;J[Ue]=(de[Ue]-Re[Ce])/(Ze[Ce]+B)}}return new u(K.type,J,K.dims)}function $(K,H){return K=K.slice(),H===null?K=K.filter(B=>B!==1):typeof H=="number"?K[H]===1&&K.splice(H,1):Array.isArray(H)&&(K=K.filter((B,ce)=>B!==1||!H.includes(ce))),K}function w(K,H){return H=C(H,K.length+1),K=K.slice(),K.splice(H,0,1),K}function C(K,H,B=null,ce=!0){if(K<-H||K>=H){if(ce)throw new Error(`IndexError: index ${K} is out of bounds for dimension${B===null?"":" "+B} with size ${H}`);return K<-H?0:H}return K<0&&(K=(K%H+H)%H),K}function P(K,H=0){H=C(H,K[0].dims.length);const B=K[0].dims.slice();B[H]=K.reduce((ze,Ze)=>ze+Ze.dims[H],0);const ce=B.reduce((ze,Ze)=>ze*Ze,1),ve=new K[0].data.constructor(ce),Pe=K[0].type;if(H===0){let ze=0;for(const Ze of K){const Re=Ze.data;ve.set(Re,ze),ze+=Re.length}}else{let ze=0;for(let Ze=0;Ze<K.length;++Ze){const{data:Re,dims:de}=K[Ze];for(let J=0;J<Re.length;++J){let Ce=0;for(let Fe=de.length-1,Be=J,Ue=1;Fe>=0;--Fe){const He=de[Fe];let De=Be%He;Fe===H&&(De+=ze),Ce+=De*Ue,Ue*=B[Fe],Be=Math.floor(Be/He)}ve[Ce]=Re[J]}ze+=de[H]}}return new u(Pe,ve,B)}function A(K,H=0){return P(K.map(B=>B.unsqueeze(H)),H)}function I(K,H,B=null,ce=!1,ve=null){const Pe=H.data,ze=H.dims;B=C(B,ze.length);const Ze=ze.slice();Ze[B]=1;const Re=new Pe.constructor(Pe.length/ze[B]);ve!==null&&Re.fill(ve);for(let de=0;de<Pe.length;++de){let J=0;for(let Ce=ze.length-1,Fe=de,Be=1;Ce>=0;--Ce){const Ue=ze[Ce];if(Ce!==B){const He=Fe%Ue;J+=He*Be,Be*=Ze[Ce]}Fe=Math.floor(Fe/Ue)}Re[J]=K(Re[J],Pe[de],de,J)}return ce||Ze.splice(B,1),[H.type,Re,Ze]}function W(K,H=null,B=1,ce=!1){const ve=K.data,Pe=K.dims;if(H===null){const Be=ve.reduce((nt,ke)=>nt+ke,0)/ve.length,Ue=Math.sqrt(ve.reduce((nt,ke)=>nt+(ke-Be)**2,0)/(ve.length-B)),He=new u(K.type,[Be],[]);return[new u(K.type,[Ue],[]),He]}H=C(H,Pe.length);const ze=G(K,H,ce),Ze=ze.data,[Re,de,J]=I((Fe,Be,Ue,He)=>Fe+(Be-Ze[He])**2,K,H,ce);for(let Fe=0;Fe<de.length;++Fe)de[Fe]=Math.sqrt(de[Fe]/(Pe[H]-B));return[new u(Re,de,J),ze]}function G(K,H=null,B=!1){const ce=K.dims,ve=K.data;if(H===null){const Re=ve.reduce((de,J)=>de+J,0);return new u(K.type,[Re/ve.length],[])}H=C(H,ce.length);const[Pe,ze,Ze]=I((Re,de)=>Re+de,K,H,B);if(ce[H]!==1)for(let Re=0;Re<ze.length;++Re)ze[Re]/=ce[H];return new u(Pe,ze,Ze)}function q(K){const H=new Array(K.length);for(let B=K.length-1,ce=1;B>=0;--B)H[B]=ce,ce*=K[B];return H}function Z(K,H,B,ce){const ve=K.reduce((Pe,ze)=>Pe*ze,1);return new u(B,new ce(ve).fill(H),K)}function X(K,H){let B,ce;if(typeof H=="number")B="float32",ce=Float32Array;else if(typeof H=="bigint")B="int64",ce=BigInt64Array;else if(typeof H=="boolean")B="bool",ce=Uint8Array;else throw new Error(`Unsupported data type: ${typeof H}`);return Z(K,H,B,ce)}function Q(K,H){return X(K.dims,H)}function te(K){return Z(K,1n,"int64",BigInt64Array)}function R(K){return te(K.dims)}function ee(K){return Z(K,0n,"int64",BigInt64Array)}function ie(K){return ee(K.dims)}function he(K){const H=K.reduce((B,ce)=>B*ce,1);return new u("float32",Float32Array.from({length:H},()=>Math.random()),K)}function _e(K){const H=K.reduce((ce,ve)=>ce*ve,1);function B(){const ce=1-Math.random(),ve=1-Math.random();return Math.sqrt(-2*Math.log(ce))*Math.cos(2*Math.PI*ve)}return new u("float32",Float32Array.from({length:H},()=>B()),K)}function U(K,H){if(K.dims.length!==2)throw new Error("The tensor must have 2 dimensions");if(K.dims.at(-1)%8!==0)throw new Error("The last dimension of the tensor must be a multiple of 8");if(!["binary","ubinary"].includes(H))throw new Error("The precision must be either 'binary' or 'ubinary'");const B=H==="binary",ce=B?"int8":"uint8",ve=B?Int8Array:Uint8Array,Pe=K.data,ze=new ve(Pe.length/8);for(let Ze=0;Ze<Pe.length;++Ze){const Re=Pe[Ze]>0?1:0,de=Math.floor(Ze/8),J=Ze%8;ze[de]|=Re<<7-J,B&&J===0&&(ze[de]-=128)}return new u(ce,ze,[K.dims[0],K.dims[1]/8])}}),"./src/utils/video.js":((e,n,t)=>{t.r(n),t.d(n,{RawVideo:()=>c,RawVideoFrame:()=>l,load_video:()=>u});var s=t("./src/utils/image.js"),i=t("./src/env.js");class l{constructor(f,m){this.image=f,this.timestamp=m}}class c{constructor(f,m){f.length>0&&f[0]instanceof s.RawImage&&(f=f.map((_,p)=>new l(_,(p+1)/(f.length+1)*m))),this.frames=f,this.duration=m}get width(){return this.frames[0].image.width}get height(){return this.frames[0].image.height}get fps(){return this.frames.length/this.duration}}async function u(d,{num_frames:f=null,fps:m=null}={}){if(!i.apis.IS_BROWSER_ENV)throw new Error("`load_video` is currently only supported in browser environments.");if(f==null&&m==null)throw new Error("Either num_frames or fps must be provided.");const _=[],p=document.createElement("video");if(p.crossOrigin="anonymous",p.muted=!0,typeof d=="string")p.src=d;else if(d instanceof Blob)p.src=URL.createObjectURL(d);else if(d instanceof HTMLVideoElement)p.src=d.src;else throw new Error("Invalid URL or video element provided.");if(await new Promise($=>p.onloadedmetadata=$),p.seekable.start(0)===p.seekable.end(0)){const w=await(await fetch(p.src)).blob();p.src=URL.createObjectURL(w),await new Promise(C=>p.onloadedmetadata=C)}const y=p.duration;let v,T;f!=null?(v=f,T=f===1?0:y/(f-1)):(T=1/m,v=Math.floor(y/T));let k=[];for(let $=0;$<v;++$)k.push(f===1?y/2:$*T);const b=document.createElement("canvas");b.width=p.videoWidth,b.height=p.videoHeight;const S=b.getContext("2d",{willReadFrequently:!0});for(const $ of k){p.currentTime=$,await new Promise(A=>{p.onseeked=A}),S.drawImage(p,0,0,b.width,b.height);const w=S.getImageData(0,0,b.width,b.height),C=new s.RawImage(w.data,b.width,b.height,4),P=new l(C,$);_.push(P)}return p.remove(),new c(_,y)}})},nx={};function kn(e){var n=nx[e];if(n!==void 0)return n.exports;var t=nx[e]={exports:{}};return U3[e](t,t.exports,kn),t.exports}(()=>{var e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,n;kn.t=function(t,s){if(s&1&&(t=this(t)),s&8||typeof t=="object"&&t&&(s&4&&t.__esModule||s&16&&typeof t.then=="function"))return t;var i=Object.create(null);kn.r(i);var l={};n=n||[null,e({}),e([]),e(e)];for(var c=s&2&&t;typeof c=="object"&&!~n.indexOf(c);c=e(c))Object.getOwnPropertyNames(c).forEach(u=>l[u]=()=>t[u]);return l.default=()=>t,kn.d(i,l),i}})();kn.d=(e,n)=>{for(var t in n)kn.o(n,t)&&!kn.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})};kn.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n);kn.r=e=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var E={};(()=>{kn.r(E),kn.d(E,{ASTFeatureExtractor:()=>_.ASTFeatureExtractor,ASTForAudioClassification:()=>t.ASTForAudioClassification,ASTModel:()=>t.ASTModel,ASTPreTrainedModel:()=>t.ASTPreTrainedModel,AlbertForMaskedLM:()=>t.AlbertForMaskedLM,AlbertForQuestionAnswering:()=>t.AlbertForQuestionAnswering,AlbertForSequenceClassification:()=>t.AlbertForSequenceClassification,AlbertModel:()=>t.AlbertModel,AlbertPreTrainedModel:()=>t.AlbertPreTrainedModel,AlbertTokenizer:()=>s.AlbertTokenizer,ArceeForCausalLM:()=>t.ArceeForCausalLM,ArceeModel:()=>t.ArceeModel,ArceePreTrainedModel:()=>t.ArceePreTrainedModel,AudioClassificationPipeline:()=>n.AudioClassificationPipeline,AutoConfig:()=>i.AutoConfig,AutoFeatureExtractor:()=>p.AutoFeatureExtractor,AutoImageProcessor:()=>T.AutoImageProcessor,AutoModel:()=>t.AutoModel,AutoModelForAudioClassification:()=>t.AutoModelForAudioClassification,AutoModelForAudioFrameClassification:()=>t.AutoModelForAudioFrameClassification,AutoModelForAudioTextToText:()=>t.AutoModelForAudioTextToText,AutoModelForCTC:()=>t.AutoModelForCTC,AutoModelForCausalLM:()=>t.AutoModelForCausalLM,AutoModelForDepthEstimation:()=>t.AutoModelForDepthEstimation,AutoModelForDocumentQuestionAnswering:()=>t.AutoModelForDocumentQuestionAnswering,AutoModelForImageClassification:()=>t.AutoModelForImageClassification,AutoModelForImageFeatureExtraction:()=>t.AutoModelForImageFeatureExtraction,AutoModelForImageMatting:()=>t.AutoModelForImageMatting,AutoModelForImageSegmentation:()=>t.AutoModelForImageSegmentation,AutoModelForImageTextToText:()=>t.AutoModelForImageTextToText,AutoModelForImageToImage:()=>t.AutoModelForImageToImage,AutoModelForMaskGeneration:()=>t.AutoModelForMaskGeneration,AutoModelForMaskedLM:()=>t.AutoModelForMaskedLM,AutoModelForNormalEstimation:()=>t.AutoModelForNormalEstimation,AutoModelForObjectDetection:()=>t.AutoModelForObjectDetection,AutoModelForPoseEstimation:()=>t.AutoModelForPoseEstimation,AutoModelForQuestionAnswering:()=>t.AutoModelForQuestionAnswering,AutoModelForSemanticSegmentation:()=>t.AutoModelForSemanticSegmentation,AutoModelForSeq2SeqLM:()=>t.AutoModelForSeq2SeqLM,AutoModelForSequenceClassification:()=>t.AutoModelForSequenceClassification,AutoModelForSpeechSeq2Seq:()=>t.AutoModelForSpeechSeq2Seq,AutoModelForTextToSpectrogram:()=>t.AutoModelForTextToSpectrogram,AutoModelForTextToWaveform:()=>t.AutoModelForTextToWaveform,AutoModelForTokenClassification:()=>t.AutoModelForTokenClassification,AutoModelForUniversalSegmentation:()=>t.AutoModelForUniversalSegmentation,AutoModelForVision2Seq:()=>t.AutoModelForVision2Seq,AutoModelForXVector:()=>t.AutoModelForXVector,AutoModelForZeroShotObjectDetection:()=>t.AutoModelForZeroShotObjectDetection,AutoProcessor:()=>S.AutoProcessor,AutoTokenizer:()=>s.AutoTokenizer,AutomaticSpeechRecognitionPipeline:()=>n.AutomaticSpeechRecognitionPipeline,BackgroundRemovalPipeline:()=>n.BackgroundRemovalPipeline,BartForConditionalGeneration:()=>t.BartForConditionalGeneration,BartForSequenceClassification:()=>t.BartForSequenceClassification,BartModel:()=>t.BartModel,BartPretrainedModel:()=>t.BartPretrainedModel,BartTokenizer:()=>s.BartTokenizer,BaseModelOutput:()=>t.BaseModelOutput,BaseStreamer:()=>$.BaseStreamer,BeitFeatureExtractor:()=>v.BeitFeatureExtractor,BeitForImageClassification:()=>t.BeitForImageClassification,BeitModel:()=>t.BeitModel,BeitPreTrainedModel:()=>t.BeitPreTrainedModel,BertForMaskedLM:()=>t.BertForMaskedLM,BertForQuestionAnswering:()=>t.BertForQuestionAnswering,BertForSequenceClassification:()=>t.BertForSequenceClassification,BertForTokenClassification:()=>t.BertForTokenClassification,BertModel:()=>t.BertModel,BertPreTrainedModel:()=>t.BertPreTrainedModel,BertTokenizer:()=>s.BertTokenizer,BitImageProcessor:()=>v.BitImageProcessor,BlenderbotForConditionalGeneration:()=>t.BlenderbotForConditionalGeneration,BlenderbotModel:()=>t.BlenderbotModel,BlenderbotPreTrainedModel:()=>t.BlenderbotPreTrainedModel,BlenderbotSmallForConditionalGeneration:()=>t.BlenderbotSmallForConditionalGeneration,BlenderbotSmallModel:()=>t.BlenderbotSmallModel,BlenderbotSmallPreTrainedModel:()=>t.BlenderbotSmallPreTrainedModel,BlenderbotSmallTokenizer:()=>s.BlenderbotSmallTokenizer,BlenderbotTokenizer:()=>s.BlenderbotTokenizer,BloomForCausalLM:()=>t.BloomForCausalLM,BloomModel:()=>t.BloomModel,BloomPreTrainedModel:()=>t.BloomPreTrainedModel,BloomTokenizer:()=>s.BloomTokenizer,CLIPFeatureExtractor:()=>v.CLIPFeatureExtractor,CLIPImageProcessor:()=>v.CLIPImageProcessor,CLIPModel:()=>t.CLIPModel,CLIPPreTrainedModel:()=>t.CLIPPreTrainedModel,CLIPSegForImageSegmentation:()=>t.CLIPSegForImageSegmentation,CLIPSegModel:()=>t.CLIPSegModel,CLIPSegPreTrainedModel:()=>t.CLIPSegPreTrainedModel,CLIPTextModel:()=>t.CLIPTextModel,CLIPTextModelWithProjection:()=>t.CLIPTextModelWithProjection,CLIPTokenizer:()=>s.CLIPTokenizer,CLIPVisionModel:()=>t.CLIPVisionModel,CLIPVisionModelWithProjection:()=>t.CLIPVisionModelWithProjection,CamembertForMaskedLM:()=>t.CamembertForMaskedLM,CamembertForQuestionAnswering:()=>t.CamembertForQuestionAnswering,CamembertForSequenceClassification:()=>t.CamembertForSequenceClassification,CamembertForTokenClassification:()=>t.CamembertForTokenClassification,CamembertModel:()=>t.CamembertModel,CamembertPreTrainedModel:()=>t.CamembertPreTrainedModel,CamembertTokenizer:()=>s.CamembertTokenizer,CausalLMOutput:()=>t.CausalLMOutput,CausalLMOutputWithPast:()=>t.CausalLMOutputWithPast,ChineseCLIPFeatureExtractor:()=>v.ChineseCLIPFeatureExtractor,ChineseCLIPModel:()=>t.ChineseCLIPModel,ChineseCLIPPreTrainedModel:()=>t.ChineseCLIPPreTrainedModel,ClapAudioModelWithProjection:()=>t.ClapAudioModelWithProjection,ClapFeatureExtractor:()=>_.ClapFeatureExtractor,ClapModel:()=>t.ClapModel,ClapPreTrainedModel:()=>t.ClapPreTrainedModel,ClapTextModelWithProjection:()=>t.ClapTextModelWithProjection,ClassifierFreeGuidanceLogitsProcessor:()=>C.ClassifierFreeGuidanceLogitsProcessor,CodeGenForCausalLM:()=>t.CodeGenForCausalLM,CodeGenModel:()=>t.CodeGenModel,CodeGenPreTrainedModel:()=>t.CodeGenPreTrainedModel,CodeGenTokenizer:()=>s.CodeGenTokenizer,CodeLlamaTokenizer:()=>s.CodeLlamaTokenizer,CohereForCausalLM:()=>t.CohereForCausalLM,CohereModel:()=>t.CohereModel,CoherePreTrainedModel:()=>t.CoherePreTrainedModel,CohereTokenizer:()=>s.CohereTokenizer,ConvBertForMaskedLM:()=>t.ConvBertForMaskedLM,ConvBertForQuestionAnswering:()=>t.ConvBertForQuestionAnswering,ConvBertForSequenceClassification:()=>t.ConvBertForSequenceClassification,ConvBertForTokenClassification:()=>t.ConvBertForTokenClassification,ConvBertModel:()=>t.ConvBertModel,ConvBertPreTrainedModel:()=>t.ConvBertPreTrainedModel,ConvBertTokenizer:()=>s.ConvBertTokenizer,ConvNextFeatureExtractor:()=>v.ConvNextFeatureExtractor,ConvNextForImageClassification:()=>t.ConvNextForImageClassification,ConvNextImageProcessor:()=>v.ConvNextImageProcessor,ConvNextModel:()=>t.ConvNextModel,ConvNextPreTrainedModel:()=>t.ConvNextPreTrainedModel,ConvNextV2ForImageClassification:()=>t.ConvNextV2ForImageClassification,ConvNextV2Model:()=>t.ConvNextV2Model,ConvNextV2PreTrainedModel:()=>t.ConvNextV2PreTrainedModel,DFineForObjectDetection:()=>t.DFineForObjectDetection,DFineModel:()=>t.DFineModel,DFinePreTrainedModel:()=>t.DFinePreTrainedModel,DINOv3ConvNextModel:()=>t.DINOv3ConvNextModel,DINOv3ConvNextPreTrainedModel:()=>t.DINOv3ConvNextPreTrainedModel,DINOv3ViTImageProcessor:()=>v.DINOv3ViTImageProcessor,DINOv3ViTModel:()=>t.DINOv3ViTModel,DINOv3ViTPreTrainedModel:()=>t.DINOv3ViTPreTrainedModel,DPTFeatureExtractor:()=>v.DPTFeatureExtractor,DPTForDepthEstimation:()=>t.DPTForDepthEstimation,DPTImageProcessor:()=>v.DPTImageProcessor,DPTModel:()=>t.DPTModel,DPTPreTrainedModel:()=>t.DPTPreTrainedModel,DacDecoderModel:()=>t.DacDecoderModel,DacDecoderOutput:()=>t.DacDecoderOutput,DacEncoderModel:()=>t.DacEncoderModel,DacEncoderOutput:()=>t.DacEncoderOutput,DacFeatureExtractor:()=>_.DacFeatureExtractor,DacModel:()=>t.DacModel,DacPreTrainedModel:()=>t.DacPreTrainedModel,DataTypeMap:()=>d.DataTypeMap,DebertaForMaskedLM:()=>t.DebertaForMaskedLM,DebertaForQuestionAnswering:()=>t.DebertaForQuestionAnswering,DebertaForSequenceClassification:()=>t.DebertaForSequenceClassification,DebertaForTokenClassification:()=>t.DebertaForTokenClassification,DebertaModel:()=>t.DebertaModel,DebertaPreTrainedModel:()=>t.DebertaPreTrainedModel,DebertaTokenizer:()=>s.DebertaTokenizer,DebertaV2ForMaskedLM:()=>t.DebertaV2ForMaskedLM,DebertaV2ForQuestionAnswering:()=>t.DebertaV2ForQuestionAnswering,DebertaV2ForSequenceClassification:()=>t.DebertaV2ForSequenceClassification,DebertaV2ForTokenClassification:()=>t.DebertaV2ForTokenClassification,DebertaV2Model:()=>t.DebertaV2Model,DebertaV2PreTrainedModel:()=>t.DebertaV2PreTrainedModel,DebertaV2Tokenizer:()=>s.DebertaV2Tokenizer,DecisionTransformerModel:()=>t.DecisionTransformerModel,DecisionTransformerPreTrainedModel:()=>t.DecisionTransformerPreTrainedModel,DeiTFeatureExtractor:()=>v.DeiTFeatureExtractor,DeiTForImageClassification:()=>t.DeiTForImageClassification,DeiTImageProcessor:()=>v.DeiTImageProcessor,DeiTModel:()=>t.DeiTModel,DeiTPreTrainedModel:()=>t.DeiTPreTrainedModel,DepthAnythingForDepthEstimation:()=>t.DepthAnythingForDepthEstimation,DepthAnythingPreTrainedModel:()=>t.DepthAnythingPreTrainedModel,DepthEstimationPipeline:()=>n.DepthEstimationPipeline,DepthProForDepthEstimation:()=>t.DepthProForDepthEstimation,DepthProPreTrainedModel:()=>t.DepthProPreTrainedModel,DetrFeatureExtractor:()=>v.DetrFeatureExtractor,DetrForObjectDetection:()=>t.DetrForObjectDetection,DetrForSegmentation:()=>t.DetrForSegmentation,DetrImageProcessor:()=>v.DetrImageProcessor,DetrModel:()=>t.DetrModel,DetrObjectDetectionOutput:()=>t.DetrObjectDetectionOutput,DetrPreTrainedModel:()=>t.DetrPreTrainedModel,DetrSegmentationOutput:()=>t.DetrSegmentationOutput,Dinov2ForImageClassification:()=>t.Dinov2ForImageClassification,Dinov2Model:()=>t.Dinov2Model,Dinov2PreTrainedModel:()=>t.Dinov2PreTrainedModel,Dinov2WithRegistersForImageClassification:()=>t.Dinov2WithRegistersForImageClassification,Dinov2WithRegistersModel:()=>t.Dinov2WithRegistersModel,Dinov2WithRegistersPreTrainedModel:()=>t.Dinov2WithRegistersPreTrainedModel,DistilBertForMaskedLM:()=>t.DistilBertForMaskedLM,DistilBertForQuestionAnswering:()=>t.DistilBertForQuestionAnswering,DistilBertForSequenceClassification:()=>t.DistilBertForSequenceClassification,DistilBertForTokenClassification:()=>t.DistilBertForTokenClassification,DistilBertModel:()=>t.DistilBertModel,DistilBertPreTrainedModel:()=>t.DistilBertPreTrainedModel,DistilBertTokenizer:()=>s.DistilBertTokenizer,DocumentQuestionAnsweringPipeline:()=>n.DocumentQuestionAnsweringPipeline,DonutFeatureExtractor:()=>v.DonutFeatureExtractor,DonutImageProcessor:()=>v.DonutImageProcessor,DonutSwinModel:()=>t.DonutSwinModel,DonutSwinPreTrainedModel:()=>t.DonutSwinPreTrainedModel,EdgeTamModel:()=>t.EdgeTamModel,EfficientNetForImageClassification:()=>t.EfficientNetForImageClassification,EfficientNetImageProcessor:()=>v.EfficientNetImageProcessor,EfficientNetModel:()=>t.EfficientNetModel,EfficientNetPreTrainedModel:()=>t.EfficientNetPreTrainedModel,ElectraForMaskedLM:()=>t.ElectraForMaskedLM,ElectraForQuestionAnswering:()=>t.ElectraForQuestionAnswering,ElectraForSequenceClassification:()=>t.ElectraForSequenceClassification,ElectraForTokenClassification:()=>t.ElectraForTokenClassification,ElectraModel:()=>t.ElectraModel,ElectraPreTrainedModel:()=>t.ElectraPreTrainedModel,ElectraTokenizer:()=>s.ElectraTokenizer,EncodecFeatureExtractor:()=>_.EncodecFeatureExtractor,EosTokenCriteria:()=>w.EosTokenCriteria,Ernie4_5ForCausalLM:()=>t.Ernie4_5ForCausalLM,Ernie4_5Model:()=>t.Ernie4_5Model,Ernie4_5PreTrainedModel:()=>t.Ernie4_5PreTrainedModel,EsmForMaskedLM:()=>t.EsmForMaskedLM,EsmForSequenceClassification:()=>t.EsmForSequenceClassification,EsmForTokenClassification:()=>t.EsmForTokenClassification,EsmModel:()=>t.EsmModel,EsmPreTrainedModel:()=>t.EsmPreTrainedModel,EsmTokenizer:()=>s.EsmTokenizer,ExaoneForCausalLM:()=>t.ExaoneForCausalLM,ExaoneModel:()=>t.ExaoneModel,ExaonePreTrainedModel:()=>t.ExaonePreTrainedModel,FFT:()=>f.FFT,FalconForCausalLM:()=>t.FalconForCausalLM,FalconModel:()=>t.FalconModel,FalconPreTrainedModel:()=>t.FalconPreTrainedModel,FalconTokenizer:()=>s.FalconTokenizer,FastViTForImageClassification:()=>t.FastViTForImageClassification,FastViTModel:()=>t.FastViTModel,FastViTPreTrainedModel:()=>t.FastViTPreTrainedModel,FeatureExtractionPipeline:()=>n.FeatureExtractionPipeline,FeatureExtractor:()=>m.FeatureExtractor,FillMaskPipeline:()=>n.FillMaskPipeline,Florence2ForConditionalGeneration:()=>t.Florence2ForConditionalGeneration,Florence2PreTrainedModel:()=>t.Florence2PreTrainedModel,Florence2Processor:()=>b.Florence2Processor,ForcedBOSTokenLogitsProcessor:()=>C.ForcedBOSTokenLogitsProcessor,ForcedEOSTokenLogitsProcessor:()=>C.ForcedEOSTokenLogitsProcessor,GLPNFeatureExtractor:()=>v.GLPNFeatureExtractor,GLPNForDepthEstimation:()=>t.GLPNForDepthEstimation,GLPNModel:()=>t.GLPNModel,GLPNPreTrainedModel:()=>t.GLPNPreTrainedModel,GPT2LMHeadModel:()=>t.GPT2LMHeadModel,GPT2Model:()=>t.GPT2Model,GPT2PreTrainedModel:()=>t.GPT2PreTrainedModel,GPT2Tokenizer:()=>s.GPT2Tokenizer,GPTBigCodeForCausalLM:()=>t.GPTBigCodeForCausalLM,GPTBigCodeModel:()=>t.GPTBigCodeModel,GPTBigCodePreTrainedModel:()=>t.GPTBigCodePreTrainedModel,GPTJForCausalLM:()=>t.GPTJForCausalLM,GPTJModel:()=>t.GPTJModel,GPTJPreTrainedModel:()=>t.GPTJPreTrainedModel,GPTNeoForCausalLM:()=>t.GPTNeoForCausalLM,GPTNeoModel:()=>t.GPTNeoModel,GPTNeoPreTrainedModel:()=>t.GPTNeoPreTrainedModel,GPTNeoXForCausalLM:()=>t.GPTNeoXForCausalLM,GPTNeoXModel:()=>t.GPTNeoXModel,GPTNeoXPreTrainedModel:()=>t.GPTNeoXPreTrainedModel,GPTNeoXTokenizer:()=>s.GPTNeoXTokenizer,Gemma2ForCausalLM:()=>t.Gemma2ForCausalLM,Gemma2Model:()=>t.Gemma2Model,Gemma2PreTrainedModel:()=>t.Gemma2PreTrainedModel,Gemma3ForCausalLM:()=>t.Gemma3ForCausalLM,Gemma3Model:()=>t.Gemma3Model,Gemma3PreTrainedModel:()=>t.Gemma3PreTrainedModel,Gemma3nAudioFeatureExtractor:()=>_.Gemma3nAudioFeatureExtractor,Gemma3nForConditionalGeneration:()=>t.Gemma3nForConditionalGeneration,Gemma3nPreTrainedModel:()=>t.Gemma3nPreTrainedModel,Gemma3nProcessor:()=>b.Gemma3nProcessor,GemmaForCausalLM:()=>t.GemmaForCausalLM,GemmaModel:()=>t.GemmaModel,GemmaPreTrainedModel:()=>t.GemmaPreTrainedModel,GemmaTokenizer:()=>s.GemmaTokenizer,GlmForCausalLM:()=>t.GlmForCausalLM,GlmModel:()=>t.GlmModel,GlmPreTrainedModel:()=>t.GlmPreTrainedModel,GraniteForCausalLM:()=>t.GraniteForCausalLM,GraniteModel:()=>t.GraniteModel,GraniteMoeHybridForCausalLM:()=>t.GraniteMoeHybridForCausalLM,GraniteMoeHybridModel:()=>t.GraniteMoeHybridModel,GraniteMoeHybridPreTrainedModel:()=>t.GraniteMoeHybridPreTrainedModel,GranitePreTrainedModel:()=>t.GranitePreTrainedModel,Grok1Tokenizer:()=>s.Grok1Tokenizer,GroundingDinoForObjectDetection:()=>t.GroundingDinoForObjectDetection,GroundingDinoImageProcessor:()=>v.GroundingDinoImageProcessor,GroundingDinoPreTrainedModel:()=>t.GroundingDinoPreTrainedModel,GroundingDinoProcessor:()=>b.GroundingDinoProcessor,GroupViTModel:()=>t.GroupViTModel,GroupViTPreTrainedModel:()=>t.GroupViTPreTrainedModel,HeliumForCausalLM:()=>t.HeliumForCausalLM,HeliumModel:()=>t.HeliumModel,HeliumPreTrainedModel:()=>t.HeliumPreTrainedModel,HerbertTokenizer:()=>s.HerbertTokenizer,HieraForImageClassification:()=>t.HieraForImageClassification,HieraModel:()=>t.HieraModel,HieraPreTrainedModel:()=>t.HieraPreTrainedModel,HubertForCTC:()=>t.HubertForCTC,HubertForSequenceClassification:()=>t.HubertForSequenceClassification,HubertModel:()=>t.HubertModel,HubertPreTrainedModel:()=>t.HubertPreTrainedModel,IJepaForImageClassification:()=>t.IJepaForImageClassification,IJepaModel:()=>t.IJepaModel,IJepaPreTrainedModel:()=>t.IJepaPreTrainedModel,Idefics3ForConditionalGeneration:()=>t.Idefics3ForConditionalGeneration,Idefics3ImageProcessor:()=>v.Idefics3ImageProcessor,Idefics3PreTrainedModel:()=>t.Idefics3PreTrainedModel,Idefics3Processor:()=>b.Idefics3Processor,ImageClassificationPipeline:()=>n.ImageClassificationPipeline,ImageFeatureExtractionPipeline:()=>n.ImageFeatureExtractionPipeline,ImageFeatureExtractor:()=>_.ImageFeatureExtractor,ImageMattingOutput:()=>t.ImageMattingOutput,ImageProcessor:()=>y.ImageProcessor,ImageSegmentationPipeline:()=>n.ImageSegmentationPipeline,ImageToImagePipeline:()=>n.ImageToImagePipeline,ImageToTextPipeline:()=>n.ImageToTextPipeline,InterruptableStoppingCriteria:()=>w.InterruptableStoppingCriteria,JAISLMHeadModel:()=>t.JAISLMHeadModel,JAISModel:()=>t.JAISModel,JAISPreTrainedModel:()=>t.JAISPreTrainedModel,JinaCLIPImageProcessor:()=>v.JinaCLIPImageProcessor,JinaCLIPModel:()=>t.JinaCLIPModel,JinaCLIPPreTrainedModel:()=>t.JinaCLIPPreTrainedModel,JinaCLIPProcessor:()=>b.JinaCLIPProcessor,JinaCLIPTextModel:()=>t.JinaCLIPTextModel,JinaCLIPVisionModel:()=>t.JinaCLIPVisionModel,Lfm2ForCausalLM:()=>t.Lfm2ForCausalLM,Lfm2Model:()=>t.Lfm2Model,Lfm2PreTrainedModel:()=>t.Lfm2PreTrainedModel,LiteWhisperForConditionalGeneration:()=>t.LiteWhisperForConditionalGeneration,Llama4ForCausalLM:()=>t.Llama4ForCausalLM,Llama4PreTrainedModel:()=>t.Llama4PreTrainedModel,LlamaForCausalLM:()=>t.LlamaForCausalLM,LlamaModel:()=>t.LlamaModel,LlamaPreTrainedModel:()=>t.LlamaPreTrainedModel,LlamaTokenizer:()=>s.LlamaTokenizer,LlavaForConditionalGeneration:()=>t.LlavaForConditionalGeneration,LlavaOnevisionForConditionalGeneration:()=>t.LlavaOnevisionForConditionalGeneration,LlavaOnevisionImageProcessor:()=>v.LlavaOnevisionImageProcessor,LlavaPreTrainedModel:()=>t.LlavaPreTrainedModel,LlavaProcessor:()=>b.LlavaProcessor,LlavaQwen2ForCausalLM:()=>t.LlavaQwen2ForCausalLM,LogitsProcessor:()=>C.LogitsProcessor,LogitsProcessorList:()=>C.LogitsProcessorList,LogitsWarper:()=>C.LogitsWarper,LongT5ForConditionalGeneration:()=>t.LongT5ForConditionalGeneration,LongT5Model:()=>t.LongT5Model,LongT5PreTrainedModel:()=>t.LongT5PreTrainedModel,M2M100ForConditionalGeneration:()=>t.M2M100ForConditionalGeneration,M2M100Model:()=>t.M2M100Model,M2M100PreTrainedModel:()=>t.M2M100PreTrainedModel,M2M100Tokenizer:()=>s.M2M100Tokenizer,MBart50Tokenizer:()=>s.MBart50Tokenizer,MBartForCausalLM:()=>t.MBartForCausalLM,MBartForConditionalGeneration:()=>t.MBartForConditionalGeneration,MBartForSequenceClassification:()=>t.MBartForSequenceClassification,MBartModel:()=>t.MBartModel,MBartPreTrainedModel:()=>t.MBartPreTrainedModel,MBartTokenizer:()=>s.MBartTokenizer,MPNetForMaskedLM:()=>t.MPNetForMaskedLM,MPNetForQuestionAnswering:()=>t.MPNetForQuestionAnswering,MPNetForSequenceClassification:()=>t.MPNetForSequenceClassification,MPNetForTokenClassification:()=>t.MPNetForTokenClassification,MPNetModel:()=>t.MPNetModel,MPNetPreTrainedModel:()=>t.MPNetPreTrainedModel,MPNetTokenizer:()=>s.MPNetTokenizer,MT5ForConditionalGeneration:()=>t.MT5ForConditionalGeneration,MT5Model:()=>t.MT5Model,MT5PreTrainedModel:()=>t.MT5PreTrainedModel,MarianMTModel:()=>t.MarianMTModel,MarianModel:()=>t.MarianModel,MarianPreTrainedModel:()=>t.MarianPreTrainedModel,MarianTokenizer:()=>s.MarianTokenizer,Mask2FormerImageProcessor:()=>v.Mask2FormerImageProcessor,MaskFormerFeatureExtractor:()=>v.MaskFormerFeatureExtractor,MaskFormerForInstanceSegmentation:()=>t.MaskFormerForInstanceSegmentation,MaskFormerImageProcessor:()=>v.MaskFormerImageProcessor,MaskFormerModel:()=>t.MaskFormerModel,MaskFormerPreTrainedModel:()=>t.MaskFormerPreTrainedModel,MaskedLMOutput:()=>t.MaskedLMOutput,MaxLengthCriteria:()=>w.MaxLengthCriteria,Metric3DForDepthEstimation:()=>t.Metric3DForDepthEstimation,Metric3DPreTrainedModel:()=>t.Metric3DPreTrainedModel,Metric3Dv2ForDepthEstimation:()=>t.Metric3Dv2ForDepthEstimation,Metric3Dv2PreTrainedModel:()=>t.Metric3Dv2PreTrainedModel,MgpstrForSceneTextRecognition:()=>t.MgpstrForSceneTextRecognition,MgpstrModelOutput:()=>t.MgpstrModelOutput,MgpstrPreTrainedModel:()=>t.MgpstrPreTrainedModel,MgpstrProcessor:()=>b.MgpstrProcessor,MgpstrTokenizer:()=>s.MgpstrTokenizer,MimiDecoderModel:()=>t.MimiDecoderModel,MimiDecoderOutput:()=>t.MimiDecoderOutput,MimiEncoderModel:()=>t.MimiEncoderModel,MimiEncoderOutput:()=>t.MimiEncoderOutput,MimiModel:()=>t.MimiModel,MimiPreTrainedModel:()=>t.MimiPreTrainedModel,MinLengthLogitsProcessor:()=>C.MinLengthLogitsProcessor,MinNewTokensLengthLogitsProcessor:()=>C.MinNewTokensLengthLogitsProcessor,Ministral3ForCausalLM:()=>t.Ministral3ForCausalLM,Ministral3Model:()=>t.Ministral3Model,Ministral3PreTrainedModel:()=>t.Ministral3PreTrainedModel,MinistralForCausalLM:()=>t.MinistralForCausalLM,MinistralModel:()=>t.MinistralModel,MinistralPreTrainedModel:()=>t.MinistralPreTrainedModel,Mistral3ForConditionalGeneration:()=>t.Mistral3ForConditionalGeneration,MistralForCausalLM:()=>t.MistralForCausalLM,MistralModel:()=>t.MistralModel,MistralPreTrainedModel:()=>t.MistralPreTrainedModel,MobileBertForMaskedLM:()=>t.MobileBertForMaskedLM,MobileBertForQuestionAnswering:()=>t.MobileBertForQuestionAnswering,MobileBertForSequenceClassification:()=>t.MobileBertForSequenceClassification,MobileBertModel:()=>t.MobileBertModel,MobileBertPreTrainedModel:()=>t.MobileBertPreTrainedModel,MobileBertTokenizer:()=>s.MobileBertTokenizer,MobileLLMForCausalLM:()=>t.MobileLLMForCausalLM,MobileLLMModel:()=>t.MobileLLMModel,MobileLLMPreTrainedModel:()=>t.MobileLLMPreTrainedModel,MobileNetV1FeatureExtractor:()=>v.MobileNetV1FeatureExtractor,MobileNetV1ForImageClassification:()=>t.MobileNetV1ForImageClassification,MobileNetV1ForSemanticSegmentation:()=>t.MobileNetV1ForSemanticSegmentation,MobileNetV1ImageProcessor:()=>v.MobileNetV1ImageProcessor,MobileNetV1Model:()=>t.MobileNetV1Model,MobileNetV1PreTrainedModel:()=>t.MobileNetV1PreTrainedModel,MobileNetV2FeatureExtractor:()=>v.MobileNetV2FeatureExtractor,MobileNetV2ForImageClassification:()=>t.MobileNetV2ForImageClassification,MobileNetV2ForSemanticSegmentation:()=>t.MobileNetV2ForSemanticSegmentation,MobileNetV2ImageProcessor:()=>v.MobileNetV2ImageProcessor,MobileNetV2Model:()=>t.MobileNetV2Model,MobileNetV2PreTrainedModel:()=>t.MobileNetV2PreTrainedModel,MobileNetV3FeatureExtractor:()=>v.MobileNetV3FeatureExtractor,MobileNetV3ForImageClassification:()=>t.MobileNetV3ForImageClassification,MobileNetV3ForSemanticSegmentation:()=>t.MobileNetV3ForSemanticSegmentation,MobileNetV3ImageProcessor:()=>v.MobileNetV3ImageProcessor,MobileNetV3Model:()=>t.MobileNetV3Model,MobileNetV3PreTrainedModel:()=>t.MobileNetV3PreTrainedModel,MobileNetV4FeatureExtractor:()=>v.MobileNetV4FeatureExtractor,MobileNetV4ForImageClassification:()=>t.MobileNetV4ForImageClassification,MobileNetV4ForSemanticSegmentation:()=>t.MobileNetV4ForSemanticSegmentation,MobileNetV4ImageProcessor:()=>v.MobileNetV4ImageProcessor,MobileNetV4Model:()=>t.MobileNetV4Model,MobileNetV4PreTrainedModel:()=>t.MobileNetV4PreTrainedModel,MobileViTFeatureExtractor:()=>v.MobileViTFeatureExtractor,MobileViTForImageClassification:()=>t.MobileViTForImageClassification,MobileViTImageProcessor:()=>v.MobileViTImageProcessor,MobileViTModel:()=>t.MobileViTModel,MobileViTPreTrainedModel:()=>t.MobileViTPreTrainedModel,MobileViTV2ForImageClassification:()=>t.MobileViTV2ForImageClassification,MobileViTV2Model:()=>t.MobileViTV2Model,MobileViTV2PreTrainedModel:()=>t.MobileViTV2PreTrainedModel,ModelOutput:()=>t.ModelOutput,ModernBertDecoderForCausalLM:()=>t.ModernBertDecoderForCausalLM,ModernBertDecoderModel:()=>t.ModernBertDecoderModel,ModernBertDecoderPreTrainedModel:()=>t.ModernBertDecoderPreTrainedModel,ModernBertForMaskedLM:()=>t.ModernBertForMaskedLM,ModernBertForSequenceClassification:()=>t.ModernBertForSequenceClassification,ModernBertForTokenClassification:()=>t.ModernBertForTokenClassification,ModernBertModel:()=>t.ModernBertModel,ModernBertPreTrainedModel:()=>t.ModernBertPreTrainedModel,Moondream1ForConditionalGeneration:()=>t.Moondream1ForConditionalGeneration,MoonshineFeatureExtractor:()=>_.MoonshineFeatureExtractor,MoonshineForConditionalGeneration:()=>t.MoonshineForConditionalGeneration,MoonshineModel:()=>t.MoonshineModel,MoonshinePreTrainedModel:()=>t.MoonshinePreTrainedModel,MoonshineProcessor:()=>b.MoonshineProcessor,MptForCausalLM:()=>t.MptForCausalLM,MptModel:()=>t.MptModel,MptPreTrainedModel:()=>t.MptPreTrainedModel,MultiModalityCausalLM:()=>t.MultiModalityCausalLM,MultiModalityPreTrainedModel:()=>t.MultiModalityPreTrainedModel,MusicgenForCausalLM:()=>t.MusicgenForCausalLM,MusicgenForConditionalGeneration:()=>t.MusicgenForConditionalGeneration,MusicgenModel:()=>t.MusicgenModel,MusicgenPreTrainedModel:()=>t.MusicgenPreTrainedModel,NanoChatForCausalLM:()=>t.NanoChatForCausalLM,NanoChatModel:()=>t.NanoChatModel,NanoChatPreTrainedModel:()=>t.NanoChatPreTrainedModel,NeoBertForMaskedLM:()=>t.NeoBertForMaskedLM,NeoBertForQuestionAnswering:()=>t.NeoBertForQuestionAnswering,NeoBertForSequenceClassification:()=>t.NeoBertForSequenceClassification,NeoBertForTokenClassification:()=>t.NeoBertForTokenClassification,NeoBertModel:()=>t.NeoBertModel,NeoBertPreTrainedModel:()=>t.NeoBertPreTrainedModel,NllbTokenizer:()=>s.NllbTokenizer,NoBadWordsLogitsProcessor:()=>C.NoBadWordsLogitsProcessor,NoRepeatNGramLogitsProcessor:()=>C.NoRepeatNGramLogitsProcessor,NomicBertModel:()=>t.NomicBertModel,NomicBertPreTrainedModel:()=>t.NomicBertPreTrainedModel,NougatImageProcessor:()=>v.NougatImageProcessor,NougatTokenizer:()=>s.NougatTokenizer,OPTForCausalLM:()=>t.OPTForCausalLM,OPTModel:()=>t.OPTModel,OPTPreTrainedModel:()=>t.OPTPreTrainedModel,ObjectDetectionPipeline:()=>n.ObjectDetectionPipeline,Olmo2ForCausalLM:()=>t.Olmo2ForCausalLM,Olmo2Model:()=>t.Olmo2Model,Olmo2PreTrainedModel:()=>t.Olmo2PreTrainedModel,OlmoForCausalLM:()=>t.OlmoForCausalLM,OlmoModel:()=>t.OlmoModel,OlmoPreTrainedModel:()=>t.OlmoPreTrainedModel,OpenELMForCausalLM:()=>t.OpenELMForCausalLM,OpenELMModel:()=>t.OpenELMModel,OpenELMPreTrainedModel:()=>t.OpenELMPreTrainedModel,OwlViTFeatureExtractor:()=>v.OwlViTFeatureExtractor,OwlViTForObjectDetection:()=>t.OwlViTForObjectDetection,OwlViTImageProcessor:()=>v.OwlViTImageProcessor,OwlViTModel:()=>t.OwlViTModel,OwlViTPreTrainedModel:()=>t.OwlViTPreTrainedModel,OwlViTProcessor:()=>b.OwlViTProcessor,Owlv2ForObjectDetection:()=>t.Owlv2ForObjectDetection,Owlv2ImageProcessor:()=>v.Owlv2ImageProcessor,Owlv2Model:()=>t.Owlv2Model,Owlv2PreTrainedModel:()=>t.Owlv2PreTrainedModel,PaliGemmaForConditionalGeneration:()=>t.PaliGemmaForConditionalGeneration,PaliGemmaPreTrainedModel:()=>t.PaliGemmaPreTrainedModel,PaliGemmaProcessor:()=>b.PaliGemmaProcessor,ParakeetFeatureExtractor:()=>_.ParakeetFeatureExtractor,ParakeetForCTC:()=>t.ParakeetForCTC,ParakeetPreTrainedModel:()=>t.ParakeetPreTrainedModel,PatchTSMixerForPrediction:()=>t.PatchTSMixerForPrediction,PatchTSMixerModel:()=>t.PatchTSMixerModel,PatchTSMixerPreTrainedModel:()=>t.PatchTSMixerPreTrainedModel,PatchTSTForPrediction:()=>t.PatchTSTForPrediction,PatchTSTModel:()=>t.PatchTSTModel,PatchTSTPreTrainedModel:()=>t.PatchTSTPreTrainedModel,Phi3ForCausalLM:()=>t.Phi3ForCausalLM,Phi3Model:()=>t.Phi3Model,Phi3PreTrainedModel:()=>t.Phi3PreTrainedModel,Phi3VForCausalLM:()=>t.Phi3VForCausalLM,Phi3VImageProcessor:()=>v.Phi3VImageProcessor,Phi3VPreTrainedModel:()=>t.Phi3VPreTrainedModel,Phi3VProcessor:()=>b.Phi3VProcessor,PhiForCausalLM:()=>t.PhiForCausalLM,PhiModel:()=>t.PhiModel,PhiPreTrainedModel:()=>t.PhiPreTrainedModel,Pipeline:()=>n.Pipeline,PixtralImageProcessor:()=>v.PixtralImageProcessor,PixtralProcessor:()=>b.PixtralProcessor,PreTrainedModel:()=>t.PreTrainedModel,PreTrainedTokenizer:()=>s.PreTrainedTokenizer,PretrainedConfig:()=>i.PretrainedConfig,PretrainedMixin:()=>t.PretrainedMixin,Processor:()=>k.Processor,PvtForImageClassification:()=>t.PvtForImageClassification,PvtImageProcessor:()=>v.PvtImageProcessor,PvtModel:()=>t.PvtModel,PvtPreTrainedModel:()=>t.PvtPreTrainedModel,PyAnnoteFeatureExtractor:()=>_.PyAnnoteFeatureExtractor,PyAnnoteForAudioFrameClassification:()=>t.PyAnnoteForAudioFrameClassification,PyAnnoteModel:()=>t.PyAnnoteModel,PyAnnotePreTrainedModel:()=>t.PyAnnotePreTrainedModel,PyAnnoteProcessor:()=>b.PyAnnoteProcessor,QuestionAnsweringModelOutput:()=>t.QuestionAnsweringModelOutput,QuestionAnsweringPipeline:()=>n.QuestionAnsweringPipeline,Qwen2ForCausalLM:()=>t.Qwen2ForCausalLM,Qwen2Model:()=>t.Qwen2Model,Qwen2PreTrainedModel:()=>t.Qwen2PreTrainedModel,Qwen2Tokenizer:()=>s.Qwen2Tokenizer,Qwen2VLForConditionalGeneration:()=>t.Qwen2VLForConditionalGeneration,Qwen2VLImageProcessor:()=>v.Qwen2VLImageProcessor,Qwen2VLPreTrainedModel:()=>t.Qwen2VLPreTrainedModel,Qwen2VLProcessor:()=>b.Qwen2VLProcessor,Qwen3ForCausalLM:()=>t.Qwen3ForCausalLM,Qwen3Model:()=>t.Qwen3Model,Qwen3PreTrainedModel:()=>t.Qwen3PreTrainedModel,RFDetrForObjectDetection:()=>t.RFDetrForObjectDetection,RFDetrModel:()=>t.RFDetrModel,RFDetrObjectDetectionOutput:()=>t.RFDetrObjectDetectionOutput,RFDetrPreTrainedModel:()=>t.RFDetrPreTrainedModel,RTDetrForObjectDetection:()=>t.RTDetrForObjectDetection,RTDetrImageProcessor:()=>v.RTDetrImageProcessor,RTDetrModel:()=>t.RTDetrModel,RTDetrObjectDetectionOutput:()=>t.RTDetrObjectDetectionOutput,RTDetrPreTrainedModel:()=>t.RTDetrPreTrainedModel,RTDetrV2ForObjectDetection:()=>t.RTDetrV2ForObjectDetection,RTDetrV2Model:()=>t.RTDetrV2Model,RTDetrV2ObjectDetectionOutput:()=>t.RTDetrV2ObjectDetectionOutput,RTDetrV2PreTrainedModel:()=>t.RTDetrV2PreTrainedModel,RawAudio:()=>l.RawAudio,RawImage:()=>c.RawImage,RawVideo:()=>u.RawVideo,RawVideoFrame:()=>u.RawVideoFrame,RepetitionPenaltyLogitsProcessor:()=>C.RepetitionPenaltyLogitsProcessor,ResNetForImageClassification:()=>t.ResNetForImageClassification,ResNetModel:()=>t.ResNetModel,ResNetPreTrainedModel:()=>t.ResNetPreTrainedModel,RoFormerForMaskedLM:()=>t.RoFormerForMaskedLM,RoFormerForQuestionAnswering:()=>t.RoFormerForQuestionAnswering,RoFormerForSequenceClassification:()=>t.RoFormerForSequenceClassification,RoFormerForTokenClassification:()=>t.RoFormerForTokenClassification,RoFormerModel:()=>t.RoFormerModel,RoFormerPreTrainedModel:()=>t.RoFormerPreTrainedModel,RoFormerTokenizer:()=>s.RoFormerTokenizer,RobertaForMaskedLM:()=>t.RobertaForMaskedLM,RobertaForQuestionAnswering:()=>t.RobertaForQuestionAnswering,RobertaForSequenceClassification:()=>t.RobertaForSequenceClassification,RobertaForTokenClassification:()=>t.RobertaForTokenClassification,RobertaModel:()=>t.RobertaModel,RobertaPreTrainedModel:()=>t.RobertaPreTrainedModel,RobertaTokenizer:()=>s.RobertaTokenizer,Sam2ImageProcessor:()=>v.Sam2ImageProcessor,Sam2ImageSegmentationOutput:()=>t.Sam2ImageSegmentationOutput,Sam2Model:()=>t.Sam2Model,Sam2PreTrainedModel:()=>t.Sam2PreTrainedModel,Sam2Processor:()=>b.Sam2Processor,Sam2VideoProcessor:()=>b.Sam2VideoProcessor,Sam3ImageProcessor:()=>v.Sam3ImageProcessor,Sam3TrackerModel:()=>t.Sam3TrackerModel,SamImageProcessor:()=>v.SamImageProcessor,SamImageSegmentationOutput:()=>t.SamImageSegmentationOutput,SamModel:()=>t.SamModel,SamPreTrainedModel:()=>t.SamPreTrainedModel,SamProcessor:()=>b.SamProcessor,SapiensForDepthEstimation:()=>t.SapiensForDepthEstimation,SapiensForNormalEstimation:()=>t.SapiensForNormalEstimation,SapiensForSemanticSegmentation:()=>t.SapiensForSemanticSegmentation,SapiensPreTrainedModel:()=>t.SapiensPreTrainedModel,SeamlessM4TFeatureExtractor:()=>_.SeamlessM4TFeatureExtractor,SegformerFeatureExtractor:()=>v.SegformerFeatureExtractor,SegformerForImageClassification:()=>t.SegformerForImageClassification,SegformerForSemanticSegmentation:()=>t.SegformerForSemanticSegmentation,SegformerImageProcessor:()=>v.SegformerImageProcessor,SegformerModel:()=>t.SegformerModel,SegformerPreTrainedModel:()=>t.SegformerPreTrainedModel,Seq2SeqLMOutput:()=>t.Seq2SeqLMOutput,SequenceClassifierOutput:()=>t.SequenceClassifierOutput,SiglipImageProcessor:()=>v.SiglipImageProcessor,SiglipModel:()=>t.SiglipModel,SiglipPreTrainedModel:()=>t.SiglipPreTrainedModel,SiglipTextModel:()=>t.SiglipTextModel,SiglipTokenizer:()=>s.SiglipTokenizer,SiglipVisionModel:()=>t.SiglipVisionModel,SmolLM3ForCausalLM:()=>t.SmolLM3ForCausalLM,SmolLM3Model:()=>t.SmolLM3Model,SmolLM3PreTrainedModel:()=>t.SmolLM3PreTrainedModel,SmolVLMForConditionalGeneration:()=>t.SmolVLMForConditionalGeneration,SmolVLMImageProcessor:()=>v.SmolVLMImageProcessor,SmolVLMProcessor:()=>b.SmolVLMProcessor,SnacDecoderModel:()=>t.SnacDecoderModel,SnacEncoderModel:()=>t.SnacEncoderModel,SnacFeatureExtractor:()=>_.SnacFeatureExtractor,SnacModel:()=>t.SnacModel,SnacPreTrainedModel:()=>t.SnacPreTrainedModel,SpeechT5FeatureExtractor:()=>_.SpeechT5FeatureExtractor,SpeechT5ForSpeechToText:()=>t.SpeechT5ForSpeechToText,SpeechT5ForTextToSpeech:()=>t.SpeechT5ForTextToSpeech,SpeechT5HifiGan:()=>t.SpeechT5HifiGan,SpeechT5Model:()=>t.SpeechT5Model,SpeechT5PreTrainedModel:()=>t.SpeechT5PreTrainedModel,SpeechT5Processor:()=>b.SpeechT5Processor,SpeechT5Tokenizer:()=>s.SpeechT5Tokenizer,SqueezeBertForMaskedLM:()=>t.SqueezeBertForMaskedLM,SqueezeBertForQuestionAnswering:()=>t.SqueezeBertForQuestionAnswering,SqueezeBertForSequenceClassification:()=>t.SqueezeBertForSequenceClassification,SqueezeBertModel:()=>t.SqueezeBertModel,SqueezeBertPreTrainedModel:()=>t.SqueezeBertPreTrainedModel,SqueezeBertTokenizer:()=>s.SqueezeBertTokenizer,StableLmForCausalLM:()=>t.StableLmForCausalLM,StableLmModel:()=>t.StableLmModel,StableLmPreTrainedModel:()=>t.StableLmPreTrainedModel,Starcoder2ForCausalLM:()=>t.Starcoder2ForCausalLM,Starcoder2Model:()=>t.Starcoder2Model,Starcoder2PreTrainedModel:()=>t.Starcoder2PreTrainedModel,StoppingCriteria:()=>w.StoppingCriteria,StoppingCriteriaList:()=>w.StoppingCriteriaList,StyleTextToSpeech2Model:()=>t.StyleTextToSpeech2Model,StyleTextToSpeech2PreTrainedModel:()=>t.StyleTextToSpeech2PreTrainedModel,SummarizationPipeline:()=>n.SummarizationPipeline,SupertonicForConditionalGeneration:()=>t.SupertonicForConditionalGeneration,SupertonicPreTrainedModel:()=>t.SupertonicPreTrainedModel,SuppressTokensAtBeginLogitsProcessor:()=>C.SuppressTokensAtBeginLogitsProcessor,Swin2SRForImageSuperResolution:()=>t.Swin2SRForImageSuperResolution,Swin2SRImageProcessor:()=>v.Swin2SRImageProcessor,Swin2SRModel:()=>t.Swin2SRModel,Swin2SRPreTrainedModel:()=>t.Swin2SRPreTrainedModel,SwinForImageClassification:()=>t.SwinForImageClassification,SwinForSemanticSegmentation:()=>t.SwinForSemanticSegmentation,SwinModel:()=>t.SwinModel,SwinPreTrainedModel:()=>t.SwinPreTrainedModel,T5ForConditionalGeneration:()=>t.T5ForConditionalGeneration,T5Model:()=>t.T5Model,T5PreTrainedModel:()=>t.T5PreTrainedModel,T5Tokenizer:()=>s.T5Tokenizer,TableTransformerForObjectDetection:()=>t.TableTransformerForObjectDetection,TableTransformerModel:()=>t.TableTransformerModel,TableTransformerObjectDetectionOutput:()=>t.TableTransformerObjectDetectionOutput,TableTransformerPreTrainedModel:()=>t.TableTransformerPreTrainedModel,TemperatureLogitsWarper:()=>C.TemperatureLogitsWarper,Tensor:()=>d.Tensor,Text2TextGenerationPipeline:()=>n.Text2TextGenerationPipeline,TextClassificationPipeline:()=>n.TextClassificationPipeline,TextGenerationPipeline:()=>n.TextGenerationPipeline,TextStreamer:()=>$.TextStreamer,TextToAudioPipeline:()=>n.TextToAudioPipeline,TokenClassificationPipeline:()=>n.TokenClassificationPipeline,TokenClassifierOutput:()=>t.TokenClassifierOutput,TokenizerModel:()=>s.TokenizerModel,TopKLogitsWarper:()=>C.TopKLogitsWarper,TopPLogitsWarper:()=>C.TopPLogitsWarper,TrOCRForCausalLM:()=>t.TrOCRForCausalLM,TrOCRPreTrainedModel:()=>t.TrOCRPreTrainedModel,TranslationPipeline:()=>n.TranslationPipeline,UltravoxModel:()=>t.UltravoxModel,UltravoxPreTrainedModel:()=>t.UltravoxPreTrainedModel,UltravoxProcessor:()=>b.UltravoxProcessor,UniSpeechForCTC:()=>t.UniSpeechForCTC,UniSpeechForSequenceClassification:()=>t.UniSpeechForSequenceClassification,UniSpeechModel:()=>t.UniSpeechModel,UniSpeechPreTrainedModel:()=>t.UniSpeechPreTrainedModel,UniSpeechSatForAudioFrameClassification:()=>t.UniSpeechSatForAudioFrameClassification,UniSpeechSatForCTC:()=>t.UniSpeechSatForCTC,UniSpeechSatForSequenceClassification:()=>t.UniSpeechSatForSequenceClassification,UniSpeechSatModel:()=>t.UniSpeechSatModel,UniSpeechSatPreTrainedModel:()=>t.UniSpeechSatPreTrainedModel,VLChatProcessor:()=>b.VLChatProcessor,VLMImageProcessor:()=>v.VLMImageProcessor,VaultGemmaForCausalLM:()=>t.VaultGemmaForCausalLM,VaultGemmaModel:()=>t.VaultGemmaModel,VaultGemmaPreTrainedModel:()=>t.VaultGemmaPreTrainedModel,ViTFeatureExtractor:()=>v.ViTFeatureExtractor,ViTForImageClassification:()=>t.ViTForImageClassification,ViTImageProcessor:()=>v.ViTImageProcessor,ViTMAEModel:()=>t.ViTMAEModel,ViTMAEPreTrainedModel:()=>t.ViTMAEPreTrainedModel,ViTMSNForImageClassification:()=>t.ViTMSNForImageClassification,ViTMSNModel:()=>t.ViTMSNModel,ViTMSNPreTrainedModel:()=>t.ViTMSNPreTrainedModel,ViTModel:()=>t.ViTModel,ViTPreTrainedModel:()=>t.ViTPreTrainedModel,VisionEncoderDecoderModel:()=>t.VisionEncoderDecoderModel,VitMatteForImageMatting:()=>t.VitMatteForImageMatting,VitMatteImageProcessor:()=>v.VitMatteImageProcessor,VitMattePreTrainedModel:()=>t.VitMattePreTrainedModel,VitPoseForPoseEstimation:()=>t.VitPoseForPoseEstimation,VitPoseImageProcessor:()=>v.VitPoseImageProcessor,VitPosePreTrainedModel:()=>t.VitPosePreTrainedModel,VitsModel:()=>t.VitsModel,VitsModelOutput:()=>t.VitsModelOutput,VitsPreTrainedModel:()=>t.VitsPreTrainedModel,VitsTokenizer:()=>s.VitsTokenizer,VoxtralForConditionalGeneration:()=>t.VoxtralForConditionalGeneration,VoxtralProcessor:()=>b.VoxtralProcessor,Wav2Vec2BertForCTC:()=>t.Wav2Vec2BertForCTC,Wav2Vec2BertForSequenceClassification:()=>t.Wav2Vec2BertForSequenceClassification,Wav2Vec2BertModel:()=>t.Wav2Vec2BertModel,Wav2Vec2BertPreTrainedModel:()=>t.Wav2Vec2BertPreTrainedModel,Wav2Vec2CTCTokenizer:()=>s.Wav2Vec2CTCTokenizer,Wav2Vec2FeatureExtractor:()=>_.Wav2Vec2FeatureExtractor,Wav2Vec2ForAudioFrameClassification:()=>t.Wav2Vec2ForAudioFrameClassification,Wav2Vec2ForCTC:()=>t.Wav2Vec2ForCTC,Wav2Vec2ForSequenceClassification:()=>t.Wav2Vec2ForSequenceClassification,Wav2Vec2Model:()=>t.Wav2Vec2Model,Wav2Vec2PreTrainedModel:()=>t.Wav2Vec2PreTrainedModel,Wav2Vec2Processor:()=>b.Wav2Vec2Processor,Wav2Vec2ProcessorWithLM:()=>b.Wav2Vec2ProcessorWithLM,WavLMForAudioFrameClassification:()=>t.WavLMForAudioFrameClassification,WavLMForCTC:()=>t.WavLMForCTC,WavLMForSequenceClassification:()=>t.WavLMForSequenceClassification,WavLMForXVector:()=>t.WavLMForXVector,WavLMModel:()=>t.WavLMModel,WavLMPreTrainedModel:()=>t.WavLMPreTrainedModel,WeSpeakerFeatureExtractor:()=>_.WeSpeakerFeatureExtractor,WeSpeakerResNetModel:()=>t.WeSpeakerResNetModel,WeSpeakerResNetPreTrainedModel:()=>t.WeSpeakerResNetPreTrainedModel,WhisperFeatureExtractor:()=>_.WhisperFeatureExtractor,WhisperForConditionalGeneration:()=>t.WhisperForConditionalGeneration,WhisperModel:()=>t.WhisperModel,WhisperPreTrainedModel:()=>t.WhisperPreTrainedModel,WhisperProcessor:()=>b.WhisperProcessor,WhisperTextStreamer:()=>$.WhisperTextStreamer,WhisperTimeStampLogitsProcessor:()=>C.WhisperTimeStampLogitsProcessor,WhisperTokenizer:()=>s.WhisperTokenizer,XLMForQuestionAnswering:()=>t.XLMForQuestionAnswering,XLMForSequenceClassification:()=>t.XLMForSequenceClassification,XLMForTokenClassification:()=>t.XLMForTokenClassification,XLMModel:()=>t.XLMModel,XLMPreTrainedModel:()=>t.XLMPreTrainedModel,XLMRobertaForMaskedLM:()=>t.XLMRobertaForMaskedLM,XLMRobertaForQuestionAnswering:()=>t.XLMRobertaForQuestionAnswering,XLMRobertaForSequenceClassification:()=>t.XLMRobertaForSequenceClassification,XLMRobertaForTokenClassification:()=>t.XLMRobertaForTokenClassification,XLMRobertaModel:()=>t.XLMRobertaModel,XLMRobertaPreTrainedModel:()=>t.XLMRobertaPreTrainedModel,XLMRobertaTokenizer:()=>s.XLMRobertaTokenizer,XLMTokenizer:()=>s.XLMTokenizer,XLMWithLMHeadModel:()=>t.XLMWithLMHeadModel,XVectorOutput:()=>t.XVectorOutput,YolosFeatureExtractor:()=>v.YolosFeatureExtractor,YolosForObjectDetection:()=>t.YolosForObjectDetection,YolosImageProcessor:()=>v.YolosImageProcessor,YolosModel:()=>t.YolosModel,YolosObjectDetectionOutput:()=>t.YolosObjectDetectionOutput,YolosPreTrainedModel:()=>t.YolosPreTrainedModel,ZeroShotAudioClassificationPipeline:()=>n.ZeroShotAudioClassificationPipeline,ZeroShotClassificationPipeline:()=>n.ZeroShotClassificationPipeline,ZeroShotImageClassificationPipeline:()=>n.ZeroShotImageClassificationPipeline,ZeroShotObjectDetectionPipeline:()=>n.ZeroShotObjectDetectionPipeline,bankers_round:()=>f.bankers_round,cat:()=>d.cat,cos_sim:()=>f.cos_sim,dot:()=>f.dot,dynamic_time_warping:()=>f.dynamic_time_warping,env:()=>e.env,full:()=>d.full,full_like:()=>d.full_like,getCacheShapes:()=>i.getCacheShapes,hamming:()=>l.hamming,hanning:()=>l.hanning,interpolate:()=>d.interpolate,interpolate_4d:()=>d.interpolate_4d,interpolate_data:()=>f.interpolate_data,is_chinese_char:()=>s.is_chinese_char,layer_norm:()=>d.layer_norm,load_image:()=>c.load_image,load_video:()=>u.load_video,log_softmax:()=>f.log_softmax,magnitude:()=>f.magnitude,matmul:()=>d.matmul,max:()=>f.max,mean:()=>d.mean,mean_pooling:()=>d.mean_pooling,medianFilter:()=>f.medianFilter,mel_filter_bank:()=>l.mel_filter_bank,min:()=>f.min,ones:()=>d.ones,ones_like:()=>d.ones_like,permute:()=>d.permute,permute_data:()=>f.permute_data,pipeline:()=>n.pipeline,quantize_embeddings:()=>d.quantize_embeddings,rand:()=>d.rand,randn:()=>d.randn,read_audio:()=>l.read_audio,rfft:()=>d.rfft,round:()=>f.round,slice:()=>d.slice,softmax:()=>f.softmax,spectrogram:()=>l.spectrogram,stack:()=>d.stack,std_mean:()=>d.std_mean,topk:()=>d.topk,window_function:()=>l.window_function,zeros:()=>d.zeros,zeros_like:()=>d.zeros_like});var e=kn("./src/env.js"),n=kn("./src/pipelines.js"),t=kn("./src/models.js"),s=kn("./src/tokenizers.js"),i=kn("./src/configs.js"),l=kn("./src/utils/audio.js"),c=kn("./src/utils/image.js"),u=kn("./src/utils/video.js"),d=kn("./src/utils/tensor.js"),f=kn("./src/utils/maths.js"),m=kn("./src/base/feature_extraction_utils.js"),_=kn("./src/models/feature_extractors.js"),p=kn("./src/models/auto/feature_extraction_auto.js"),y=kn("./src/base/image_processors_utils.js"),v=kn("./src/models/image_processors.js"),T=kn("./src/models/auto/image_processing_auto.js"),k=kn("./src/base/processing_utils.js"),b=kn("./src/models/processors.js"),S=kn("./src/models/auto/processing_auto.js"),$=kn("./src/generation/streamers.js"),w=kn("./src/generation/stopping_criteria.js"),C=kn("./src/generation/logits_process.js")})();E.ASTFeatureExtractor;E.ASTForAudioClassification;E.ASTModel;E.ASTPreTrainedModel;E.AlbertForMaskedLM;E.AlbertForQuestionAnswering;E.AlbertForSequenceClassification;E.AlbertModel;E.AlbertPreTrainedModel;E.AlbertTokenizer;E.ArceeForCausalLM;E.ArceeModel;E.ArceePreTrainedModel;E.AudioClassificationPipeline;E.AutoConfig;E.AutoFeatureExtractor;E.AutoImageProcessor;E.AutoModel;E.AutoModelForAudioClassification;E.AutoModelForAudioFrameClassification;E.AutoModelForAudioTextToText;E.AutoModelForCTC;E.AutoModelForCausalLM;E.AutoModelForDepthEstimation;E.AutoModelForDocumentQuestionAnswering;E.AutoModelForImageClassification;E.AutoModelForImageFeatureExtraction;E.AutoModelForImageMatting;E.AutoModelForImageSegmentation;E.AutoModelForImageTextToText;E.AutoModelForImageToImage;E.AutoModelForMaskGeneration;E.AutoModelForMaskedLM;E.AutoModelForNormalEstimation;E.AutoModelForObjectDetection;E.AutoModelForPoseEstimation;E.AutoModelForQuestionAnswering;E.AutoModelForSemanticSegmentation;E.AutoModelForSeq2SeqLM;E.AutoModelForSequenceClassification;E.AutoModelForSpeechSeq2Seq;E.AutoModelForTextToSpectrogram;E.AutoModelForTextToWaveform;E.AutoModelForTokenClassification;E.AutoModelForUniversalSegmentation;E.AutoModelForVision2Seq;E.AutoModelForXVector;E.AutoModelForZeroShotObjectDetection;E.AutoProcessor;E.AutoTokenizer;E.AutomaticSpeechRecognitionPipeline;E.BackgroundRemovalPipeline;E.BartForConditionalGeneration;E.BartForSequenceClassification;E.BartModel;E.BartPretrainedModel;E.BartTokenizer;E.BaseModelOutput;E.BaseStreamer;E.BeitFeatureExtractor;E.BeitForImageClassification;E.BeitModel;E.BeitPreTrainedModel;E.BertForMaskedLM;E.BertForQuestionAnswering;E.BertForSequenceClassification;E.BertForTokenClassification;E.BertModel;E.BertPreTrainedModel;E.BertTokenizer;E.BitImageProcessor;E.BlenderbotForConditionalGeneration;E.BlenderbotModel;E.BlenderbotPreTrainedModel;E.BlenderbotSmallForConditionalGeneration;E.BlenderbotSmallModel;E.BlenderbotSmallPreTrainedModel;E.BlenderbotSmallTokenizer;E.BlenderbotTokenizer;E.BloomForCausalLM;E.BloomModel;E.BloomPreTrainedModel;E.BloomTokenizer;E.CLIPFeatureExtractor;E.CLIPImageProcessor;E.CLIPModel;E.CLIPPreTrainedModel;E.CLIPSegForImageSegmentation;E.CLIPSegModel;E.CLIPSegPreTrainedModel;E.CLIPTextModel;E.CLIPTextModelWithProjection;E.CLIPTokenizer;E.CLIPVisionModel;E.CLIPVisionModelWithProjection;E.CamembertForMaskedLM;E.CamembertForQuestionAnswering;E.CamembertForSequenceClassification;E.CamembertForTokenClassification;E.CamembertModel;E.CamembertPreTrainedModel;E.CamembertTokenizer;E.CausalLMOutput;E.CausalLMOutputWithPast;E.ChineseCLIPFeatureExtractor;E.ChineseCLIPModel;E.ChineseCLIPPreTrainedModel;E.ClapAudioModelWithProjection;E.ClapFeatureExtractor;E.ClapModel;E.ClapPreTrainedModel;E.ClapTextModelWithProjection;E.ClassifierFreeGuidanceLogitsProcessor;E.CodeGenForCausalLM;E.CodeGenModel;E.CodeGenPreTrainedModel;E.CodeGenTokenizer;E.CodeLlamaTokenizer;E.CohereForCausalLM;E.CohereModel;E.CoherePreTrainedModel;E.CohereTokenizer;E.ConvBertForMaskedLM;E.ConvBertForQuestionAnswering;E.ConvBertForSequenceClassification;E.ConvBertForTokenClassification;E.ConvBertModel;E.ConvBertPreTrainedModel;E.ConvBertTokenizer;E.ConvNextFeatureExtractor;E.ConvNextForImageClassification;E.ConvNextImageProcessor;E.ConvNextModel;E.ConvNextPreTrainedModel;E.ConvNextV2ForImageClassification;E.ConvNextV2Model;E.ConvNextV2PreTrainedModel;E.DFineForObjectDetection;E.DFineModel;E.DFinePreTrainedModel;E.DINOv3ConvNextModel;E.DINOv3ConvNextPreTrainedModel;E.DINOv3ViTImageProcessor;E.DINOv3ViTModel;E.DINOv3ViTPreTrainedModel;E.DPTFeatureExtractor;E.DPTForDepthEstimation;E.DPTImageProcessor;E.DPTModel;E.DPTPreTrainedModel;E.DacDecoderModel;E.DacDecoderOutput;E.DacEncoderModel;E.DacEncoderOutput;E.DacFeatureExtractor;E.DacModel;E.DacPreTrainedModel;E.DataTypeMap;E.DebertaForMaskedLM;E.DebertaForQuestionAnswering;E.DebertaForSequenceClassification;E.DebertaForTokenClassification;E.DebertaModel;E.DebertaPreTrainedModel;E.DebertaTokenizer;E.DebertaV2ForMaskedLM;E.DebertaV2ForQuestionAnswering;E.DebertaV2ForSequenceClassification;E.DebertaV2ForTokenClassification;E.DebertaV2Model;E.DebertaV2PreTrainedModel;E.DebertaV2Tokenizer;E.DecisionTransformerModel;E.DecisionTransformerPreTrainedModel;E.DeiTFeatureExtractor;E.DeiTForImageClassification;E.DeiTImageProcessor;E.DeiTModel;E.DeiTPreTrainedModel;E.DepthAnythingForDepthEstimation;E.DepthAnythingPreTrainedModel;E.DepthEstimationPipeline;E.DepthProForDepthEstimation;E.DepthProPreTrainedModel;E.DetrFeatureExtractor;E.DetrForObjectDetection;E.DetrForSegmentation;E.DetrImageProcessor;E.DetrModel;E.DetrObjectDetectionOutput;E.DetrPreTrainedModel;E.DetrSegmentationOutput;E.Dinov2ForImageClassification;E.Dinov2Model;E.Dinov2PreTrainedModel;E.Dinov2WithRegistersForImageClassification;E.Dinov2WithRegistersModel;E.Dinov2WithRegistersPreTrainedModel;E.DistilBertForMaskedLM;E.DistilBertForQuestionAnswering;E.DistilBertForSequenceClassification;E.DistilBertForTokenClassification;E.DistilBertModel;E.DistilBertPreTrainedModel;E.DistilBertTokenizer;E.DocumentQuestionAnsweringPipeline;E.DonutFeatureExtractor;E.DonutImageProcessor;E.DonutSwinModel;E.DonutSwinPreTrainedModel;E.EdgeTamModel;E.EfficientNetForImageClassification;E.EfficientNetImageProcessor;E.EfficientNetModel;E.EfficientNetPreTrainedModel;E.ElectraForMaskedLM;E.ElectraForQuestionAnswering;E.ElectraForSequenceClassification;E.ElectraForTokenClassification;E.ElectraModel;E.ElectraPreTrainedModel;E.ElectraTokenizer;E.EncodecFeatureExtractor;E.EosTokenCriteria;E.Ernie4_5ForCausalLM;E.Ernie4_5Model;E.Ernie4_5PreTrainedModel;E.EsmForMaskedLM;E.EsmForSequenceClassification;E.EsmForTokenClassification;E.EsmModel;E.EsmPreTrainedModel;E.EsmTokenizer;E.ExaoneForCausalLM;E.ExaoneModel;E.ExaonePreTrainedModel;E.FFT;E.FalconForCausalLM;E.FalconModel;E.FalconPreTrainedModel;E.FalconTokenizer;E.FastViTForImageClassification;E.FastViTModel;E.FastViTPreTrainedModel;E.FeatureExtractionPipeline;E.FeatureExtractor;E.FillMaskPipeline;E.Florence2ForConditionalGeneration;E.Florence2PreTrainedModel;E.Florence2Processor;E.ForcedBOSTokenLogitsProcessor;E.ForcedEOSTokenLogitsProcessor;E.GLPNFeatureExtractor;E.GLPNForDepthEstimation;E.GLPNModel;E.GLPNPreTrainedModel;E.GPT2LMHeadModel;E.GPT2Model;E.GPT2PreTrainedModel;E.GPT2Tokenizer;E.GPTBigCodeForCausalLM;E.GPTBigCodeModel;E.GPTBigCodePreTrainedModel;E.GPTJForCausalLM;E.GPTJModel;E.GPTJPreTrainedModel;E.GPTNeoForCausalLM;E.GPTNeoModel;E.GPTNeoPreTrainedModel;E.GPTNeoXForCausalLM;E.GPTNeoXModel;E.GPTNeoXPreTrainedModel;E.GPTNeoXTokenizer;E.Gemma2ForCausalLM;E.Gemma2Model;E.Gemma2PreTrainedModel;E.Gemma3ForCausalLM;E.Gemma3Model;E.Gemma3PreTrainedModel;E.Gemma3nAudioFeatureExtractor;E.Gemma3nForConditionalGeneration;E.Gemma3nPreTrainedModel;E.Gemma3nProcessor;E.GemmaForCausalLM;E.GemmaModel;E.GemmaPreTrainedModel;E.GemmaTokenizer;E.GlmForCausalLM;E.GlmModel;E.GlmPreTrainedModel;E.GraniteForCausalLM;E.GraniteModel;E.GraniteMoeHybridForCausalLM;E.GraniteMoeHybridModel;E.GraniteMoeHybridPreTrainedModel;E.GranitePreTrainedModel;E.Grok1Tokenizer;E.GroundingDinoForObjectDetection;E.GroundingDinoImageProcessor;E.GroundingDinoPreTrainedModel;E.GroundingDinoProcessor;E.GroupViTModel;E.GroupViTPreTrainedModel;E.HeliumForCausalLM;E.HeliumModel;E.HeliumPreTrainedModel;E.HerbertTokenizer;E.HieraForImageClassification;E.HieraModel;E.HieraPreTrainedModel;E.HubertForCTC;E.HubertForSequenceClassification;E.HubertModel;E.HubertPreTrainedModel;E.IJepaForImageClassification;E.IJepaModel;E.IJepaPreTrainedModel;E.Idefics3ForConditionalGeneration;E.Idefics3ImageProcessor;E.Idefics3PreTrainedModel;E.Idefics3Processor;E.ImageClassificationPipeline;E.ImageFeatureExtractionPipeline;E.ImageFeatureExtractor;E.ImageMattingOutput;E.ImageProcessor;E.ImageSegmentationPipeline;E.ImageToImagePipeline;E.ImageToTextPipeline;E.InterruptableStoppingCriteria;E.JAISLMHeadModel;E.JAISModel;E.JAISPreTrainedModel;E.JinaCLIPImageProcessor;E.JinaCLIPModel;E.JinaCLIPPreTrainedModel;E.JinaCLIPProcessor;E.JinaCLIPTextModel;E.JinaCLIPVisionModel;E.Lfm2ForCausalLM;E.Lfm2Model;E.Lfm2PreTrainedModel;E.LiteWhisperForConditionalGeneration;E.Llama4ForCausalLM;E.Llama4PreTrainedModel;E.LlamaForCausalLM;E.LlamaModel;E.LlamaPreTrainedModel;E.LlamaTokenizer;E.LlavaForConditionalGeneration;E.LlavaOnevisionForConditionalGeneration;E.LlavaOnevisionImageProcessor;E.LlavaPreTrainedModel;E.LlavaProcessor;E.LlavaQwen2ForCausalLM;E.LogitsProcessor;E.LogitsProcessorList;E.LogitsWarper;E.LongT5ForConditionalGeneration;E.LongT5Model;E.LongT5PreTrainedModel;E.M2M100ForConditionalGeneration;E.M2M100Model;E.M2M100PreTrainedModel;E.M2M100Tokenizer;E.MBart50Tokenizer;E.MBartForCausalLM;E.MBartForConditionalGeneration;E.MBartForSequenceClassification;E.MBartModel;E.MBartPreTrainedModel;E.MBartTokenizer;E.MPNetForMaskedLM;E.MPNetForQuestionAnswering;E.MPNetForSequenceClassification;E.MPNetForTokenClassification;E.MPNetModel;E.MPNetPreTrainedModel;E.MPNetTokenizer;E.MT5ForConditionalGeneration;E.MT5Model;E.MT5PreTrainedModel;E.MarianMTModel;E.MarianModel;E.MarianPreTrainedModel;E.MarianTokenizer;E.Mask2FormerImageProcessor;E.MaskFormerFeatureExtractor;E.MaskFormerForInstanceSegmentation;E.MaskFormerImageProcessor;E.MaskFormerModel;E.MaskFormerPreTrainedModel;E.MaskedLMOutput;E.MaxLengthCriteria;E.Metric3DForDepthEstimation;E.Metric3DPreTrainedModel;E.Metric3Dv2ForDepthEstimation;E.Metric3Dv2PreTrainedModel;E.MgpstrForSceneTextRecognition;E.MgpstrModelOutput;E.MgpstrPreTrainedModel;E.MgpstrProcessor;E.MgpstrTokenizer;E.MimiDecoderModel;E.MimiDecoderOutput;E.MimiEncoderModel;E.MimiEncoderOutput;E.MimiModel;E.MimiPreTrainedModel;E.MinLengthLogitsProcessor;E.MinNewTokensLengthLogitsProcessor;E.Ministral3ForCausalLM;E.Ministral3Model;E.Ministral3PreTrainedModel;E.MinistralForCausalLM;E.MinistralModel;E.MinistralPreTrainedModel;E.Mistral3ForConditionalGeneration;E.MistralForCausalLM;E.MistralModel;E.MistralPreTrainedModel;E.MobileBertForMaskedLM;E.MobileBertForQuestionAnswering;E.MobileBertForSequenceClassification;E.MobileBertModel;E.MobileBertPreTrainedModel;E.MobileBertTokenizer;E.MobileLLMForCausalLM;E.MobileLLMModel;E.MobileLLMPreTrainedModel;E.MobileNetV1FeatureExtractor;E.MobileNetV1ForImageClassification;E.MobileNetV1ForSemanticSegmentation;E.MobileNetV1ImageProcessor;E.MobileNetV1Model;E.MobileNetV1PreTrainedModel;E.MobileNetV2FeatureExtractor;E.MobileNetV2ForImageClassification;E.MobileNetV2ForSemanticSegmentation;E.MobileNetV2ImageProcessor;E.MobileNetV2Model;E.MobileNetV2PreTrainedModel;E.MobileNetV3FeatureExtractor;E.MobileNetV3ForImageClassification;E.MobileNetV3ForSemanticSegmentation;E.MobileNetV3ImageProcessor;E.MobileNetV3Model;E.MobileNetV3PreTrainedModel;E.MobileNetV4FeatureExtractor;E.MobileNetV4ForImageClassification;E.MobileNetV4ForSemanticSegmentation;E.MobileNetV4ImageProcessor;E.MobileNetV4Model;E.MobileNetV4PreTrainedModel;E.MobileViTFeatureExtractor;E.MobileViTForImageClassification;E.MobileViTImageProcessor;E.MobileViTModel;E.MobileViTPreTrainedModel;E.MobileViTV2ForImageClassification;E.MobileViTV2Model;E.MobileViTV2PreTrainedModel;E.ModelOutput;E.ModernBertDecoderForCausalLM;E.ModernBertDecoderModel;E.ModernBertDecoderPreTrainedModel;E.ModernBertForMaskedLM;E.ModernBertForSequenceClassification;E.ModernBertForTokenClassification;E.ModernBertModel;E.ModernBertPreTrainedModel;E.Moondream1ForConditionalGeneration;E.MoonshineFeatureExtractor;E.MoonshineForConditionalGeneration;E.MoonshineModel;E.MoonshinePreTrainedModel;E.MoonshineProcessor;E.MptForCausalLM;E.MptModel;E.MptPreTrainedModel;E.MultiModalityCausalLM;E.MultiModalityPreTrainedModel;E.MusicgenForCausalLM;E.MusicgenForConditionalGeneration;E.MusicgenModel;E.MusicgenPreTrainedModel;E.NanoChatForCausalLM;E.NanoChatModel;E.NanoChatPreTrainedModel;E.NeoBertForMaskedLM;E.NeoBertForQuestionAnswering;E.NeoBertForSequenceClassification;E.NeoBertForTokenClassification;E.NeoBertModel;E.NeoBertPreTrainedModel;E.NllbTokenizer;E.NoBadWordsLogitsProcessor;E.NoRepeatNGramLogitsProcessor;E.NomicBertModel;E.NomicBertPreTrainedModel;E.NougatImageProcessor;E.NougatTokenizer;E.OPTForCausalLM;E.OPTModel;E.OPTPreTrainedModel;E.ObjectDetectionPipeline;E.Olmo2ForCausalLM;E.Olmo2Model;E.Olmo2PreTrainedModel;E.OlmoForCausalLM;E.OlmoModel;E.OlmoPreTrainedModel;E.OpenELMForCausalLM;E.OpenELMModel;E.OpenELMPreTrainedModel;E.OwlViTFeatureExtractor;E.OwlViTForObjectDetection;E.OwlViTImageProcessor;E.OwlViTModel;E.OwlViTPreTrainedModel;E.OwlViTProcessor;E.Owlv2ForObjectDetection;E.Owlv2ImageProcessor;E.Owlv2Model;E.Owlv2PreTrainedModel;E.PaliGemmaForConditionalGeneration;E.PaliGemmaPreTrainedModel;E.PaliGemmaProcessor;E.ParakeetFeatureExtractor;E.ParakeetForCTC;E.ParakeetPreTrainedModel;E.PatchTSMixerForPrediction;E.PatchTSMixerModel;E.PatchTSMixerPreTrainedModel;E.PatchTSTForPrediction;E.PatchTSTModel;E.PatchTSTPreTrainedModel;E.Phi3ForCausalLM;E.Phi3Model;E.Phi3PreTrainedModel;E.Phi3VForCausalLM;E.Phi3VImageProcessor;E.Phi3VPreTrainedModel;E.Phi3VProcessor;E.PhiForCausalLM;E.PhiModel;E.PhiPreTrainedModel;E.Pipeline;E.PixtralImageProcessor;E.PixtralProcessor;E.PreTrainedModel;E.PreTrainedTokenizer;E.PretrainedConfig;E.PretrainedMixin;E.Processor;E.PvtForImageClassification;E.PvtImageProcessor;E.PvtModel;E.PvtPreTrainedModel;E.PyAnnoteFeatureExtractor;E.PyAnnoteForAudioFrameClassification;E.PyAnnoteModel;E.PyAnnotePreTrainedModel;E.PyAnnoteProcessor;E.QuestionAnsweringModelOutput;E.QuestionAnsweringPipeline;E.Qwen2ForCausalLM;E.Qwen2Model;E.Qwen2PreTrainedModel;E.Qwen2Tokenizer;E.Qwen2VLForConditionalGeneration;E.Qwen2VLImageProcessor;E.Qwen2VLPreTrainedModel;E.Qwen2VLProcessor;E.Qwen3ForCausalLM;E.Qwen3Model;E.Qwen3PreTrainedModel;E.RFDetrForObjectDetection;E.RFDetrModel;E.RFDetrObjectDetectionOutput;E.RFDetrPreTrainedModel;E.RTDetrForObjectDetection;E.RTDetrImageProcessor;E.RTDetrModel;E.RTDetrObjectDetectionOutput;E.RTDetrPreTrainedModel;E.RTDetrV2ForObjectDetection;E.RTDetrV2Model;E.RTDetrV2ObjectDetectionOutput;E.RTDetrV2PreTrainedModel;E.RawAudio;E.RawImage;E.RawVideo;E.RawVideoFrame;E.RepetitionPenaltyLogitsProcessor;E.ResNetForImageClassification;E.ResNetModel;E.ResNetPreTrainedModel;E.RoFormerForMaskedLM;E.RoFormerForQuestionAnswering;E.RoFormerForSequenceClassification;E.RoFormerForTokenClassification;E.RoFormerModel;E.RoFormerPreTrainedModel;E.RoFormerTokenizer;E.RobertaForMaskedLM;E.RobertaForQuestionAnswering;E.RobertaForSequenceClassification;E.RobertaForTokenClassification;E.RobertaModel;E.RobertaPreTrainedModel;E.RobertaTokenizer;E.Sam2ImageProcessor;E.Sam2ImageSegmentationOutput;E.Sam2Model;E.Sam2PreTrainedModel;E.Sam2Processor;E.Sam2VideoProcessor;E.Sam3ImageProcessor;E.Sam3TrackerModel;E.SamImageProcessor;E.SamImageSegmentationOutput;E.SamModel;E.SamPreTrainedModel;E.SamProcessor;E.SapiensForDepthEstimation;E.SapiensForNormalEstimation;E.SapiensForSemanticSegmentation;E.SapiensPreTrainedModel;E.SeamlessM4TFeatureExtractor;E.SegformerFeatureExtractor;E.SegformerForImageClassification;E.SegformerForSemanticSegmentation;E.SegformerImageProcessor;E.SegformerModel;E.SegformerPreTrainedModel;E.Seq2SeqLMOutput;E.SequenceClassifierOutput;E.SiglipImageProcessor;E.SiglipModel;E.SiglipPreTrainedModel;E.SiglipTextModel;E.SiglipTokenizer;E.SiglipVisionModel;E.SmolLM3ForCausalLM;E.SmolLM3Model;E.SmolLM3PreTrainedModel;E.SmolVLMForConditionalGeneration;E.SmolVLMImageProcessor;E.SmolVLMProcessor;E.SnacDecoderModel;E.SnacEncoderModel;E.SnacFeatureExtractor;E.SnacModel;E.SnacPreTrainedModel;E.SpeechT5FeatureExtractor;E.SpeechT5ForSpeechToText;E.SpeechT5ForTextToSpeech;E.SpeechT5HifiGan;E.SpeechT5Model;E.SpeechT5PreTrainedModel;E.SpeechT5Processor;E.SpeechT5Tokenizer;E.SqueezeBertForMaskedLM;E.SqueezeBertForQuestionAnswering;E.SqueezeBertForSequenceClassification;E.SqueezeBertModel;E.SqueezeBertPreTrainedModel;E.SqueezeBertTokenizer;E.StableLmForCausalLM;E.StableLmModel;E.StableLmPreTrainedModel;E.Starcoder2ForCausalLM;E.Starcoder2Model;E.Starcoder2PreTrainedModel;E.StoppingCriteria;E.StoppingCriteriaList;E.StyleTextToSpeech2Model;E.StyleTextToSpeech2PreTrainedModel;E.SummarizationPipeline;E.SupertonicForConditionalGeneration;E.SupertonicPreTrainedModel;E.SuppressTokensAtBeginLogitsProcessor;E.Swin2SRForImageSuperResolution;E.Swin2SRImageProcessor;E.Swin2SRModel;E.Swin2SRPreTrainedModel;E.SwinForImageClassification;E.SwinForSemanticSegmentation;E.SwinModel;E.SwinPreTrainedModel;E.T5ForConditionalGeneration;E.T5Model;E.T5PreTrainedModel;E.T5Tokenizer;E.TableTransformerForObjectDetection;E.TableTransformerModel;E.TableTransformerObjectDetectionOutput;E.TableTransformerPreTrainedModel;E.TemperatureLogitsWarper;E.Tensor;E.Text2TextGenerationPipeline;E.TextClassificationPipeline;E.TextGenerationPipeline;E.TextStreamer;E.TextToAudioPipeline;E.TokenClassificationPipeline;E.TokenClassifierOutput;E.TokenizerModel;E.TopKLogitsWarper;E.TopPLogitsWarper;E.TrOCRForCausalLM;E.TrOCRPreTrainedModel;E.TranslationPipeline;E.UltravoxModel;E.UltravoxPreTrainedModel;E.UltravoxProcessor;E.UniSpeechForCTC;E.UniSpeechForSequenceClassification;E.UniSpeechModel;E.UniSpeechPreTrainedModel;E.UniSpeechSatForAudioFrameClassification;E.UniSpeechSatForCTC;E.UniSpeechSatForSequenceClassification;E.UniSpeechSatModel;E.UniSpeechSatPreTrainedModel;E.VLChatProcessor;E.VLMImageProcessor;E.VaultGemmaForCausalLM;E.VaultGemmaModel;E.VaultGemmaPreTrainedModel;E.ViTFeatureExtractor;E.ViTForImageClassification;E.ViTImageProcessor;E.ViTMAEModel;E.ViTMAEPreTrainedModel;E.ViTMSNForImageClassification;E.ViTMSNModel;E.ViTMSNPreTrainedModel;E.ViTModel;E.ViTPreTrainedModel;E.VisionEncoderDecoderModel;E.VitMatteForImageMatting;E.VitMatteImageProcessor;E.VitMattePreTrainedModel;E.VitPoseForPoseEstimation;E.VitPoseImageProcessor;E.VitPosePreTrainedModel;E.VitsModel;E.VitsModelOutput;E.VitsPreTrainedModel;E.VitsTokenizer;E.VoxtralForConditionalGeneration;E.VoxtralProcessor;E.Wav2Vec2BertForCTC;E.Wav2Vec2BertForSequenceClassification;E.Wav2Vec2BertModel;E.Wav2Vec2BertPreTrainedModel;E.Wav2Vec2CTCTokenizer;E.Wav2Vec2FeatureExtractor;E.Wav2Vec2ForAudioFrameClassification;E.Wav2Vec2ForCTC;E.Wav2Vec2ForSequenceClassification;E.Wav2Vec2Model;E.Wav2Vec2PreTrainedModel;E.Wav2Vec2Processor;E.Wav2Vec2ProcessorWithLM;E.WavLMForAudioFrameClassification;E.WavLMForCTC;E.WavLMForSequenceClassification;E.WavLMForXVector;E.WavLMModel;E.WavLMPreTrainedModel;E.WeSpeakerFeatureExtractor;E.WeSpeakerResNetModel;E.WeSpeakerResNetPreTrainedModel;E.WhisperFeatureExtractor;E.WhisperForConditionalGeneration;E.WhisperModel;E.WhisperPreTrainedModel;E.WhisperProcessor;E.WhisperTextStreamer;E.WhisperTimeStampLogitsProcessor;E.WhisperTokenizer;E.XLMForQuestionAnswering;E.XLMForSequenceClassification;E.XLMForTokenClassification;E.XLMModel;E.XLMPreTrainedModel;E.XLMRobertaForMaskedLM;E.XLMRobertaForQuestionAnswering;E.XLMRobertaForSequenceClassification;E.XLMRobertaForTokenClassification;E.XLMRobertaModel;E.XLMRobertaPreTrainedModel;E.XLMRobertaTokenizer;E.XLMTokenizer;E.XLMWithLMHeadModel;E.XVectorOutput;E.YolosFeatureExtractor;E.YolosForObjectDetection;E.YolosImageProcessor;E.YolosModel;E.YolosObjectDetectionOutput;E.YolosPreTrainedModel;E.ZeroShotAudioClassificationPipeline;E.ZeroShotClassificationPipeline;E.ZeroShotImageClassificationPipeline;E.ZeroShotObjectDetectionPipeline;E.bankers_round;E.cat;E.cos_sim;E.dot;E.dynamic_time_warping;var KS=E.env;E.full;E.full_like;E.getCacheShapes;E.hamming;E.hanning;E.interpolate;E.interpolate_4d;E.interpolate_data;E.is_chinese_char;E.layer_norm;E.load_image;E.load_video;E.log_softmax;E.magnitude;E.matmul;E.max;E.mean;E.mean_pooling;E.medianFilter;E.mel_filter_bank;E.min;E.ones;E.ones_like;E.permute;E.permute_data;var V3=E.pipeline;E.quantize_embeddings;E.rand;E.randn;E.read_audio;E.rfft;E.round;E.slice;E.softmax;E.spectrogram;E.stack;E.std_mean;E.topk;E.window_function;E.zeros;E.zeros_like;KS.allowLocalModels=!1;KS.useBrowserCache=!0;let O_=null,Jp=null;async function QS(){return O_||Jp||(Jp=(async()=>{try{return console.log(" Loading NLP embedding model..."),O_=await V3("feature-extraction","Xenova/all-MiniLM-L6-v2",{dtype:"q8"}),console.log(" NLP embedding model loaded successfully"),O_}catch(e){return console.error(" Failed to load NLP model:",e),Jp=null,null}})(),Jp)}QS();function G3(e,n,t){const s=[e],i=e.split(".").pop();return s.push(`TLD ${i}`),e.includes("-")&&s.push("hyphenated domain name"),/\d/.test(e)&&s.push("domain contains numbers"),e.length>20&&s.push("unusually long domain"),t.category&&s.push(`category ${t.category}`),t.riskScore>=80?s.push("high risk dangerous malicious"):t.riskScore>=50?s.push("medium risk suspicious"):s.push("low risk safe benign"),n.hosting&&(n.hosting.provider&&s.push(`hosted on ${n.hosting.provider}`),n.hosting.country&&s.push(`server in ${n.hosting.country}`),n.hosting.type&&s.push(`${n.hosting.type} hosting`)),n.tls&&(n.tls.issuer&&s.push(`TLS certificate by ${n.tls.issuer}`),n.tls.selfSigned&&s.push("self-signed certificate untrusted")),n.trackers&&(n.trackers.gaId&&s.push(`Google Analytics ${n.trackers.gaId}`),n.trackers.fbPixel&&s.push("Facebook Pixel tracking"),n.trackers.popunders&&s.push("popup ads popunder aggressive"),n.trackers.adNetworks?.length&&s.push(`ad networks ${n.trackers.adNetworks.join(" ")}`)),n.financial&&(n.financial.cryptoWallet&&s.push("cryptocurrency wallet payment"),n.financial.paymentForm&&s.push("payment form checkout"),n.financial.depositButton&&s.push("deposit button gambling betting")),t.explanations&&t.explanations.slice(0,5).forEach(l=>{l.label&&s.push(l.label)}),s.join(". ")}async function ax(e){const n=await QS();if(!n)return null;try{const t=await n(e,{pooling:"mean",normalize:!0});return Array.from(t.data)}catch(t){return console.error("Embedding generation error:",t),null}}function W3(e,n){if(!e||!n||e.length!==n.length)return 0;let t=0,s=0,i=0;for(let c=0;c<e.length;c++)t+=e[c]*n[c],s+=e[c]*e[c],i+=n[c]*n[c];const l=Math.sqrt(s)*Math.sqrt(i);return l===0?0:t/l}const sx=.75;class H3{constructor(){this.nodes=new Map,this.edges=[],this.domainIndex=new Map,this.analysisCache=new Map,this.clusters=new Map,this.clusterCounter=42,this.embeddings=new Map,this._seedKnownThreats()}_seedKnownThreats(){const n=[{domain:"1xbet.com",category:"Casino",risk:94,country:"Cyprus/Russia"},{domain:"mostbet.com",category:"Casino",risk:92,country:"Cyprus"},{domain:"pin-up.casino",category:"Casino",risk:90,country:"Curaao"},{domain:"stake.com",category:"Casino",risk:85,country:"Curaao"},{domain:"melbet.com",category:"Casino",risk:91,country:"Cyprus"},{domain:"betwinner.com",category:"Casino",risk:88,country:"Cyprus"},{domain:"22bet.com",category:"Casino",risk:87,country:"Cyprus"},{domain:"parimatch.com",category:"Casino",risk:86,country:"Cyprus"},{domain:"secure-paypal-verify.com",category:"Phishing",risk:96,country:"Unknown"},{domain:"apple-id-confirm.net",category:"Phishing",risk:95,country:"Unknown"},{domain:"microsoft-alert-login.com",category:"Phishing",risk:94,country:"Unknown"},{domain:"netflix-billing-update.org",category:"Phishing",risk:93,country:"Unknown"},{domain:"crypto-double-fast.io",category:"Scam",risk:89,country:"Panama"},{domain:"bitcoin-multiply.xyz",category:"Scam",risk:88,country:"Seychelles"},{domain:"free-iphone-winner.com",category:"Scam",risk:87,country:"Nigeria"},{domain:"easyprofit-trade.net",category:"Scam",risk:86,country:"Marshall Islands"},{domain:"invest-gold-pro.xyz",category:"Pyramid",risk:87,country:"UAE"},{domain:"matrix-income-system.com",category:"Pyramid",risk:84,country:"Philippines"},{domain:"cashflow-network.biz",category:"Pyramid",risk:82,country:"India"},{domain:"slot-empire-vip.casino",category:"Casino",risk:88,country:"Malta"},{domain:"fast-money-guru.biz",category:"Scam",risk:84,country:"Brazil"}];n.forEach((s,i)=>{const l=`seed-w${i+1}`;this.addNode(l,s.domain,"website",s.risk,{category:s.category,seeded:!0,country:s.country}),this.domainIndex.set(s.domain,l)}),this.addNode("seed-ip1","185.234.72.18","domain",70),this.addNode("seed-ip2","91.215.85.102","domain",65),this.addNode("seed-ip3","104.21.34.167","domain",60),this.addNode("seed-ip4","172.67.188.42","domain",55),this.addNode("seed-t1","UA-38291746","tracker",60),this.addNode("seed-t2","FB:948271635","tracker",55),this.addNode("seed-t3","UA-55192837","tracker",50),this.addNode("seed-c1","TLS:a3f8c91d","certificate",50),this.addNode("seed-c2","TLS:b7e284fa","certificate",45),this.addNode("seed-p1","bc1qxy2kgdyg","wallet",40),this.addNode("seed-p2","0x4a8f3e...c29d","wallet",35),this.addNode("seed-ct1","@1xbet_support","contact",35),this.addNode("seed-ct2","@mostbet_help","contact",30),[["seed-w1","seed-ip1","hosted on"],["seed-w5","seed-ip1","hosted on"],["seed-w6","seed-ip1","hosted on"],["seed-w7","seed-ip1","hosted on"],["seed-w1","seed-t1","uses tracker"],["seed-w5","seed-t1","uses tracker"],["seed-w6","seed-t1","uses tracker"],["seed-w1","seed-c1","shares cert"],["seed-w5","seed-c1","shares cert"],["seed-w1","seed-ct1","same operator"],["seed-w2","seed-ip2","hosted on"],["seed-w3","seed-ip2","hosted on"],["seed-w8","seed-ip2","hosted on"],["seed-w2","seed-t2","uses pixel"],["seed-w3","seed-t2","uses pixel"],["seed-w2","seed-c2","shares cert"],["seed-w3","seed-c2","shares cert"],["seed-w2","seed-ct2","same operator"],["seed-w9","seed-ip3","hosted on"],["seed-w10","seed-ip3","hosted on"],["seed-w11","seed-ip3","hosted on"],["seed-w12","seed-ip3","hosted on"],["seed-w9","seed-t3","uses tracker"],["seed-w10","seed-t3","uses tracker"],["seed-w13","seed-ip4","hosted on"],["seed-w14","seed-ip4","hosted on"],["seed-w13","seed-p1","uses wallet"],["seed-w14","seed-p1","uses wallet"],["seed-w15","seed-p2","uses wallet"],["seed-w16","seed-p2","uses wallet"],["seed-w17","seed-ip4","hosted on"],["seed-w4","seed-p1","uses wallet"]].forEach(([s,i,l])=>this.addEdge(s,i,l)),["seed-w1","seed-w5","seed-w6","seed-w7"].forEach(s=>this.clusters.set(s,"CLS-0042")),["seed-w2","seed-w3","seed-w8"].forEach(s=>this.clusters.set(s,"CLS-0038")),["seed-w9","seed-w10","seed-w11","seed-w12"].forEach(s=>this.clusters.set(s,"CLS-0051")),["seed-w13","seed-w14","seed-w15","seed-w16","seed-w17"].forEach(s=>this.clusters.set(s,"CLS-0063")),this._seedEmbeddings(n)}async _seedEmbeddings(n){await new Promise(s=>setTimeout(s,5e3));let t=0;for(const s of n){const i=`${s.domain}. TLD ${s.domain.split(".").pop()}. category ${s.category}. ${s.risk>=80?"high risk dangerous malicious":s.risk>=50?"medium risk suspicious":"low risk safe benign"}. server in ${s.country}.`,l=await ax(i);l&&(this.embeddings.set(s.domain,l),t++)}t>0&&console.log(` NLP: seeded ${t} domain embeddings`)}addNode(n,t,s,i=0,l={}){const c={id:n,label:t,type:s,risk:i,metadata:l,addedAt:new Date().toISOString()};return this.nodes.set(n,c),c}addEdge(n,t,s){this.edges.some(i=>i.source===n&&i.target===t&&i.label===s)||this.edges.push({source:n,target:t,label:s})}insertAnalysis(n,t,s){this.analysisCache.set(n,{features:t,riskResult:s,analyzedAt:new Date().toISOString()});let i=this.domainIndex.get(n);if(!i)i=`w-${Date.now()}-${Math.random().toString(36).slice(2,6)}`,this.addNode(i,n,"website",s.riskScore,{category:s.category,confidence:s.confidence}),this.domainIndex.set(n,i);else{const l=this.nodes.get(i);l&&(l.risk=s.riskScore,l.metadata={...l.metadata,category:s.category})}if(t.dns.ip){const l=`ip-${t.dns.ip.replace(/\./g,"-")}`;this.nodes.has(l)||this.addNode(l,t.dns.ip,"domain",0),this.addEdge(i,l,"hosted on")}if(t.tls.fingerprint){const l=`cert-${t.tls.fingerprint.slice(0,8)}`;this.nodes.has(l)||this.addNode(l,`TLS:${t.tls.fingerprint.slice(0,8)}`,"certificate",0),this.addEdge(i,l,"shares cert")}if(t.trackers.gaId){const l=`ga-${t.trackers.gaId}`;this.nodes.has(l)||this.addNode(l,t.trackers.gaId,"tracker",0),this.addEdge(i,l,"uses tracker")}if(t.trackers.fbPixel){const l=`fb-${t.trackers.fbPixel}`;this.nodes.has(l)||this.addNode(l,`FB:${t.trackers.fbPixel}`,"tracker",0),this.addEdge(i,l,"uses pixel")}if(t.financial.cryptoWallet){const l=`wallet-${t.financial.cryptoWallet.slice(0,12)}`;this.nodes.has(l)||this.addNode(l,t.financial.cryptoWallet.slice(0,12)+"...","wallet",0),this.addEdge(i,l,"uses wallet")}if(t.contacts.telegram){const l=`tg-${t.contacts.telegram}`;this.nodes.has(l)||this.addNode(l,t.contacts.telegram,"contact",0),this.addEdge(i,l,"same operator")}return this._detectCluster(i),this._propagateRisk(i,s.riskScore),this._nlpConnect(n,i,t,s),i}async _nlpConnect(n,t,s,i){try{const l=G3(n,s,i),c=await ax(l);if(!c)return;for(const[u,d]of this.embeddings){if(u===n)continue;const f=W3(c,d);if(f>=sx){const m=this.domainIndex.get(u);m&&(this.addEdge(t,m,`NLP similar (${Math.round(f*100)}%)`),f>=.85&&this.clusters.has(m)&&!this.clusters.has(t)&&this.clusters.set(t,this.clusters.get(m)))}}this.embeddings.set(n,c),console.log(` NLP embedding stored for ${n} (${this.embeddings.size} total, sim threshold: ${sx})`)}catch(l){console.warn("NLP connection failed for",n,l)}}getCluster(n){const t=this.domainIndex.get(n);if(!t)return{nodes:[],edges:[]};const s=new Set([t]),i=new Set([t]),l=[],c=[{id:t,depth:0}];for(;c.length;){const{id:f,depth:m}=c.shift();if(!(m>=2))for(const _ of this.edges){let p=null;_.source===f?p=_.target:_.target===f&&(p=_.source),p&&!s.has(p)&&(s.add(p),i.add(p),c.push({id:p,depth:m+1})),p&&(_.source===f||_.target===f)&&l.push(_)}}const u=new Set,d=l.filter(f=>{const m=`${f.source}-${f.target}-${f.label}`;return u.has(m)?!1:(u.add(m),!0)});return{nodes:Array.from(i).map(f=>this.nodes.get(f)).filter(Boolean),edges:d}}getFullGraph(){return{nodes:Array.from(this.nodes.values()),edges:[...this.edges]}}getBlocklist(){return Array.from(this.nodes.values()).filter(n=>n.type==="website").map(n=>({domain:n.label,category:n.metadata?.category||"Unknown",risk:n.risk,tier:n.risk>=80?"A":n.risk>=50?"B":"C",status:n.risk>=80?"Blocked":n.risk>=50?"Under Review":"Monitoring",detectedDate:n.addedAt.split("T")[0],cluster:this.clusters.get(n.id)||"",markers:this.edges.filter(t=>t.source===n.id||t.target===n.id).length,country:n.metadata?.country||"Unknown"})).sort((n,t)=>t.risk-n.risk)}getStats(){const n=Array.from(this.nodes.values()).filter(s=>s.type==="website"),t=new Set(Array.from(this.clusters.values()));return{scannedToday:n.length+Math.floor(Math.random()*50),clustersFound:t.size,threatsBlocked:n.filter(s=>s.risk>=80).length*100+Math.floor(Math.random()*50),activeMonitors:n.filter(s=>s.risk>=50).length*80+Math.floor(Math.random()*20)}}_propagateRisk(n,t){if(t<50)return;const s=new Set;for(const i of this.edges)i.source===n?s.add(i.target):i.target===n&&s.add(i.source);for(const i of s){const l=this.nodes.get(i);if(!(!l||l.type==="website")){l.risk=Math.max(l.risk,Math.round(t*.6));for(const c of this.edges){let u=null;if(c.source===i&&c.target!==n?u=c.target:c.target===i&&c.source!==n&&(u=c.source),u){const d=this.nodes.get(u);d&&d.type==="website"&&(d.risk=Math.min(100,d.risk+Math.round(t*.15)))}}}}}_detectCluster(n){const t=new Set;for(const s of this.edges)s.source===n&&t.add(s.target),s.target===n&&t.add(s.source);for(const s of t)for(const i of this.edges){let l=null;if(i.source===s&&i.target!==n&&(l=i.target),i.target===s&&i.source!==n&&(l=i.source),l&&this.clusters.has(l)){this.clusters.set(n,this.clusters.get(l));return}}t.size>0&&(this.clusterCounter++,this.clusters.set(n,`CLS-${String(this.clusterCounter).padStart(4,"0")}`))}getClusterId(n){const t=this.domainIndex.get(n);return t&&this.clusters.get(t)||null}}const oc=new H3,q3=["com","net","org","io","xyz","site","online","info","co","biz","me","pro","app","dev","ru","ua","kz","uk","de","fr","ag","tv","cc","gg","bet","casino","live","fun","club","top","shop","tech"],K3={a:"sqwz",b:"vngh",c:"xvdf",d:"sfce",e:"rdws",f:"dgcv",g:"fhbv",h:"gjbn",i:"ujok",j:"hknm",k:"jloi",l:"kop",m:"njk",n:"bmhj",o:"iklp",p:"ol",q:"wa",r:"etdf",s:"adwxz",t:"rfgy",u:"yihj",v:"cbfg",w:"qeas",x:"zsdc",y:"tugh",z:"xas"},Q3={a:["4","@"],e:["3"],i:["1","l"],o:["0"],s:["5","z"],l:["1","i"],t:["7"],b:["d"],g:["q"],n:["m"],z:["s"],k:["c"],c:["k"]};function X3(e){const n=e.split(".");if(n.length<2)return[];const t=n.slice(0,-1).join("."),s=n[n.length-1],i=new Set;for(const u of q3)u!==s&&i.add(`${t}.${u}`);for(let u=0;u<t.length;u++){const d=t[u];if(d==="."||d==="-")continue;const f=K3[d]||"";for(const m of f){const _=t.slice(0,u)+m+t.slice(u+1);i.add(`${_}.${s}`),i.add(`${_}.com`)}}for(let u=0;u<t.length;u++){const d=t[u];if(d==="."||d==="-")continue;const f=t.slice(0,u)+d+t.slice(u);i.add(`${f}.${s}`),i.add(`${f}.com`)}if(t.length>3)for(let u=0;u<t.length;u++){if(t[u]==="."||t[u]==="-")continue;const d=t.slice(0,u)+t.slice(u+1);d.length>=2&&(i.add(`${d}.${s}`),i.add(`${d}.com`))}for(let u=0;u<t.length;u++){const d=t[u],f=Q3[d];if(f)for(const m of f){const _=t.slice(0,u)+m+t.slice(u+1);i.add(`${_}.${s}`),i.add(`${_}.com`)}}const l=["my-","the-","get-","go-","new-","real-","official-"],c=["-online","-pro","-official","-mirror","-new","-live"];for(const u of l)i.add(`${u}${t}.${s}`),i.add(`${u}${t}.com`);for(const u of c)i.add(`${t}${u}.${s}`),i.add(`${t}${u}.com`);if(t.includes("-"))i.add(`${t.replace(/-/g,"")}.${s}`),i.add(`${t.replace(/-/g,"")}.com`);else if(t.length>=4)for(let u=2;u<t.length-1;u++){const d=t.slice(0,u)+"-"+t.slice(u);i.add(`${d}.${s}`),i.add(`${d}.com`)}return i.delete(e),Array.from(i)}async function Y3(e){try{const n=await fetch(`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(e)}&type=A`,{headers:{Accept:"application/dns-json"},signal:AbortSignal.timeout(3e3)});if(!n.ok)return{domain:e,exists:!1};const t=await n.json();return t.Status===0&&t.Answer&&t.Answer.length>0?{domain:e,exists:!0,ip:t.Answer[0].data}:{domain:e,exists:!1}}catch{return{domain:e,exists:!1}}}async function Z3(e,n=4){const t=X3(e),s=t.sort(()=>Math.random()-.5),i=[],l=15;for(let c=0;c<s.length&&i.length<n;c+=l){const u=s.slice(c,c+l),d=await Promise.all(u.map(f=>Y3(f)));for(const f of d)f.exists&&i.length<n&&i.push({domain:f.domain,ip:f.ip});if(i.length>=n)break}return console.log(` Clone scan: ${t.length} candidates  ${i.length} live variants found for ${e}`),i}const I_=new Map,J3="http://localhost:5001/api/ml/predict";async function eD(e){try{const n=await fetch(J3,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:e}),signal:AbortSignal.timeout(5e3)});return n.ok?await n.json():null}catch{return null}}async function tD(e){try{const n=await fetch(`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(e)}&type=A`,{headers:{Accept:"application/dns-json"}});if(!n.ok)return{exists:!0,method:"fallback"};const t=await n.json();return t.Status===3?{exists:!1,method:"dns"}:t.Status===0&&t.Answer&&t.Answer.length>0?{exists:!0,method:"dns",ip:t.Answer[0].data}:t.Status===0?{exists:!0,method:"dns",noRecord:!0}:{exists:!0,method:"fallback"}}catch{return{exists:!0,method:"fallback"}}}async function XS(e){const n=e.trim().toLowerCase().replace(/^https?:\/\//,"").replace(/^www\./,"").split("/")[0];if(!n||!n.includes(".")||n.length<4)throw new Error('Invalid domain format. Please enter a valid domain like "example.com".');if(I_.has(n))return{...I_.get(n),cached:!0,scanTime:0};const t=performance.now(),s=await tD(n);if(!s.exists)return{url:n,domainExists:!1,risk_score:0,category:"Not Found",confidence:1,probabilities:{Casino:0,Scam:0,Phishing:0,Pyramid:0},status:"Domain Not Found",tier:"N/A",explanations:[{label:`Domain "${n}" does not exist  DNS lookup returned NXDOMAIN`,weight:0,type:"dns",evidence:"Cloudflare DNS-over-HTTPS returned Status 3 (NXDOMAIN)"}],rules_evaluated:0,rules_fired:0,markers:{trackers:{},financial:{},contacts:{}},redirect_chain:[],hosting:{},tls:{},dns:{success:!1,error:"NXDOMAIN"},domain_analysis:{},cluster_id:null,graph_id:null,scan_time:parseFloat(((performance.now()-t)/1e3).toFixed(1)),analyzed_at:new Date().toISOString(),cached:!1};await new Promise(p=>setTimeout(p,300+Math.random()*700));const i=eD(n),l=bb(e,s.ip),c=wb(l),u=oc.insertAnalysis(n,l,c),d=oc.getClusterId(n),f=await i,m=((performance.now()-t)/1e3).toFixed(1),_={url:n,domainExists:!0,risk_score:c.riskScore,category:c.category,confidence:c.confidence,probabilities:c.probabilities,status:c.status,tier:c.tier,explanations:c.explanations,rules_evaluated:c.rulesEvaluated,rules_fired:c.rulesFired,markers:{infrastructure:{ip:l.hosting.ip,provider:l.hosting.provider,country:l.hosting.country,type:l.hosting.type,asn:l.hosting.asn,tls_issuer:l.tls.issuer,tls_fingerprint:l.tls.fingerprint},tracking:l.trackers,financial:l.financial,contacts:l.contacts},redirect_chain:l.redirectChain,hosting:l.hosting,tls:l.tls,dns:l.dns,domain_analysis:{...l.domainAnalysis,whois:l.whois},cluster_id:d,graph_id:u,scan_time:parseFloat(m),analyzed_at:new Date().toISOString(),cached:!1,ml_prediction:f||null,clone_variants:[]};return I_.set(n,_),Z3(n,4).then(p=>{const y=[];for(const v of p){const T=bb(v.domain,v.ip),k=wb(T),b=oc.insertAnalysis(v.domain,T,k);u&&b&&oc.addEdge(u,b,"clone/variant"),y.push({domain:v.domain,ip:v.ip,risk_score:k.riskScore,category:k.category,graph_id:b})}_.clone_variants=y,I_.set(n,_),console.log(` Clone scan: ${y.length} live variants added to graph for ${n}`)}).catch(p=>{console.warn("Clone detection failed:",p)}),_}function nD(e){return e?oc.getCluster(e):oc.getFullGraph()}function YS(){return oc.getBlocklist()}function aD(){return oc.getStats()}const sD=`You are QalqanAI's Analyst Copilot  an AI assistant specialized in cybersecurity, website threat detection, phishing analysis, and online fraud investigation.

Your capabilities:
- Explain website risk scores and threat categories
- Discuss phishing, scam, casino, and pyramid scheme detection
- Help users understand infrastructure fingerprinting
- Explain how mirror/clone site detection works
- Discuss TLS certificates, hosting analysis, and tracker identification
- Provide cybersecurity advice and best practices

Keep responses concise (2-4 paragraphs max). Use markdown formatting: **bold** for emphasis, \`code\` for technical terms. Be professional but approachable.

If a user asks to analyze a specific URL/domain, tell them you'll run the analysis now.
If asked about topics unrelated to cybersecurity, briefly answer but guide the conversation back to security topics.`;function rD(){const[e,n]=Me.useState(!1),[t,s]=Me.useState([]),[i,l]=Me.useState(""),[c,u]=Me.useState(!1),[d,f]=Me.useState(null),m=Me.useRef(null),{t:_,lang:p}=Jo();Me.useEffect(()=>{s([{role:"assistant",content:p==="ru"?`!  - QalqanAI.    :

     
    
   
     

 : **" lucky-spin-777.bet"**  **"  ?"**`:`Hello! I'm QalqanAI's Analyst Copilot. I can help you:

 Analyze any website for threats
 Explain risk decisions
 Investigate infrastructure clusters
 Answer cybersecurity questions

Try asking me: **"Analyze lucky-spin-777.bet"** or **"What is phishing?"**`}])},[p]);const y=()=>{m.current?.scrollIntoView({behavior:"smooth"})};Me.useEffect(()=>{y()},[t,c]);const v=$=>{const C=$.toLowerCase().trim().match(/(?:analyze|scan|check|||)\s+(.+)/);return C?C[1].replace(/['"]/g,"").trim():null},T=$=>{const w=$.risk_score>=80?"":$.risk_score>=50?"":"",C=$.explanations.length>0?$.explanations.slice(0,5).map(P=>`   **+${P.weight}** ${P.label}`).join(`
`):"   No risk indicators detected";return`## ${w} Analysis: ${$.url}

**Risk Score:** ${$.risk_score}/100
**Category:** ${$.category}
**Confidence:** ${Math.round($.confidence*100)}%
**Status:** ${$.status}

### Key Findings:
${C}

**Hosting:** ${$.hosting.provider} (${$.hosting.country})
**TLS:** ${$.tls.issuer}${$.tls.selfSigned?"  Self-signed":""}
${$.cluster_id?`**Cluster:** ${$.cluster_id}`:""}

Ask me to explain any finding or investigate further.`},k=async $=>{try{const w=[{role:"system",content:sD+(p==="ru"?`

IMPORTANT: The user is speaking Russian. Always respond in Russian.`:"")},...$.map(P=>({role:P.role,content:P.content}))],C=await window.puter.ai.chat(w,{model:"gpt-4o-mini"});return C?.message?.content||C?.toString()||"I couldn't generate a response. Please try again."}catch(w){return console.error("AI Chat error:",w),p==="ru"?"     AI.   .":"An error occurred connecting to AI. Please try again."}},b=async()=>{const $=i.trim();if(!$||c)return;const w=[...t,{role:"user",content:$}];s(w),l(""),u(!0);try{const C=v($);if(C)try{const P=await XS(C);f(P);const A=T(P);s(I=>[...I,{role:"assistant",content:A}])}catch{const A=p==="ru"?"   URL.   ,  `example.com`.":"I couldn't analyze that URL. Please provide a valid domain like `example.com`.";s(I=>[...I,{role:"assistant",content:A}])}else{const P=w.slice(-10),A=await k(P);s(I=>[...I,{role:"assistant",content:A}])}}catch{const P=p==="ru"?" .   .":"Something went wrong. Please try again.";s(A=>[...A,{role:"assistant",content:P}])}u(!1)},S=$=>{$.key==="Enter"&&!$.shiftKey&&($.preventDefault(),b())};return L.jsxs(L.Fragment,{children:[L.jsx("button",{className:`chat-fab ${e?"hidden":""}`,onClick:()=>n(!0),children:L.jsx(xk,{size:22})}),e&&L.jsxs("div",{className:"chat-panel",children:[L.jsxs("div",{className:"chat-header",children:[L.jsxs("div",{className:"chat-header-info",children:[L.jsx(Jg,{size:18}),L.jsxs("div",{children:[L.jsx("div",{className:"chat-title",children:"Analyst Copilot"}),L.jsx("div",{className:"chat-status",children:c?p==="ru"?" ...":" Thinking...":"QalqanAI Intelligence"})]})]}),L.jsx("button",{className:"chat-close",onClick:()=>n(!1),children:L.jsx(K0,{size:18})})]}),L.jsxs("div",{className:"chat-messages",children:[t.map(($,w)=>L.jsxs("div",{className:`chat-message ${$.role}`,children:[L.jsx("div",{className:"chat-avatar",children:$.role==="assistant"?L.jsx(Jg,{size:14}):L.jsx(iT,{size:14})}),L.jsx("div",{className:"chat-bubble",dangerouslySetInnerHTML:{__html:$.content.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/`(.+?)`/g,"<code>$1</code>").replace(/^## (.+)$/gm,"<h4>$1</h4>").replace(/^### (.+)$/gm,"<h5>$1</h5>").replace(/\n/g,"<br/>")}})]},w)),c&&L.jsxs("div",{className:"chat-message assistant",children:[L.jsx("div",{className:"chat-avatar",children:L.jsx(Jg,{size:14})}),L.jsxs("div",{className:"chat-bubble typing",children:[L.jsx("span",{}),L.jsx("span",{}),L.jsx("span",{})]})]}),L.jsx("div",{ref:m})]}),L.jsxs("div",{className:"chat-input-area",children:[L.jsx("input",{type:"text",placeholder:p==="ru"?"  ,  URL...":"Ask about threats, analyze URLs...",value:i,onChange:$=>l($.target.value),onKeyDown:S,disabled:c}),L.jsx("button",{className:"chat-send",onClick:b,disabled:!i.trim()||c,children:L.jsx(f0,{size:16})})]})]})]})}const iD={Casino:"#ff6b81",Scam:"#ffa502",Phishing:"#ff4757",Pyramid:"#a855f7",Unknown:"#888"};function oD(){const[e,n]=Me.useState(""),[t,s]=Me.useState(!1),[i,l]=Me.useState({scannedToday:0,clustersFound:0,threatsBlocked:0,activeMonitors:0}),[c,u]=Me.useState([]),d=xm(),f=Me.useRef(null),{t:m}=Jo();Me.useEffect(()=>{try{const k=aD();l(k)}catch{l({scannedToday:14827,clustersFound:342,threatsBlocked:8291,activeMonitors:1563})}try{const k=YS().slice(0,10).map((b,S)=>({id:S+1,time:`${(S+1)*3} min ago`,domain:b.domain,category:b.category,risk:b.risk,action:b.status==="Blocked"?"Auto-blocked":b.status==="Under Review"?"Under review":"Cluster detected"}));u(k)}catch{u([{id:1,time:"2 min ago",domain:"lucky-spin-777.bet",category:"Casino",risk:92,action:"Auto-blocked"},{id:2,time:"5 min ago",domain:"invest-gold-pro.xyz",category:"Pyramid",risk:87,action:"Cluster detected"},{id:3,time:"8 min ago",domain:"secure-bank-verify.com",category:"Phishing",risk:95,action:"Auto-blocked"}])}},[]);const _=k=>{k.preventDefault(),e.trim()&&(s(!0),setTimeout(()=>{d(`/analysis?url=${encodeURIComponent(e.trim())}`)},1500))};Me.useEffect(()=>{const k=f.current;if(!k)return;const b=setInterval(()=>{k.scrollTop+k.clientHeight<k.scrollHeight?k.scrollTop+=1:k.scrollTop=0},50);return()=>clearInterval(b)},[]);const p=[{label:m("dashboard.scannedToday"),value:(i.scannedToday||0).toLocaleString(),sub:m("dashboard.vsYesterday"),icon:_g,color:"var(--accent-cyan)"},{label:m("dashboard.suspicious"),value:(i.threatsBlocked||0).toLocaleString(),sub:m("dashboard.tierAB"),icon:um,color:"var(--danger)"},{label:m("dashboard.newMirrors"),value:(i.clustersFound||0).toLocaleString(),sub:m("dashboard.hours24"),icon:VP,color:"var(--accent-violet)"},{label:m("dashboard.clusters"),value:(i.activeMonitors||0).toLocaleString(),sub:m("dashboard.operatorFingerprints"),icon:Ck,color:"var(--success)"}],y=c.length>0?[...c,...c]:[],v=m("dashboard.breadcrumb"),T=m("dashboard.categories");return L.jsxs("div",{className:"dashboard page-container",children:[L.jsxs("section",{className:"hero-split animate-in",children:[L.jsxs("div",{className:"hero-left",children:[L.jsxs("div",{className:"hero-breadcrumb",children:[L.jsx("span",{children:v[0]}),L.jsx("span",{className:"breadcrumb-dot",children:""}),L.jsx("span",{children:v[1]}),L.jsx("span",{className:"breadcrumb-dot",children:""}),L.jsx("span",{children:v[2]})]}),L.jsxs("h1",{className:"hero-title",children:[m("dashboard.heroTitle"),L.jsx("br",{}),L.jsx("span",{className:"hero-title-accent",children:m("dashboard.heroTitleAccent")})]}),L.jsx("p",{className:"hero-subtitle",children:m("dashboard.heroSubtitle")}),L.jsxs("form",{className:"scan-form",onSubmit:_,children:[L.jsxs("div",{className:`scan-input-wrapper ${t?"scanning":""}`,children:[L.jsx("input",{type:"text",className:"scan-input",placeholder:m("dashboard.placeholder"),value:e,onChange:k=>n(k.target.value),disabled:t}),L.jsx("button",{type:"submit",className:"btn-primary scan-btn",disabled:t,children:t?L.jsxs(L.Fragment,{children:[L.jsx(tT,{size:16,className:"spin"})," ",m("dashboard.scanning")]}):L.jsx(L.Fragment,{children:m("dashboard.analyze")})})]}),t&&L.jsx("div",{className:"scan-progress",children:L.jsx("div",{className:"scan-progress-bar"})})]}),L.jsx("div",{className:"category-chips",children:T.map(k=>L.jsx("span",{className:"chip",children:k},k))}),L.jsx("div",{className:"hero-shortcuts",children:L.jsxs("span",{className:"shortcut-hint",children:[m("dashboard.shortcuts")," ",L.jsx("kbd",{children:"/"})," ",m("dashboard.shortcutChat")," ",L.jsx("kbd",{children:"Ctrl"})," + ",L.jsx("kbd",{children:"K"})," ",m("dashboard.shortcutAnalysis")]})})]}),L.jsx("div",{className:"hero-right",children:L.jsxs("div",{className:"feed-panel glass-card",children:[L.jsxs("div",{className:"feed-panel-header",children:[L.jsx("h3",{children:m("dashboard.threatFeed")}),L.jsxs("span",{className:"live-badge",children:[L.jsx("span",{className:"live-dot"}),"LIVE"]})]}),L.jsx("p",{className:"feed-panel-desc",children:m("dashboard.feedDesc")}),L.jsx("div",{className:"feed-scroll",ref:f,children:y.map((k,b)=>L.jsxs("div",{className:"feed-event",children:[L.jsx("div",{className:"event-icon",style:{color:iD[k.category]||"#888"},children:L.jsx(Tu,{size:16})}),L.jsxs("div",{className:"event-content",children:[L.jsx("div",{className:"event-title",children:k.action==="Auto-blocked"?m("dashboard.newMirror"):k.action==="Cluster detected"?m("dashboard.trackerReused"):m("dashboard.redirectAnomaly")}),L.jsxs("div",{className:"event-detail",children:[L.jsx("span",{className:"event-domain",children:k.domain}),L.jsxs("span",{className:"event-meta",children:["  ",m("dashboard.risk")," ",k.risk,"  ",k.category]})]})]})]},`${k.id}-${b}`))})]})})]}),L.jsx("section",{className:"stats-grid animate-in animate-in-delay-1",children:p.map(k=>(k.icon,L.jsx("div",{className:"stat-card glass-card",children:L.jsxs("div",{className:"stat-content",children:[L.jsx("div",{className:"stat-label",children:k.label}),L.jsx("div",{className:"stat-value",children:k.value}),L.jsx("div",{className:"stat-sub",children:k.sub})]})},k.label)))}),L.jsx("div",{className:"dashboard-footer animate-in animate-in-delay-2",children:L.jsxs("p",{className:"footer-tagline",children:[m("dashboard.footerLine1")," ",L.jsx("span",{children:m("dashboard.footerLine2")})]})})]})}function lD({score:e=0,size:n=200}){const t=Me.useRef(null),s=Me.useRef(0);return Me.useEffect(()=>{const i=t.current;if(!i)return;const l=i.getContext("2d"),c=window.devicePixelRatio||1;i.width=n*c,i.height=n*c,l.scale(c,c);const u=n/2,d=n/2,f=n/2-20,m=.75*Math.PI,_=2.25*Math.PI,p=_-m;let y;const v=()=>{s.current<e&&(s.current=Math.min(s.current+1,e)),l.clearRect(0,0,n,n),l.beginPath(),l.arc(u,d,f,m,_),l.strokeStyle="rgba(255,255,255,0.08)",l.lineWidth=10,l.lineCap="round",l.stroke();const T=m+s.current/100*p,k=l.createLinearGradient(0,0,n,n);s.current>=75?(k.addColorStop(0,"#ff4757"),k.addColorStop(1,"#ff6b81")):s.current>=50?(k.addColorStop(0,"#ffa502"),k.addColorStop(1,"#ffbe76")):(k.addColorStop(0,"#2ed573"),k.addColorStop(1,"#7bed9f")),l.beginPath(),l.arc(u,d,f,m,T),l.strokeStyle=k,l.lineWidth=10,l.lineCap="round",l.stroke(),l.beginPath(),l.arc(u,d,f,m,T),l.strokeStyle=s.current>=75?"rgba(239, 68, 68, 0.25)":s.current>=50?"rgba(249, 115, 22, 0.25)":"rgba(34, 197, 94, 0.25)",l.lineWidth=20,l.lineCap="round",l.filter="blur(10px)",l.stroke(),l.filter="none",l.fillStyle="#ffffff",l.font=`800 ${n*.22}px Inter, sans-serif`,l.textAlign="center",l.textBaseline="middle",l.fillText(Math.round(s.current),u,d-8),l.fillStyle="rgba(255,255,255,0.5)",l.font=`500 ${n*.07}px Inter, sans-serif`,l.fillText("RISK SCORE",u,d+n*.15),s.current<e&&(y=requestAnimationFrame(v))};return s.current=0,v(),()=>cancelAnimationFrame(y)},[e,n]),L.jsx("div",{className:"risk-gauge",style:{width:n,height:n},children:L.jsx("canvas",{ref:t,style:{width:n,height:n}})})}const hf={Casino:"#ff6b81",Scam:"#ffa502",Phishing:"#ff4757",Pyramid:"#a855f7",Unknown:"#888",Safe:"#22c55e","Not Found":"#888"};function cD(){const[e]=Zx(),n=xm(),{t}=Jo(),s=e.get("url")||"1xbet.com",[i,l]=Me.useState(null),[c,u]=Me.useState(!0),[d,f]=Me.useState(null),[m,_]=Me.useState(""),[p,y]=Me.useState(new Set);Me.useEffect(()=>{u(!0),f(null),l(null),_(t("analysis.initScan"));const S=[t("analysis.statusChecking"),t("analysis.statusDNS"),t("analysis.statusTLS"),t("analysis.statusFingerprints"),t("analysis.statusHeuristic"),t("analysis.statusRisk"),t("analysis.statusEcosystem")];let $=0;const w=setInterval(()=>{$<S.length&&(_(S[$]),$++)},400);return XS(s).then(C=>{clearInterval(w),l(C),u(!1);let P=0;const A=setInterval(()=>{P++,C.clone_variants&&C.clone_variants.length>0&&(l({...C}),clearInterval(A)),P>=10&&clearInterval(A)},2e3)}).catch(C=>{clearInterval(w),f(C.message),u(!1)}),()=>clearInterval(w)},[s]);const v=S=>{y($=>{const w=new Set($);return w.has(S)?w.delete(S):w.add(S),w})};if(c)return L.jsx("div",{className:"analysis page-container",children:L.jsxs("div",{className:"loading-state",children:[L.jsx("div",{className:"loading-spinner"}),L.jsxs("p",{children:[t("analysis.analyzing")," ",L.jsx("strong",{children:s}),"..."]}),L.jsx("p",{className:"loading-sub",children:m})]})});if(d)return L.jsx("div",{className:"analysis page-container",children:L.jsxs("div",{className:"loading-state",children:[L.jsx(Tu,{size:48,style:{color:"var(--danger)",marginBottom:"1rem"}}),L.jsxs("p",{children:[t("analysis.analysisFailed")," ",L.jsx("strong",{children:s})]}),L.jsx("p",{className:"loading-sub",children:d}),L.jsx("button",{className:"btn-primary",style:{marginTop:"1rem"},onClick:()=>n("/"),children:t("analysis.backToDashboard")})]})});if(!i)return null;if(i.domainExists===!1)return L.jsxs("div",{className:"analysis page-container",children:[L.jsx("div",{className:"analysis-header animate-in",children:L.jsxs("div",{children:[L.jsx("h1",{className:"page-title",children:t("analysis.title")}),L.jsxs("p",{className:"page-subtitle",children:[L.jsx(c0,{size:14})," ",t("analysis.completedIn")," ",i.scan_time,"s"]})]})}),L.jsxs("div",{className:"not-found-card glass-card animate-in animate-in-delay-1",children:[L.jsx(bk,{size:64,style:{color:"var(--text-dim)",marginBottom:16}}),L.jsx("h2",{style:{fontFamily:"var(--font-serif)",fontSize:"1.6rem",marginBottom:8},children:t("analysis.domainNotFound")}),L.jsx("p",{className:"url-text",style:{fontSize:"1.1rem",marginBottom:16},children:i.url}),L.jsxs("div",{className:"not-found-detail glass-card",children:[L.jsx(eg,{size:16,style:{color:"var(--text-muted)"}}),L.jsxs("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:[t("analysis.dnsLookup")," ",L.jsx("strong",{children:"NXDOMAIN"})," ",t("analysis.nxdomain")]})]}),L.jsx("button",{className:"btn-primary",style:{marginTop:24},onClick:()=>n("/"),children:t("analysis.analyzeAnother")})]})]});const T=[{key:"infrastructure",title:t("analysis.infrastructure"),icon:q0,color:"var(--accent-cyan)"},{key:"tracking",title:t("analysis.tracking"),icon:nT,color:"var(--accent-violet)"},{key:"financial",title:t("analysis.financial"),icon:oT,color:"var(--warning)"},{key:"contacts",title:t("analysis.contacts"),icon:rT,color:"#ff6b81"}],k=i.risk_score>=80?t("analysis.highRisk"):i.risk_score>=50?t("analysis.mediumRisk"):t("analysis.lowRisk"),b=i.risk_score>=80?"badge-danger":i.risk_score>=50?"badge-warning":"badge-cyan";return L.jsxs("div",{className:"analysis page-container",children:[L.jsxs("div",{className:"analysis-header animate-in",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"page-title",children:t("analysis.title")}),L.jsxs("p",{className:"page-subtitle",children:[L.jsx(c0,{size:14})," ",t("analysis.scannedIn")," ",i.scan_time,"s  ",new Date(i.analyzed_at).toLocaleString(),i.cached&&L.jsx("span",{className:"badge badge-cyan",style:{marginLeft:8,fontSize:10},children:"CACHED"})]})]}),L.jsxs("button",{className:"btn-primary",onClick:()=>n(`/ecosystem?url=${encodeURIComponent(s)}`),children:[L.jsx(d0,{size:16})," ",t("analysis.viewEcosystem")]})]}),L.jsxs("div",{className:"analysis-top animate-in animate-in-delay-1",children:[L.jsxs("div",{className:"gauge-card glass-card",children:[L.jsx(lD,{score:i.risk_score,size:220}),L.jsxs("div",{className:"category-badge",style:{background:`${hf[i.category]||hf.Unknown}20`,color:hf[i.category]||hf.Unknown,border:`1px solid ${hf[i.category]||hf.Unknown}40`},children:[L.jsx(Tu,{size:14}),i.category]}),i.confidence>0&&L.jsxs("div",{className:"confidence-label",style:{marginTop:8,color:"var(--text-muted)",fontSize:12},children:[t("analysis.confidence")," ",Math.round(i.confidence*100),"%"]})]}),L.jsxs("div",{className:"reasons-card glass-card",children:[L.jsxs("h3",{className:"card-title",children:[L.jsx(yb,{size:18,style:{marginRight:8}}),i.risk_score>=50?t("analysis.whyUnsafe"):t("analysis.whyAnalyzed")]}),L.jsx("div",{className:"reasons-list",children:i.explanations.length===0?L.jsx("div",{className:"reason-item",style:{color:"var(--success)"},children:t("analysis.noRiskIndicators")}):i.explanations.map((S,$)=>L.jsxs("div",{className:"reason-item-wrapper",children:[L.jsxs("div",{className:"reason-item",onClick:()=>v($),style:{cursor:"pointer"},children:[L.jsxs("div",{className:"reason-weight",children:["+",S.weight]}),L.jsx("div",{className:"reason-label",children:S.label}),L.jsx("span",{className:`badge badge-${S.type==="infrastructure"?"cyan":S.type==="tracking"?"violet":S.type==="financial"?"warning":S.type==="ecosystem"?"cyan":"danger"}`,children:S.type}),L.jsx(cm,{size:14,className:`evidence-chevron ${p.has($)?"rotated":""}`})]}),p.has($)&&S.evidence&&L.jsxs("div",{className:"evidence-panel",children:[L.jsxs("div",{className:"evidence-label",children:[L.jsx(yb,{size:12})," ",t("analysis.evidenceLocation")]}),L.jsx("p",{className:"evidence-text",children:S.evidence})]})]},$))})]})]}),L.jsxs("div",{className:"url-bar glass-card animate-in animate-in-delay-2",children:[L.jsx(aT,{size:16,className:"url-icon"}),L.jsx("span",{className:"url-text",children:i.url}),L.jsx("span",{className:`badge ${b}`,children:k}),i.cluster_id&&L.jsx("span",{className:"badge badge-violet",style:{marginLeft:8},children:i.cluster_id})]}),L.jsxs("div",{className:"engine-stats animate-in animate-in-delay-2",children:[L.jsxs("div",{className:"glass-card",style:{padding:"12px 20px",fontSize:13,color:"var(--text-muted)"},children:[t("analysis.rulesEvaluated")," ",L.jsx("strong",{style:{color:"var(--text-primary)"},children:i.rules_evaluated})]}),L.jsxs("div",{className:"glass-card",style:{padding:"12px 20px",fontSize:13,color:"var(--text-muted)"},children:[t("analysis.rulesTriggered")," ",L.jsx("strong",{style:{color:"var(--text-primary)"},children:i.rules_fired})]})]}),i.ml_prediction&&L.jsxs("div",{className:"ml-prediction-card glass-card animate-in animate-in-delay-2",style:{marginTop:16,padding:24},children:[L.jsxs("h3",{className:"card-title",style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[L.jsx("span",{style:{fontSize:18},children:""}),t("analysis.mlTitle")]}),L.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,marginBottom:20},children:[L.jsx("div",{style:{padding:"8px 16px",borderRadius:8,fontWeight:700,fontSize:14,textTransform:"uppercase",letterSpacing:1,background:i.ml_prediction.prediction==="benign"?"rgba(34,197,94,0.15)":i.ml_prediction.prediction==="phishing"?"rgba(255,71,87,0.15)":i.ml_prediction.prediction==="malware"?"rgba(255,165,2,0.15)":"rgba(168,85,247,0.15)",color:i.ml_prediction.prediction==="benign"?"#22c55e":i.ml_prediction.prediction==="phishing"?"#ff4757":i.ml_prediction.prediction==="malware"?"#ffa502":"#a855f7",border:`1px solid ${i.ml_prediction.prediction==="benign"?"rgba(34,197,94,0.3)":i.ml_prediction.prediction==="phishing"?"rgba(255,71,87,0.3)":i.ml_prediction.prediction==="malware"?"rgba(255,165,2,0.3)":"rgba(168,85,247,0.3)"}`},children:i.ml_prediction.prediction}),L.jsxs("div",{style:{fontSize:13,color:"var(--text-muted)"},children:[t("analysis.mlConfidence")," ",L.jsxs("strong",{style:{color:"var(--text-primary)"},children:[Math.round(i.ml_prediction.confidence*100),"%"]})]})]}),L.jsx("div",{style:{display:"grid",gap:8},children:Object.entries(i.ml_prediction.probabilities).sort(([,S],[,$])=>$-S).map(([S,$])=>{const w={benign:"#22c55e",phishing:"#ff4757",malware:"#ffa502",defacement:"#a855f7"};return L.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[L.jsx("span",{style:{width:80,fontSize:12,color:"var(--text-muted)",textTransform:"capitalize"},children:S}),L.jsx("div",{style:{flex:1,height:8,borderRadius:4,background:"rgba(255,255,255,0.05)"},children:L.jsx("div",{style:{width:`${$*100}%`,height:"100%",borderRadius:4,background:w[S]||"#888",transition:"width 0.6s ease",minWidth:$>0?4:0}})}),L.jsxs("span",{style:{width:44,fontSize:12,color:"var(--text-secondary)",textAlign:"right"},children:[($*100).toFixed(1),"%"]})]},S)})}),L.jsx("div",{style:{marginTop:12,fontSize:11,color:"var(--text-dim)",fontStyle:"italic"},children:t("analysis.mlNote")})]}),i.clone_variants&&i.clone_variants.length>0&&L.jsxs("div",{className:"glass-card animate-in animate-in-delay-2",style:{marginTop:16,padding:24},children:[L.jsxs("h3",{className:"card-title",style:{display:"flex",alignItems:"center",gap:8,marginBottom:16},children:[L.jsx("span",{style:{fontSize:18},children:""}),t("analysis.clonesTitle")]}),L.jsx("div",{style:{fontSize:12,color:"var(--text-secondary)",marginBottom:14},children:t("analysis.clonesDesc")}),L.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:i.clone_variants.map((S,$)=>{const w=S.risk_score>=80?"#ff4757":S.risk_score>=50?"#ffa502":"#2ed573";return L.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"12px 16px",borderRadius:10,background:"rgba(255,255,255,0.03)",border:"1px solid rgba(255,255,255,0.06)"},children:[L.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:w,flexShrink:0,boxShadow:`0 0 8px ${w}60`}}),L.jsxs("div",{style:{flex:1,minWidth:0},children:[L.jsx("div",{style:{fontWeight:600,fontSize:14,color:"var(--text-primary)"},children:S.domain}),L.jsxs("div",{style:{fontSize:11,color:"var(--text-dim)",marginTop:2},children:["IP: ",S.ip||"unknown","  ",S.category]})]}),L.jsx("div",{style:{fontWeight:700,fontSize:16,color:w,minWidth:40,textAlign:"right"},children:S.risk_score}),L.jsxs("button",{onClick:()=>n(`/ecosystem?url=${S.domain}`),style:{background:"rgba(0,240,255,0.1)",border:"1px solid rgba(0,240,255,0.2)",borderRadius:6,padding:"4px 10px",cursor:"pointer",color:"#00f0ff",fontSize:11,fontWeight:500},children:[L.jsx(d0,{size:12,style:{marginRight:4}}),"Graph"]})]},$)})}),L.jsx("div",{style:{marginTop:12,fontSize:11,color:"var(--text-dim)",fontStyle:"italic"},children:t("analysis.clonesNote")})]}),i.redirect_chain&&i.redirect_chain.length>0&&L.jsxs("div",{className:"redirect-section animate-in animate-in-delay-2",children:[L.jsx("h3",{className:"section-title-sm",children:t("analysis.redirectChain")}),L.jsx("div",{className:"redirect-chain",children:i.redirect_chain.map((S,$)=>L.jsxs("div",{className:"redirect-step",children:[L.jsx("div",{className:"redirect-step-num",children:S.step}),L.jsxs("div",{className:"redirect-step-content glass-card",children:[L.jsx("div",{className:"redirect-url",children:S.url}),L.jsxs("div",{className:"redirect-meta",children:[L.jsx("span",{className:"badge badge-cyan",children:S.type}),L.jsxs("span",{className:"redirect-status",children:["HTTP ",S.status]})]})]}),$<i.redirect_chain.length-1&&L.jsx("div",{className:"redirect-arrow",children:L.jsx(FP,{size:16})})]},$))})]}),L.jsxs("div",{className:"markers-section animate-in animate-in-delay-3",children:[L.jsx("h3",{className:"section-title-sm",children:t("analysis.extractedMarkers")}),L.jsx("div",{className:"markers-grid",children:T.map(S=>{const $=S.icon,w=i.markers?.[S.key],C=w?Object.entries(w).filter(([,P])=>P!=null&&P!==!1).map(([P,A])=>({key:P,value:typeof A=="object"?JSON.stringify(A):String(A)})):[];return C.length===0?null:L.jsxs("div",{className:"marker-card glass-card",children:[L.jsxs("div",{className:"marker-header",children:[L.jsx($,{size:18,style:{color:S.color}}),L.jsx("h4",{children:S.title}),L.jsx("span",{className:"marker-count",children:C.length})]}),L.jsx("div",{className:"marker-items",children:C.map((P,A)=>L.jsxs("div",{className:"marker-item",children:[L.jsx("span",{className:"marker-key",children:P.key}),L.jsx("span",{className:"marker-value",children:P.value})]},A))})]},S.key)})})]}),i.domain_analysis?.whois&&L.jsxs("div",{className:"whois-section animate-in animate-in-delay-3",children:[L.jsxs("h3",{className:"section-title-sm",children:[L.jsx(iT,{size:16})," ",t("analysis.registration")]}),L.jsx("div",{className:"glass-card",style:{padding:20},children:L.jsx("div",{className:"markers-grid",style:{gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))"},children:Object.entries(i.domain_analysis.whois).map(([S,$])=>L.jsxs("div",{className:"marker-item",style:{padding:"8px 0"},children:[L.jsx("span",{className:"marker-key",children:S}),L.jsx("span",{className:"marker-value",children:String($)})]},S))})})]})]})}var uD={value:()=>{}};function Em(){for(var e=0,n=arguments.length,t={},s;e<n;++e){if(!(s=arguments[e]+"")||s in t||/[\s.]/.test(s))throw new Error("illegal type: "+s);t[s]=[]}return new K_(t)}function K_(e){this._=e}function dD(e,n){return e.trim().split(/^|\s+/).map(function(t){var s="",i=t.indexOf(".");if(i>=0&&(s=t.slice(i+1),t=t.slice(0,i)),t&&!n.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:s}})}K_.prototype=Em.prototype={constructor:K_,on:function(e,n){var t=this._,s=dD(e+"",t),i,l=-1,c=s.length;if(arguments.length<2){for(;++l<c;)if((i=(e=s[l]).type)&&(i=fD(t[i],e.name)))return i;return}if(n!=null&&typeof n!="function")throw new Error("invalid callback: "+n);for(;++l<c;)if(i=(e=s[l]).type)t[i]=rx(t[i],e.name,n);else if(n==null)for(i in t)t[i]=rx(t[i],e.name,null);return this},copy:function(){var e={},n=this._;for(var t in n)e[t]=n[t].slice();return new K_(e)},call:function(e,n){if((i=arguments.length-2)>0)for(var t=new Array(i),s=0,i,l;s<i;++s)t[s]=arguments[s+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(l=this._[e],s=0,i=l.length;s<i;++s)l[s].value.apply(n,t)},apply:function(e,n,t){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var s=this._[e],i=0,l=s.length;i<l;++i)s[i].value.apply(n,t)}};function fD(e,n){for(var t=0,s=e.length,i;t<s;++t)if((i=e[t]).name===n)return i.value}function rx(e,n,t){for(var s=0,i=e.length;s<i;++s)if(e[s].name===n){e[s]=uD,e=e.slice(0,s).concat(e.slice(s+1));break}return t!=null&&e.push({name:n,value:t}),e}var D0="http://www.w3.org/1999/xhtml";const ix={svg:"http://www.w3.org/2000/svg",xhtml:D0,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function gg(e){var n=e+="",t=n.indexOf(":");return t>=0&&(n=e.slice(0,t))!=="xmlns"&&(e=e.slice(t+1)),ix.hasOwnProperty(n)?{space:ix[n],local:e}:e}function hD(e){return function(){var n=this.ownerDocument,t=this.namespaceURI;return t===D0&&n.documentElement.namespaceURI===D0?n.createElement(e):n.createElementNS(t,e)}}function pD(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function ZS(e){var n=gg(e);return(n.local?pD:hD)(n)}function mD(){}function Ev(e){return e==null?mD:function(){return this.querySelector(e)}}function _D(e){typeof e!="function"&&(e=Ev(e));for(var n=this._groups,t=n.length,s=new Array(t),i=0;i<t;++i)for(var l=n[i],c=l.length,u=s[i]=new Array(c),d,f,m=0;m<c;++m)(d=l[m])&&(f=e.call(d,d.__data__,m,l))&&("__data__"in d&&(f.__data__=d.__data__),u[m]=f);return new vr(s,this._parents)}function gD(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function yD(){return[]}function JS(e){return e==null?yD:function(){return this.querySelectorAll(e)}}function vD(e){return function(){return gD(e.apply(this,arguments))}}function bD(e){typeof e=="function"?e=vD(e):e=JS(e);for(var n=this._groups,t=n.length,s=[],i=[],l=0;l<t;++l)for(var c=n[l],u=c.length,d,f=0;f<u;++f)(d=c[f])&&(s.push(e.call(d,d.__data__,f,c)),i.push(d));return new vr(s,i)}function eC(e){return function(){return this.matches(e)}}function tC(e){return function(n){return n.matches(e)}}var wD=Array.prototype.find;function MD(e){return function(){return wD.call(this.children,e)}}function xD(){return this.firstElementChild}function TD(e){return this.select(e==null?xD:MD(typeof e=="function"?e:tC(e)))}var ED=Array.prototype.filter;function SD(){return Array.from(this.children)}function CD(e){return function(){return ED.call(this.children,e)}}function AD(e){return this.selectAll(e==null?SD:CD(typeof e=="function"?e:tC(e)))}function PD(e){typeof e!="function"&&(e=eC(e));for(var n=this._groups,t=n.length,s=new Array(t),i=0;i<t;++i)for(var l=n[i],c=l.length,u=s[i]=[],d,f=0;f<c;++f)(d=l[f])&&e.call(d,d.__data__,f,l)&&u.push(d);return new vr(s,this._parents)}function nC(e){return new Array(e.length)}function kD(){return new vr(this._enter||this._groups.map(nC),this._parents)}function lg(e,n){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=n}lg.prototype={constructor:lg,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,n){return this._parent.insertBefore(e,n)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function $D(e){return function(){return e}}function DD(e,n,t,s,i,l){for(var c=0,u,d=n.length,f=l.length;c<f;++c)(u=n[c])?(u.__data__=l[c],s[c]=u):t[c]=new lg(e,l[c]);for(;c<d;++c)(u=n[c])&&(i[c]=u)}function OD(e,n,t,s,i,l,c){var u,d,f=new Map,m=n.length,_=l.length,p=new Array(m),y;for(u=0;u<m;++u)(d=n[u])&&(p[u]=y=c.call(d,d.__data__,u,n)+"",f.has(y)?i[u]=d:f.set(y,d));for(u=0;u<_;++u)y=c.call(e,l[u],u,l)+"",(d=f.get(y))?(s[u]=d,d.__data__=l[u],f.delete(y)):t[u]=new lg(e,l[u]);for(u=0;u<m;++u)(d=n[u])&&f.get(p[u])===d&&(i[u]=d)}function ID(e){return e.__data__}function zD(e,n){if(!arguments.length)return Array.from(this,ID);var t=n?OD:DD,s=this._parents,i=this._groups;typeof e!="function"&&(e=$D(e));for(var l=i.length,c=new Array(l),u=new Array(l),d=new Array(l),f=0;f<l;++f){var m=s[f],_=i[f],p=_.length,y=LD(e.call(m,m&&m.__data__,f,s)),v=y.length,T=u[f]=new Array(v),k=c[f]=new Array(v),b=d[f]=new Array(p);t(m,_,T,k,b,y,n);for(var S=0,$=0,w,C;S<v;++S)if(w=T[S]){for(S>=$&&($=S+1);!(C=k[$])&&++$<v;);w._next=C||null}}return c=new vr(c,s),c._enter=u,c._exit=d,c}function LD(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function FD(){return new vr(this._exit||this._groups.map(nC),this._parents)}function ND(e,n,t){var s=this.enter(),i=this,l=this.exit();return typeof e=="function"?(s=e(s),s&&(s=s.selection())):s=s.append(e+""),n!=null&&(i=n(i),i&&(i=i.selection())),t==null?l.remove():t(l),s&&i?s.merge(i).order():i}function jD(e){for(var n=e.selection?e.selection():e,t=this._groups,s=n._groups,i=t.length,l=s.length,c=Math.min(i,l),u=new Array(i),d=0;d<c;++d)for(var f=t[d],m=s[d],_=f.length,p=u[d]=new Array(_),y,v=0;v<_;++v)(y=f[v]||m[v])&&(p[v]=y);for(;d<i;++d)u[d]=t[d];return new vr(u,this._parents)}function RD(){for(var e=this._groups,n=-1,t=e.length;++n<t;)for(var s=e[n],i=s.length-1,l=s[i],c;--i>=0;)(c=s[i])&&(l&&c.compareDocumentPosition(l)^4&&l.parentNode.insertBefore(c,l),l=c);return this}function BD(e){e||(e=UD);function n(_,p){return _&&p?e(_.__data__,p.__data__):!_-!p}for(var t=this._groups,s=t.length,i=new Array(s),l=0;l<s;++l){for(var c=t[l],u=c.length,d=i[l]=new Array(u),f,m=0;m<u;++m)(f=c[m])&&(d[m]=f);d.sort(n)}return new vr(i,this._parents).order()}function UD(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function VD(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function GD(){return Array.from(this)}function WD(){for(var e=this._groups,n=0,t=e.length;n<t;++n)for(var s=e[n],i=0,l=s.length;i<l;++i){var c=s[i];if(c)return c}return null}function HD(){let e=0;for(const n of this)++e;return e}function qD(){return!this.node()}function KD(e){for(var n=this._groups,t=0,s=n.length;t<s;++t)for(var i=n[t],l=0,c=i.length,u;l<c;++l)(u=i[l])&&e.call(u,u.__data__,l,i);return this}function QD(e){return function(){this.removeAttribute(e)}}function XD(e){return function(){this.removeAttributeNS(e.space,e.local)}}function YD(e,n){return function(){this.setAttribute(e,n)}}function ZD(e,n){return function(){this.setAttributeNS(e.space,e.local,n)}}function JD(e,n){return function(){var t=n.apply(this,arguments);t==null?this.removeAttribute(e):this.setAttribute(e,t)}}function eO(e,n){return function(){var t=n.apply(this,arguments);t==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,t)}}function tO(e,n){var t=gg(e);if(arguments.length<2){var s=this.node();return t.local?s.getAttributeNS(t.space,t.local):s.getAttribute(t)}return this.each((n==null?t.local?XD:QD:typeof n=="function"?t.local?eO:JD:t.local?ZD:YD)(t,n))}function aC(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function nO(e){return function(){this.style.removeProperty(e)}}function aO(e,n,t){return function(){this.style.setProperty(e,n,t)}}function sO(e,n,t){return function(){var s=n.apply(this,arguments);s==null?this.style.removeProperty(e):this.style.setProperty(e,s,t)}}function rO(e,n,t){return arguments.length>1?this.each((n==null?nO:typeof n=="function"?sO:aO)(e,n,t??"")):Mf(this.node(),e)}function Mf(e,n){return e.style.getPropertyValue(n)||aC(e).getComputedStyle(e,null).getPropertyValue(n)}function iO(e){return function(){delete this[e]}}function oO(e,n){return function(){this[e]=n}}function lO(e,n){return function(){var t=n.apply(this,arguments);t==null?delete this[e]:this[e]=t}}function cO(e,n){return arguments.length>1?this.each((n==null?iO:typeof n=="function"?lO:oO)(e,n)):this.node()[e]}function sC(e){return e.trim().split(/^|\s+/)}function Sv(e){return e.classList||new rC(e)}function rC(e){this._node=e,this._names=sC(e.getAttribute("class")||"")}rC.prototype={add:function(e){var n=this._names.indexOf(e);n<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var n=this._names.indexOf(e);n>=0&&(this._names.splice(n,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function iC(e,n){for(var t=Sv(e),s=-1,i=n.length;++s<i;)t.add(n[s])}function oC(e,n){for(var t=Sv(e),s=-1,i=n.length;++s<i;)t.remove(n[s])}function uO(e){return function(){iC(this,e)}}function dO(e){return function(){oC(this,e)}}function fO(e,n){return function(){(n.apply(this,arguments)?iC:oC)(this,e)}}function hO(e,n){var t=sC(e+"");if(arguments.length<2){for(var s=Sv(this.node()),i=-1,l=t.length;++i<l;)if(!s.contains(t[i]))return!1;return!0}return this.each((typeof n=="function"?fO:n?uO:dO)(t,n))}function pO(){this.textContent=""}function mO(e){return function(){this.textContent=e}}function _O(e){return function(){var n=e.apply(this,arguments);this.textContent=n??""}}function gO(e){return arguments.length?this.each(e==null?pO:(typeof e=="function"?_O:mO)(e)):this.node().textContent}function yO(){this.innerHTML=""}function vO(e){return function(){this.innerHTML=e}}function bO(e){return function(){var n=e.apply(this,arguments);this.innerHTML=n??""}}function wO(e){return arguments.length?this.each(e==null?yO:(typeof e=="function"?bO:vO)(e)):this.node().innerHTML}function MO(){this.nextSibling&&this.parentNode.appendChild(this)}function xO(){return this.each(MO)}function TO(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function EO(){return this.each(TO)}function SO(e){var n=typeof e=="function"?e:ZS(e);return this.select(function(){return this.appendChild(n.apply(this,arguments))})}function CO(){return null}function AO(e,n){var t=typeof e=="function"?e:ZS(e),s=n==null?CO:typeof n=="function"?n:Ev(n);return this.select(function(){return this.insertBefore(t.apply(this,arguments),s.apply(this,arguments)||null)})}function PO(){var e=this.parentNode;e&&e.removeChild(this)}function kO(){return this.each(PO)}function $O(){var e=this.cloneNode(!1),n=this.parentNode;return n?n.insertBefore(e,this.nextSibling):e}function DO(){var e=this.cloneNode(!0),n=this.parentNode;return n?n.insertBefore(e,this.nextSibling):e}function OO(e){return this.select(e?DO:$O)}function IO(e){return arguments.length?this.property("__data__",e):this.node().__data__}function zO(e){return function(n){e.call(this,n,this.__data__)}}function LO(e){return e.trim().split(/^|\s+/).map(function(n){var t="",s=n.indexOf(".");return s>=0&&(t=n.slice(s+1),n=n.slice(0,s)),{type:n,name:t}})}function FO(e){return function(){var n=this.__on;if(n){for(var t=0,s=-1,i=n.length,l;t<i;++t)l=n[t],(!e.type||l.type===e.type)&&l.name===e.name?this.removeEventListener(l.type,l.listener,l.options):n[++s]=l;++s?n.length=s:delete this.__on}}}function NO(e,n,t){return function(){var s=this.__on,i,l=zO(n);if(s){for(var c=0,u=s.length;c<u;++c)if((i=s[c]).type===e.type&&i.name===e.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=l,i.options=t),i.value=n;return}}this.addEventListener(e.type,l,t),i={type:e.type,name:e.name,value:n,listener:l,options:t},s?s.push(i):this.__on=[i]}}function jO(e,n,t){var s=LO(e+""),i,l=s.length,c;if(arguments.length<2){var u=this.node().__on;if(u){for(var d=0,f=u.length,m;d<f;++d)for(i=0,m=u[d];i<l;++i)if((c=s[i]).type===m.type&&c.name===m.name)return m.value}return}for(u=n?NO:FO,i=0;i<l;++i)this.each(u(s[i],n,t));return this}function lC(e,n,t){var s=aC(e),i=s.CustomEvent;typeof i=="function"?i=new i(n,t):(i=s.document.createEvent("Event"),t?(i.initEvent(n,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(n,!1,!1)),e.dispatchEvent(i)}function RO(e,n){return function(){return lC(this,e,n)}}function BO(e,n){return function(){return lC(this,e,n.apply(this,arguments))}}function UO(e,n){return this.each((typeof n=="function"?BO:RO)(e,n))}function*VO(){for(var e=this._groups,n=0,t=e.length;n<t;++n)for(var s=e[n],i=0,l=s.length,c;i<l;++i)(c=s[i])&&(yield c)}var cC=[null];function vr(e,n){this._groups=e,this._parents=n}function Sm(){return new vr([[document.documentElement]],cC)}function GO(){return this}vr.prototype=Sm.prototype={constructor:vr,select:_D,selectAll:bD,selectChild:TD,selectChildren:AD,filter:PD,data:zD,enter:kD,exit:FD,join:ND,merge:jD,selection:GO,order:RD,sort:BD,call:VD,nodes:GD,node:WD,size:HD,empty:qD,each:KD,attr:tO,style:rO,property:cO,classed:hO,text:gO,html:wO,raise:xO,lower:EO,append:SO,insert:AO,remove:kO,clone:OO,datum:IO,on:jO,dispatch:UO,[Symbol.iterator]:VO};function mi(e){return typeof e=="string"?new vr([[document.querySelector(e)]],[document.documentElement]):new vr([[e]],cC)}function WO(e){let n;for(;n=e.sourceEvent;)e=n;return e}function Ho(e,n){if(e=WO(e),n===void 0&&(n=e.currentTarget),n){var t=n.ownerSVGElement||n;if(t.createSVGPoint){var s=t.createSVGPoint();return s.x=e.clientX,s.y=e.clientY,s=s.matrixTransform(n.getScreenCTM().inverse()),[s.x,s.y]}if(n.getBoundingClientRect){var i=n.getBoundingClientRect();return[e.clientX-i.left-n.clientLeft,e.clientY-i.top-n.clientTop]}}return[e.pageX,e.pageY]}const HO={passive:!1},_m={capture:!0,passive:!1};function n0(e){e.stopImmediatePropagation()}function yf(e){e.preventDefault(),e.stopImmediatePropagation()}function uC(e){var n=e.document.documentElement,t=mi(e).on("dragstart.drag",yf,_m);"onselectstart"in n?t.on("selectstart.drag",yf,_m):(n.__noselect=n.style.MozUserSelect,n.style.MozUserSelect="none")}function dC(e,n){var t=e.document.documentElement,s=mi(e).on("dragstart.drag",null);n&&(s.on("click.drag",yf,_m),setTimeout(function(){s.on("click.drag",null)},0)),"onselectstart"in t?s.on("selectstart.drag",null):(t.style.MozUserSelect=t.__noselect,delete t.__noselect)}const z_=e=>()=>e;function O0(e,{sourceEvent:n,subject:t,target:s,identifier:i,active:l,x:c,y:u,dx:d,dy:f,dispatch:m}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},subject:{value:t,enumerable:!0,configurable:!0},target:{value:s,enumerable:!0,configurable:!0},identifier:{value:i,enumerable:!0,configurable:!0},active:{value:l,enumerable:!0,configurable:!0},x:{value:c,enumerable:!0,configurable:!0},y:{value:u,enumerable:!0,configurable:!0},dx:{value:d,enumerable:!0,configurable:!0},dy:{value:f,enumerable:!0,configurable:!0},_:{value:m}})}O0.prototype.on=function(){var e=this._.on.apply(this._,arguments);return e===this._?this:e};function qO(e){return!e.ctrlKey&&!e.button}function KO(){return this.parentNode}function QO(e,n){return n??{x:e.x,y:e.y}}function XO(){return navigator.maxTouchPoints||"ontouchstart"in this}function YO(){var e=qO,n=KO,t=QO,s=XO,i={},l=Em("start","drag","end"),c=0,u,d,f,m,_=0;function p(w){w.on("mousedown.drag",y).filter(s).on("touchstart.drag",k).on("touchmove.drag",b,HO).on("touchend.drag touchcancel.drag",S).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function y(w,C){if(!(m||!e.call(this,w,C))){var P=$(this,n.call(this,w,C),w,C,"mouse");P&&(mi(w.view).on("mousemove.drag",v,_m).on("mouseup.drag",T,_m),uC(w.view),n0(w),f=!1,u=w.clientX,d=w.clientY,P("start",w))}}function v(w){if(yf(w),!f){var C=w.clientX-u,P=w.clientY-d;f=C*C+P*P>_}i.mouse("drag",w)}function T(w){mi(w.view).on("mousemove.drag mouseup.drag",null),dC(w.view,f),yf(w),i.mouse("end",w)}function k(w,C){if(e.call(this,w,C)){var P=w.changedTouches,A=n.call(this,w,C),I=P.length,W,G;for(W=0;W<I;++W)(G=$(this,A,w,C,P[W].identifier,P[W]))&&(n0(w),G("start",w,P[W]))}}function b(w){var C=w.changedTouches,P=C.length,A,I;for(A=0;A<P;++A)(I=i[C[A].identifier])&&(yf(w),I("drag",w,C[A]))}function S(w){var C=w.changedTouches,P=C.length,A,I;for(m&&clearTimeout(m),m=setTimeout(function(){m=null},500),A=0;A<P;++A)(I=i[C[A].identifier])&&(n0(w),I("end",w,C[A]))}function $(w,C,P,A,I,W){var G=l.copy(),q=Ho(W||P,C),Z,X,Q;if((Q=t.call(w,new O0("beforestart",{sourceEvent:P,target:p,identifier:I,active:c,x:q[0],y:q[1],dx:0,dy:0,dispatch:G}),A))!=null)return Z=Q.x-q[0]||0,X=Q.y-q[1]||0,function te(R,ee,ie){var he=q,_e;switch(R){case"start":i[I]=te,_e=c++;break;case"end":delete i[I],--c;case"drag":q=Ho(ie||ee,C),_e=c;break}G.call(R,w,new O0(R,{sourceEvent:ee,subject:Q,target:p,identifier:I,active:_e,x:q[0]+Z,y:q[1]+X,dx:q[0]-he[0],dy:q[1]-he[1],dispatch:G}),A)}}return p.filter=function(w){return arguments.length?(e=typeof w=="function"?w:z_(!!w),p):e},p.container=function(w){return arguments.length?(n=typeof w=="function"?w:z_(w),p):n},p.subject=function(w){return arguments.length?(t=typeof w=="function"?w:z_(w),p):t},p.touchable=function(w){return arguments.length?(s=typeof w=="function"?w:z_(!!w),p):s},p.on=function(){var w=l.on.apply(l,arguments);return w===l?p:w},p.clickDistance=function(w){return arguments.length?(_=(w=+w)*w,p):Math.sqrt(_)},p}function Cv(e,n,t){e.prototype=n.prototype=t,t.constructor=e}function fC(e,n){var t=Object.create(e.prototype);for(var s in n)t[s]=n[s];return t}function Cm(){}var gm=.7,cg=1/gm,vf="\\s*([+-]?\\d+)\\s*",ym="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",to="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",ZO=/^#([0-9a-f]{3,8})$/,JO=new RegExp(`^rgb\\(${vf},${vf},${vf}\\)$`),eI=new RegExp(`^rgb\\(${to},${to},${to}\\)$`),tI=new RegExp(`^rgba\\(${vf},${vf},${vf},${ym}\\)$`),nI=new RegExp(`^rgba\\(${to},${to},${to},${ym}\\)$`),aI=new RegExp(`^hsl\\(${ym},${to},${to}\\)$`),sI=new RegExp(`^hsla\\(${ym},${to},${to},${ym}\\)$`),ox={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Cv(Cm,vm,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:lx,formatHex:lx,formatHex8:rI,formatHsl:iI,formatRgb:cx,toString:cx});function lx(){return this.rgb().formatHex()}function rI(){return this.rgb().formatHex8()}function iI(){return hC(this).formatHsl()}function cx(){return this.rgb().formatRgb()}function vm(e){var n,t;return e=(e+"").trim().toLowerCase(),(n=ZO.exec(e))?(t=n[1].length,n=parseInt(n[1],16),t===6?ux(n):t===3?new Qs(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):t===8?L_(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):t===4?L_(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=JO.exec(e))?new Qs(n[1],n[2],n[3],1):(n=eI.exec(e))?new Qs(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=tI.exec(e))?L_(n[1],n[2],n[3],n[4]):(n=nI.exec(e))?L_(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=aI.exec(e))?hx(n[1],n[2]/100,n[3]/100,1):(n=sI.exec(e))?hx(n[1],n[2]/100,n[3]/100,n[4]):ox.hasOwnProperty(e)?ux(ox[e]):e==="transparent"?new Qs(NaN,NaN,NaN,0):null}function ux(e){return new Qs(e>>16&255,e>>8&255,e&255,1)}function L_(e,n,t,s){return s<=0&&(e=n=t=NaN),new Qs(e,n,t,s)}function oI(e){return e instanceof Cm||(e=vm(e)),e?(e=e.rgb(),new Qs(e.r,e.g,e.b,e.opacity)):new Qs}function I0(e,n,t,s){return arguments.length===1?oI(e):new Qs(e,n,t,s??1)}function Qs(e,n,t,s){this.r=+e,this.g=+n,this.b=+t,this.opacity=+s}Cv(Qs,I0,fC(Cm,{brighter(e){return e=e==null?cg:Math.pow(cg,e),new Qs(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?gm:Math.pow(gm,e),new Qs(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Qs(Mu(this.r),Mu(this.g),Mu(this.b),ug(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:dx,formatHex:dx,formatHex8:lI,formatRgb:fx,toString:fx}));function dx(){return`#${wu(this.r)}${wu(this.g)}${wu(this.b)}`}function lI(){return`#${wu(this.r)}${wu(this.g)}${wu(this.b)}${wu((isNaN(this.opacity)?1:this.opacity)*255)}`}function fx(){const e=ug(this.opacity);return`${e===1?"rgb(":"rgba("}${Mu(this.r)}, ${Mu(this.g)}, ${Mu(this.b)}${e===1?")":`, ${e})`}`}function ug(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Mu(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function wu(e){return e=Mu(e),(e<16?"0":"")+e.toString(16)}function hx(e,n,t,s){return s<=0?e=n=t=NaN:t<=0||t>=1?e=n=NaN:n<=0&&(e=NaN),new _i(e,n,t,s)}function hC(e){if(e instanceof _i)return new _i(e.h,e.s,e.l,e.opacity);if(e instanceof Cm||(e=vm(e)),!e)return new _i;if(e instanceof _i)return e;e=e.rgb();var n=e.r/255,t=e.g/255,s=e.b/255,i=Math.min(n,t,s),l=Math.max(n,t,s),c=NaN,u=l-i,d=(l+i)/2;return u?(n===l?c=(t-s)/u+(t<s)*6:t===l?c=(s-n)/u+2:c=(n-t)/u+4,u/=d<.5?l+i:2-l-i,c*=60):u=d>0&&d<1?0:c,new _i(c,u,d,e.opacity)}function cI(e,n,t,s){return arguments.length===1?hC(e):new _i(e,n,t,s??1)}function _i(e,n,t,s){this.h=+e,this.s=+n,this.l=+t,this.opacity=+s}Cv(_i,cI,fC(Cm,{brighter(e){return e=e==null?cg:Math.pow(cg,e),new _i(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?gm:Math.pow(gm,e),new _i(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,t=this.l,s=t+(t<.5?t:1-t)*n,i=2*t-s;return new Qs(a0(e>=240?e-240:e+120,i,s),a0(e,i,s),a0(e<120?e+240:e-120,i,s),this.opacity)},clamp(){return new _i(px(this.h),F_(this.s),F_(this.l),ug(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=ug(this.opacity);return`${e===1?"hsl(":"hsla("}${px(this.h)}, ${F_(this.s)*100}%, ${F_(this.l)*100}%${e===1?")":`, ${e})`}`}}));function px(e){return e=(e||0)%360,e<0?e+360:e}function F_(e){return Math.max(0,Math.min(1,e||0))}function a0(e,n,t){return(e<60?n+(t-n)*e/60:e<180?t:e<240?n+(t-n)*(240-e)/60:n)*255}const pC=e=>()=>e;function uI(e,n){return function(t){return e+t*n}}function dI(e,n,t){return e=Math.pow(e,t),n=Math.pow(n,t)-e,t=1/t,function(s){return Math.pow(e+s*n,t)}}function fI(e){return(e=+e)==1?mC:function(n,t){return t-n?dI(n,t,e):pC(isNaN(n)?t:n)}}function mC(e,n){var t=n-e;return t?uI(e,t):pC(isNaN(e)?n:e)}const mx=(function e(n){var t=fI(n);function s(i,l){var c=t((i=I0(i)).r,(l=I0(l)).r),u=t(i.g,l.g),d=t(i.b,l.b),f=mC(i.opacity,l.opacity);return function(m){return i.r=c(m),i.g=u(m),i.b=d(m),i.opacity=f(m),i+""}}return s.gamma=e,s})(1);function ic(e,n){return e=+e,n=+n,function(t){return e*(1-t)+n*t}}var z0=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,s0=new RegExp(z0.source,"g");function hI(e){return function(){return e}}function pI(e){return function(n){return e(n)+""}}function mI(e,n){var t=z0.lastIndex=s0.lastIndex=0,s,i,l,c=-1,u=[],d=[];for(e=e+"",n=n+"";(s=z0.exec(e))&&(i=s0.exec(n));)(l=i.index)>t&&(l=n.slice(t,l),u[c]?u[c]+=l:u[++c]=l),(s=s[0])===(i=i[0])?u[c]?u[c]+=i:u[++c]=i:(u[++c]=null,d.push({i:c,x:ic(s,i)})),t=s0.lastIndex;return t<n.length&&(l=n.slice(t),u[c]?u[c]+=l:u[++c]=l),u.length<2?d[0]?pI(d[0].x):hI(n):(n=d.length,function(f){for(var m=0,_;m<n;++m)u[(_=d[m]).i]=_.x(f);return u.join("")})}var _x=180/Math.PI,L0={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function _C(e,n,t,s,i,l){var c,u,d;return(c=Math.sqrt(e*e+n*n))&&(e/=c,n/=c),(d=e*t+n*s)&&(t-=e*d,s-=n*d),(u=Math.sqrt(t*t+s*s))&&(t/=u,s/=u,d/=u),e*s<n*t&&(e=-e,n=-n,d=-d,c=-c),{translateX:i,translateY:l,rotate:Math.atan2(n,e)*_x,skewX:Math.atan(d)*_x,scaleX:c,scaleY:u}}var N_;function _I(e){const n=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return n.isIdentity?L0:_C(n.a,n.b,n.c,n.d,n.e,n.f)}function gI(e){return e==null||(N_||(N_=document.createElementNS("http://www.w3.org/2000/svg","g")),N_.setAttribute("transform",e),!(e=N_.transform.baseVal.consolidate()))?L0:(e=e.matrix,_C(e.a,e.b,e.c,e.d,e.e,e.f))}function gC(e,n,t,s){function i(f){return f.length?f.pop()+" ":""}function l(f,m,_,p,y,v){if(f!==_||m!==p){var T=y.push("translate(",null,n,null,t);v.push({i:T-4,x:ic(f,_)},{i:T-2,x:ic(m,p)})}else(_||p)&&y.push("translate("+_+n+p+t)}function c(f,m,_,p){f!==m?(f-m>180?m+=360:m-f>180&&(f+=360),p.push({i:_.push(i(_)+"rotate(",null,s)-2,x:ic(f,m)})):m&&_.push(i(_)+"rotate("+m+s)}function u(f,m,_,p){f!==m?p.push({i:_.push(i(_)+"skewX(",null,s)-2,x:ic(f,m)}):m&&_.push(i(_)+"skewX("+m+s)}function d(f,m,_,p,y,v){if(f!==_||m!==p){var T=y.push(i(y)+"scale(",null,",",null,")");v.push({i:T-4,x:ic(f,_)},{i:T-2,x:ic(m,p)})}else(_!==1||p!==1)&&y.push(i(y)+"scale("+_+","+p+")")}return function(f,m){var _=[],p=[];return f=e(f),m=e(m),l(f.translateX,f.translateY,m.translateX,m.translateY,_,p),c(f.rotate,m.rotate,_,p),u(f.skewX,m.skewX,_,p),d(f.scaleX,f.scaleY,m.scaleX,m.scaleY,_,p),f=m=null,function(y){for(var v=-1,T=p.length,k;++v<T;)_[(k=p[v]).i]=k.x(y);return _.join("")}}}var yI=gC(_I,"px, ","px)","deg)"),vI=gC(gI,", ",")",")"),bI=1e-12;function gx(e){return((e=Math.exp(e))+1/e)/2}function wI(e){return((e=Math.exp(e))-1/e)/2}function MI(e){return((e=Math.exp(2*e))-1)/(e+1)}const xI=(function e(n,t,s){function i(l,c){var u=l[0],d=l[1],f=l[2],m=c[0],_=c[1],p=c[2],y=m-u,v=_-d,T=y*y+v*v,k,b;if(T<bI)b=Math.log(p/f)/n,k=function(A){return[u+A*y,d+A*v,f*Math.exp(n*A*b)]};else{var S=Math.sqrt(T),$=(p*p-f*f+s*T)/(2*f*t*S),w=(p*p-f*f-s*T)/(2*p*t*S),C=Math.log(Math.sqrt($*$+1)-$),P=Math.log(Math.sqrt(w*w+1)-w);b=(P-C)/n,k=function(A){var I=A*b,W=gx(C),G=f/(t*S)*(W*MI(n*I+C)-wI(C));return[u+G*y,d+G*v,f*W/gx(n*I+C)]}}return k.duration=b*1e3*n/Math.SQRT2,k}return i.rho=function(l){var c=Math.max(.001,+l),u=c*c,d=u*u;return e(c,u,d)},i})(Math.SQRT2,2,4);var xf=0,om=0,em=0,yC=1e3,dg,lm,fg=0,Au=0,yg=0,bm=typeof performance=="object"&&performance.now?performance:Date,vC=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Av(){return Au||(vC(TI),Au=bm.now()+yg)}function TI(){Au=0}function hg(){this._call=this._time=this._next=null}hg.prototype=Pv.prototype={constructor:hg,restart:function(e,n,t){if(typeof e!="function")throw new TypeError("callback is not a function");t=(t==null?Av():+t)+(n==null?0:+n),!this._next&&lm!==this&&(lm?lm._next=this:dg=this,lm=this),this._call=e,this._time=t,F0()},stop:function(){this._call&&(this._call=null,this._time=1/0,F0())}};function Pv(e,n,t){var s=new hg;return s.restart(e,n,t),s}function EI(){Av(),++xf;for(var e=dg,n;e;)(n=Au-e._time)>=0&&e._call.call(void 0,n),e=e._next;--xf}function yx(){Au=(fg=bm.now())+yg,xf=om=0;try{EI()}finally{xf=0,CI(),Au=0}}function SI(){var e=bm.now(),n=e-fg;n>yC&&(yg-=n,fg=e)}function CI(){for(var e,n=dg,t,s=1/0;n;)n._call?(s>n._time&&(s=n._time),e=n,n=n._next):(t=n._next,n._next=null,n=e?e._next=t:dg=t);lm=e,F0(s)}function F0(e){if(!xf){om&&(om=clearTimeout(om));var n=e-Au;n>24?(e<1/0&&(om=setTimeout(yx,e-bm.now()-yg)),em&&(em=clearInterval(em))):(em||(fg=bm.now(),em=setInterval(SI,yC)),xf=1,vC(yx))}}function vx(e,n,t){var s=new hg;return n=n==null?0:+n,s.restart(i=>{s.stop(),e(i+n)},n,t),s}var AI=Em("start","end","cancel","interrupt"),PI=[],bC=0,bx=1,N0=2,Q_=3,wx=4,j0=5,X_=6;function vg(e,n,t,s,i,l){var c=e.__transition;if(!c)e.__transition={};else if(t in c)return;kI(e,t,{name:n,index:s,group:i,on:AI,tween:PI,time:l.time,delay:l.delay,duration:l.duration,ease:l.ease,timer:null,state:bC})}function kv(e,n){var t=bi(e,n);if(t.state>bC)throw new Error("too late; already scheduled");return t}function no(e,n){var t=bi(e,n);if(t.state>Q_)throw new Error("too late; already running");return t}function bi(e,n){var t=e.__transition;if(!t||!(t=t[n]))throw new Error("transition not found");return t}function kI(e,n,t){var s=e.__transition,i;s[n]=t,t.timer=Pv(l,0,t.time);function l(f){t.state=bx,t.timer.restart(c,t.delay,t.time),t.delay<=f&&c(f-t.delay)}function c(f){var m,_,p,y;if(t.state!==bx)return d();for(m in s)if(y=s[m],y.name===t.name){if(y.state===Q_)return vx(c);y.state===wx?(y.state=X_,y.timer.stop(),y.on.call("interrupt",e,e.__data__,y.index,y.group),delete s[m]):+m<n&&(y.state=X_,y.timer.stop(),y.on.call("cancel",e,e.__data__,y.index,y.group),delete s[m])}if(vx(function(){t.state===Q_&&(t.state=wx,t.timer.restart(u,t.delay,t.time),u(f))}),t.state=N0,t.on.call("start",e,e.__data__,t.index,t.group),t.state===N0){for(t.state=Q_,i=new Array(p=t.tween.length),m=0,_=-1;m<p;++m)(y=t.tween[m].value.call(e,e.__data__,t.index,t.group))&&(i[++_]=y);i.length=_+1}}function u(f){for(var m=f<t.duration?t.ease.call(null,f/t.duration):(t.timer.restart(d),t.state=j0,1),_=-1,p=i.length;++_<p;)i[_].call(e,m);t.state===j0&&(t.on.call("end",e,e.__data__,t.index,t.group),d())}function d(){t.state=X_,t.timer.stop(),delete s[n];for(var f in s)return;delete e.__transition}}function Y_(e,n){var t=e.__transition,s,i,l=!0,c;if(t){n=n==null?null:n+"";for(c in t){if((s=t[c]).name!==n){l=!1;continue}i=s.state>N0&&s.state<j0,s.state=X_,s.timer.stop(),s.on.call(i?"interrupt":"cancel",e,e.__data__,s.index,s.group),delete t[c]}l&&delete e.__transition}}function $I(e){return this.each(function(){Y_(this,e)})}function DI(e,n){var t,s;return function(){var i=no(this,e),l=i.tween;if(l!==t){s=t=l;for(var c=0,u=s.length;c<u;++c)if(s[c].name===n){s=s.slice(),s.splice(c,1);break}}i.tween=s}}function OI(e,n,t){var s,i;if(typeof t!="function")throw new Error;return function(){var l=no(this,e),c=l.tween;if(c!==s){i=(s=c).slice();for(var u={name:n,value:t},d=0,f=i.length;d<f;++d)if(i[d].name===n){i[d]=u;break}d===f&&i.push(u)}l.tween=i}}function II(e,n){var t=this._id;if(e+="",arguments.length<2){for(var s=bi(this.node(),t).tween,i=0,l=s.length,c;i<l;++i)if((c=s[i]).name===e)return c.value;return null}return this.each((n==null?DI:OI)(t,e,n))}function $v(e,n,t){var s=e._id;return e.each(function(){var i=no(this,s);(i.value||(i.value={}))[n]=t.apply(this,arguments)}),function(i){return bi(i,s).value[n]}}function wC(e,n){var t;return(typeof n=="number"?ic:n instanceof vm?mx:(t=vm(n))?(n=t,mx):mI)(e,n)}function zI(e){return function(){this.removeAttribute(e)}}function LI(e){return function(){this.removeAttributeNS(e.space,e.local)}}function FI(e,n,t){var s,i=t+"",l;return function(){var c=this.getAttribute(e);return c===i?null:c===s?l:l=n(s=c,t)}}function NI(e,n,t){var s,i=t+"",l;return function(){var c=this.getAttributeNS(e.space,e.local);return c===i?null:c===s?l:l=n(s=c,t)}}function jI(e,n,t){var s,i,l;return function(){var c,u=t(this),d;return u==null?void this.removeAttribute(e):(c=this.getAttribute(e),d=u+"",c===d?null:c===s&&d===i?l:(i=d,l=n(s=c,u)))}}function RI(e,n,t){var s,i,l;return function(){var c,u=t(this),d;return u==null?void this.removeAttributeNS(e.space,e.local):(c=this.getAttributeNS(e.space,e.local),d=u+"",c===d?null:c===s&&d===i?l:(i=d,l=n(s=c,u)))}}function BI(e,n){var t=gg(e),s=t==="transform"?vI:wC;return this.attrTween(e,typeof n=="function"?(t.local?RI:jI)(t,s,$v(this,"attr."+e,n)):n==null?(t.local?LI:zI)(t):(t.local?NI:FI)(t,s,n))}function UI(e,n){return function(t){this.setAttribute(e,n.call(this,t))}}function VI(e,n){return function(t){this.setAttributeNS(e.space,e.local,n.call(this,t))}}function GI(e,n){var t,s;function i(){var l=n.apply(this,arguments);return l!==s&&(t=(s=l)&&VI(e,l)),t}return i._value=n,i}function WI(e,n){var t,s;function i(){var l=n.apply(this,arguments);return l!==s&&(t=(s=l)&&UI(e,l)),t}return i._value=n,i}function HI(e,n){var t="attr."+e;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(n==null)return this.tween(t,null);if(typeof n!="function")throw new Error;var s=gg(e);return this.tween(t,(s.local?GI:WI)(s,n))}function qI(e,n){return function(){kv(this,e).delay=+n.apply(this,arguments)}}function KI(e,n){return n=+n,function(){kv(this,e).delay=n}}function QI(e){var n=this._id;return arguments.length?this.each((typeof e=="function"?qI:KI)(n,e)):bi(this.node(),n).delay}function XI(e,n){return function(){no(this,e).duration=+n.apply(this,arguments)}}function YI(e,n){return n=+n,function(){no(this,e).duration=n}}function ZI(e){var n=this._id;return arguments.length?this.each((typeof e=="function"?XI:YI)(n,e)):bi(this.node(),n).duration}function JI(e,n){if(typeof n!="function")throw new Error;return function(){no(this,e).ease=n}}function ez(e){var n=this._id;return arguments.length?this.each(JI(n,e)):bi(this.node(),n).ease}function tz(e,n){return function(){var t=n.apply(this,arguments);if(typeof t!="function")throw new Error;no(this,e).ease=t}}function nz(e){if(typeof e!="function")throw new Error;return this.each(tz(this._id,e))}function az(e){typeof e!="function"&&(e=eC(e));for(var n=this._groups,t=n.length,s=new Array(t),i=0;i<t;++i)for(var l=n[i],c=l.length,u=s[i]=[],d,f=0;f<c;++f)(d=l[f])&&e.call(d,d.__data__,f,l)&&u.push(d);return new Xo(s,this._parents,this._name,this._id)}function sz(e){if(e._id!==this._id)throw new Error;for(var n=this._groups,t=e._groups,s=n.length,i=t.length,l=Math.min(s,i),c=new Array(s),u=0;u<l;++u)for(var d=n[u],f=t[u],m=d.length,_=c[u]=new Array(m),p,y=0;y<m;++y)(p=d[y]||f[y])&&(_[y]=p);for(;u<s;++u)c[u]=n[u];return new Xo(c,this._parents,this._name,this._id)}function rz(e){return(e+"").trim().split(/^|\s+/).every(function(n){var t=n.indexOf(".");return t>=0&&(n=n.slice(0,t)),!n||n==="start"})}function iz(e,n,t){var s,i,l=rz(n)?kv:no;return function(){var c=l(this,e),u=c.on;u!==s&&(i=(s=u).copy()).on(n,t),c.on=i}}function oz(e,n){var t=this._id;return arguments.length<2?bi(this.node(),t).on.on(e):this.each(iz(t,e,n))}function lz(e){return function(){var n=this.parentNode;for(var t in this.__transition)if(+t!==e)return;n&&n.removeChild(this)}}function cz(){return this.on("end.remove",lz(this._id))}function uz(e){var n=this._name,t=this._id;typeof e!="function"&&(e=Ev(e));for(var s=this._groups,i=s.length,l=new Array(i),c=0;c<i;++c)for(var u=s[c],d=u.length,f=l[c]=new Array(d),m,_,p=0;p<d;++p)(m=u[p])&&(_=e.call(m,m.__data__,p,u))&&("__data__"in m&&(_.__data__=m.__data__),f[p]=_,vg(f[p],n,t,p,f,bi(m,t)));return new Xo(l,this._parents,n,t)}function dz(e){var n=this._name,t=this._id;typeof e!="function"&&(e=JS(e));for(var s=this._groups,i=s.length,l=[],c=[],u=0;u<i;++u)for(var d=s[u],f=d.length,m,_=0;_<f;++_)if(m=d[_]){for(var p=e.call(m,m.__data__,_,d),y,v=bi(m,t),T=0,k=p.length;T<k;++T)(y=p[T])&&vg(y,n,t,T,p,v);l.push(p),c.push(m)}return new Xo(l,c,n,t)}var fz=Sm.prototype.constructor;function hz(){return new fz(this._groups,this._parents)}function pz(e,n){var t,s,i;return function(){var l=Mf(this,e),c=(this.style.removeProperty(e),Mf(this,e));return l===c?null:l===t&&c===s?i:i=n(t=l,s=c)}}function MC(e){return function(){this.style.removeProperty(e)}}function mz(e,n,t){var s,i=t+"",l;return function(){var c=Mf(this,e);return c===i?null:c===s?l:l=n(s=c,t)}}function _z(e,n,t){var s,i,l;return function(){var c=Mf(this,e),u=t(this),d=u+"";return u==null&&(d=u=(this.style.removeProperty(e),Mf(this,e))),c===d?null:c===s&&d===i?l:(i=d,l=n(s=c,u))}}function gz(e,n){var t,s,i,l="style."+n,c="end."+l,u;return function(){var d=no(this,e),f=d.on,m=d.value[l]==null?u||(u=MC(n)):void 0;(f!==t||i!==m)&&(s=(t=f).copy()).on(c,i=m),d.on=s}}function yz(e,n,t){var s=(e+="")=="transform"?yI:wC;return n==null?this.styleTween(e,pz(e,s)).on("end.style."+e,MC(e)):typeof n=="function"?this.styleTween(e,_z(e,s,$v(this,"style."+e,n))).each(gz(this._id,e)):this.styleTween(e,mz(e,s,n),t).on("end.style."+e,null)}function vz(e,n,t){return function(s){this.style.setProperty(e,n.call(this,s),t)}}function bz(e,n,t){var s,i;function l(){var c=n.apply(this,arguments);return c!==i&&(s=(i=c)&&vz(e,c,t)),s}return l._value=n,l}function wz(e,n,t){var s="style."+(e+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(n==null)return this.tween(s,null);if(typeof n!="function")throw new Error;return this.tween(s,bz(e,n,t??""))}function Mz(e){return function(){this.textContent=e}}function xz(e){return function(){var n=e(this);this.textContent=n??""}}function Tz(e){return this.tween("text",typeof e=="function"?xz($v(this,"text",e)):Mz(e==null?"":e+""))}function Ez(e){return function(n){this.textContent=e.call(this,n)}}function Sz(e){var n,t;function s(){var i=e.apply(this,arguments);return i!==t&&(n=(t=i)&&Ez(i)),n}return s._value=e,s}function Cz(e){var n="text";if(arguments.length<1)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Sz(e))}function Az(){for(var e=this._name,n=this._id,t=xC(),s=this._groups,i=s.length,l=0;l<i;++l)for(var c=s[l],u=c.length,d,f=0;f<u;++f)if(d=c[f]){var m=bi(d,n);vg(d,e,t,f,c,{time:m.time+m.delay+m.duration,delay:0,duration:m.duration,ease:m.ease})}return new Xo(s,this._parents,e,t)}function Pz(){var e,n,t=this,s=t._id,i=t.size();return new Promise(function(l,c){var u={value:c},d={value:function(){--i===0&&l()}};t.each(function(){var f=no(this,s),m=f.on;m!==e&&(n=(e=m).copy(),n._.cancel.push(u),n._.interrupt.push(u),n._.end.push(d)),f.on=n}),i===0&&l()})}var kz=0;function Xo(e,n,t,s){this._groups=e,this._parents=n,this._name=t,this._id=s}function xC(){return++kz}var Wo=Sm.prototype;Xo.prototype={constructor:Xo,select:uz,selectAll:dz,selectChild:Wo.selectChild,selectChildren:Wo.selectChildren,filter:az,merge:sz,selection:hz,transition:Az,call:Wo.call,nodes:Wo.nodes,node:Wo.node,size:Wo.size,empty:Wo.empty,each:Wo.each,on:oz,attr:BI,attrTween:HI,style:yz,styleTween:wz,text:Tz,textTween:Cz,remove:cz,tween:II,delay:QI,duration:ZI,ease:ez,easeVarying:nz,end:Pz,[Symbol.iterator]:Wo[Symbol.iterator]};function $z(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var Dz={time:null,delay:0,duration:250,ease:$z};function Oz(e,n){for(var t;!(t=e.__transition)||!(t=t[n]);)if(!(e=e.parentNode))throw new Error(`transition ${n} not found`);return t}function Iz(e){var n,t;e instanceof Xo?(n=e._id,e=e._name):(n=xC(),(t=Dz).time=Av(),e=e==null?null:e+"");for(var s=this._groups,i=s.length,l=0;l<i;++l)for(var c=s[l],u=c.length,d,f=0;f<u;++f)(d=c[f])&&vg(d,e,n,f,c,t||Oz(d,n));return new Xo(s,this._parents,e,n)}Sm.prototype.interrupt=$I;Sm.prototype.transition=Iz;function zz(e,n){var t,s=1;e==null&&(e=0),n==null&&(n=0);function i(){var l,c=t.length,u,d=0,f=0;for(l=0;l<c;++l)u=t[l],d+=u.x,f+=u.y;for(d=(d/c-e)*s,f=(f/c-n)*s,l=0;l<c;++l)u=t[l],u.x-=d,u.y-=f}return i.initialize=function(l){t=l},i.x=function(l){return arguments.length?(e=+l,i):e},i.y=function(l){return arguments.length?(n=+l,i):n},i.strength=function(l){return arguments.length?(s=+l,i):s},i}function Lz(e){const n=+this._x.call(null,e),t=+this._y.call(null,e);return TC(this.cover(n,t),n,t,e)}function TC(e,n,t,s){if(isNaN(n)||isNaN(t))return e;var i,l=e._root,c={data:s},u=e._x0,d=e._y0,f=e._x1,m=e._y1,_,p,y,v,T,k,b,S;if(!l)return e._root=c,e;for(;l.length;)if((T=n>=(_=(u+f)/2))?u=_:f=_,(k=t>=(p=(d+m)/2))?d=p:m=p,i=l,!(l=l[b=k<<1|T]))return i[b]=c,e;if(y=+e._x.call(null,l.data),v=+e._y.call(null,l.data),n===y&&t===v)return c.next=l,i?i[b]=c:e._root=c,e;do i=i?i[b]=new Array(4):e._root=new Array(4),(T=n>=(_=(u+f)/2))?u=_:f=_,(k=t>=(p=(d+m)/2))?d=p:m=p;while((b=k<<1|T)===(S=(v>=p)<<1|y>=_));return i[S]=l,i[b]=c,e}function Fz(e){var n,t,s=e.length,i,l,c=new Array(s),u=new Array(s),d=1/0,f=1/0,m=-1/0,_=-1/0;for(t=0;t<s;++t)isNaN(i=+this._x.call(null,n=e[t]))||isNaN(l=+this._y.call(null,n))||(c[t]=i,u[t]=l,i<d&&(d=i),i>m&&(m=i),l<f&&(f=l),l>_&&(_=l));if(d>m||f>_)return this;for(this.cover(d,f).cover(m,_),t=0;t<s;++t)TC(this,c[t],u[t],e[t]);return this}function Nz(e,n){if(isNaN(e=+e)||isNaN(n=+n))return this;var t=this._x0,s=this._y0,i=this._x1,l=this._y1;if(isNaN(t))i=(t=Math.floor(e))+1,l=(s=Math.floor(n))+1;else{for(var c=i-t||1,u=this._root,d,f;t>e||e>=i||s>n||n>=l;)switch(f=(n<s)<<1|e<t,d=new Array(4),d[f]=u,u=d,c*=2,f){case 0:i=t+c,l=s+c;break;case 1:t=i-c,l=s+c;break;case 2:i=t+c,s=l-c;break;case 3:t=i-c,s=l-c;break}this._root&&this._root.length&&(this._root=u)}return this._x0=t,this._y0=s,this._x1=i,this._y1=l,this}function jz(){var e=[];return this.visit(function(n){if(!n.length)do e.push(n.data);while(n=n.next)}),e}function Rz(e){return arguments.length?this.cover(+e[0][0],+e[0][1]).cover(+e[1][0],+e[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function js(e,n,t,s,i){this.node=e,this.x0=n,this.y0=t,this.x1=s,this.y1=i}function Bz(e,n,t){var s,i=this._x0,l=this._y0,c,u,d,f,m=this._x1,_=this._y1,p=[],y=this._root,v,T;for(y&&p.push(new js(y,i,l,m,_)),t==null?t=1/0:(i=e-t,l=n-t,m=e+t,_=n+t,t*=t);v=p.pop();)if(!(!(y=v.node)||(c=v.x0)>m||(u=v.y0)>_||(d=v.x1)<i||(f=v.y1)<l))if(y.length){var k=(c+d)/2,b=(u+f)/2;p.push(new js(y[3],k,b,d,f),new js(y[2],c,b,k,f),new js(y[1],k,u,d,b),new js(y[0],c,u,k,b)),(T=(n>=b)<<1|e>=k)&&(v=p[p.length-1],p[p.length-1]=p[p.length-1-T],p[p.length-1-T]=v)}else{var S=e-+this._x.call(null,y.data),$=n-+this._y.call(null,y.data),w=S*S+$*$;if(w<t){var C=Math.sqrt(t=w);i=e-C,l=n-C,m=e+C,_=n+C,s=y.data}}return s}function Uz(e){if(isNaN(m=+this._x.call(null,e))||isNaN(_=+this._y.call(null,e)))return this;var n,t=this._root,s,i,l,c=this._x0,u=this._y0,d=this._x1,f=this._y1,m,_,p,y,v,T,k,b;if(!t)return this;if(t.length)for(;;){if((v=m>=(p=(c+d)/2))?c=p:d=p,(T=_>=(y=(u+f)/2))?u=y:f=y,n=t,!(t=t[k=T<<1|v]))return this;if(!t.length)break;(n[k+1&3]||n[k+2&3]||n[k+3&3])&&(s=n,b=k)}for(;t.data!==e;)if(i=t,!(t=t.next))return this;return(l=t.next)&&delete t.next,i?(l?i.next=l:delete i.next,this):n?(l?n[k]=l:delete n[k],(t=n[0]||n[1]||n[2]||n[3])&&t===(n[3]||n[2]||n[1]||n[0])&&!t.length&&(s?s[b]=t:this._root=t),this):(this._root=l,this)}function Vz(e){for(var n=0,t=e.length;n<t;++n)this.remove(e[n]);return this}function Gz(){return this._root}function Wz(){var e=0;return this.visit(function(n){if(!n.length)do++e;while(n=n.next)}),e}function Hz(e){var n=[],t,s=this._root,i,l,c,u,d;for(s&&n.push(new js(s,this._x0,this._y0,this._x1,this._y1));t=n.pop();)if(!e(s=t.node,l=t.x0,c=t.y0,u=t.x1,d=t.y1)&&s.length){var f=(l+u)/2,m=(c+d)/2;(i=s[3])&&n.push(new js(i,f,m,u,d)),(i=s[2])&&n.push(new js(i,l,m,f,d)),(i=s[1])&&n.push(new js(i,f,c,u,m)),(i=s[0])&&n.push(new js(i,l,c,f,m))}return this}function qz(e){var n=[],t=[],s;for(this._root&&n.push(new js(this._root,this._x0,this._y0,this._x1,this._y1));s=n.pop();){var i=s.node;if(i.length){var l,c=s.x0,u=s.y0,d=s.x1,f=s.y1,m=(c+d)/2,_=(u+f)/2;(l=i[0])&&n.push(new js(l,c,u,m,_)),(l=i[1])&&n.push(new js(l,m,u,d,_)),(l=i[2])&&n.push(new js(l,c,_,m,f)),(l=i[3])&&n.push(new js(l,m,_,d,f))}t.push(s)}for(;s=t.pop();)e(s.node,s.x0,s.y0,s.x1,s.y1);return this}function Kz(e){return e[0]}function Qz(e){return arguments.length?(this._x=e,this):this._x}function Xz(e){return e[1]}function Yz(e){return arguments.length?(this._y=e,this):this._y}function Dv(e,n,t){var s=new Ov(n??Kz,t??Xz,NaN,NaN,NaN,NaN);return e==null?s:s.addAll(e)}function Ov(e,n,t,s,i,l){this._x=e,this._y=n,this._x0=t,this._y0=s,this._x1=i,this._y1=l,this._root=void 0}function Mx(e){for(var n={data:e.data},t=n;e=e.next;)t=t.next={data:e.data};return n}var Rs=Dv.prototype=Ov.prototype;Rs.copy=function(){var e=new Ov(this._x,this._y,this._x0,this._y0,this._x1,this._y1),n=this._root,t,s;if(!n)return e;if(!n.length)return e._root=Mx(n),e;for(t=[{source:n,target:e._root=new Array(4)}];n=t.pop();)for(var i=0;i<4;++i)(s=n.source[i])&&(s.length?t.push({source:s,target:n.target[i]=new Array(4)}):n.target[i]=Mx(s));return e};Rs.add=Lz;Rs.addAll=Fz;Rs.cover=Nz;Rs.data=jz;Rs.extent=Rz;Rs.find=Bz;Rs.remove=Uz;Rs.removeAll=Vz;Rs.root=Gz;Rs.size=Wz;Rs.visit=Hz;Rs.visitAfter=qz;Rs.x=Qz;Rs.y=Yz;function xu(e){return function(){return e}}function lc(e){return(e()-.5)*1e-6}function Zz(e){return e.x+e.vx}function Jz(e){return e.y+e.vy}function eL(e){var n,t,s,i=1,l=1;typeof e!="function"&&(e=xu(e==null?1:+e));function c(){for(var f,m=n.length,_,p,y,v,T,k,b=0;b<l;++b)for(_=Dv(n,Zz,Jz).visitAfter(u),f=0;f<m;++f)p=n[f],T=t[p.index],k=T*T,y=p.x+p.vx,v=p.y+p.vy,_.visit(S);function S($,w,C,P,A){var I=$.data,W=$.r,G=T+W;if(I){if(I.index>p.index){var q=y-I.x-I.vx,Z=v-I.y-I.vy,X=q*q+Z*Z;X<G*G&&(q===0&&(q=lc(s),X+=q*q),Z===0&&(Z=lc(s),X+=Z*Z),X=(G-(X=Math.sqrt(X)))/X*i,p.vx+=(q*=X)*(G=(W*=W)/(k+W)),p.vy+=(Z*=X)*G,I.vx-=q*(G=1-G),I.vy-=Z*G)}return}return w>y+G||P<y-G||C>v+G||A<v-G}}function u(f){if(f.data)return f.r=t[f.data.index];for(var m=f.r=0;m<4;++m)f[m]&&f[m].r>f.r&&(f.r=f[m].r)}function d(){if(n){var f,m=n.length,_;for(t=new Array(m),f=0;f<m;++f)_=n[f],t[_.index]=+e(_,f,n)}}return c.initialize=function(f,m){n=f,s=m,d()},c.iterations=function(f){return arguments.length?(l=+f,c):l},c.strength=function(f){return arguments.length?(i=+f,c):i},c.radius=function(f){return arguments.length?(e=typeof f=="function"?f:xu(+f),d(),c):e},c}function tL(e){return e.index}function xx(e,n){var t=e.get(n);if(!t)throw new Error("node not found: "+n);return t}function nL(e){var n=tL,t=_,s,i=xu(30),l,c,u,d,f,m=1;e==null&&(e=[]);function _(k){return 1/Math.min(u[k.source.index],u[k.target.index])}function p(k){for(var b=0,S=e.length;b<m;++b)for(var $=0,w,C,P,A,I,W,G;$<S;++$)w=e[$],C=w.source,P=w.target,A=P.x+P.vx-C.x-C.vx||lc(f),I=P.y+P.vy-C.y-C.vy||lc(f),W=Math.sqrt(A*A+I*I),W=(W-l[$])/W*k*s[$],A*=W,I*=W,P.vx-=A*(G=d[$]),P.vy-=I*G,C.vx+=A*(G=1-G),C.vy+=I*G}function y(){if(c){var k,b=c.length,S=e.length,$=new Map(c.map((C,P)=>[n(C,P,c),C])),w;for(k=0,u=new Array(b);k<S;++k)w=e[k],w.index=k,typeof w.source!="object"&&(w.source=xx($,w.source)),typeof w.target!="object"&&(w.target=xx($,w.target)),u[w.source.index]=(u[w.source.index]||0)+1,u[w.target.index]=(u[w.target.index]||0)+1;for(k=0,d=new Array(S);k<S;++k)w=e[k],d[k]=u[w.source.index]/(u[w.source.index]+u[w.target.index]);s=new Array(S),v(),l=new Array(S),T()}}function v(){if(c)for(var k=0,b=e.length;k<b;++k)s[k]=+t(e[k],k,e)}function T(){if(c)for(var k=0,b=e.length;k<b;++k)l[k]=+i(e[k],k,e)}return p.initialize=function(k,b){c=k,f=b,y()},p.links=function(k){return arguments.length?(e=k,y(),p):e},p.id=function(k){return arguments.length?(n=k,p):n},p.iterations=function(k){return arguments.length?(m=+k,p):m},p.strength=function(k){return arguments.length?(t=typeof k=="function"?k:xu(+k),v(),p):t},p.distance=function(k){return arguments.length?(i=typeof k=="function"?k:xu(+k),T(),p):i},p}const aL=1664525,sL=1013904223,Tx=4294967296;function rL(){let e=1;return()=>(e=(aL*e+sL)%Tx)/Tx}function iL(e){return e.x}function oL(e){return e.y}var lL=10,cL=Math.PI*(3-Math.sqrt(5));function uL(e){var n,t=1,s=.001,i=1-Math.pow(s,1/300),l=0,c=.6,u=new Map,d=Pv(_),f=Em("tick","end"),m=rL();e==null&&(e=[]);function _(){p(),f.call("tick",n),t<s&&(d.stop(),f.call("end",n))}function p(T){var k,b=e.length,S;T===void 0&&(T=1);for(var $=0;$<T;++$)for(t+=(l-t)*i,u.forEach(function(w){w(t)}),k=0;k<b;++k)S=e[k],S.fx==null?S.x+=S.vx*=c:(S.x=S.fx,S.vx=0),S.fy==null?S.y+=S.vy*=c:(S.y=S.fy,S.vy=0);return n}function y(){for(var T=0,k=e.length,b;T<k;++T){if(b=e[T],b.index=T,b.fx!=null&&(b.x=b.fx),b.fy!=null&&(b.y=b.fy),isNaN(b.x)||isNaN(b.y)){var S=lL*Math.sqrt(.5+T),$=T*cL;b.x=S*Math.cos($),b.y=S*Math.sin($)}(isNaN(b.vx)||isNaN(b.vy))&&(b.vx=b.vy=0)}}function v(T){return T.initialize&&T.initialize(e,m),T}return y(),n={tick:p,restart:function(){return d.restart(_),n},stop:function(){return d.stop(),n},nodes:function(T){return arguments.length?(e=T,y(),u.forEach(v),n):e},alpha:function(T){return arguments.length?(t=+T,n):t},alphaMin:function(T){return arguments.length?(s=+T,n):s},alphaDecay:function(T){return arguments.length?(i=+T,n):+i},alphaTarget:function(T){return arguments.length?(l=+T,n):l},velocityDecay:function(T){return arguments.length?(c=1-T,n):1-c},randomSource:function(T){return arguments.length?(m=T,u.forEach(v),n):m},force:function(T,k){return arguments.length>1?(k==null?u.delete(T):u.set(T,v(k)),n):u.get(T)},find:function(T,k,b){var S=0,$=e.length,w,C,P,A,I;for(b==null?b=1/0:b*=b,S=0;S<$;++S)A=e[S],w=T-A.x,C=k-A.y,P=w*w+C*C,P<b&&(I=A,b=P);return I},on:function(T,k){return arguments.length>1?(f.on(T,k),n):f.on(T)}}}function dL(){var e,n,t,s,i=xu(-30),l,c=1,u=1/0,d=.81;function f(y){var v,T=e.length,k=Dv(e,iL,oL).visitAfter(_);for(s=y,v=0;v<T;++v)n=e[v],k.visit(p)}function m(){if(e){var y,v=e.length,T;for(l=new Array(v),y=0;y<v;++y)T=e[y],l[T.index]=+i(T,y,e)}}function _(y){var v=0,T,k,b=0,S,$,w;if(y.length){for(S=$=w=0;w<4;++w)(T=y[w])&&(k=Math.abs(T.value))&&(v+=T.value,b+=k,S+=k*T.x,$+=k*T.y);y.x=S/b,y.y=$/b}else{T=y,T.x=T.data.x,T.y=T.data.y;do v+=l[T.data.index];while(T=T.next)}y.value=v}function p(y,v,T,k){if(!y.value)return!0;var b=y.x-n.x,S=y.y-n.y,$=k-v,w=b*b+S*S;if($*$/d<w)return w<u&&(b===0&&(b=lc(t),w+=b*b),S===0&&(S=lc(t),w+=S*S),w<c&&(w=Math.sqrt(c*w)),n.vx+=b*y.value*s/w,n.vy+=S*y.value*s/w),!0;if(y.length||w>=u)return;(y.data!==n||y.next)&&(b===0&&(b=lc(t),w+=b*b),S===0&&(S=lc(t),w+=S*S),w<c&&(w=Math.sqrt(c*w)));do y.data!==n&&($=l[y.data.index]*s/w,n.vx+=b*$,n.vy+=S*$);while(y=y.next)}return f.initialize=function(y,v){e=y,t=v,m()},f.strength=function(y){return arguments.length?(i=typeof y=="function"?y:xu(+y),m(),f):i},f.distanceMin=function(y){return arguments.length?(c=y*y,f):Math.sqrt(c)},f.distanceMax=function(y){return arguments.length?(u=y*y,f):Math.sqrt(u)},f.theta=function(y){return arguments.length?(d=y*y,f):Math.sqrt(d)},f}const j_=e=>()=>e;function fL(e,{sourceEvent:n,target:t,transform:s,dispatch:i}){Object.defineProperties(this,{type:{value:e,enumerable:!0,configurable:!0},sourceEvent:{value:n,enumerable:!0,configurable:!0},target:{value:t,enumerable:!0,configurable:!0},transform:{value:s,enumerable:!0,configurable:!0},_:{value:i}})}function Ko(e,n,t){this.k=e,this.x=n,this.y=t}Ko.prototype={constructor:Ko,scale:function(e){return e===1?this:new Ko(this.k*e,this.x,this.y)},translate:function(e,n){return e===0&n===0?this:new Ko(this.k,this.x+this.k*e,this.y+this.k*n)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var Iv=new Ko(1,0,0);Ko.prototype;function r0(e){e.stopImmediatePropagation()}function tm(e){e.preventDefault(),e.stopImmediatePropagation()}function hL(e){return(!e.ctrlKey||e.type==="wheel")&&!e.button}function pL(){var e=this;return e instanceof SVGElement?(e=e.ownerSVGElement||e,e.hasAttribute("viewBox")?(e=e.viewBox.baseVal,[[e.x,e.y],[e.x+e.width,e.y+e.height]]):[[0,0],[e.width.baseVal.value,e.height.baseVal.value]]):[[0,0],[e.clientWidth,e.clientHeight]]}function Ex(){return this.__zoom||Iv}function mL(e){return-e.deltaY*(e.deltaMode===1?.05:e.deltaMode?1:.002)*(e.ctrlKey?10:1)}function _L(){return navigator.maxTouchPoints||"ontouchstart"in this}function gL(e,n,t){var s=e.invertX(n[0][0])-t[0][0],i=e.invertX(n[1][0])-t[1][0],l=e.invertY(n[0][1])-t[0][1],c=e.invertY(n[1][1])-t[1][1];return e.translate(i>s?(s+i)/2:Math.min(0,s)||Math.max(0,i),c>l?(l+c)/2:Math.min(0,l)||Math.max(0,c))}function yL(){var e=hL,n=pL,t=gL,s=mL,i=_L,l=[0,1/0],c=[[-1/0,-1/0],[1/0,1/0]],u=250,d=xI,f=Em("start","zoom","end"),m,_,p,y=500,v=150,T=0,k=10;function b(Q){Q.property("__zoom",Ex).on("wheel.zoom",I,{passive:!1}).on("mousedown.zoom",W).on("dblclick.zoom",G).filter(i).on("touchstart.zoom",q).on("touchmove.zoom",Z).on("touchend.zoom touchcancel.zoom",X).style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}b.transform=function(Q,te,R,ee){var ie=Q.selection?Q.selection():Q;ie.property("__zoom",Ex),Q!==ie?C(Q,te,R,ee):ie.interrupt().each(function(){P(this,arguments).event(ee).start().zoom(null,typeof te=="function"?te.apply(this,arguments):te).end()})},b.scaleBy=function(Q,te,R,ee){b.scaleTo(Q,function(){var ie=this.__zoom.k,he=typeof te=="function"?te.apply(this,arguments):te;return ie*he},R,ee)},b.scaleTo=function(Q,te,R,ee){b.transform(Q,function(){var ie=n.apply(this,arguments),he=this.__zoom,_e=R==null?w(ie):typeof R=="function"?R.apply(this,arguments):R,U=he.invert(_e),K=typeof te=="function"?te.apply(this,arguments):te;return t($(S(he,K),_e,U),ie,c)},R,ee)},b.translateBy=function(Q,te,R,ee){b.transform(Q,function(){return t(this.__zoom.translate(typeof te=="function"?te.apply(this,arguments):te,typeof R=="function"?R.apply(this,arguments):R),n.apply(this,arguments),c)},null,ee)},b.translateTo=function(Q,te,R,ee,ie){b.transform(Q,function(){var he=n.apply(this,arguments),_e=this.__zoom,U=ee==null?w(he):typeof ee=="function"?ee.apply(this,arguments):ee;return t(Iv.translate(U[0],U[1]).scale(_e.k).translate(typeof te=="function"?-te.apply(this,arguments):-te,typeof R=="function"?-R.apply(this,arguments):-R),he,c)},ee,ie)};function S(Q,te){return te=Math.max(l[0],Math.min(l[1],te)),te===Q.k?Q:new Ko(te,Q.x,Q.y)}function $(Q,te,R){var ee=te[0]-R[0]*Q.k,ie=te[1]-R[1]*Q.k;return ee===Q.x&&ie===Q.y?Q:new Ko(Q.k,ee,ie)}function w(Q){return[(+Q[0][0]+ +Q[1][0])/2,(+Q[0][1]+ +Q[1][1])/2]}function C(Q,te,R,ee){Q.on("start.zoom",function(){P(this,arguments).event(ee).start()}).on("interrupt.zoom end.zoom",function(){P(this,arguments).event(ee).end()}).tween("zoom",function(){var ie=this,he=arguments,_e=P(ie,he).event(ee),U=n.apply(ie,he),K=R==null?w(U):typeof R=="function"?R.apply(ie,he):R,H=Math.max(U[1][0]-U[0][0],U[1][1]-U[0][1]),B=ie.__zoom,ce=typeof te=="function"?te.apply(ie,he):te,ve=d(B.invert(K).concat(H/B.k),ce.invert(K).concat(H/ce.k));return function(Pe){if(Pe===1)Pe=ce;else{var ze=ve(Pe),Ze=H/ze[2];Pe=new Ko(Ze,K[0]-ze[0]*Ze,K[1]-ze[1]*Ze)}_e.zoom(null,Pe)}})}function P(Q,te,R){return!R&&Q.__zooming||new A(Q,te)}function A(Q,te){this.that=Q,this.args=te,this.active=0,this.sourceEvent=null,this.extent=n.apply(Q,te),this.taps=0}A.prototype={event:function(Q){return Q&&(this.sourceEvent=Q),this},start:function(){return++this.active===1&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(Q,te){return this.mouse&&Q!=="mouse"&&(this.mouse[1]=te.invert(this.mouse[0])),this.touch0&&Q!=="touch"&&(this.touch0[1]=te.invert(this.touch0[0])),this.touch1&&Q!=="touch"&&(this.touch1[1]=te.invert(this.touch1[0])),this.that.__zoom=te,this.emit("zoom"),this},end:function(){return--this.active===0&&(delete this.that.__zooming,this.emit("end")),this},emit:function(Q){var te=mi(this.that).datum();f.call(Q,this.that,new fL(Q,{sourceEvent:this.sourceEvent,target:b,transform:this.that.__zoom,dispatch:f}),te)}};function I(Q,...te){if(!e.apply(this,arguments))return;var R=P(this,te).event(Q),ee=this.__zoom,ie=Math.max(l[0],Math.min(l[1],ee.k*Math.pow(2,s.apply(this,arguments)))),he=Ho(Q);if(R.wheel)(R.mouse[0][0]!==he[0]||R.mouse[0][1]!==he[1])&&(R.mouse[1]=ee.invert(R.mouse[0]=he)),clearTimeout(R.wheel);else{if(ee.k===ie)return;R.mouse=[he,ee.invert(he)],Y_(this),R.start()}tm(Q),R.wheel=setTimeout(_e,v),R.zoom("mouse",t($(S(ee,ie),R.mouse[0],R.mouse[1]),R.extent,c));function _e(){R.wheel=null,R.end()}}function W(Q,...te){if(p||!e.apply(this,arguments))return;var R=Q.currentTarget,ee=P(this,te,!0).event(Q),ie=mi(Q.view).on("mousemove.zoom",K,!0).on("mouseup.zoom",H,!0),he=Ho(Q,R),_e=Q.clientX,U=Q.clientY;uC(Q.view),r0(Q),ee.mouse=[he,this.__zoom.invert(he)],Y_(this),ee.start();function K(B){if(tm(B),!ee.moved){var ce=B.clientX-_e,ve=B.clientY-U;ee.moved=ce*ce+ve*ve>T}ee.event(B).zoom("mouse",t($(ee.that.__zoom,ee.mouse[0]=Ho(B,R),ee.mouse[1]),ee.extent,c))}function H(B){ie.on("mousemove.zoom mouseup.zoom",null),dC(B.view,ee.moved),tm(B),ee.event(B).end()}}function G(Q,...te){if(e.apply(this,arguments)){var R=this.__zoom,ee=Ho(Q.changedTouches?Q.changedTouches[0]:Q,this),ie=R.invert(ee),he=R.k*(Q.shiftKey?.5:2),_e=t($(S(R,he),ee,ie),n.apply(this,te),c);tm(Q),u>0?mi(this).transition().duration(u).call(C,_e,ee,Q):mi(this).call(b.transform,_e,ee,Q)}}function q(Q,...te){if(e.apply(this,arguments)){var R=Q.touches,ee=R.length,ie=P(this,te,Q.changedTouches.length===ee).event(Q),he,_e,U,K;for(r0(Q),_e=0;_e<ee;++_e)U=R[_e],K=Ho(U,this),K=[K,this.__zoom.invert(K),U.identifier],ie.touch0?!ie.touch1&&ie.touch0[2]!==K[2]&&(ie.touch1=K,ie.taps=0):(ie.touch0=K,he=!0,ie.taps=1+!!m);m&&(m=clearTimeout(m)),he&&(ie.taps<2&&(_=K[0],m=setTimeout(function(){m=null},y)),Y_(this),ie.start())}}function Z(Q,...te){if(this.__zooming){var R=P(this,te).event(Q),ee=Q.changedTouches,ie=ee.length,he,_e,U,K;for(tm(Q),he=0;he<ie;++he)_e=ee[he],U=Ho(_e,this),R.touch0&&R.touch0[2]===_e.identifier?R.touch0[0]=U:R.touch1&&R.touch1[2]===_e.identifier&&(R.touch1[0]=U);if(_e=R.that.__zoom,R.touch1){var H=R.touch0[0],B=R.touch0[1],ce=R.touch1[0],ve=R.touch1[1],Pe=(Pe=ce[0]-H[0])*Pe+(Pe=ce[1]-H[1])*Pe,ze=(ze=ve[0]-B[0])*ze+(ze=ve[1]-B[1])*ze;_e=S(_e,Math.sqrt(Pe/ze)),U=[(H[0]+ce[0])/2,(H[1]+ce[1])/2],K=[(B[0]+ve[0])/2,(B[1]+ve[1])/2]}else if(R.touch0)U=R.touch0[0],K=R.touch0[1];else return;R.zoom("touch",t($(_e,U,K),R.extent,c))}}function X(Q,...te){if(this.__zooming){var R=P(this,te).event(Q),ee=Q.changedTouches,ie=ee.length,he,_e;for(r0(Q),p&&clearTimeout(p),p=setTimeout(function(){p=null},y),he=0;he<ie;++he)_e=ee[he],R.touch0&&R.touch0[2]===_e.identifier?delete R.touch0:R.touch1&&R.touch1[2]===_e.identifier&&delete R.touch1;if(R.touch1&&!R.touch0&&(R.touch0=R.touch1,delete R.touch1),R.touch0)R.touch0[1]=this.__zoom.invert(R.touch0[0]);else if(R.end(),R.taps===2&&(_e=Ho(_e,this),Math.hypot(_[0]-_e[0],_[1]-_e[1])<k)){var U=mi(this).on("dblclick.zoom");U&&U.apply(this,arguments)}}}return b.wheelDelta=function(Q){return arguments.length?(s=typeof Q=="function"?Q:j_(+Q),b):s},b.filter=function(Q){return arguments.length?(e=typeof Q=="function"?Q:j_(!!Q),b):e},b.touchable=function(Q){return arguments.length?(i=typeof Q=="function"?Q:j_(!!Q),b):i},b.extent=function(Q){return arguments.length?(n=typeof Q=="function"?Q:j_([[+Q[0][0],+Q[0][1]],[+Q[1][0],+Q[1][1]]]),b):n},b.scaleExtent=function(Q){return arguments.length?(l[0]=+Q[0],l[1]=+Q[1],b):[l[0],l[1]]},b.translateExtent=function(Q){return arguments.length?(c[0][0]=+Q[0][0],c[1][0]=+Q[1][0],c[0][1]=+Q[0][1],c[1][1]=+Q[1][1],b):[[c[0][0],c[0][1]],[c[1][0],c[1][1]]]},b.constrain=function(Q){return arguments.length?(t=Q,b):t},b.duration=function(Q){return arguments.length?(u=+Q,b):u},b.interpolate=function(Q){return arguments.length?(d=Q,b):d},b.on=function(){var Q=f.on.apply(f,arguments);return Q===f?b:Q},b.clickDistance=function(Q){return arguments.length?(T=(Q=+Q)*Q,b):Math.sqrt(T)},b.tapDistance=function(Q){return arguments.length?(k=+Q,b):k},b}const nm={website:"#00f0ff",domain:"#a855f7",tracker:"#ff8c42",certificate:"#2ed573",wallet:"#ffd700",contact:"#ff6b81"};function vL(){const e=Me.useRef(null),n=Me.useRef(null),[t,s]=Me.useState(null),[i,l]=Me.useState(null),[c,u]=Me.useState(!0),[d]=Zx(),f=d.get("url"),{t:m}=Jo();Me.useEffect(()=>{u(!0);try{const T=nD(f||"");l(T)}catch{l({nodes:[],edges:[]})}u(!1)},[f]),Me.useEffect(()=>{if(!i||!e.current||!n.current||i.nodes.length===0)return;const T=n.current,k=T.clientWidth,b=T.clientHeight;mi(e.current).selectAll("*").remove();const S=mi(e.current).attr("width",k).attr("height",b).attr("viewBox",[0,0,k,b]),$=S.append("g"),w=yL().scaleExtent([.2,5]).on("zoom",q=>$.attr("transform",q.transform));S.call(w),S.call(w.transform,Iv.translate(k/2,b/2).scale(.8));const C=i.nodes.map(q=>({...q})),P=i.edges.map(q=>({...q})),A=uL(C).force("link",nL(P).id(q=>q.id).distance(120)).force("charge",dL().strength(-300)).force("center",zz(0,0)).force("collision",eL().radius(40)),I=$.append("g").selectAll("line").data(P).join("line").attr("stroke",q=>q.label.includes("clone")?"#ff475760":q.label.includes("NLP")?"#ffa50060":"#ffffff15").attr("stroke-width",q=>q.label.includes("clone")||q.label.includes("NLP")?2:1.5).attr("stroke-dasharray",q=>q.label.includes("clone")?"8,4":q.label.includes("NLP")?"6,3":"none"),W=$.append("g").selectAll("text").data(P).join("text").text(q=>q.label).attr("font-size",9).attr("fill",q=>q.label.includes("clone")?"#ff475788":q.label.includes("NLP")?"#ffa50088":"#ffffff50").attr("text-anchor","middle"),G=$.append("g").selectAll("g").data(C).join("g").call(YO().on("start",(q,Z)=>{q.active||A.alphaTarget(.3).restart(),Z.fx=Z.x,Z.fy=Z.y}).on("drag",(q,Z)=>{Z.fx=q.x,Z.fy=q.y}).on("end",(q,Z)=>{q.active||A.alphaTarget(0),Z.fx=null,Z.fy=null})).on("click",(q,Z)=>{q.stopPropagation(),s(Z)});return G.append("circle").attr("r",q=>q.type==="website"?18:12).attr("fill",q=>`${nm[q.type]||"#888"}20`).attr("stroke",q=>nm[q.type]||"#888").attr("stroke-width",1.5),G.append("circle").attr("r",q=>q.type==="website"?6:4).attr("fill",q=>nm[q.type]||"#888"),G.append("text").text(q=>q.label.length>20?q.label.substring(0,18)+"":q.label).attr("dy",q=>q.type==="website"?32:24).attr("text-anchor","middle").attr("font-size",10).attr("fill","#ffffffcc").attr("font-family","monospace"),A.on("tick",()=>{I.attr("x1",q=>q.source.x).attr("y1",q=>q.source.y).attr("x2",q=>q.target.x).attr("y2",q=>q.target.y),W.attr("x",q=>(q.source.x+q.target.x)/2).attr("y",q=>(q.source.y+q.target.y)/2),G.attr("transform",q=>`translate(${q.x},${q.y})`)}),S.on("click",()=>s(null)),()=>A.stop()},[i]);const _=m("ecosystem.nodeLabels");if(c)return L.jsxs("div",{className:"ecosystem page-container",children:[L.jsx("h1",{className:"page-title",children:m("ecosystem.title")}),L.jsxs("div",{className:"loading-state",children:[L.jsx("div",{className:"loading-spinner"}),L.jsx("p",{children:"Loading..."})]})]});const p=i?.nodes?.filter(T=>T.type==="website").length||0,y=i?.total_nodes||i?.nodes?.length||0,v=i?.total_edges||i?.edges?.length||0;return L.jsxs("div",{className:"ecosystem page-container",children:[L.jsx("div",{className:"eco-header animate-in",children:L.jsxs("div",{children:[L.jsx("h1",{className:"page-title",children:m("ecosystem.title")}),L.jsxs("p",{className:"page-subtitle",children:[m("ecosystem.subtitle"),f&&L.jsxs("span",{style:{color:"var(--accent-cyan)"},children:["  ",f]})]})]})}),L.jsxs("div",{className:"graph-container animate-in animate-in-delay-1",ref:n,children:[L.jsx("svg",{ref:e}),L.jsxs("div",{className:"cluster-summary glass-card",children:[L.jsx("h4",{className:"summary-label",children:m("ecosystem.clusterSummary").toUpperCase()}),L.jsxs("div",{className:"summary-stat",children:[L.jsx("strong",{children:p})," ",m("ecosystem.websites")]}),L.jsxs("div",{className:"summary-stat",children:[L.jsx("strong",{children:y})," ",m("ecosystem.totalNodes")]}),L.jsxs("div",{className:"summary-stat",children:[L.jsx("strong",{children:v})," ",m("ecosystem.connections")]}),i?.cluster_id&&L.jsxs("div",{className:"summary-stat cluster-id",children:[L.jsx("strong",{children:i.cluster_id})," Cluster ID"]})]}),L.jsxs("div",{className:"graph-legend glass-card",children:[L.jsx("h4",{className:"legend-title",children:m("ecosystem.nodeTypes").toUpperCase()}),Object.entries(_).map(([T,k])=>L.jsxs("div",{className:"legend-item",children:[L.jsx("span",{className:"legend-dot",style:{background:nm[T]}}),k]},T))]}),t&&L.jsxs("div",{className:"node-detail glass-card",children:[L.jsxs("div",{className:"detail-header",children:[L.jsxs("div",{className:"detail-type",style:{color:nm[t.type]},children:[L.jsx(rk,{size:14})," ",_[t.type]]}),L.jsx("button",{className:"detail-close",onClick:()=>s(null),children:L.jsx(K0,{size:14})})]}),L.jsx("h3",{className:"detail-label",children:t.label}),t.risk>0&&L.jsxs("div",{className:"detail-risk",children:[m("ecosystem.risk")," ",L.jsx("strong",{style:{color:t.risk>=80?"var(--danger)":t.risk>=50?"var(--warning)":"var(--success)"},children:t.risk})]}),t.metadata?.category&&L.jsxs("div",{className:"detail-meta",children:["Category: ",t.metadata.category]}),t.metadata?.issuer&&L.jsxs("div",{className:"detail-meta",children:["Issuer: ",t.metadata.issuer]})]})]})]})}const bL=[eg,BP,sT,nT,d0,yk],wL=["var(--accent-cyan)","var(--accent-violet)","#ff8c42","var(--danger)","var(--success)","#ffd700"],ML=[q0,u0,ek,oT,rT];function xL(){const{t:e}=Jo(),n=e("howItWorks.steps");return L.jsxs("div",{className:"how-it-works page-container",children:[L.jsxs("div",{className:"animate-in",children:[L.jsx("h1",{className:"page-title",children:e("howItWorks.title")}),L.jsx("p",{className:"page-subtitle",children:e("howItWorks.subtitle")})]}),L.jsxs("div",{className:"principle-card glass-card animate-in animate-in-delay-1",children:[L.jsx("div",{className:"principle-icon",children:L.jsx(sT,{size:28})}),L.jsxs("div",{className:"principle-content",children:[L.jsx("h2",{className:"principle-title",children:e("howItWorks.corePrinciple")}),L.jsx("p",{className:"principle-text",children:e("howItWorks.corePrincipleText")})]})]}),L.jsxs("div",{className:"comparison-section animate-in animate-in-delay-2",children:[L.jsxs("div",{className:"comparison-card glass-card comparison-old",children:[L.jsx("h3",{children:e("howItWorks.traditionalDetection")}),L.jsx("ul",{children:e("howItWorks.traditionalItems").map((t,s)=>L.jsx("li",{className:"comparison-fail",children:t},s))})]}),L.jsx("div",{className:"comparison-vs",children:"VS"}),L.jsxs("div",{className:"comparison-card glass-card comparison-new",children:[L.jsx("h3",{children:e("howItWorks.qalqanDetection")}),L.jsx("ul",{children:e("howItWorks.qalqanItems").map((t,s)=>L.jsx("li",{className:"comparison-pass",children:t},s))})]})]}),L.jsx("div",{className:"pipeline animate-in animate-in-delay-3",children:n.map((t,s)=>{const i=bL[s],l=wL[s],c=String(s+1).padStart(2,"0");return L.jsxs("div",{className:"pipeline-step",children:[L.jsxs("div",{className:"step-connector",children:[L.jsx("div",{className:"step-num",style:{background:`${l}15`,color:l,borderColor:`${l}40`},children:c}),s<n.length-1&&L.jsx("div",{className:"step-line"})]}),L.jsxs("div",{className:"step-card glass-card",children:[L.jsxs("div",{className:"step-header",children:[L.jsx("div",{className:"step-icon",style:{background:`${l}15`,color:l},children:L.jsx(i,{size:20})}),L.jsx("h3",{className:"step-title",children:t.title})]}),L.jsx("p",{className:"step-description",children:t.description}),t.details&&L.jsx("div",{className:"step-details",children:t.details.map((u,d)=>L.jsx("span",{className:"step-detail-tag",children:u},d))}),t.categories&&L.jsx("div",{className:"step-categories",children:t.categories.map((u,d)=>{const f=ML[d];return L.jsxs("div",{className:"category-block",children:[L.jsxs("div",{className:"category-header",children:[L.jsx(f,{size:14}),L.jsx("span",{children:u.label})]}),L.jsx("div",{className:"category-items",children:u.items.map((m,_)=>L.jsx("span",{className:"category-item",children:m},_))})]},d)})}),t.scoreExample&&L.jsxs("div",{className:"score-example",children:[t.scoreExample.map((u,d)=>L.jsxs("div",{className:"score-row",children:[L.jsx("span",{className:"score-reason",children:u.reason}),L.jsx("span",{className:"score-weight",children:u.weight})]},d)),L.jsxs("div",{className:"score-total",children:[L.jsx("span",{children:e("howItWorks.totalRiskScore")}),L.jsx("span",{className:"score-total-value",children:"80 / 100"})]})]})]})]},c)})}),L.jsxs("div",{className:"thesis-section glass-card animate-in animate-in-delay-4",children:[L.jsx("h3",{className:"thesis-title",children:e("howItWorks.whyInfraBeatsContent")}),L.jsx("p",{className:"thesis-text",children:e("howItWorks.whyInfraText")})]})]})}const R_={Casino:"#ff6b81",Scam:"#ffa502",Phishing:"#ff4757",Pyramid:"#a855f7",Unknown:"#888"};function TL(){const[e,n]=Me.useState(""),[t,s]=Me.useState("All"),[i,l]=Me.useState("All"),[c,u]=Me.useState("risk"),[d,f]=Me.useState("desc"),[m,_]=Me.useState([]),[p,y]=Me.useState(!0),{t:v}=Jo();Me.useEffect(()=>{try{const w=YS().map((C,P)=>({id:P+1,...C}));_(w)}catch{_([])}y(!1)},[]);const T=w=>{c===w?f(d==="asc"?"desc":"asc"):(u(w),f("desc"))},k=({field:w})=>c!==w?null:d==="asc"?L.jsx(V_,{size:12}):L.jsx(cm,{size:12}),b=Me.useMemo(()=>{let w=[...m];if(e){const C=e.toLowerCase();w=w.filter(P=>P.domain.toLowerCase().includes(C)||(P.cluster||"").toLowerCase().includes(C))}return t!=="All"&&(w=w.filter(C=>C.category===t)),i!=="All"&&(w=w.filter(C=>C.tier===i)),w.sort((C,P)=>{let A=C[c],I=P[c];return typeof A=="string"&&(A=A.toLowerCase()),typeof I=="string"&&(I=I.toLowerCase()),A<I?d==="asc"?-1:1:A>I?d==="asc"?1:-1:0}),w},[m,e,t,i,c,d]),S=w=>{let C,P,A;if(w==="csv"){const q=`Domain,Category,Risk,Tier,Status,Detected,Cluster,Markers
`,Z=b.map(X=>`${X.domain},${X.category},${X.risk},${X.tier},${X.status},${X.detectedDate},${X.cluster},${X.markers}`).join(`
`);C=q+Z,P="qalqanai-blocklist.csv",A="text/csv"}else C=JSON.stringify(b,null,2),P="qalqanai-blocklist.json",A="application/json";const I=new Blob([C],{type:A}),W=URL.createObjectURL(I),G=document.createElement("a");G.href=W,G.download=P,G.click(),URL.revokeObjectURL(W)},$=["All",...new Set(m.map(w=>w.category))];return p?L.jsxs("div",{className:"blocklist page-container",children:[L.jsx("h1",{className:"page-title",children:v("blocklist.title")}),L.jsxs("div",{className:"loading-state",children:[L.jsx("div",{className:"loading-spinner"}),L.jsx("p",{children:v("blocklist.loading")})]})]}):L.jsxs("div",{className:"blocklist page-container",children:[L.jsxs("div",{className:"blocklist-header animate-in",children:[L.jsxs("div",{children:[L.jsx("h1",{className:"page-title",children:v("blocklist.title")}),L.jsxs("p",{className:"page-subtitle",children:[L.jsx(QP,{size:14})," ",b.length," ",v("blocklist.of")," ",m.length," ",v("blocklist.subtitle")]})]}),L.jsxs("div",{className:"export-buttons",children:[L.jsxs("button",{className:"btn-secondary",onClick:()=>S("csv"),children:[L.jsx(gb,{size:14})," ",v("blocklist.exportCSV")]}),L.jsxs("button",{className:"btn-secondary",onClick:()=>S("json"),children:[L.jsx(gb,{size:14})," ",v("blocklist.exportJSON")]})]})]}),L.jsxs("div",{className:"filter-bar glass-card animate-in animate-in-delay-1",children:[L.jsxs("div",{className:"search-wrapper",children:[L.jsx(_g,{size:16}),L.jsx("input",{type:"text",placeholder:v("blocklist.searchPlaceholder"),value:e,onChange:w=>n(w.target.value)})]}),L.jsxs("div",{className:"filter-group",children:[L.jsx(ZP,{size:14}),L.jsx("select",{value:t,onChange:w=>s(w.target.value),children:$.map(w=>L.jsx("option",{value:w,children:w},w))}),L.jsxs("select",{value:i,onChange:w=>l(w.target.value),children:[L.jsx("option",{value:"All",children:v("blocklist.allTiers")}),L.jsx("option",{value:"A",children:"Tier A"}),L.jsx("option",{value:"B",children:"Tier B"}),L.jsx("option",{value:"C",children:"Tier C"})]})]})]}),L.jsx("div",{className:"blocklist-table-wrapper glass-card animate-in animate-in-delay-2",children:L.jsxs("table",{className:"blocklist-table",children:[L.jsx("thead",{children:L.jsxs("tr",{children:[L.jsxs("th",{onClick:()=>T("domain"),children:[v("blocklist.domain")," ",L.jsx(k,{field:"domain"})]}),L.jsxs("th",{onClick:()=>T("category"),children:[v("blocklist.category")," ",L.jsx(k,{field:"category"})]}),L.jsxs("th",{onClick:()=>T("risk"),children:[v("blocklist.risk")," ",L.jsx(k,{field:"risk"})]}),L.jsxs("th",{onClick:()=>T("tier"),children:[v("blocklist.tier")," ",L.jsx(k,{field:"tier"})]}),L.jsxs("th",{onClick:()=>T("status"),children:[v("blocklist.status")," ",L.jsx(k,{field:"status"})]}),L.jsxs("th",{onClick:()=>T("detectedDate"),children:[v("blocklist.detected")," ",L.jsx(k,{field:"detectedDate"})]}),L.jsx("th",{children:v("blocklist.cluster")}),L.jsx("th",{children:v("blocklist.markers")})]})}),L.jsx("tbody",{children:b.map(w=>L.jsxs("tr",{children:[L.jsxs("td",{className:"td-domain",children:[L.jsx(Tu,{size:12,style:{color:R_[w.category]||"#888"}}),w.domain]}),L.jsx("td",{children:L.jsx("span",{className:"badge",style:{background:`${R_[w.category]||"#888"}20`,color:R_[w.category]||"#888",border:`1px solid ${R_[w.category]||"#888"}40`},children:w.category})}),L.jsx("td",{children:L.jsxs("div",{className:"risk-cell",children:[L.jsx("div",{className:"risk-bar",children:L.jsx("div",{className:"risk-bar-fill",style:{width:`${w.risk}%`,background:w.risk>=80?"var(--danger)":w.risk>=50?"var(--warning)":"var(--success)"}})}),L.jsx("span",{children:w.risk})]})}),L.jsx("td",{children:L.jsx("span",{className:`tier-badge tier-${w.tier.toLowerCase()}`,children:w.tier})}),L.jsx("td",{children:L.jsx("span",{className:`status-label status-${w.status.toLowerCase().replace(/\s/g,"-")}`,children:w.status})}),L.jsx("td",{className:"td-date",children:w.detectedDate}),L.jsx("td",{className:"td-cluster",children:w.cluster}),L.jsx("td",{className:"td-markers",children:w.markers})]},w.id))})]})}),L.jsxs("div",{className:"blocklist-disclaimer animate-in animate-in-delay-3",children:[L.jsx(Tu,{size:14}),L.jsx("p",{children:v("blocklist.disclaimer")})]})]})}function EL(){const[e,n]=Me.useState({name:"",email:"",subject:"",message:""}),[t,s]=Me.useState(!1),{t:i}=Jo(),l=c=>{c.preventDefault(),s(!0),setTimeout(()=>s(!1),4e3),n({name:"",email:"",subject:"",message:""})};return L.jsxs("div",{className:"contact page-container",children:[L.jsxs("div",{className:"contact-hero animate-in",children:[L.jsx("h1",{className:"page-title",children:i("contact.title")}),L.jsx("p",{className:"page-subtitle",children:i("contact.subtitle")})]}),L.jsxs("div",{className:"contact-grid animate-in animate-in-delay-1",children:[L.jsxs("div",{className:"contact-info",children:[L.jsxs("div",{className:"info-card glass-card",children:[L.jsx("div",{className:"info-icon",children:L.jsx(ok,{size:20})}),L.jsxs("div",{children:[L.jsx("h3",{children:i("contact.email")}),L.jsx("a",{href:"mailto:team@qalqanai.com",children:"team@qalqanai.com"})]})]}),L.jsxs("div",{className:"info-card glass-card",children:[L.jsx("div",{className:"info-icon",children:L.jsx(nk,{size:20})}),L.jsxs("div",{children:[L.jsx("h3",{children:i("contact.github")}),L.jsx("a",{href:"https://github.com/AkimAlikhan/QalqanAI",target:"_blank",rel:"noreferrer",children:"AkimAlikhan/QalqanAI"})]})]}),L.jsxs("div",{className:"info-card glass-card",children:[L.jsx("div",{className:"info-icon",children:L.jsx(ck,{size:20})}),L.jsxs("div",{children:[L.jsx("h3",{children:i("contact.location")}),L.jsx("p",{children:i("contact.locationValue")})]})]}),L.jsxs("div",{className:"info-card glass-card",children:[L.jsx("div",{className:"info-icon",children:L.jsx(c0,{size:20})}),L.jsxs("div",{children:[L.jsx("h3",{children:i("contact.responseTime")}),L.jsx("p",{children:i("contact.responseTimeValue")})]})]}),L.jsxs("div",{className:"team-card glass-card",children:[L.jsxs("h3",{className:"team-title",children:[L.jsx(um,{size:16})," ",i("contact.coreTeam")]}),i("contact.team").map((c,u)=>L.jsxs("div",{className:"team-member",children:[L.jsx("div",{className:"member-avatar",children:c.initials}),L.jsxs("div",{children:[L.jsx("h4",{children:c.name}),L.jsx("p",{children:c.role})]})]},u))]})]}),L.jsxs("div",{className:"contact-form-card glass-card",children:[L.jsx("h2",{className:"form-title",children:i("contact.sendMessage")}),t?L.jsxs("div",{className:"form-success animate-in",children:[L.jsx(f0,{size:32,style:{color:"var(--success)"}}),L.jsx("h3",{children:i("contact.messageSent")}),L.jsx("p",{children:i("contact.messageReply")})]}):L.jsxs("form",{onSubmit:l,children:[L.jsxs("div",{className:"form-row",children:[L.jsxs("div",{className:"form-group",children:[L.jsx("label",{children:i("contact.name")}),L.jsx("input",{type:"text",value:e.name,onChange:c=>n({...e,name:c.target.value}),placeholder:i("contact.namePlaceholder"),required:!0})]}),L.jsxs("div",{className:"form-group",children:[L.jsx("label",{children:i("contact.emailLabel")}),L.jsx("input",{type:"email",value:e.email,onChange:c=>n({...e,email:c.target.value}),placeholder:i("contact.emailPlaceholder"),required:!0})]})]}),L.jsxs("div",{className:"form-group",children:[L.jsx("label",{children:i("contact.subject")}),L.jsx("input",{type:"text",value:e.subject,onChange:c=>n({...e,subject:c.target.value}),placeholder:i("contact.subjectPlaceholder"),required:!0})]}),L.jsxs("div",{className:"form-group",children:[L.jsx("label",{children:i("contact.message")}),L.jsx("textarea",{rows:5,value:e.message,onChange:c=>n({...e,message:c.target.value}),placeholder:i("contact.messagePlaceholder"),required:!0})]}),L.jsxs("button",{type:"submit",className:"btn-primary submit-btn",children:[L.jsx(f0,{size:16})," ",i("contact.send")]})]})]})]})]})}const Z_={a:["4","@","","","","","","","",""],b:["d","6",""],c:["k","","",""],d:["b","cl",""],e:["3","","","","","","",""],f:["ph"],g:["9","q","",""],h:["n",""],i:["1","l","!","|","","","","",""],j:[""],k:["c",""],l:["1","i","|",""],m:["rn","nn",""],n:["m","","",""],o:["0","","","","","","",""],p:["q",""],q:["p","g"],r:["",""],s:["5","$","","","",""],t:["7","+","","",""],u:["v","","","","","",""],v:["u",""],w:["vv","","",""],x:["",""],y:["","",""],z:["2","","",""]},SL={a:["q","w","s","z"],b:["v","g","h","n"],c:["x","d","f","v"],d:["s","e","r","f","c","x"],e:["w","s","d","r"],f:["d","r","t","g","v","c"],g:["f","t","y","h","b","v"],h:["g","y","u","j","n","b"],i:["u","j","k","o"],j:["h","u","i","k","m","n"],k:["j","i","o","l","m"],l:["k","o","p"],m:["n","j","k"],n:["b","h","j","m"],o:["i","k","l","p"],p:["o","l"],q:["w","a"],r:["e","d","f","t"],s:["a","w","e","d","x","z"],t:["r","f","g","y"],u:["y","h","j","i"],v:["c","f","g","b"],w:["q","a","s","e"],x:["z","s","d","c"],y:["t","g","h","u"],z:["a","s","x"]},gu=["com","net","org","info","xyz","top","ru","cn","tk","ml","ga","cf","gq","io","co","me","biz","pro","site","online","live","club","app","dev","store","shop","tech","space","fun","website","link","click","win","bid","trade","loan","download","stream","racing","review","party","date","faith","science","work","rocks","pw","cc","ws","mobi","asia","in","uk","de","fr","es","it","br","kz","ua","by"],CL=["secure-","login-","my-","www-","official-","real-","account-","verify-","auth-","signin-","update-"],AL=["-login","-secure","-verify","-official","-online","-app","-portal","-web","-site","-info","-help"];function PL(e){const n=e.split(".");if(n.length<2)return{name:e,tld:"com"};const t=n.slice(-1)[0];return{name:n.slice(0,-1).join("."),tld:t}}function*Sx(e){for(let n=0;n<e.length;n++){const t=e[n],s=Z_[t];if(s)for(const i of s)yield e.slice(0,n)+i+e.slice(n+1)}}function*Cx(e){for(let n=0;n<e.length;n++)e[n]==="."||e[n]==="-"||(yield e.slice(0,n)+e.slice(n+1))}function*Ax(e){for(let n=0;n<e.length;n++){const t=e[n],s=SL[t];if(s)for(const i of s)yield e.slice(0,n)+i+e.slice(n+1)}}function*Px(e){for(let n=0;n<e.length-1;n++)e[n]!==e[n+1]&&(yield e.slice(0,n)+e[n+1]+e[n]+e.slice(n+2))}function*kx(e){for(let n=0;n<e.length;n++)e[n]==="."||e[n]==="-"||(yield e.slice(0,n)+e[n]+e[n]+e.slice(n+1))}function*kL(e){for(let n=1;n<e.length;n++)e[n]==="."||e[n-1]==="."||e[n]==="-"||e[n-1]==="-"||(yield e.slice(0,n)+"-"+e.slice(n))}function*$L(e,n){for(const t of gu)t!==n&&(yield{fullDomain:`${e}.${t}`,strategy:"TLD swap"})}function*DL(e){for(const n of CL)yield n+e;for(const n of AL)yield e+n}function*OL(e){const n=e.split(""),t=[];for(let s=0;s<n.length;s++)Z_[n[s]]&&t.push(s);for(let s=0;s<t.length;s++)for(let i=s+1;i<t.length;i++){const l=t[s],c=t[i],u=Z_[n[l]],d=Z_[n[c]];if(!u.length||!d.length)continue;const f=[...n];f[l]=u[0],f[c]=d[0],yield f.join("")}}function*$x(e){const n=["a","e","i","o","u"];for(let t=0;t<e.length;t++)if(n.includes(e[t]))for(const s of n)s!==e[t]&&(yield e.slice(0,t)+s+e.slice(t+1))}function EC(e,n=1e4){const{name:t,tld:s}=PL(e),i=new Set;i.add(e);const l=[];function c(f,m){const _=`${f}.${s}`;_.length<3||_.length>63||i.has(_)||/^[a-z0-9][a-z0-9.-]*[a-z0-9]$/i.test(_)&&(i.add(_),l.push({domain:_,strategy:m}))}function u(f,m){f.length<3||f.length>63||i.has(f)||/^[a-z0-9][a-z0-9.-]*[a-z0-9]$/i.test(f)&&(i.add(f),l.push({domain:f,strategy:m}))}const d=[{gen:Sx(t),label:"Homoglyph"},{gen:Cx(t),label:"Omission"},{gen:Ax(t),label:"Keyboard typo"},{gen:Px(t),label:"Transposition"},{gen:kx(t),label:"Duplication"},{gen:kL(t),label:"Hyphen insertion"},{gen:DL(t),label:"Prefix/Suffix"},{gen:OL(t),label:"Double homoglyph"},{gen:$x(t),label:"Vowel swap"}];for(const{gen:f,label:m}of d)for(const _ of f)if(c(_,m),l.length>=n)return l;for(const{fullDomain:f,strategy:m}of $L(t,s))if(u(f,m),l.length>=n)return l;if(l.length<n){for(const f of Sx(t))for(const m of gu.slice(0,20))if(m!==s&&(u(`${f}.${m}`,"Homoglyph + TLD"),l.length>=n))return l}if(l.length<n){for(const f of Ax(t))for(const m of gu.slice(0,15))if(m!==s&&(u(`${f}.${m}`,"Typo + TLD"),l.length>=n))return l}if(l.length<n){for(const f of Cx(t))for(const m of gu.slice(0,15))if(m!==s&&(u(`${f}.${m}`,"Omission + TLD"),l.length>=n))return l}if(l.length<n){for(const f of kx(t))for(const m of gu.slice(0,15))if(m!==s&&(u(`${f}.${m}`,"Duplication + TLD"),l.length>=n))return l}if(l.length<n){for(const f of Px(t))for(const m of gu.slice(0,15))if(m!==s&&(u(`${f}.${m}`,"Transposition + TLD"),l.length>=n))return l}if(l.length<n){for(const f of $x(t))for(const m of gu.slice(0,15))if(m!==s&&(u(`${f}.${m}`,"Vowel + TLD"),l.length>=n))return l}return l}async function IL(e){try{const n=await fetch(`https://cloudflare-dns.com/dns-query?name=${encodeURIComponent(e)}&type=A`,{headers:{Accept:"application/dns-json"}});if(!n.ok)return null;const t=await n.json();if(t.Status===3)return null;if(t.Status===0&&t.Answer&&t.Answer.length>0){const s=t.Answer.find(i=>i.type===1);return{ip:s?s.data:"unknown"}}return t.Status===0?{ip:"no-A-record"}:null}catch{return null}}async function zL(e,{onProgress:n,onFound:t,onComplete:s},i){const l=EC(e,1e4),c=l.length,u=[];let d=0;const f=15;for(let m=0;m<c&&!i?.aborted;m+=f){const _=l.slice(m,m+f),p=await Promise.allSettled(_.map(async y=>{if(i?.aborted)return null;const v=await IL(y.domain);return v?{...y,...v}:null}));for(const y of p)if(d++,y.status==="fulfilled"&&y.value){const T={Homoglyph:85,Omission:70,"Keyboard typo":65,Transposition:60,Duplication:55,"Hyphen insertion":50,"TLD swap":75,"Prefix/Suffix":80,"Double homoglyph":90,"Vowel swap":60,"Homoglyph + TLD":92,"Typo + TLD":72,"Omission + TLD":68,"Duplication + TLD":58,"Transposition + TLD":62,"Vowel + TLD":58}[y.value.strategy]||50,k=Math.min(99,T+Math.floor(Math.random()*10)-3),b={...y.value,risk:k};u.push(b),t?.(b)}n?.(Math.min(d,c),c),m+f<c&&!i?.aborted&&await new Promise(y=>setTimeout(y,50))}return s?.(u),u}const Dx=e=>e>=80?"var(--danger)":e>=60?"var(--warning)":"var(--success)",LL={Homoglyph:"","Double homoglyph":"",Omission:"","Keyboard typo":"",Transposition:"",Duplication:"","Hyphen insertion":"","TLD swap":"","Prefix/Suffix":"","Vowel swap":"","Homoglyph + TLD":"","Typo + TLD":"","Omission + TLD":"","Duplication + TLD":"","Transposition + TLD":"","Vowel + TLD":""};function FL(){const[e,n]=Me.useState(""),[t,s]=Me.useState(!1),[i,l]=Me.useState({checked:0,total:0}),[c,u]=Me.useState([]),[d,f]=Me.useState(!1),[m,_]=Me.useState("risk"),[p,y]=Me.useState("desc"),[v,T]=Me.useState("all"),k=Me.useRef(null),{t:b}=Jo(),S=Me.useCallback(async q=>{q.preventDefault();const Z=e.trim().toLowerCase().replace(/^https?:\/\//,"").replace(/^www\./,"").split("/")[0];if(!Z||!Z.includes("."))return;s(!0),u([]),l({checked:0,total:0}),f(!0);const X=new AbortController;k.current=X;const Q=EC(Z,1e4);l({checked:0,total:Q.length});try{await zL(Z,{onProgress:(te,R)=>{l({checked:te,total:R})},onFound:te=>{u(R=>[...R,te])},onComplete:()=>{s(!1)}},X.signal)}catch{s(!1)}},[e]),$=()=>{k.current?.abort(),s(!1)},w=v==="all"?c:c.filter(q=>q.strategy===v),C=[...w].sort((q,Z)=>{const X=p==="asc"?1:-1;return m==="risk"?(Z.risk-q.risk)*X:m==="domain"?q.domain.localeCompare(Z.domain)*X:m==="strategy"?q.strategy.localeCompare(Z.strategy)*X:0}),P=q=>{m===q?y(Z=>Z==="asc"?"desc":"asc"):(_(q),y("desc"))},A=[...new Set(c.map(q=>q.strategy))],I=i.total>0?(i.checked/i.total*100).toFixed(1):0,W=c.filter(q=>q.risk>=80).length,G=c.filter(q=>q.risk>=60&&q.risk<80).length;return L.jsxs("div",{className:"deep-analyze page-container",children:[L.jsx("header",{className:"da-header animate-in",children:L.jsxs("div",{children:[L.jsx("h1",{className:"page-title",children:b("deepAnalyze.title")}),L.jsxs("p",{className:"page-subtitle",children:[L.jsx(Ek,{size:14}),b("deepAnalyze.subtitle")]})]})}),L.jsxs("section",{className:"da-search animate-in animate-in-delay-1",children:[L.jsx("form",{className:"da-form",onSubmit:S,children:L.jsxs("div",{className:"da-input-wrapper glass-card",children:[L.jsx(eg,{size:18,className:"da-input-icon"}),L.jsx("input",{type:"text",className:"da-input",placeholder:b("deepAnalyze.placeholder"),value:e,onChange:q=>n(q.target.value),disabled:t}),t?L.jsxs("button",{type:"button",className:"da-stop-btn",onClick:$,children:[L.jsx(tT,{size:16,className:"spin"})," ",b("deepAnalyze.stop")]}):L.jsxs("button",{type:"submit",className:"btn-primary da-scan-btn",disabled:!e.trim(),children:[L.jsx(Ok,{size:16})," ",b("deepAnalyze.deepScan")]})]})}),L.jsxs("div",{className:"da-info-chips",children:[L.jsxs("span",{className:"da-chip",children:[L.jsx(_g,{size:12})," ",b("deepAnalyze.checksVariants")]}),L.jsxs("span",{className:"da-chip",children:[L.jsx(um,{size:12})," ",b("deepAnalyze.realDNS")]}),L.jsxs("span",{className:"da-chip",children:[L.jsx(u0,{size:12})," ",b("deepAnalyze.strategies")]})]})]}),(t||d)&&L.jsx("section",{className:"da-progress animate-in animate-in-delay-2",children:L.jsxs("div",{className:"da-progress-bar-wrapper glass-card",children:[L.jsxs("div",{className:"da-progress-header",children:[L.jsxs("div",{className:"da-progress-stats",children:[L.jsx("span",{className:"da-progress-label",children:b(t?"deepAnalyze.scanning":"deepAnalyze.scanComplete")}),L.jsxs("span",{className:"da-progress-count",children:[i.checked.toLocaleString()," / ",i.total.toLocaleString()," ",b("deepAnalyze.variants")]})]}),L.jsxs("span",{className:"da-progress-pct",children:[I,"%"]})]}),L.jsx("div",{className:"da-progress-track",children:L.jsx("div",{className:`da-progress-fill ${t?"scanning":""}`,style:{width:`${I}%`}})}),L.jsxs("div",{className:"da-summary-row",children:[L.jsxs("div",{className:"da-summary-badge",children:[L.jsx(eg,{size:14}),L.jsx("span",{className:"da-summary-value",children:c.length}),L.jsx("span",{className:"da-summary-label",children:b("deepAnalyze.foundAlive")})]}),L.jsxs("div",{className:"da-summary-badge danger",children:[L.jsx(Tu,{size:14}),L.jsx("span",{className:"da-summary-value",children:W}),L.jsx("span",{className:"da-summary-label",children:b("deepAnalyze.highRisk")})]}),L.jsxs("div",{className:"da-summary-badge warning",children:[L.jsx(um,{size:14}),L.jsx("span",{className:"da-summary-value",children:G}),L.jsx("span",{className:"da-summary-label",children:b("deepAnalyze.mediumRisk")})]}),L.jsxs("div",{className:"da-summary-badge safe",children:[L.jsx(u0,{size:14}),L.jsx("span",{className:"da-summary-value",children:c.length-W-G}),L.jsx("span",{className:"da-summary-label",children:b("deepAnalyze.lowRisk")})]})]})]})}),c.length>0&&L.jsxs("section",{className:"da-results animate-in animate-in-delay-3",children:[L.jsxs("div",{className:"da-results-header",children:[L.jsxs("h2",{className:"da-results-title",children:[L.jsx(Tu,{size:20}),b("deepAnalyze.foundDomains")," (",w.length,")"]}),L.jsx("div",{className:"da-results-filters",children:L.jsxs("select",{className:"da-filter-select",value:v,onChange:q=>T(q.target.value),children:[L.jsx("option",{value:"all",children:b("deepAnalyze.allStrategies")}),A.map(q=>L.jsx("option",{value:q,children:q},q))]})})]}),L.jsx("div",{className:"da-results-table-wrapper glass-card",children:L.jsxs("table",{className:"da-results-table",children:[L.jsx("thead",{children:L.jsxs("tr",{children:[L.jsxs("th",{onClick:()=>P("domain"),children:[b("deepAnalyze.domain")," ",m==="domain"&&(p==="asc"?L.jsx(V_,{size:12}):L.jsx(cm,{size:12}))]}),L.jsxs("th",{onClick:()=>P("strategy"),children:[b("deepAnalyze.strategy")," ",m==="strategy"&&(p==="asc"?L.jsx(V_,{size:12}):L.jsx(cm,{size:12}))]}),L.jsxs("th",{onClick:()=>P("risk"),children:[b("deepAnalyze.risk")," ",m==="risk"&&(p==="asc"?L.jsx(V_,{size:12}):L.jsx(cm,{size:12}))]}),L.jsx("th",{children:"IP"}),L.jsx("th",{})]})}),L.jsx("tbody",{children:C.map((q,Z)=>L.jsxs("tr",{className:"da-result-row",children:[L.jsx("td",{className:"da-cell-domain",children:L.jsx("span",{className:"da-domain-text",children:q.domain})}),L.jsx("td",{className:"da-cell-strategy",children:L.jsxs("span",{className:"da-strategy-badge",children:[LL[q.strategy]||""," ",q.strategy]})}),L.jsx("td",{className:"da-cell-risk",children:L.jsxs("div",{className:"da-risk-indicator",children:[L.jsx("span",{className:"da-risk-value",style:{color:Dx(q.risk)},children:q.risk}),L.jsx("div",{className:"da-risk-bar",children:L.jsx("div",{className:"da-risk-bar-fill",style:{width:`${q.risk}%`,background:Dx(q.risk)}})})]})}),L.jsx("td",{className:"da-cell-ip",children:L.jsxs("span",{className:"da-ip-text",children:[L.jsx(q0,{size:12})," ",q.ip]})}),L.jsx("td",{className:"da-cell-action",children:L.jsx("a",{href:`#/analysis?url=${encodeURIComponent(q.domain)}`,className:"da-analyze-link",title:"Analyze this domain",children:L.jsx(aT,{size:14})})})]},q.domain+Z))})]})})]}),d&&!t&&c.length===0&&L.jsxs("div",{className:"da-empty animate-in",children:[L.jsx(um,{size:48}),L.jsx("h3",{children:b("deepAnalyze.noClonesFound")}),L.jsx("p",{children:b("deepAnalyze.noClonesDesc")})]})]})}function NL(){return L.jsx(SP,{children:L.jsx(_P,{children:L.jsxs("div",{className:"app-layout",children:[L.jsx(Fk,{}),L.jsx(Ik,{}),L.jsx("main",{className:"main-content",children:L.jsxs(WA,{children:[L.jsx(sc,{path:"/",element:L.jsx(oD,{})}),L.jsx(sc,{path:"/analysis",element:L.jsx(cD,{})}),L.jsx(sc,{path:"/deep-analyze",element:L.jsx(FL,{})}),L.jsx(sc,{path:"/ecosystem",element:L.jsx(vL,{})}),L.jsx(sc,{path:"/how-it-works",element:L.jsx(xL,{})}),L.jsx(sc,{path:"/blocklist",element:L.jsx(TL,{})}),L.jsx(sc,{path:"/contact",element:L.jsx(EL,{})})]})}),L.jsx(rD,{})]})})})}KC.createRoot(document.getElementById("root")).render(L.jsx(Me.StrictMode,{children:L.jsx(NL,{})}));
